/*! For license information please see gwebgl.min.js.LICENSE.txt */
(()=>{var e={9296:e=>{"use strict";e.exports=n,e.exports.default=n;var t=1e20;function n(e,t,n,r,i,o){this.fontSize=e||24,this.buffer=void 0===t?3:t,this.cutoff=r||.25,this.fontFamily=i||"sans-serif",this.fontWeight=o||"normal",this.radius=n||8;var a=this.size=this.fontSize+2*this.buffer,s=a+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(s*s),this.gridInner=new Float64Array(s*s),this.f=new Float64Array(s),this.z=new Float64Array(s+1),this.v=new Uint16Array(s),this.useMetrics=void 0!==this.ctx.measureText("A").actualBoundingBoxLeft,this.middle=Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function r(e,t,n,r,o,a){for(var s=0;s<t;s++)i(e,s,t,n,r,o,a);for(var u=0;u<n;u++)i(e,u*t,1,t,r,o,a)}function i(e,n,r,i,o,a,s){var u,c,l,h;for(a[0]=0,s[0]=-t,s[1]=t,u=0;u<i;u++)o[u]=e[n+u*r];for(u=1,c=0,l=0;u<i;u++){do{h=a[c],l=(o[u]-o[h]+u*u-h*h)/(u-h)/2}while(l<=s[c]&&--c>-1);a[++c]=u,s[c]=l,s[c+1]=t}for(u=0,c=0;u<i;u++){for(;s[c+1]<u;)c++;h=a[c],e[n+u*r]=o[h]+(u-h)*(u-h)}}n.prototype._draw=function(e,n){var i,o,a,s,u,c,l,h,f,d=this.ctx.measureText(e),p=d.width,v=2*this.buffer;n&&this.useMetrics?(u=Math.floor(d.actualBoundingBoxAscent),h=this.buffer+Math.ceil(d.actualBoundingBoxAscent),c=this.buffer,l=this.buffer,i=(o=Math.min(this.size,Math.ceil(d.actualBoundingBoxRight-d.actualBoundingBoxLeft)))+v,a=(s=Math.min(this.size-c,Math.ceil(d.actualBoundingBoxAscent+d.actualBoundingBoxDescent)))+v,this.ctx.textBaseline="alphabetic"):(i=o=this.size,a=s=this.size,u=19*this.fontSize/24,c=l=0,h=this.middle,this.ctx.textBaseline="middle"),o&&s&&(this.ctx.clearRect(l,c,o,s),this.ctx.fillText(e,this.buffer,h),f=this.ctx.getImageData(l,c,o,s));var g=new Uint8ClampedArray(i*a);return function(e,n,r,i,o,a,s){a.fill(t,0,n*r),s.fill(0,0,n*r);for(var u=(n-i)/2,c=0;c<o;c++)for(var l=0;l<i;l++){var h=(c+u)*n+l+u,f=e.data[4*(c*i+l)+3]/255;if(1===f)a[h]=0,s[h]=t;else if(0===f)a[h]=t,s[h]=0;else{var d=Math.max(0,.5-f),p=Math.max(0,f-.5);a[h]=d*d,s[h]=p*p}}}(f,i,a,o,s,this.gridOuter,this.gridInner),r(this.gridOuter,i,a,this.f,this.v,this.z),r(this.gridInner,i,a,this.f,this.v,this.z),function(e,t,n,r,i,o,a){for(var s=0;s<t*n;s++){var u=Math.sqrt(r[s])-Math.sqrt(i[s]);e[s]=Math.round(255-255*(u/o+a))}}(g,i,a,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:g,metrics:{width:o,height:s,sdfWidth:i,sdfHeight:a,top:u,left:0,advance:p}}},n.prototype.draw=function(e){return this._draw(e,!1).data},n.prototype.drawWithMetrics=function(e){return this._draw(e,!0)}},9187:e=>{"use strict";function t(e,t,o){o=o||2;var a,s,u,h,f,p,v,g=t&&t.length,_=g?t[0]*o:e.length,y=n(e,0,_,o,!0),m=[];if(!y||y.next===y.prev)return m;if(g&&(y=function(e,t,i,o){var a,s,u,h=[];for(a=0,s=t.length;a<s;a++)(u=n(e,t[a]*o,a<s-1?t[a+1]*o:e.length,o,!1))===u.next&&(u.steiner=!0),h.push(d(u));for(h.sort(c),a=0;a<h.length;a++)i=r(i=l(h[a],i),i.next);return i}(e,t,y,o)),e.length>80*o){a=u=e[0],s=h=e[1];for(var E=o;E<_;E+=o)(f=e[E])<a&&(a=f),(p=e[E+1])<s&&(s=p),f>u&&(u=f),p>h&&(h=p);v=0!==(v=Math.max(u-a,h-s))?1/v:0}return i(y,m,o,a,s,v),m}function n(e,t,n,r,i){var o,a;if(i===x(e,t,n,r)>0)for(o=t;o<n;o+=r)a=A(o,e[o],e[o+1],a);else for(o=n-r;o>=t;o-=r)a=A(o,e[o],e[o+1],a);return a&&_(a,a.next)&&(S(a),a=a.next),a}function r(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!_(r,r.next)&&0!==g(r.prev,r,r.next))r=r.next;else{if(S(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function i(e,t,n,c,l,h,d){if(e){!d&&h&&function(e,t,n,r){var i=e;do{null===i.z&&(i.z=f(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,o,a,s,u,c=1;do{for(n=e,e=null,o=null,a=0;n;){for(a++,r=n,s=0,t=0;t<c&&(s++,r=r.nextZ);t++);for(u=c;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;n=r}o.nextZ=null,c*=2}while(a>1)}(i)}(e,c,l,h);for(var p,v,g=e;e.prev!==e.next;)if(p=e.prev,v=e.next,h?a(e,c,l,h):o(e))t.push(p.i/n),t.push(e.i/n),t.push(v.i/n),S(e),e=v.next,g=v.next;else if((e=v)===g){d?1===d?i(e=s(r(e),t,n),t,n,c,l,h,2):2===d&&u(e,t,n,c,l,h):i(r(e),t,n,c,l,h,1);break}}}function o(e){var t=e.prev,n=e,r=e.next;if(g(t,n,r)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(p(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&g(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function a(e,t,n,r){var i=e.prev,o=e,a=e.next;if(g(i,o,a)>=0)return!1;for(var s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,u=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,c=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,l=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,h=f(s,u,t,n,r),d=f(c,l,t,n,r),v=e.prevZ,_=e.nextZ;v&&v.z>=h&&_&&_.z<=d;){if(v!==e.prev&&v!==e.next&&p(i.x,i.y,o.x,o.y,a.x,a.y,v.x,v.y)&&g(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,_!==e.prev&&_!==e.next&&p(i.x,i.y,o.x,o.y,a.x,a.y,_.x,_.y)&&g(_.prev,_,_.next)>=0)return!1;_=_.nextZ}for(;v&&v.z>=h;){if(v!==e.prev&&v!==e.next&&p(i.x,i.y,o.x,o.y,a.x,a.y,v.x,v.y)&&g(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;_&&_.z<=d;){if(_!==e.prev&&_!==e.next&&p(i.x,i.y,o.x,o.y,a.x,a.y,_.x,_.y)&&g(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function s(e,t,n){var i=e;do{var o=i.prev,a=i.next.next;!_(o,a)&&y(o,i,i.next,a)&&T(o,a)&&T(a,o)&&(t.push(o.i/n),t.push(i.i/n),t.push(a.i/n),S(i),S(i.next),i=e=a),i=i.next}while(i!==e);return r(i)}function u(e,t,n,o,a,s){var u=e;do{for(var c=u.next.next;c!==u.prev;){if(u.i!==c.i&&v(u,c)){var l=R(u,c);return u=r(u,u.next),l=r(l,l.next),i(u,t,n,o,a,s),void i(l,t,n,o,a,s)}c=c.next}u=u.next}while(u!==e)}function c(e,t){return e.x-t.x}function l(e,t){var n=function(e,t){var n,r=t,i=e.x,o=e.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a){if(a=s,s===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(i===a)return n;var u,c=n,l=n.x,f=n.y,d=1/0;r=n;do{i>=r.x&&r.x>=l&&i!==r.x&&p(o<f?i:a,o,l,f,o<f?a:i,o,r.x,r.y)&&(u=Math.abs(o-r.y)/(i-r.x),T(r,e)&&(u<d||u===d&&(r.x>n.x||r.x===n.x&&h(n,r)))&&(n=r,d=u)),r=r.next}while(r!==c);return n}(e,t);if(!n)return t;var i=R(n,e),o=r(n,n.next);return r(i,i.next),t===n?o:t}function h(e,t){return g(e.prev,e,t.prev)<0&&g(t.next,e,e.next)<0}function f(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function d(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function p(e,t,n,r,i,o,a,s){return(i-a)*(t-s)-(e-a)*(o-s)>=0&&(e-a)*(r-s)-(n-a)*(t-s)>=0&&(n-a)*(o-s)-(i-a)*(r-s)>=0}function v(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&y(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(T(e,t)&&T(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(g(e.prev,e,t.prev)||g(e,t.prev,t))||_(e,t)&&g(e.prev,e,e.next)>0&&g(t.prev,t,t.next)>0)}function g(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function _(e,t){return e.x===t.x&&e.y===t.y}function y(e,t,n,r){var i=E(g(e,t,n)),o=E(g(e,t,r)),a=E(g(n,r,e)),s=E(g(n,r,t));return i!==o&&a!==s||!(0!==i||!m(e,n,t))||!(0!==o||!m(e,r,t))||!(0!==a||!m(n,e,r))||!(0!==s||!m(n,t,r))}function m(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function E(e){return e>0?1:e<0?-1:0}function T(e,t){return g(e.prev,e,e.next)<0?g(e,t,e.next)>=0&&g(e,e.prev,t)>=0:g(e,t,e.prev)<0||g(e,e.next,t)<0}function R(e,t){var n=new b(e.i,e.x,e.y),r=new b(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function A(e,t,n,r){var i=new b(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function S(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function b(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function x(e,t,n,r){for(var i=0,o=t,a=n-r;o<n;o+=r)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}e.exports=t,e.exports.default=t,t.deviation=function(e,t,n,r){var i=t&&t.length,o=i?t[0]*n:e.length,a=Math.abs(x(e,0,o,n));if(i)for(var s=0,u=t.length;s<u;s++){var c=t[s]*n,l=s<u-1?t[s+1]*n:e.length;a-=Math.abs(x(e,c,l,n))}var h=0;for(s=0;s<r.length;s+=3){var f=r[s]*n,d=r[s+1]*n,p=r[s+2]*n;h+=Math.abs((e[f]-e[p])*(e[d+1]-e[f+1])-(e[f]-e[d])*(e[p+1]-e[f+1]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},t.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var a=0;a<t;a++)n.vertices.push(e[i][o][a]);i>0&&(r+=e[i-1].length,n.holes.push(r))}return n}},6729:e=>{"use strict";var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,r,o,a){if("function"!=typeof r)throw new TypeError("The listener must be a function");var s=new i(r,o||e,a),u=n?n+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],s]:e._events[u].push(s):(e._events[u]=s,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function s(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),s.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,a=new Array(o);i<o;i++)a[i]=r[i].fn;return a},s.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},s.prototype.emit=function(e,t,r,i,o,a){var s=n?n+e:e;if(!this._events[s])return!1;var u,c,l=this._events[s],h=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),h){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,r),!0;case 4:return l.fn.call(l.context,t,r,i),!0;case 5:return l.fn.call(l.context,t,r,i,o),!0;case 6:return l.fn.call(l.context,t,r,i,o,a),!0}for(c=1,u=new Array(h-1);c<h;c++)u[c-1]=arguments[c];l.fn.apply(l.context,u)}else{var f,d=l.length;for(c=0;c<d;c++)switch(l[c].once&&this.removeListener(e,l[c].fn,void 0,!0),h){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,t);break;case 3:l[c].fn.call(l[c].context,t,r);break;case 4:l[c].fn.call(l[c].context,t,r,i);break;default:if(!u)for(f=1,u=new Array(h-1);f<h;f++)u[f-1]=arguments[f];l[c].fn.apply(l[c].context,u)}}return!0},s.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},s.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},s.prototype.removeListener=function(e,t,r,i){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||i&&!s.once||r&&s.context!==r||a(this,o);else{for(var u=0,c=[],l=s.length;u<l;u++)(s[u].fn!==t||i&&!s[u].once||r&&s[u].context!==r)&&c.push(s[u]);c.length?this._events[o]=1===c.length?c[0]:c:a(this,o)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&a(this,t)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,e.exports=s},9934:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tagProperty=t.tagParameter=t.decorate=void 0;var r=n(6674),i=n(6867);function o(e,t,n,i,o){var a={},s="number"==typeof o,u=void 0!==o&&s?o.toString():n;if(s&&void 0!==n)throw new Error(r.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(e,t)&&(a=Reflect.getMetadata(e,t));var c=a[u];if(Array.isArray(c))for(var l=0,h=c;l<h.length;l++){var f=h[l];if(f.key===i.key)throw new Error(r.DUPLICATED_METADATA+" "+f.key.toString())}else c=[];c.push(i),a[u]=c,Reflect.defineMetadata(e,a,t)}function a(e,t){Reflect.decorate(e,t)}function s(e,t){return function(n,r){t(n,r,e)}}t.tagParameter=function(e,t,n,r){o(i.TAGGED,e,t,r,n)},t.tagProperty=function(e,t,n){o(i.TAGGED_PROP,e.constructor,t,n)},t.decorate=function(e,t,n){"number"==typeof n?a([s(n,e)],t):"string"==typeof n?Reflect.decorate([e],t,n):a([e],t)}},5744:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.inject=t.LazyServiceIdentifer=void 0;var r=n(6674),i=n(6867),o=n(7738),a=n(9934),s=function(){function e(e){this._cb=e}return e.prototype.unwrap=function(){return this._cb()},e}();t.LazyServiceIdentifer=s,t.inject=function(e){return function(t,n,s){if(void 0===e)throw new Error(r.UNDEFINED_INJECT_ANNOTATION(t.name));var u=new o.Metadata(i.INJECT_TAG,e);"number"==typeof s?a.tagParameter(t,n,s,u):a.tagProperty(t,n,u)}}},4315:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.injectable=void 0;var r=n(6674),i=n(6867);t.injectable=function(){return function(e){if(Reflect.hasOwnMetadata(i.PARAM_TYPES,e))throw new Error(r.DUPLICATED_INJECTABLE_DECORATOR);var t=Reflect.getMetadata(i.DESIGN_PARAM_TYPES,e)||[];return Reflect.defineMetadata(i.PARAM_TYPES,t,e),e}}},1693:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.multiInject=void 0;var r=n(6867),i=n(7738),o=n(9934);t.multiInject=function(e){return function(t,n,a){var s=new i.Metadata(r.MULTI_INJECT_TAG,e);"number"==typeof a?o.tagParameter(t,n,a,s):o.tagProperty(t,n,s)}}},8085:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.named=void 0;var r=n(6867),i=n(7738),o=n(9934);t.named=function(e){return function(t,n,a){var s=new i.Metadata(r.NAMED_TAG,e);"number"==typeof a?o.tagParameter(t,n,a,s):o.tagProperty(t,n,s)}}},6515:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.optional=void 0;var r=n(6867),i=n(7738),o=n(9934);t.optional=function(){return function(e,t,n){var a=new i.Metadata(r.OPTIONAL_TAG,!0);"number"==typeof n?o.tagParameter(e,t,n,a):o.tagProperty(e,t,a)}}},7014:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.postConstruct=void 0;var r=n(6674),i=n(6867),o=n(7738);t.postConstruct=function(){return function(e,t,n){var a=new o.Metadata(i.POST_CONSTRUCT,t);if(Reflect.hasOwnMetadata(i.POST_CONSTRUCT,e.constructor))throw new Error(r.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(i.POST_CONSTRUCT,a,e.constructor)}}},2052:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tagged=void 0;var r=n(7738),i=n(9934);t.tagged=function(e,t){return function(n,o,a){var s=new r.Metadata(e,t);"number"==typeof a?i.tagParameter(n,o,a,s):i.tagProperty(n,o,s)}}},5638:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.targetName=void 0;var r=n(6867),i=n(7738),o=n(9934);t.targetName=function(e){return function(t,n,a){var s=new i.Metadata(r.NAME_TAG,e);o.tagParameter(t,n,a,s)}}},6757:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.unmanaged=void 0;var r=n(6867),i=n(7738),o=n(9934);t.unmanaged=function(){return function(e,t,n){var a=new i.Metadata(r.UNMANAGED_TAG,!0);o.tagParameter(e,t,n,a)}}},4290:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Binding=void 0;var r=n(8421),i=n(7791),o=function(){function e(e,t){this.id=i.id(),this.activated=!1,this.serviceIdentifier=e,this.scope=t,this.type=r.BindingTypeEnum.Invalid,this.constraint=function(e){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return e.prototype.clone=function(){var t=new e(this.serviceIdentifier,this.scope);return t.activated=t.scope===r.BindingScopeEnum.Singleton&&this.activated,t.implementationType=this.implementationType,t.dynamicValue=this.dynamicValue,t.scope=this.scope,t.type=this.type,t.factory=this.factory,t.provider=this.provider,t.constraint=this.constraint,t.onActivation=this.onActivation,t.cache=this.cache,t},e}();t.Binding=o},3184:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BindingCount=void 0,t.BindingCount={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1}},6674:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.STACK_OVERFLOW=t.CIRCULAR_DEPENDENCY_IN_FACTORY=t.POST_CONSTRUCT_ERROR=t.MULTIPLE_POST_CONSTRUCT_METHODS=t.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=t.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=t.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=t.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=t.ARGUMENTS_LENGTH_MISMATCH=t.INVALID_DECORATOR_OPERATION=t.INVALID_TO_SELF_VALUE=t.INVALID_FUNCTION_BINDING=t.INVALID_MIDDLEWARE_RETURN=t.NO_MORE_SNAPSHOTS_AVAILABLE=t.INVALID_BINDING_TYPE=t.NOT_IMPLEMENTED=t.CIRCULAR_DEPENDENCY=t.UNDEFINED_INJECT_ANNOTATION=t.MISSING_INJECT_ANNOTATION=t.MISSING_INJECTABLE_ANNOTATION=t.NOT_REGISTERED=t.CANNOT_UNBIND=t.AMBIGUOUS_MATCH=t.KEY_NOT_FOUND=t.NULL_ARGUMENT=t.DUPLICATED_METADATA=t.DUPLICATED_INJECTABLE_DECORATOR=void 0,t.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",t.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",t.NULL_ARGUMENT="NULL argument",t.KEY_NOT_FOUND="Key Not Found",t.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",t.CANNOT_UNBIND="Could not unbind serviceIdentifier:",t.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",t.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",t.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:",t.UNDEFINED_INJECT_ANNOTATION=function(e){return"@inject called with undefined this could mean that the class "+e+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."},t.CIRCULAR_DEPENDENCY="Circular dependency found:",t.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",t.INVALID_BINDING_TYPE="Invalid binding type:",t.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",t.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",t.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",t.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",t.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.",t.ARGUMENTS_LENGTH_MISMATCH=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"The number of constructor arguments in the derived class "+e[0]+" must be >= than the number of constructor arguments of its base class."},t.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",t.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",t.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",t.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",t.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class",t.POST_CONSTRUCT_ERROR=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"@postConstruct error in class "+e[0]+": "+e[1]},t.CIRCULAR_DEPENDENCY_IN_FACTORY=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"It looks like there is a circular dependency in one of the '"+e[0]+"' bindings. Please investigate bindings withservice identifier '"+e[1]+"'."},t.STACK_OVERFLOW="Maximum call stack size exceeded"},8421:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TargetTypeEnum=t.BindingTypeEnum=t.BindingScopeEnum=void 0,t.BindingScopeEnum={Request:"Request",Singleton:"Singleton",Transient:"Transient"},t.BindingTypeEnum={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"},t.TargetTypeEnum={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"}},6867:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NON_CUSTOM_TAG_KEYS=t.POST_CONSTRUCT=t.DESIGN_PARAM_TYPES=t.PARAM_TYPES=t.TAGGED_PROP=t.TAGGED=t.MULTI_INJECT_TAG=t.INJECT_TAG=t.OPTIONAL_TAG=t.UNMANAGED_TAG=t.NAME_TAG=t.NAMED_TAG=void 0,t.NAMED_TAG="named",t.NAME_TAG="name",t.UNMANAGED_TAG="unmanaged",t.OPTIONAL_TAG="optional",t.INJECT_TAG="inject",t.MULTI_INJECT_TAG="multi_inject",t.TAGGED="inversify:tagged",t.TAGGED_PROP="inversify:tagged_props",t.PARAM_TYPES="inversify:paramtypes",t.DESIGN_PARAM_TYPES="design:paramtypes",t.POST_CONSTRUCT="post_construct",t.NON_CUSTOM_TAG_KEYS=[t.INJECT_TAG,t.MULTI_INJECT_TAG,t.NAME_TAG,t.UNMANAGED_TAG,t.NAMED_TAG,t.OPTIONAL_TAG]},1389:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.Container=void 0;var a=n(4290),s=n(6674),u=n(8421),c=n(6867),l=n(1377),h=n(6311),f=n(1927),d=n(1860),p=n(7791),v=n(5800),g=n(5700),_=n(175),y=function(){function e(e){this._appliedMiddleware=[];var t=e||{};if("object"!=typeof t)throw new Error(""+s.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(void 0===t.defaultScope)t.defaultScope=u.BindingScopeEnum.Transient;else if(t.defaultScope!==u.BindingScopeEnum.Singleton&&t.defaultScope!==u.BindingScopeEnum.Transient&&t.defaultScope!==u.BindingScopeEnum.Request)throw new Error(""+s.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(void 0===t.autoBindInjectable)t.autoBindInjectable=!1;else if("boolean"!=typeof t.autoBindInjectable)throw new Error(""+s.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(void 0===t.skipBaseClassChecks)t.skipBaseClassChecks=!1;else if("boolean"!=typeof t.skipBaseClassChecks)throw new Error(""+s.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:t.autoBindInjectable,defaultScope:t.defaultScope,skipBaseClassChecks:t.skipBaseClassChecks},this.id=p.id(),this._bindingDictionary=new _.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new l.MetadataReader}return e.merge=function(t,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var a=new e,s=o([t,n],r).map((function(e){return h.getBindingDictionary(e)})),u=h.getBindingDictionary(a);function c(e,t){e.traverse((function(e,n){n.forEach((function(e){t.add(e.serviceIdentifier,e.clone())}))}))}return s.forEach((function(e){c(e,u)})),a},e.prototype.load=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=this._getContainerModuleHelpersFactory(),r=0,i=e;r<i.length;r++){var o=i[r],a=n(o.id);o.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)}},e.prototype.loadAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r(this,void 0,void 0,(function(){var t,n,r,o,a;return i(this,(function(i){switch(i.label){case 0:t=this._getContainerModuleHelpersFactory(),n=0,r=e,i.label=1;case 1:return n<r.length?(o=r[n],a=t(o.id),[4,o.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)]):[3,4];case 2:i.sent(),i.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},e.prototype.unload=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=function(e){return function(t){return t.moduleId===e}};t.forEach((function(t){var n=r(t.id);e._bindingDictionary.removeByCondition(n)}))},e.prototype.bind=function(e){var t=this.options.defaultScope||u.BindingScopeEnum.Transient,n=new a.Binding(e,t);return this._bindingDictionary.add(e,n),new d.BindingToSyntax(n)},e.prototype.rebind=function(e){return this.unbind(e),this.bind(e)},e.prototype.unbind=function(e){try{this._bindingDictionary.remove(e)}catch(t){throw new Error(s.CANNOT_UNBIND+" "+v.getServiceIdentifierAsString(e))}},e.prototype.unbindAll=function(){this._bindingDictionary=new _.Lookup},e.prototype.isBound=function(e){var t=this._bindingDictionary.hasKey(e);return!t&&this.parent&&(t=this.parent.isBound(e)),t},e.prototype.isBoundNamed=function(e,t){return this.isBoundTagged(e,c.NAMED_TAG,t)},e.prototype.isBoundTagged=function(e,t,n){var r=!1;if(this._bindingDictionary.hasKey(e)){var i=this._bindingDictionary.get(e),o=h.createMockRequest(this,e,t,n);r=i.some((function(e){return e.constraint(o)}))}return!r&&this.parent&&(r=this.parent.isBoundTagged(e,t,n)),r},e.prototype.snapshot=function(){this._snapshots.push(g.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},e.prototype.restore=function(){var e=this._snapshots.pop();if(void 0===e)throw new Error(s.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=e.bindings,this._middleware=e.middleware},e.prototype.createChild=function(t){var n=new e(t||this.options);return n.parent=this,n},e.prototype.applyMiddleware=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._appliedMiddleware=this._appliedMiddleware.concat(e);var n=this._middleware?this._middleware:this._planAndResolve();this._middleware=e.reduce((function(e,t){return t(e)}),n)},e.prototype.applyCustomMetadataReader=function(e){this._metadataReader=e},e.prototype.get=function(e){return this._get(!1,!1,u.TargetTypeEnum.Variable,e)},e.prototype.getTagged=function(e,t,n){return this._get(!1,!1,u.TargetTypeEnum.Variable,e,t,n)},e.prototype.getNamed=function(e,t){return this.getTagged(e,c.NAMED_TAG,t)},e.prototype.getAll=function(e){return this._get(!0,!0,u.TargetTypeEnum.Variable,e)},e.prototype.getAllTagged=function(e,t,n){return this._get(!1,!0,u.TargetTypeEnum.Variable,e,t,n)},e.prototype.getAllNamed=function(e,t){return this.getAllTagged(e,c.NAMED_TAG,t)},e.prototype.resolve=function(e){var t=this.createChild();return t.bind(e).toSelf(),this._appliedMiddleware.forEach((function(e){t.applyMiddleware(e)})),t.get(e)},e.prototype._getContainerModuleHelpersFactory=function(){var e=this,t=function(e,t){e._binding.moduleId=t},n=function(n){return function(r){var i=e.rebind.bind(e)(r);return t(i,n),i}};return function(r){return{bindFunction:(i=r,function(n){var r=e.bind.bind(e)(n);return t(r,i),r}),isboundFunction:function(t){return e.isBound.bind(e)(t)},rebindFunction:n(r),unbindFunction:function(t){e.unbind.bind(e)(t)}};var i}},e.prototype._get=function(e,t,n,r,i,o){var a=null,u={avoidConstraints:e,contextInterceptor:function(e){return e},isMultiInject:t,key:i,serviceIdentifier:r,targetType:n,value:o};if(this._middleware){if(null==(a=this._middleware(u)))throw new Error(s.INVALID_MIDDLEWARE_RETURN)}else a=this._planAndResolve()(u);return a},e.prototype._planAndResolve=function(){var e=this;return function(t){var n=h.plan(e._metadataReader,e,t.isMultiInject,t.targetType,t.serviceIdentifier,t.key,t.value,t.avoidConstraints);return n=t.contextInterceptor(n),f.resolve(n)}},e}();t.Container=y},3244:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncContainerModule=t.ContainerModule=void 0;var r=n(7791);t.ContainerModule=function(e){this.id=r.id(),this.registry=e};t.AsyncContainerModule=function(e){this.id=r.id(),this.registry=e}},5700:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ContainerSnapshot=void 0;var n=function(){function e(){}return e.of=function(t,n){var r=new e;return r.bindings=t,r.middleware=n,r},e}();t.ContainerSnapshot=n},175:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Lookup=void 0;var r=n(6674),i=function(){function e(){this._map=new Map}return e.prototype.getMap=function(){return this._map},e.prototype.add=function(e,t){if(null==e)throw new Error(r.NULL_ARGUMENT);if(null==t)throw new Error(r.NULL_ARGUMENT);var n=this._map.get(e);void 0!==n?(n.push(t),this._map.set(e,n)):this._map.set(e,[t])},e.prototype.get=function(e){if(null==e)throw new Error(r.NULL_ARGUMENT);var t=this._map.get(e);if(void 0!==t)return t;throw new Error(r.KEY_NOT_FOUND)},e.prototype.remove=function(e){if(null==e)throw new Error(r.NULL_ARGUMENT);if(!this._map.delete(e))throw new Error(r.KEY_NOT_FOUND)},e.prototype.removeByCondition=function(e){var t=this;this._map.forEach((function(n,r){var i=n.filter((function(t){return!e(t)}));i.length>0?t._map.set(r,i):t._map.delete(r)}))},e.prototype.hasKey=function(e){if(null==e)throw new Error(r.NULL_ARGUMENT);return this._map.has(e)},e.prototype.clone=function(){var t=new e;return this._map.forEach((function(e,n){e.forEach((function(e){return t.add(n,e.clone())}))})),t},e.prototype.traverse=function(e){this._map.forEach((function(t,n){e(n,t)}))},e}();t.Lookup=i},6700:(e,t,n)=>{"use strict";t.GW=t.zY=t.f3=t.t6=t.b2=t.W2=void 0,n(6867);var r=n(1389);Object.defineProperty(t,"W2",{enumerable:!0,get:function(){return r.Container}});n(8421),n(3244);var i=n(4315);Object.defineProperty(t,"b2",{enumerable:!0,get:function(){return i.injectable}});n(2052);var o=n(8085);Object.defineProperty(t,"t6",{enumerable:!0,get:function(){return o.named}});var a=n(5744);Object.defineProperty(t,"f3",{enumerable:!0,get:function(){return a.inject}});n(6515),n(6757),n(1693),n(5638);var s=n(7014);Object.defineProperty(t,"zY",{enumerable:!0,get:function(){return s.postConstruct}});n(1377),n(7791);var u=n(9934);Object.defineProperty(t,"GW",{enumerable:!0,get:function(){return u.decorate}});n(758),n(5800),n(600)},5228:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Context=void 0;var r=n(7791),i=function(){function e(e){this.id=r.id(),this.container=e}return e.prototype.addPlan=function(e){this.plan=e},e.prototype.setCurrentRequest=function(e){this.currentRequest=e},e}();t.Context=i},7738:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Metadata=void 0;var r=n(6867),i=function(){function e(e,t){this.key=e,this.value=t}return e.prototype.toString=function(){return this.key===r.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},e}();t.Metadata=i},1377:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MetadataReader=void 0;var r=n(6867),i=function(){function e(){}return e.prototype.getConstructorMetadata=function(e){return{compilerGeneratedMetadata:Reflect.getMetadata(r.PARAM_TYPES,e),userGeneratedMetadata:Reflect.getMetadata(r.TAGGED,e)||{}}},e.prototype.getPropertiesMetadata=function(e){return Reflect.getMetadata(r.TAGGED_PROP,e)||[]},e}();t.MetadataReader=i},5314:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Plan=void 0;t.Plan=function(e,t){this.parentContext=e,this.rootRequest=t}},6311:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getBindingDictionary=t.createMockRequest=t.plan=void 0;var r=n(3184),i=n(6674),o=n(8421),a=n(6867),s=n(5265),u=n(5800),c=n(5228),l=n(7738),h=n(5314),f=n(6e3),d=n(6748),p=n(8924);function v(e){return e._bindingDictionary}function g(e,t,n,o,a){var s,c=y(n.container,a.serviceIdentifier);return c.length===r.BindingCount.NoBindingsAvailable&&n.container.options.autoBindInjectable&&"function"==typeof a.serviceIdentifier&&e.getConstructorMetadata(a.serviceIdentifier).compilerGeneratedMetadata&&(n.container.bind(a.serviceIdentifier).toSelf(),c=y(n.container,a.serviceIdentifier)),s=t?c:c.filter((function(e){var t=new d.Request(e.serviceIdentifier,n,o,e,a);return e.constraint(t)})),function(e,t,n,o){switch(t.length){case r.BindingCount.NoBindingsAvailable:if(n.isOptional())return t;var a=u.getServiceIdentifierAsString(e),s=i.NOT_REGISTERED;throw s+=u.listMetadataForTarget(a,n),s+=u.listRegisteredBindingsForServiceIdentifier(o,a,y),new Error(s);case r.BindingCount.OnlyOneBindingAvailable:if(!n.isArray())return t;case r.BindingCount.MultipleBindingsAvailable:default:if(n.isArray())return t;throw a=u.getServiceIdentifierAsString(e),s=i.AMBIGUOUS_MATCH+" "+a,s+=u.listRegisteredBindingsForServiceIdentifier(o,a,y),new Error(s)}}(a.serviceIdentifier,s,a,n.container),s}function _(e,t,n,r,a,s){var u,c;if(null===a){u=g(e,t,r,null,s),c=new d.Request(n,r,null,u,s);var l=new h.Plan(r,c);r.addPlan(l)}else u=g(e,t,r,a,s),c=a.addChildRequest(s.serviceIdentifier,u,s);u.forEach((function(t){var n=null;if(s.isArray())n=c.addChildRequest(t.serviceIdentifier,t,s);else{if(t.cache)return;n=c}if(t.type===o.BindingTypeEnum.Instance&&null!==t.implementationType){var a=f.getDependencies(e,t.implementationType);if(!r.container.options.skipBaseClassChecks){var u=f.getBaseClassDependencyCount(e,t.implementationType);if(a.length<u){var l=i.ARGUMENTS_LENGTH_MISMATCH(f.getFunctionName(t.implementationType));throw new Error(l)}}a.forEach((function(t){_(e,!1,t.serviceIdentifier,r,n,t)}))}}))}function y(e,t){var n=[],r=v(e);return r.hasKey(t)?n=r.get(t):null!==e.parent&&(n=y(e.parent,t)),n}t.getBindingDictionary=v,t.plan=function(e,t,n,r,i,o,h,f){void 0===f&&(f=!1);var d=new c.Context(t),v=function(e,t,n,r,i,o){var s=e?a.MULTI_INJECT_TAG:a.INJECT_TAG,u=new l.Metadata(s,n),c=new p.Target(t,"",n,u);if(void 0!==i){var h=new l.Metadata(i,o);c.metadata.push(h)}return c}(n,r,i,0,o,h);try{return _(e,f,i,d,null,v),d}catch(e){throw s.isStackOverflowExeption(e)&&d.plan&&u.circularDependencyToException(d.plan.rootRequest),e}},t.createMockRequest=function(e,t,n,r){var i=new p.Target(o.TargetTypeEnum.Variable,"",t,new l.Metadata(n,r)),a=new c.Context(e);return new d.Request(t,a,null,[],i)}},8460:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QueryableString=void 0;var n=function(){function e(e){this.str=e}return e.prototype.startsWith=function(e){return 0===this.str.indexOf(e)},e.prototype.endsWith=function(e){var t,n=e.split("").reverse().join("");return t=this.str.split("").reverse().join(""),this.startsWith.call({str:t},n)},e.prototype.contains=function(e){return-1!==this.str.indexOf(e)},e.prototype.equals=function(e){return this.str===e},e.prototype.value=function(){return this.str},e}();t.QueryableString=n},6e3:function(e,t,n){"use strict";var r=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.getFunctionName=t.getBaseClassDependencyCount=t.getDependencies=void 0;var i=n(5744),o=n(6674),a=n(8421),s=n(6867),u=n(5800);Object.defineProperty(t,"getFunctionName",{enumerable:!0,get:function(){return u.getFunctionName}});var c=n(8924);function l(e,t,n,i){var a=e.getConstructorMetadata(n),s=a.compilerGeneratedMetadata;if(void 0===s){var u=o.MISSING_INJECTABLE_ANNOTATION+" "+t+".";throw new Error(u)}var c=a.userGeneratedMetadata,l=Object.keys(c),d=0===n.length&&l.length>0,p=l.length>n.length,v=function(e,t,n,r,i){for(var o=[],a=0;a<i;a++){var s=h(a,e,t,n,r);null!==s&&o.push(s)}return o}(i,t,s,c,d||p?l.length:n.length),g=f(e,n);return r(r([],v),g)}function h(e,t,n,r,s){var u=s[e.toString()]||[],l=d(u),h=!0!==l.unmanaged,f=r[e];if((f=l.inject||l.multiInject||f)instanceof i.LazyServiceIdentifer&&(f=f.unwrap()),h){if(!t&&(f===Object||f===Function||void 0===f)){var p=o.MISSING_INJECT_ANNOTATION+" argument "+e+" in class "+n+".";throw new Error(p)}var v=new c.Target(a.TargetTypeEnum.ConstructorArgument,l.targetName,f);return v.metadata=u,v}return null}function f(e,t){for(var n=e.getPropertiesMetadata(t),i=[],o=0,s=Object.keys(n);o<s.length;o++){var u=s[o],l=n[u],h=d(n[u]),p=h.targetName||u,v=h.inject||h.multiInject,g=new c.Target(a.TargetTypeEnum.ClassProperty,p,v);g.metadata=l,i.push(g)}var _=Object.getPrototypeOf(t.prototype).constructor;if(_!==Object){var y=f(e,_);i=r(r([],i),y)}return i}function d(e){var t={};return e.forEach((function(e){t[e.key.toString()]=e.value})),{inject:t[s.INJECT_TAG],multiInject:t[s.MULTI_INJECT_TAG],targetName:t[s.NAME_TAG],unmanaged:t[s.UNMANAGED_TAG]}}t.getDependencies=function(e,t){return l(e,u.getFunctionName(t),t,!1)},t.getBaseClassDependencyCount=function e(t,n){var r=Object.getPrototypeOf(n.prototype).constructor;if(r!==Object){var i=l(t,u.getFunctionName(r),r,!0),o=i.map((function(e){return e.metadata.filter((function(e){return e.key===s.UNMANAGED_TAG}))})),a=[].concat.apply([],o).length,c=i.length-a;return c>0?c:e(t,r)}return 0}},6748:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Request=void 0;var r=n(7791),i=function(){function e(e,t,n,i,o){this.id=r.id(),this.serviceIdentifier=e,this.parentContext=t,this.parentRequest=n,this.target=o,this.childRequests=[],this.bindings=Array.isArray(i)?i:[i],this.requestScope=null===n?new Map:null}return e.prototype.addChildRequest=function(t,n,r){var i=new e(t,this.parentContext,this,n,r);return this.childRequests.push(i),i},e}();t.Request=i},8924:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Target=void 0;var r=n(6867),i=n(7791),o=n(7738),a=n(8460),s=function(){function e(e,t,n,s){this.id=i.id(),this.type=e,this.serviceIdentifier=n,this.name=new a.QueryableString(t||""),this.metadata=new Array;var u=null;"string"==typeof s?u=new o.Metadata(r.NAMED_TAG,s):s instanceof o.Metadata&&(u=s),null!==u&&this.metadata.push(u)}return e.prototype.hasTag=function(e){for(var t=0,n=this.metadata;t<n.length;t++)if(n[t].key===e)return!0;return!1},e.prototype.isArray=function(){return this.hasTag(r.MULTI_INJECT_TAG)},e.prototype.matchesArray=function(e){return this.matchesTag(r.MULTI_INJECT_TAG)(e)},e.prototype.isNamed=function(){return this.hasTag(r.NAMED_TAG)},e.prototype.isTagged=function(){return this.metadata.some((function(e){return r.NON_CUSTOM_TAG_KEYS.every((function(t){return e.key!==t}))}))},e.prototype.isOptional=function(){return this.matchesTag(r.OPTIONAL_TAG)(!0)},e.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter((function(e){return e.key===r.NAMED_TAG}))[0]:null},e.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter((function(e){return r.NON_CUSTOM_TAG_KEYS.every((function(t){return e.key!==t}))})):null},e.prototype.matchesNamedTag=function(e){return this.matchesTag(r.NAMED_TAG)(e)},e.prototype.matchesTag=function(e){var t=this;return function(n){for(var r=0,i=t.metadata;r<i.length;r++){var o=i[r];if(o.key===e&&o.value===n)return!0}return!1}},e}();t.Target=s},2279:function(e,t,n){"use strict";var r=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.resolveInstance=void 0;var i=n(6674),o=n(8421),a=n(6867);t.resolveInstance=function(e,t,n){var s,u,c=null;t.length>0?(u=t.filter((function(e){return null!==e.target&&e.target.type===o.TargetTypeEnum.ConstructorArgument})).map(n),c=function(e,t,n){var r=t.filter((function(e){return null!==e.target&&e.target.type===o.TargetTypeEnum.ClassProperty})),i=r.map(n);return r.forEach((function(t,n){var r;r=t.target.name.value();var o=i[n];e[r]=o})),e}(c=new((s=e).bind.apply(s,r([void 0],u))),t,n)):c=new e;return function(e,t){if(Reflect.hasMetadata(a.POST_CONSTRUCT,e)){var n=Reflect.getMetadata(a.POST_CONSTRUCT,e);try{t[n.value]()}catch(t){throw new Error(i.POST_CONSTRUCT_ERROR(e.name,t.message))}}}(e,c),c}},1927:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resolve=void 0;var r=n(6674),i=n(8421),o=n(5265),a=n(5800),s=n(2279),u=function(e,t,n){try{return n()}catch(n){throw o.isStackOverflowExeption(n)?new Error(r.CIRCULAR_DEPENDENCY_IN_FACTORY(e,t.toString())):n}},c=function(e){return function(t){t.parentContext.setCurrentRequest(t);var n=t.bindings,o=t.childRequests,l=t.target&&t.target.isArray(),h=!(t.parentRequest&&t.parentRequest.target&&t.target&&t.parentRequest.target.matchesArray(t.target.serviceIdentifier));if(l&&h)return o.map((function(t){return c(e)(t)}));var f=null;if(!t.target.isOptional()||0!==n.length){var d=n[0],p=d.scope===i.BindingScopeEnum.Singleton,v=d.scope===i.BindingScopeEnum.Request;if(p&&d.activated)return d.cache;if(v&&null!==e&&e.has(d.id))return e.get(d.id);if(d.type===i.BindingTypeEnum.ConstantValue)f=d.cache,d.activated=!0;else if(d.type===i.BindingTypeEnum.Function)f=d.cache,d.activated=!0;else if(d.type===i.BindingTypeEnum.Constructor)f=d.implementationType;else if(d.type===i.BindingTypeEnum.DynamicValue&&null!==d.dynamicValue)f=u("toDynamicValue",d.serviceIdentifier,(function(){return d.dynamicValue(t.parentContext)}));else if(d.type===i.BindingTypeEnum.Factory&&null!==d.factory)f=u("toFactory",d.serviceIdentifier,(function(){return d.factory(t.parentContext)}));else if(d.type===i.BindingTypeEnum.Provider&&null!==d.provider)f=u("toProvider",d.serviceIdentifier,(function(){return d.provider(t.parentContext)}));else{if(d.type!==i.BindingTypeEnum.Instance||null===d.implementationType){var g=a.getServiceIdentifierAsString(t.serviceIdentifier);throw new Error(r.INVALID_BINDING_TYPE+" "+g)}f=s.resolveInstance(d.implementationType,o,c(e))}return"function"==typeof d.onActivation&&(f=d.onActivation(t.parentContext,f)),p&&(d.cache=f,d.activated=!0),v&&null!==e&&!e.has(d.id)&&e.set(d.id,f),f}}};t.resolve=function(e){return c(e.plan.rootRequest.requestScope)(e.plan.rootRequest)}},3366:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BindingInSyntax=void 0;var r=n(8421),i=n(1325),o=function(){function e(e){this._binding=e}return e.prototype.inRequestScope=function(){return this._binding.scope=r.BindingScopeEnum.Request,new i.BindingWhenOnSyntax(this._binding)},e.prototype.inSingletonScope=function(){return this._binding.scope=r.BindingScopeEnum.Singleton,new i.BindingWhenOnSyntax(this._binding)},e.prototype.inTransientScope=function(){return this._binding.scope=r.BindingScopeEnum.Transient,new i.BindingWhenOnSyntax(this._binding)},e}();t.BindingInSyntax=o},9812:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BindingInWhenOnSyntax=void 0;var r=n(3366),i=n(1811),o=n(8370),a=function(){function e(e){this._binding=e,this._bindingWhenSyntax=new o.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new i.BindingOnSyntax(this._binding),this._bindingInSyntax=new r.BindingInSyntax(e)}return e.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},e.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},e.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},e.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},e.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},e.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},e.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},e.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},e.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},e.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},e.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},e.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},e.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},e.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},e.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},e.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},e}();t.BindingInWhenOnSyntax=a},1811:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BindingOnSyntax=void 0;var r=n(8370),i=function(){function e(e){this._binding=e}return e.prototype.onActivation=function(e){return this._binding.onActivation=e,new r.BindingWhenSyntax(this._binding)},e}();t.BindingOnSyntax=i},1860:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BindingToSyntax=void 0;var r=n(6674),i=n(8421),o=n(9812),a=n(1325),s=function(){function e(e){this._binding=e}return e.prototype.to=function(e){return this._binding.type=i.BindingTypeEnum.Instance,this._binding.implementationType=e,new o.BindingInWhenOnSyntax(this._binding)},e.prototype.toSelf=function(){if("function"!=typeof this._binding.serviceIdentifier)throw new Error(""+r.INVALID_TO_SELF_VALUE);var e=this._binding.serviceIdentifier;return this.to(e)},e.prototype.toConstantValue=function(e){return this._binding.type=i.BindingTypeEnum.ConstantValue,this._binding.cache=e,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},e.prototype.toDynamicValue=function(e){return this._binding.type=i.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=e,this._binding.implementationType=null,new o.BindingInWhenOnSyntax(this._binding)},e.prototype.toConstructor=function(e){return this._binding.type=i.BindingTypeEnum.Constructor,this._binding.implementationType=e,this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},e.prototype.toFactory=function(e){return this._binding.type=i.BindingTypeEnum.Factory,this._binding.factory=e,this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},e.prototype.toFunction=function(e){if("function"!=typeof e)throw new Error(r.INVALID_FUNCTION_BINDING);var t=this.toConstantValue(e);return this._binding.type=i.BindingTypeEnum.Function,this._binding.scope=i.BindingScopeEnum.Singleton,t},e.prototype.toAutoFactory=function(e){return this._binding.type=i.BindingTypeEnum.Factory,this._binding.factory=function(t){return function(){return t.container.get(e)}},this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},e.prototype.toProvider=function(e){return this._binding.type=i.BindingTypeEnum.Provider,this._binding.provider=e,this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},e.prototype.toService=function(e){this.toDynamicValue((function(t){return t.container.get(e)}))},e}();t.BindingToSyntax=s},1325:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BindingWhenOnSyntax=void 0;var r=n(1811),i=n(8370),o=function(){function e(e){this._binding=e,this._bindingWhenSyntax=new i.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new r.BindingOnSyntax(this._binding)}return e.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},e.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},e.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},e.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},e.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},e.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},e.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},e.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},e.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},e.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},e.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},e.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},e.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},e}();t.BindingWhenOnSyntax=o},8370:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BindingWhenSyntax=void 0;var r=n(1811),i=n(758),o=function(){function e(e){this._binding=e}return e.prototype.when=function(e){return this._binding.constraint=e,new r.BindingOnSyntax(this._binding)},e.prototype.whenTargetNamed=function(e){return this._binding.constraint=i.namedConstraint(e),new r.BindingOnSyntax(this._binding)},e.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(e){return null!==e.target&&!e.target.isNamed()&&!e.target.isTagged()},new r.BindingOnSyntax(this._binding)},e.prototype.whenTargetTagged=function(e,t){return this._binding.constraint=i.taggedConstraint(e)(t),new r.BindingOnSyntax(this._binding)},e.prototype.whenInjectedInto=function(e){return this._binding.constraint=function(t){return i.typeConstraint(e)(t.parentRequest)},new r.BindingOnSyntax(this._binding)},e.prototype.whenParentNamed=function(e){return this._binding.constraint=function(t){return i.namedConstraint(e)(t.parentRequest)},new r.BindingOnSyntax(this._binding)},e.prototype.whenParentTagged=function(e,t){return this._binding.constraint=function(n){return i.taggedConstraint(e)(t)(n.parentRequest)},new r.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorIs=function(e){return this._binding.constraint=function(t){return i.traverseAncerstors(t,i.typeConstraint(e))},new r.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorIs=function(e){return this._binding.constraint=function(t){return!i.traverseAncerstors(t,i.typeConstraint(e))},new r.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorNamed=function(e){return this._binding.constraint=function(t){return i.traverseAncerstors(t,i.namedConstraint(e))},new r.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorNamed=function(e){return this._binding.constraint=function(t){return!i.traverseAncerstors(t,i.namedConstraint(e))},new r.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._binding.constraint=function(n){return i.traverseAncerstors(n,i.taggedConstraint(e)(t))},new r.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorTagged=function(e,t){return this._binding.constraint=function(n){return!i.traverseAncerstors(n,i.taggedConstraint(e)(t))},new r.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorMatches=function(e){return this._binding.constraint=function(t){return i.traverseAncerstors(t,e)},new r.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorMatches=function(e){return this._binding.constraint=function(t){return!i.traverseAncerstors(t,e)},new r.BindingOnSyntax(this._binding)},e}();t.BindingWhenSyntax=o},758:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.typeConstraint=t.namedConstraint=t.taggedConstraint=t.traverseAncerstors=void 0;var r=n(6867),i=n(7738),o=function(e,t){var n=e.parentRequest;return null!==n&&(!!t(n)||o(n,t))};t.traverseAncerstors=o;var a=function(e){return function(t){var n=function(n){return null!==n&&null!==n.target&&n.target.matchesTag(e)(t)};return n.metaData=new i.Metadata(e,t),n}};t.taggedConstraint=a;var s=a(r.NAMED_TAG);t.namedConstraint=s,t.typeConstraint=function(e){return function(t){var n=null;if(null!==t){if(n=t.bindings[0],"string"==typeof e)return n.serviceIdentifier===e;var r=t.bindings[0].implementationType;return e===r}return!1}}},600:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.multiBindToService=void 0,t.multiBindToService=function(e){return function(t){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return n.forEach((function(n){return e.bind(n).toService(t)}))}}}},5265:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isStackOverflowExeption=void 0;var r=n(6674);t.isStackOverflowExeption=function(e){return e instanceof RangeError||e.message===r.STACK_OVERFLOW}},7791:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.id=void 0;var n=0;t.id=function(){return n++}},5800:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.circularDependencyToException=t.listMetadataForTarget=t.listRegisteredBindingsForServiceIdentifier=t.getServiceIdentifierAsString=t.getFunctionName=void 0;var r=n(6674);function i(e){return"function"==typeof e?e.name:"symbol"==typeof e?e.toString():e}function o(e,t){return null!==e.parentRequest&&(e.parentRequest.serviceIdentifier===t||o(e.parentRequest,t))}function a(e){if(e.name)return e.name;var t=e.toString(),n=t.match(/^function\s*([^\s(]+)/);return n?n[1]:"Anonymous function: "+t}t.getServiceIdentifierAsString=i,t.listRegisteredBindingsForServiceIdentifier=function(e,t,n){var r="",i=n(e,t);return 0!==i.length&&(r="\nRegistered bindings:",i.forEach((function(e){var t="Object";null!==e.implementationType&&(t=a(e.implementationType)),r=r+"\n "+t,e.constraint.metaData&&(r=r+" - "+e.constraint.metaData)}))),r},t.circularDependencyToException=function e(t){t.childRequests.forEach((function(t){if(o(t,t.serviceIdentifier)){var n=function(e){return function e(t,n){void 0===n&&(n=[]);var r=i(t.serviceIdentifier);return n.push(r),null!==t.parentRequest?e(t.parentRequest,n):n}(e).reverse().join(" --\x3e ")}(t);throw new Error(r.CIRCULAR_DEPENDENCY+" "+n)}e(t)}))},t.listMetadataForTarget=function(e,t){if(t.isTagged()||t.isNamed()){var n="",r=t.getNamedTag(),i=t.getCustomTags();return null!==r&&(n+=r.toString()+"\n"),null!==i&&i.forEach((function(e){n+=e.toString()+"\n"}))," "+e+"\n "+e+" - "+n}return" "+e},t.getFunctionName=a},5666:e=>{var t=function(e){"use strict";var t,n=Object.prototype,r=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var i=t&&t.prototype instanceof g?t:g,o=Object.create(i.prototype),a=new M(r||[]);return o._invoke=function(e,t,n){var r=h;return function(i,o){if(r===d)throw new Error("Generator is already running");if(r===p){if("throw"===i)throw o;return N()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=b(a,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===h)throw r=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=d;var u=l(e,t,n);if("normal"===u.type){if(r=n.done?p:f,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r=p,n.method="throw",n.arg=u.arg)}}}(e,n,a),o}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var h="suspendedStart",f="suspendedYield",d="executing",p="completed",v={};function g(){}function _(){}function y(){}var m={};u(m,o,(function(){return this}));var E=Object.getPrototypeOf,T=E&&E(E(P([])));T&&T!==n&&r.call(T,o)&&(m=T);var R=y.prototype=g.prototype=Object.create(m);function A(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function S(e,t){function n(i,o,a,s){var u=l(e[i],e,o);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"==typeof h&&r.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(h).then((function(e){c.value=e,a(c)}),(function(e){return n("throw",e,a,s)}))}s(u.arg)}var i;this._invoke=function(e,r){function o(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(o,o):o()}}function b(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,b(e,n),"throw"===n.method))return v;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var i=l(r,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,v;var o=i.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,v):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function M(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function P(e){if(e){var n=e[o];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,a=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}return{next:N}}function N(){return{value:t,done:!0}}return _.prototype=y,u(R,"constructor",y),u(y,"constructor",_),_.displayName=u(y,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===_||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,u(e,s,"GeneratorFunction")),e.prototype=Object.create(R),e},e.awrap=function(e){return{__await:e}},A(S.prototype),u(S.prototype,a,(function(){return this})),e.AsyncIterator=S,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new S(c(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},A(R),u(R,s,"Generator"),u(R,o,(function(){return this})),u(R,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=P,M.prototype={constructor:M,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),C(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;C(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:P(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),v}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}},7247:(e,t,n)=>{"use strict";const r=n(6534),i=n(2275),o=new class extends i{content({onError:e,onResult:t,onDone:n}){let r="";return r+=`var _results = new Array(${this.options.taps.length});\n`,r+="var _checkDone = function() {\n",r+="for(var i = 0; i < _results.length; i++) {\n",r+="var item = _results[i];\n",r+="if(item === undefined) return false;\n",r+="if(item.result !== undefined) {\n",r+=t("item.result"),r+="return true;\n",r+="}\n",r+="if(item.error) {\n",r+=e("item.error"),r+="return true;\n",r+="}\n",r+="}\n",r+="return false;\n",r+="}\n",r+=this.callTapsParallel({onError:(e,t,n,r)=>{let i="";return i+=`if(${e} < _results.length && ((_results.length = ${e+1}), (_results[${e}] = { error: ${t} }), _checkDone())) {\n`,i+=r(!0),i+="} else {\n",i+=n(),i+="}\n",i},onResult:(e,t,n,r)=>{let i="";return i+=`if(${e} < _results.length && (${t} !== undefined && (_results.length = ${e+1}), (_results[${e}] = { result: ${t} }), _checkDone())) {\n`,i+=r(!0),i+="} else {\n",i+=n(),i+="}\n",i},onTap:(e,t,n,r)=>{let i="";return e>0&&(i+=`if(${e} >= _results.length) {\n`,i+=n(),i+="} else {\n"),i+=t(),e>0&&(i+="}\n"),i},onDone:n}),r}},a=function(e){return o.setup(this,e),o.create(e)};function s(e=[],t){const n=new r(e,t);return n.constructor=s,n.compile=a,n._call=void 0,n.call=void 0,n}s.prototype=null,e.exports=s},6714:(e,t,n)=>{"use strict";const r=n(6534),i=n(2275),o=new class extends i{content({onError:e,onDone:t}){return this.callTapsParallel({onError:(t,n,r,i)=>e(n)+i(!0),onDone:t})}},a=function(e){return o.setup(this,e),o.create(e)};function s(e=[],t){const n=new r(e,t);return n.constructor=s,n.compile=a,n._call=void 0,n.call=void 0,n}s.prototype=null,e.exports=s},1293:(e,t,n)=>{"use strict";const r=n(6534),i=n(2275),o=new class extends i{content({onError:e,onResult:t,resultReturns:n,onDone:r}){return this.callTapsSeries({onError:(t,n,r,i)=>e(n)+i(!0),onResult:(e,n,r)=>`if(${n} !== undefined) {\n${t(n)}\n} else {\n${r()}}\n`,resultReturns:n,onDone:r})}},a=function(e){return o.setup(this,e),o.create(e)};function s(e=[],t){const n=new r(e,t);return n.constructor=s,n.compile=a,n._call=void 0,n.call=void 0,n}s.prototype=null,e.exports=s},1617:(e,t,n)=>{"use strict";const r=n(6534),i=n(2275),o=new class extends i{content({onError:e,onDone:t}){return this.callTapsSeries({onError:(t,n,r,i)=>e(n)+i(!0),onDone:t})}},a=function(e){return o.setup(this,e),o.create(e)};function s(e=[],t){const n=new r(e,t);return n.constructor=s,n.compile=a,n._call=void 0,n.call=void 0,n}s.prototype=null,e.exports=s},996:(e,t,n)=>{"use strict";const r=n(6534),i=n(2275),o=new class extends i{content({onError:e,onDone:t}){return this.callTapsLooping({onError:(t,n,r,i)=>e(n)+i(!0),onDone:t})}},a=function(e){return o.setup(this,e),o.create(e)};function s(e=[],t){const n=new r(e,t);return n.constructor=s,n.compile=a,n._call=void 0,n.call=void 0,n}s.prototype=null,e.exports=s},7178:(e,t,n)=>{"use strict";const r=n(6534),i=n(2275),o=new class extends i{content({onError:e,onResult:t,onDone:n}){return this.callTapsSeries({onError:(t,n,r,i)=>e(n)+i(!0),onResult:(e,t,n)=>{let r="";return r+=`if(${t} !== undefined) {\n`,r+=`${this._args[0]} = ${t};\n`,r+="}\n",r+=n(),r},onDone:()=>t(this._args[0])})}},a=function(e){return o.setup(this,e),o.create(e)};function s(e=[],t){if(e.length<1)throw new Error("Waterfall hooks must have at least one argument");const n=new r(e,t);return n.constructor=s,n.compile=a,n._call=void 0,n.call=void 0,n}s.prototype=null,e.exports=s},6534:(e,t,n)=>{"use strict";const r=n(517).deprecate((()=>{}),"Hook.context is deprecated and will be removed"),i=function(...e){return this.call=this._createCall("sync"),this.call(...e)},o=function(...e){return this.callAsync=this._createCall("async"),this.callAsync(...e)},a=function(...e){return this.promise=this._createCall("promise"),this.promise(...e)};class s{constructor(e=[],t){this._args=e,this.name=t,this.taps=[],this.interceptors=[],this._call=i,this.call=i,this._callAsync=o,this.callAsync=o,this._promise=a,this.promise=a,this._x=void 0,this.compile=this.compile,this.tap=this.tap,this.tapAsync=this.tapAsync,this.tapPromise=this.tapPromise}compile(e){throw new Error("Abstract: should be overridden")}_createCall(e){return this.compile({taps:this.taps,interceptors:this.interceptors,args:this._args,type:e})}_tap(e,t,n){if("string"==typeof t)t={name:t.trim()};else if("object"!=typeof t||null===t)throw new Error("Invalid tap options");if("string"!=typeof t.name||""===t.name)throw new Error("Missing name for tap");void 0!==t.context&&r(),t=Object.assign({type:e,fn:n},t),t=this._runRegisterInterceptors(t),this._insert(t)}tap(e,t){this._tap("sync",e,t)}tapAsync(e,t){this._tap("async",e,t)}tapPromise(e,t){this._tap("promise",e,t)}_runRegisterInterceptors(e){for(const t of this.interceptors)if(t.register){const n=t.register(e);void 0!==n&&(e=n)}return e}withOptions(e){const t=t=>Object.assign({},e,"string"==typeof t?{name:t}:t);return{name:this.name,tap:(e,n)=>this.tap(t(e),n),tapAsync:(e,n)=>this.tapAsync(t(e),n),tapPromise:(e,n)=>this.tapPromise(t(e),n),intercept:e=>this.intercept(e),isUsed:()=>this.isUsed(),withOptions:e=>this.withOptions(t(e))}}isUsed(){return this.taps.length>0||this.interceptors.length>0}intercept(e){if(this._resetCompilation(),this.interceptors.push(Object.assign({},e)),e.register)for(let t=0;t<this.taps.length;t++)this.taps[t]=e.register(this.taps[t])}_resetCompilation(){this.call=this._call,this.callAsync=this._callAsync,this.promise=this._promise}_insert(e){let t;this._resetCompilation(),"string"==typeof e.before?t=new Set([e.before]):Array.isArray(e.before)&&(t=new Set(e.before));let n=0;"number"==typeof e.stage&&(n=e.stage);let r=this.taps.length;for(;r>0;){r--;const e=this.taps[r];this.taps[r+1]=e;const i=e.stage||0;if(t){if(t.has(e.name)){t.delete(e.name);continue}if(t.size>0)continue}if(!(i>n)){r++;break}}this.taps[r]=e}}Object.setPrototypeOf(s.prototype,null),e.exports=s},2275:e=>{"use strict";e.exports=class{constructor(e){this.config=e,this.options=void 0,this._args=void 0}create(e){let t;switch(this.init(e),this.options.type){case"sync":t=new Function(this.args(),'"use strict";\n'+this.header()+this.contentWithInterceptors({onError:e=>`throw ${e};\n`,onResult:e=>`return ${e};\n`,resultReturns:!0,onDone:()=>"",rethrowIfPossible:!0}));break;case"async":t=new Function(this.args({after:"_callback"}),'"use strict";\n'+this.header()+this.contentWithInterceptors({onError:e=>`_callback(${e});\n`,onResult:e=>`_callback(null, ${e});\n`,onDone:()=>"_callback();\n"}));break;case"promise":let e=!1;const n=this.contentWithInterceptors({onError:t=>(e=!0,`_error(${t});\n`),onResult:e=>`_resolve(${e});\n`,onDone:()=>"_resolve();\n"});let r="";r+='"use strict";\n',r+=this.header(),r+="return new Promise((function(_resolve, _reject) {\n",e&&(r+="var _sync = true;\n",r+="function _error(_err) {\n",r+="if(_sync)\n",r+="_resolve(Promise.resolve().then((function() { throw _err; })));\n",r+="else\n",r+="_reject(_err);\n",r+="};\n"),r+=n,e&&(r+="_sync = false;\n"),r+="}));\n",t=new Function(this.args(),r)}return this.deinit(),t}setup(e,t){e._x=t.taps.map((e=>e.fn))}init(e){this.options=e,this._args=e.args.slice()}deinit(){this.options=void 0,this._args=void 0}contentWithInterceptors(e){if(this.options.interceptors.length>0){const t=e.onError,n=e.onResult,r=e.onDone;let i="";for(let e=0;e<this.options.interceptors.length;e++){const t=this.options.interceptors[e];t.call&&(i+=`${this.getInterceptor(e)}.call(${this.args({before:t.context?"_context":void 0})});\n`)}return i+=this.content(Object.assign(e,{onError:t&&(e=>{let n="";for(let t=0;t<this.options.interceptors.length;t++)this.options.interceptors[t].error&&(n+=`${this.getInterceptor(t)}.error(${e});\n`);return n+=t(e),n}),onResult:n&&(e=>{let t="";for(let n=0;n<this.options.interceptors.length;n++)this.options.interceptors[n].result&&(t+=`${this.getInterceptor(n)}.result(${e});\n`);return t+=n(e),t}),onDone:r&&(()=>{let e="";for(let t=0;t<this.options.interceptors.length;t++)this.options.interceptors[t].done&&(e+=`${this.getInterceptor(t)}.done();\n`);return e+=r(),e})})),i}return this.content(e)}header(){let e="";return this.needContext()?e+="var _context = {};\n":e+="var _context;\n",e+="var _x = this._x;\n",this.options.interceptors.length>0&&(e+="var _taps = this.taps;\n",e+="var _interceptors = this.interceptors;\n"),e}needContext(){for(const e of this.options.taps)if(e.context)return!0;return!1}callTap(e,{onError:t,onResult:n,onDone:r,rethrowIfPossible:i}){let o="",a=!1;for(let t=0;t<this.options.interceptors.length;t++){const n=this.options.interceptors[t];n.tap&&(a||(o+=`var _tap${e} = ${this.getTap(e)};\n`,a=!0),o+=`${this.getInterceptor(t)}.tap(${n.context?"_context, ":""}_tap${e});\n`)}o+=`var _fn${e} = ${this.getTapFn(e)};\n`;const s=this.options.taps[e];switch(s.type){case"sync":i||(o+=`var _hasError${e} = false;\n`,o+="try {\n"),o+=n?`var _result${e} = _fn${e}(${this.args({before:s.context?"_context":void 0})});\n`:`_fn${e}(${this.args({before:s.context?"_context":void 0})});\n`,i||(o+="} catch(_err) {\n",o+=`_hasError${e} = true;\n`,o+=t("_err"),o+="}\n",o+=`if(!_hasError${e}) {\n`),n&&(o+=n(`_result${e}`)),r&&(o+=r()),i||(o+="}\n");break;case"async":let a="";a+=n?`(function(_err${e}, _result${e}) {\n`:`(function(_err${e}) {\n`,a+=`if(_err${e}) {\n`,a+=t(`_err${e}`),a+="} else {\n",n&&(a+=n(`_result${e}`)),r&&(a+=r()),a+="}\n",a+="})",o+=`_fn${e}(${this.args({before:s.context?"_context":void 0,after:a})});\n`;break;case"promise":o+=`var _hasResult${e} = false;\n`,o+=`var _promise${e} = _fn${e}(${this.args({before:s.context?"_context":void 0})});\n`,o+=`if (!_promise${e} || !_promise${e}.then)\n`,o+=`  throw new Error('Tap function (tapPromise) did not return promise (returned ' + _promise${e} + ')');\n`,o+=`_promise${e}.then((function(_result${e}) {\n`,o+=`_hasResult${e} = true;\n`,n&&(o+=n(`_result${e}`)),r&&(o+=r()),o+=`}), function(_err${e}) {\n`,o+=`if(_hasResult${e}) throw _err${e};\n`,o+=t(`_err${e}`),o+="});\n"}return o}callTapsSeries({onError:e,onResult:t,resultReturns:n,onDone:r,doneReturns:i,rethrowIfPossible:o}){if(0===this.options.taps.length)return r();const a=this.options.taps.findIndex((e=>"sync"!==e.type)),s=n||i;let u="",c=r,l=0;for(let n=this.options.taps.length-1;n>=0;n--){const i=n;c!==r&&("sync"!==this.options.taps[i].type||l++>20)&&(l=0,u+=`function _next${i}() {\n`,u+=c(),u+="}\n",c=()=>`${s?"return ":""}_next${i}();\n`);const h=c,f=e=>e?"":r(),d=this.callTap(i,{onError:t=>e(i,t,h,f),onResult:t&&(e=>t(i,e,h,f)),onDone:!t&&h,rethrowIfPossible:o&&(a<0||i<a)});c=()=>d}return u+=c(),u}callTapsLooping({onError:e,onDone:t,rethrowIfPossible:n}){if(0===this.options.taps.length)return t();const r=this.options.taps.every((e=>"sync"===e.type));let i="";r||(i+="var _looper = (function() {\n",i+="var _loopAsync = false;\n"),i+="var _loop;\n",i+="do {\n",i+="_loop = false;\n";for(let e=0;e<this.options.interceptors.length;e++){const t=this.options.interceptors[e];t.loop&&(i+=`${this.getInterceptor(e)}.loop(${this.args({before:t.context?"_context":void 0})});\n`)}return i+=this.callTapsSeries({onError:e,onResult:(e,t,n,i)=>{let o="";return o+=`if(${t} !== undefined) {\n`,o+="_loop = true;\n",r||(o+="if(_loopAsync) _looper();\n"),o+=i(!0),o+="} else {\n",o+=n(),o+="}\n",o},onDone:t&&(()=>{let e="";return e+="if(!_loop) {\n",e+=t(),e+="}\n",e}),rethrowIfPossible:n&&r}),i+="} while(_loop);\n",r||(i+="_loopAsync = true;\n",i+="});\n",i+="_looper();\n"),i}callTapsParallel({onError:e,onResult:t,onDone:n,rethrowIfPossible:r,onTap:i=((e,t)=>t())}){if(this.options.taps.length<=1)return this.callTapsSeries({onError:e,onResult:t,onDone:n,rethrowIfPossible:r});let o="";o+="do {\n",o+=`var _counter = ${this.options.taps.length};\n`,n&&(o+="var _done = (function() {\n",o+=n(),o+="});\n");for(let a=0;a<this.options.taps.length;a++){const s=()=>n?"if(--_counter === 0) _done();\n":"--_counter;",u=e=>e||!n?"_counter = 0;\n":"_counter = 0;\n_done();\n";o+="if(_counter <= 0) break;\n",o+=i(a,(()=>this.callTap(a,{onError:t=>{let n="";return n+="if(_counter > 0) {\n",n+=e(a,t,s,u),n+="}\n",n},onResult:t&&(e=>{let n="";return n+="if(_counter > 0) {\n",n+=t(a,e,s,u),n+="}\n",n}),onDone:!t&&(()=>s()),rethrowIfPossible:r})),s,u)}return o+="} while(false);\n",o}args({before:e,after:t}={}){let n=this._args;return e&&(n=[e].concat(n)),t&&(n=n.concat(t)),0===n.length?"":n.join(", ")}getTapFn(e){return`_x[${e}]`}getTap(e){return`_taps[${e}]`}getInterceptor(e){return`_interceptors[${e}]`}}},2459:(e,t,n)=>{"use strict";const r=n(517),i=(e,t)=>t;class o{constructor(e,t){this._map=new Map,this.name=t,this._factory=e,this._interceptors=[]}get(e){return this._map.get(e)}for(e){const t=this.get(e);if(void 0!==t)return t;let n=this._factory(e);const r=this._interceptors;for(let t=0;t<r.length;t++)n=r[t].factory(e,n);return this._map.set(e,n),n}intercept(e){this._interceptors.push(Object.assign({factory:i},e))}}o.prototype.tap=r.deprecate((function(e,t,n){return this.for(e).tap(t,n)}),"HookMap#tap(key,…) is deprecated. Use HookMap#for(key).tap(…) instead."),o.prototype.tapAsync=r.deprecate((function(e,t,n){return this.for(e).tapAsync(t,n)}),"HookMap#tapAsync(key,…) is deprecated. Use HookMap#for(key).tapAsync(…) instead."),o.prototype.tapPromise=r.deprecate((function(e,t,n){return this.for(e).tapPromise(t,n)}),"HookMap#tapPromise(key,…) is deprecated. Use HookMap#for(key).tapPromise(…) instead."),e.exports=o},942:(e,t,n)=>{"use strict";n(6534);class r{constructor(e,t){this.hooks=e,this.name=t}tap(e,t){for(const n of this.hooks)n.tap(e,t)}tapAsync(e,t){for(const n of this.hooks)n.tapAsync(e,t)}tapPromise(e,t){for(const n of this.hooks)n.tapPromise(e,t)}isUsed(){for(const e of this.hooks)if(e.isUsed())return!0;return!1}intercept(e){for(const t of this.hooks)t.intercept(e)}withOptions(e){return new r(this.hooks.map((t=>t.withOptions(e))),this.name)}}e.exports=r},3922:(e,t,n)=>{"use strict";const r=n(6534),i=n(2275),o=new class extends i{content({onError:e,onResult:t,resultReturns:n,onDone:r,rethrowIfPossible:i}){return this.callTapsSeries({onError:(t,n)=>e(n),onResult:(e,n,r)=>`if(${n} !== undefined) {\n${t(n)};\n} else {\n${r()}}\n`,resultReturns:n,onDone:r,rethrowIfPossible:i})}},a=()=>{throw new Error("tapAsync is not supported on a SyncBailHook")},s=()=>{throw new Error("tapPromise is not supported on a SyncBailHook")},u=function(e){return o.setup(this,e),o.create(e)};function c(e=[],t){const n=new r(e,t);return n.constructor=c,n.tapAsync=a,n.tapPromise=s,n.compile=u,n}c.prototype=null,e.exports=c},537:(e,t,n)=>{"use strict";const r=n(6534),i=n(2275),o=new class extends i{content({onError:e,onDone:t,rethrowIfPossible:n}){return this.callTapsSeries({onError:(t,n)=>e(n),onDone:t,rethrowIfPossible:n})}},a=()=>{throw new Error("tapAsync is not supported on a SyncHook")},s=()=>{throw new Error("tapPromise is not supported on a SyncHook")},u=function(e){return o.setup(this,e),o.create(e)};function c(e=[],t){const n=new r(e,t);return n.constructor=c,n.tapAsync=a,n.tapPromise=s,n.compile=u,n}c.prototype=null,e.exports=c},3074:(e,t,n)=>{"use strict";const r=n(6534),i=n(2275),o=new class extends i{content({onError:e,onDone:t,rethrowIfPossible:n}){return this.callTapsLooping({onError:(t,n)=>e(n),onDone:t,rethrowIfPossible:n})}},a=()=>{throw new Error("tapAsync is not supported on a SyncLoopHook")},s=()=>{throw new Error("tapPromise is not supported on a SyncLoopHook")},u=function(e){return o.setup(this,e),o.create(e)};function c(e=[],t){const n=new r(e,t);return n.constructor=c,n.tapAsync=a,n.tapPromise=s,n.compile=u,n}c.prototype=null,e.exports=c},2076:(e,t,n)=>{"use strict";const r=n(6534),i=n(2275),o=new class extends i{content({onError:e,onResult:t,resultReturns:n,rethrowIfPossible:r}){return this.callTapsSeries({onError:(t,n)=>e(n),onResult:(e,t,n)=>{let r="";return r+=`if(${t} !== undefined) {\n`,r+=`${this._args[0]} = ${t};\n`,r+="}\n",r+=n(),r},onDone:()=>t(this._args[0]),doneReturns:n,rethrowIfPossible:r})}},a=()=>{throw new Error("tapAsync is not supported on a SyncWaterfallHook")},s=()=>{throw new Error("tapPromise is not supported on a SyncWaterfallHook")},u=function(e){return o.setup(this,e),o.create(e)};function c(e=[],t){if(e.length<1)throw new Error("Waterfall hooks must have at least one argument");const n=new r(e,t);return n.constructor=c,n.tapAsync=a,n.tapPromise=s,n.compile=u,n}c.prototype=null,e.exports=c},9991:(e,t,n)=>{"use strict";t.SyncHook=n(537),n(3922),t.SyncWaterfallHook=n(2076),n(3074),n(6714),n(7247),t.AsyncSeriesHook=n(1617),n(1293),n(996),t.AsyncSeriesWaterfallHook=n(7178),n(2459),n(942)},517:(e,t)=>{"use strict";t.deprecate=(e,t)=>{let n=!0;return function(){return n&&(console.warn("DeprecationWarning: "+t),n=!1),e.apply(this,arguments)}}},6285:()=>{},5e3:()=>{}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={exports:{}};return e[r].call(o.exports,o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";var e={};n.r(e),n.d(e,{add:()=>xe,angle:()=>tt,bezier:()=>Ye,ceil:()=>Ne,clone:()=>Te,copy:()=>Se,create:()=>Ee,cross:()=>He,dist:()=>lt,distance:()=>Le,div:()=>ct,divide:()=>Pe,dot:()=>Xe,equals:()=>ot,exactEquals:()=>it,floor:()=>Oe,forEach:()=>pt,fromValues:()=>Ae,hermite:()=>ze,inverse:()=>We,len:()=>ft,length:()=>Re,lerp:()=>je,max:()=>Ie,min:()=>Be,mul:()=>ut,multiply:()=>Me,negate:()=>Ge,normalize:()=>Ve,random:()=>qe,rotateX:()=>Qe,rotateY:()=>Je,rotateZ:()=>et,round:()=>De,scale:()=>Fe,scaleAndAdd:()=>we,set:()=>be,sqrDist:()=>ht,sqrLen:()=>dt,squaredDistance:()=>ke,squaredLength:()=>Ue,str:()=>rt,sub:()=>st,subtract:()=>Ce,transformMat3:()=>Ze,transformMat4:()=>Ke,transformQuat:()=>$e,zero:()=>nt});var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},t(e,n)};function r(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var i=function(){return i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i.apply(this,arguments)};function o(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function a(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}function s(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function u(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))}function c(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function l(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function h(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function f(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}Object.create,Object.create;var d,p,v,g=n(6700);function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(Object(n),!0).forEach((function(t){A(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function m(e){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m(e)}function E(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function T(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function R(e,t,n){return t&&T(e.prototype,t),n&&T(e,n),e}function A(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function b(e,t){return t.lifecycle===p.Lifecycle.singleton?function(e){return e.inSingletonScope()}(e):function(e){return e.inTransientScope()}(e)}function x(e,t){e.whenTargetNamed(P(t))}function C(e,t){return t.container.bind(N(e))}function M(e,t){var n=t.container.parent,r=n&&n.isBound(N(e));return t.container.isBound(N(e))&&!r?t.container.rebind(N(e)):t.container.bind(N(e))}function P(e){return v.isDefinedToken(e)?e.symbol:e}function N(e){return v.isDefinedToken(e)?e.symbol:e}!function(e){!function(t){var r="object"==typeof n.g?n.g:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),i=o(e);function o(e,t){return function(n,r){"function"!=typeof e[n]&&Object.defineProperty(e,n,{configurable:!0,writable:!0,value:r}),t&&t(n,r)}}void 0===r.Reflect?r.Reflect=e:i=o(r.Reflect,i),function(e){var t=Object.prototype.hasOwnProperty,n="function"==typeof Symbol,r=n&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",i=n&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",o="function"==typeof Object.create,a={__proto__:[]}instanceof Array,s=!o&&!a,u={create:o?function(){return F(Object.create(null))}:a?function(){return F({__proto__:null})}:function(){return F({})},has:s?function(e,n){return t.call(e,n)}:function(e,t){return t in e},get:s?function(e,n){return t.call(e,n)?e[n]:void 0}:function(e,t){return e[t]}},c=Object.getPrototypeOf(Function),l="object"==typeof process&&process.env&&"true"===process.env.REFLECT_METADATA_USE_MAP_POLYFILL,h=l||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function(){var e={},t=[],n=function(){function e(e,t,n){this._index=0,this._keys=e,this._values=t,this._selector=n}return e.prototype["@@iterator"]=function(){return this},e.prototype[i]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var n=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var n=this._find(e,!0);return this._values[n]=t,this},t.prototype.delete=function(t){var n=this._find(t,!1);if(n>=0){for(var r=this._keys.length,i=n+1;i<r;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,t===this._cacheKey&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new n(this._keys,this._values,r)},t.prototype.values=function(){return new n(this._keys,this._values,o)},t.prototype.entries=function(){return new n(this._keys,this._values,a)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[i]=function(){return this.entries()},t.prototype._find=function(e,t){return this._cacheKey!==e&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=e)),this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function r(e,t){return e}function o(e,t){return t}function a(e,t){return[e,t]}}():Map,f=l||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function(){function e(){this._map=new h}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.values()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[i]=function(){return this.keys()},e}():Set,d=new(l||"function"!=typeof WeakMap?function(){var e=u.create(),n=r();return function(){function e(){this._key=r()}return e.prototype.has=function(e){var t=i(e,!1);return void 0!==t&&u.has(t,this._key)},e.prototype.get=function(e){var t=i(e,!1);return void 0!==t?u.get(t,this._key):void 0},e.prototype.set=function(e,t){return i(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=i(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=r()},e}();function r(){var t;do{t="@@WeakMap@@"+a()}while(u.has(e,t));return e[t]=!0,t}function i(e,r){if(!t.call(e,n)){if(!r)return;Object.defineProperty(e,n,{value:u.create()})}return e[n]}function o(e,t){for(var n=0;n<t;++n)e[n]=255*Math.random()|0;return e}function a(){var e,t=(e=16,"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(e)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(e)):o(new Uint8Array(e),e):o(new Array(e),e));t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var n="",r=0;r<16;++r){var i=t[r];4!==r&&6!==r&&8!==r||(n+="-"),i<16&&(n+="0"),n+=i.toString(16).toLowerCase()}return n}}():WeakMap);function p(e,t,n){var r=d.get(e);if(A(r)){if(!n)return;r=new h,d.set(e,r)}var i=r.get(t);if(A(i)){if(!n)return;i=new h,r.set(t,i)}return i}function v(e,t,n){if(g(e,t,n))return!0;var r=D(t);return!S(r)&&v(e,r,n)}function g(e,t,n){var r=p(t,n,!1);return!A(r)&&!!r.has(e)}function _(e,t,n){if(g(e,t,n))return y(e,t,n);var r=D(t);return S(r)?void 0:_(e,r,n)}function y(e,t,n){var r=p(t,n,!1);if(!A(r))return r.get(e)}function m(e,t,n,r){p(n,r,!0).set(e,t)}function E(e,t){var n=T(e,t),r=D(e);if(null===r)return n;var i=E(r,t);if(i.length<=0)return n;if(n.length<=0)return i;for(var o=new f,a=[],s=0,u=n;s<u.length;s++){var c=u[s];o.has(c)||(o.add(c),a.push(c))}for(var l=0,h=i;l<h.length;l++)c=h[l],o.has(c)||(o.add(c),a.push(c));return a}function T(e,t){var n=[],r=p(e,t,!1);if(A(r))return n;for(var o=function(e){var t=O(e,i);if(!P(t))throw new TypeError;var n=t.call(e);if(!b(n))throw new TypeError;return n}(r.keys()),a=0;;){var s=B(o);if(!s)return n.length=a,n;var u=s.value;try{n[a]=u}catch(e){try{I(o)}finally{throw e}}a++}}function R(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function A(e){return void 0===e}function S(e){return null===e}function b(e){return"object"==typeof e?null!==e:"function"==typeof e}function x(e,t){switch(R(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var n=3===t?"string":5===t?"number":"default",i=O(e,r);if(void 0!==i){var o=i.call(e,n);if(b(o))throw new TypeError;return o}return function(e,t){if("string"===t){var n=e.toString;if(P(n)&&!b(i=n.call(e)))return i;if(P(r=e.valueOf)&&!b(i=r.call(e)))return i}else{var r;if(P(r=e.valueOf)&&!b(i=r.call(e)))return i;var i,o=e.toString;if(P(o)&&!b(i=o.call(e)))return i}throw new TypeError}(e,"default"===n?"number":n)}function C(e){var t=x(e,3);return"symbol"==typeof t?t:function(e){return""+e}(t)}function M(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function P(e){return"function"==typeof e}function N(e){return"function"==typeof e}function O(e,t){var n=e[t];if(null!=n){if(!P(n))throw new TypeError;return n}}function B(e){var t=e.next();return!t.done&&t}function I(e){var t=e.return;t&&t.call(e)}function D(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===c)return t;if(t!==c)return t;var n=e.prototype,r=n&&Object.getPrototypeOf(n);if(null==r||r===Object.prototype)return t;var i=r.constructor;return"function"!=typeof i||i===e?t:i}function F(e){return e.__=void 0,delete e.__,e}e("decorate",(function(e,t,n,r){if(A(n)){if(!M(e))throw new TypeError;if(!N(t))throw new TypeError;return function(e,t){for(var n=e.length-1;n>=0;--n){var r=(0,e[n])(t);if(!A(r)&&!S(r)){if(!N(r))throw new TypeError;t=r}}return t}(e,t)}if(!M(e))throw new TypeError;if(!b(t))throw new TypeError;if(!b(r)&&!A(r)&&!S(r))throw new TypeError;return S(r)&&(r=void 0),function(e,t,n,r){for(var i=e.length-1;i>=0;--i){var o=(0,e[i])(t,n,r);if(!A(o)&&!S(o)){if(!b(o))throw new TypeError;r=o}}return r}(e,t,n=C(n),r)})),e("metadata",(function(e,t){return function(n,r){if(!b(n))throw new TypeError;if(!A(r)&&!function(e){switch(R(e)){case 3:case 4:return!0;default:return!1}}(r))throw new TypeError;m(e,t,n,r)}})),e("defineMetadata",(function(e,t,n,r){if(!b(n))throw new TypeError;return A(r)||(r=C(r)),m(e,t,n,r)})),e("hasMetadata",(function(e,t,n){if(!b(t))throw new TypeError;return A(n)||(n=C(n)),v(e,t,n)})),e("hasOwnMetadata",(function(e,t,n){if(!b(t))throw new TypeError;return A(n)||(n=C(n)),g(e,t,n)})),e("getMetadata",(function(e,t,n){if(!b(t))throw new TypeError;return A(n)||(n=C(n)),_(e,t,n)})),e("getOwnMetadata",(function(e,t,n){if(!b(t))throw new TypeError;return A(n)||(n=C(n)),y(e,t,n)})),e("getMetadataKeys",(function(e,t){if(!b(e))throw new TypeError;return A(t)||(t=C(t)),E(e,t)})),e("getOwnMetadataKeys",(function(e,t){if(!b(e))throw new TypeError;return A(t)||(t=C(t)),T(e,t)})),e("deleteMetadata",(function(e,t,n){if(!b(t))throw new TypeError;A(n)||(n=C(n));var r=p(t,n,!1);if(A(r))return!1;if(!r.delete(e))return!1;if(r.size>0)return!0;var i=d.get(t);return i.delete(n),i.size>0||d.delete(t),!0}))}(i)}()}(d||(d={})),function(e){var t;e.defineToken=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{multiple:!0};return new e.DefinedToken(t,n)},e.DefinedToken=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};E(this,e),this.prototype={},this.name=void 0,this.multiple=void 0,this.symbol=void 0;var r=n.multiple,i=void 0!==r&&r;this.name=t,this.symbol=Symbol(this.name),this.multiple=i},e.isModule=function(e){return!!e&&"object"===m(e)&&"id"in e&&"registry"in e},function(e){e.singleton="singleton",e.transient="transient"}(t=e.Lifecycle||(e.Lifecycle={})),e.ClassOptionSymbol=Symbol("SyringeClassOptionSymbol"),e.DefaultOption={lifecycle:t.transient}}(p||(p={})),function(e){e.maybeArrayToArray=function(e){return e instanceof Array?e:void 0!==e?[e]:[]},e.isClass=function(e){return!(!e||"function"!=typeof e||!("prototype"in e))},e.isDefinedToken=function(e){return!!(e&&"object"===m(e)&&"symbol"in e&&"multiple"in e)},e.isInjectOption=function(e){return!(!e||"object"!==m(e)||!("token"in e))},e.isNamedToken=function(e){return!!(e&&"object"===m(e)&&"token"in e&&"named"in e)},e.isMultipleEnabled=function(t){return e.isDefinedToken(t)&&t.multiple}}(v||(v={}));var O=new g.W2;function B(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,g.b2)();return function(n){Reflect.defineMetadata(p.ClassOptionSymbol,y(y({},e),{},{target:n}),n),t(n)}}function I(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return B(y(y({},e),{},{lifecycle:p.Lifecycle.singleton}))}function D(e){return(0,g.f3)(N(e))}var F=Symbol("SyringeOptionSymbol"),w=function(){function e(t,n,r){E(this,e),this.token=void 0,this.rawToken=void 0,this.named=void 0,this.generalToken=void 0,this.option=void 0,this.context=void 0,this.mutiple=void 0,this.context=t,this.token=n,this.option=r,this.rawToken=v.isNamedToken(n)?n.token:n,this.named=v.isNamedToken(n)?n.named:void 0,this.mutiple=!!this.named||v.isMultipleEnabled(this.rawToken),this.generalToken=this.rawToken}return R(e,[{key:"resolve",value:function(){var e,t=this,n=this.context;(e=n)&&"object"===m(e)&&"container"in e&&"inversify"in e&&(this.mutiple?this.resolveMutilple(n):(this.resolveMono(n),!this.named&&this.option.contrib.length>0&&this.option.contrib.forEach((function(e){v.isMultipleEnabled(e)?C(e,n).toService(t.generalToken):M(e,n).toService(t.generalToken)}))))}},{key:"resolveMono",value:function(e){var t=this;if("useValue"in this.option)return M(this.generalToken,e).toConstantValue(this.option.useValue);if(this.option.useDynamic.length>0){var n=this.option.useDynamic[this.option.useDynamic.length-1];return b(M(this.generalToken,e).toDynamicValue((function(){return n({container:t.context})})),this.option)}if(this.option.useFactory.length>0){var r=this.option.useFactory[this.option.useFactory.length-1];return M(this.generalToken,e).toFactory((function(){return r({container:t.context})}))}if(this.option.useClass.length>0){var i=this.option.useClass[this.option.useClass.length-1];return b(M(this.generalToken,e).to(i),this.option)}}},{key:"resolveMutilple",value:function(e){var t=this,n=this.option.useClass.map((function(n){return b(C(t.generalToken,e).to(n),t.option)})),r=this.option.useDynamic.map((function(n){return b(C(t.generalToken,e).toDynamicValue((function(){return n({container:t.context})})),t.option)})),i=this.option.useFactory.map((function(n){return C(t.generalToken,e).toFactory((function(){return n({container:t.context})}))})),o="useValue"in this.option?C(this.generalToken,e).toConstantValue(this.option.useValue):void 0;this.named&&(n.forEach((function(e){return t.named&&x(e,t.named)})),r.forEach((function(e){return t.named&&x(e,t.named)})),i.forEach((function(e){return t.named&&x(e,t.named)})),o&&x(o,this.named))}}],[{key:"resolveTarget",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{try{var i=Reflect.getMetadata(F,n);i&&e.resolveOption(t,i)}catch(e){}if(v.isClass(n))if(r.useClass){var o=v.maybeArrayToArray(r.useClass);o.unshift(n),r.useClass=o}else r.useClass=[n];var a;try{a=Reflect.getMetadata(p.ClassOptionSymbol,n)}catch(e){}if((a=y(y({},a||{}),r)).token){var s=v.maybeArrayToArray(a.token);s.unshift(n),a.token=s}else a.token=[n];e.resolveOption(t,a)}catch(e){}}},{key:"resolveOption",value:function(t,n){var r=function(e){var t=v.maybeArrayToArray(e.token),n=v.maybeArrayToArray(e.useClass),r=v.maybeArrayToArray(e.useDynamic),i=v.maybeArrayToArray(e.useFactory),o=v.maybeArrayToArray(e.contrib),a=e.lifecycle||p.Lifecycle.transient,s={token:t,useClass:n,lifecycle:o.length>0?p.Lifecycle.singleton:a,contrib:o,useDynamic:r,useFactory:i};return"useValue"in e&&(s.useValue=e.useValue),s}(y(y({},e.globalConfig),n));(0!==r.useClass.length||0!==r.useDynamic.length||0!==r.useFactory.length||"useValue"in r)&&r.token.forEach((function(n){new e(t,n,y({},r)).resolve()}))}}]),e}();w.globalConfig=p.DefaultOption;var L=new(function(){function e(t){E(this,e),this.loadedModules=[],this.container=void 0,this.inversify=!0,this.parent=void 0,this.container=t||new g.W2}return R(e,[{key:"load",value:function(e,t){!t&&this.loadedModules.includes(e.id)||(e.registry(this.register.bind(this),this.resolveContext()),this.loadedModules.push(e.id))}},{key:"remove",value:function(e){return this.container.unbind(N(e))}},{key:"get",value:function(e){return this.container.get(N(e))}},{key:"getNamed",value:function(e,t){return this.container.getNamed(N(e),P(t))}},{key:"getAll",value:function(e){return this.container.getAll(N(e))}},{key:"getAllNamed",value:function(e,t){return this.container.getAllNamed(N(e),P(t))}},{key:"isBound",value:function(e){return this.container.isBound(N(e))}},{key:"isBoundNamed",value:function(e,t){return this.container.isBoundNamed(N(e),P(t))}},{key:"createChild",value:function(){var t=new e(this.container.createChild());return t.parent=this,t}},{key:"register",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};v.isInjectOption(e)?w.resolveOption(this,e):w.resolveTarget(this,e,t)}},{key:"resolveContext",value:function(){return{container:this}}}],[{key:"config",value:function(e){w.globalConfig=e}}]),e}())(O),k=(L.register.bind(L),p.defineToken("ContributionProvider")),U=function(){function e(t,n,r){E(this,e),this.option={recursive:!1,cache:!0},this.services=void 0,this.serviceIdentifier=void 0,this.container=void 0,this.container=n,this.serviceIdentifier=t,r&&(this.option=y(y({},this.option),r))}return R(e,[{key:"setServices",value:function(e){for(var t=[],n=this.container;n;){if(n.isBound(this.serviceIdentifier)){var r=n.getAll(this.serviceIdentifier);t.push.apply(t,function(e){if(Array.isArray(e))return S(e)}(i=r)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(i)||function(e,t){if(e){if("string"==typeof e)return S(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?S(e,t):void 0}}(i)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}n=e?n.parent:void 0}var i;return t}},{key:"getContributions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=y(y({},this.option),e),n=t.cache,r=t.recursive;return n&&void 0!==this.services||(this.services=this.setServices(!!r)),this.services}}]),e}();function G(e,t){return{token:{token:k,named:e},useDynamic:function(n){return new U(e,n.container,t)},lifecycle:p.Lifecycle.singleton}}function W(e,t,n){e({token:{token:k,named:t},useDynamic:function(e){return new U(t,e.container,n)},lifecycle:p.Lifecycle.singleton})}var V=function(){function e(t){E(this,e),this.id=void 0,this.baseRegistry=void 0,this.optionCollection=void 0,e.moduleId+=1,this.id=e.moduleId,this.baseRegistry=t}return R(e,[{key:"registry",get:function(){var e=this;return function(t,n){e.baseRegistry&&e.baseRegistry(t,n),e.optionCollection&&e.optionCollection.forEach((function(e){return t(e)}))}}},{key:"options",get:function(){return this.optionCollection||(this.optionCollection=[]),this.optionCollection}},{key:"register",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.forEach((function(t){return e.options.push(t)})),this}},{key:"contribution",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.forEach((function(t){return e.options.push(G(t))})),this}}]),e}();function X(e){return new V(e)}V.moduleId=0;var H,j=function(e){return function(t,n,r){var i;(i=e,(0,g.t6)(P(i)))(t,n,r),D(k)(t,n,r)}};!function(e){e.Provider=k,e.register=W}(H||(H={}));var z=n(6729),Y=function(){function e(){this.pool={}}return e.prototype.getByEntity=function(e){return this.pool[e]},e.prototype.add=function(e,t){this.pool[e]=t},e.prototype.remove=function(e){delete this.pool[e]},a([I()],e)}(),q={}.toString;const K=function(e,t){return q.call(e)==="[object "+t+"]"},Z=function(e){return K(e,"Function")},$=function(e){return Array.isArray?Array.isArray(e):K(e,"Array")},Q=function(e){var t=typeof e;return null!==e&&"object"===t||"function"===t},J=function(e,t){if(e)if($(e))for(var n=0,r=e.length;n<r&&!1!==t(e[n],n);n++);else if(Q(e))for(var i in e)if(e.hasOwnProperty(i)&&!1===t(e[i],i))break};Object.keys;const ee=function(e){if($(e))return e.reduce((function(e,t){return Math.max(e,t)}),e[0])},te=function(e){if($(e))return e.reduce((function(e,t){return Math.min(e,t)}),e[0])};var ne=Array.prototype;ne.splice,ne.indexOf,Array.prototype.splice;const re=function(e){return K(e,"String")};Object.prototype.hasOwnProperty;const ie=function(e,t,n){return e<t?t:e>n?n:e},oe=function(e){return K(e,"Number")};Number.isInteger&&Number.isInteger;Math.PI,parseInt;var ae=Math.PI/180;const se=Object.values?function(e){return Object.values(e)}:function(e){var t=[];return J(e,(function(n,r){Z(e)&&"prototype"===r||t.push(n)})),t},ue=function(e){return K(e,"Boolean")},ce=function(e){return null==e};Object.prototype;const le=function(e){return void 0===e};Object.prototype.hasOwnProperty;const he=function(e){return"object"==typeof e&&null!==e},fe=function(e){return null!==e&&"function"!=typeof e&&isFinite(e.length)};var de=function(e,t){if(e===t)return!0;if(!e||!t)return!1;if(re(e)||re(t))return!1;if(fe(e)||fe(t)){if(e.length!==t.length)return!1;for(var n=!0,r=0;r<e.length&&(n=de(e[r],t[r]));r++);return n}if(he(e)||he(t)){var i=Object.keys(e),o=Object.keys(t);if(i.length!==o.length)return!1;for(n=!0,r=0;r<i.length&&(n=de(e[i[r]],t[i[r]]));r++);return n}return!1};const pe=de;var ve;Object.prototype.hasOwnProperty,function(e,t){if(!Z(e))throw new TypeError("Expected a function");var n=function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];var o=t?t.apply(this,r):r[0],a=n.cache;if(a.has(o))return a.get(o);var s=e.apply(this,r);return a.set(o,s),s};n.cache=new Map}((function(e,t){void 0===t&&(t={});var n=t.fontSize,r=t.fontFamily,i=t.fontWeight,o=t.fontStyle,a=t.fontVariant;return ve||(ve=document.createElement("canvas").getContext("2d")),ve.font=[o,a,i,n+"px",r].join(" "),ve.measureText(re(e)?e:"").width}),(function(e,t){return void 0===t&&(t={}),function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}([e],se(t)).join("")})),function(){function e(){this.map={}}e.prototype.has=function(e){return void 0!==this.map[e]},e.prototype.get=function(e,t){var n=this.map[e];return void 0===n?t:n},e.prototype.set=function(e,t){this.map[e]=t},e.prototype.clear=function(){this.map={}},e.prototype.delete=function(e){delete this.map[e]},e.prototype.size=function(){return Object.keys(this.map).length}}();var ge=1e-6,_e="undefined"!=typeof Float32Array?Float32Array:Array,ye=Math.random;function me(){var e=new _e(9);return _e!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function Ee(){var e=new _e(3);return _e!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Te(e){var t=new _e(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Re(e){var t=e[0],n=e[1],r=e[2];return Math.hypot(t,n,r)}function Ae(e,t,n){var r=new _e(3);return r[0]=e,r[1]=t,r[2]=n,r}function Se(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function be(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e}function xe(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function Ce(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function Me(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function Pe(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function Ne(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function Oe(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function Be(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e}function Ie(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e}function De(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function Fe(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function we(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e}function Le(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.hypot(n,r,i)}function ke(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return n*n+r*r+i*i}function Ue(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}function Ge(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function We(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function Ve(e,t){var n=t[0],r=t[1],i=t[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function Xe(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function He(e,t,n){var r=t[0],i=t[1],o=t[2],a=n[0],s=n[1],u=n[2];return e[0]=i*u-o*s,e[1]=o*a-r*u,e[2]=r*s-i*a,e}function je(e,t,n,r){var i=t[0],o=t[1],a=t[2];return e[0]=i+r*(n[0]-i),e[1]=o+r*(n[1]-o),e[2]=a+r*(n[2]-a),e}function ze(e,t,n,r,i,o){var a=o*o,s=a*(2*o-3)+1,u=a*(o-2)+o,c=a*(o-1),l=a*(3-2*o);return e[0]=t[0]*s+n[0]*u+r[0]*c+i[0]*l,e[1]=t[1]*s+n[1]*u+r[1]*c+i[1]*l,e[2]=t[2]*s+n[2]*u+r[2]*c+i[2]*l,e}function Ye(e,t,n,r,i,o){var a=1-o,s=a*a,u=o*o,c=s*a,l=3*o*s,h=3*u*a,f=u*o;return e[0]=t[0]*c+n[0]*l+r[0]*h+i[0]*f,e[1]=t[1]*c+n[1]*l+r[1]*h+i[1]*f,e[2]=t[2]*c+n[2]*l+r[2]*h+i[2]*f,e}function qe(e,t){t=t||1;var n=2*ye()*Math.PI,r=2*ye()-1,i=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(n)*i,e[1]=Math.sin(n)*i,e[2]=r*t,e}function Ke(e,t,n){var r=t[0],i=t[1],o=t[2],a=n[3]*r+n[7]*i+n[11]*o+n[15];return a=a||1,e[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/a,e[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/a,e[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/a,e}function Ze(e,t,n){var r=t[0],i=t[1],o=t[2];return e[0]=r*n[0]+i*n[3]+o*n[6],e[1]=r*n[1]+i*n[4]+o*n[7],e[2]=r*n[2]+i*n[5]+o*n[8],e}function $e(e,t,n){var r=n[0],i=n[1],o=n[2],a=n[3],s=t[0],u=t[1],c=t[2],l=i*c-o*u,h=o*s-r*c,f=r*u-i*s,d=i*f-o*h,p=o*l-r*f,v=r*h-i*l,g=2*a;return l*=g,h*=g,f*=g,d*=2,p*=2,v*=2,e[0]=s+l+d,e[1]=u+h+p,e[2]=c+f+v,e}function Qe(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e}function Je(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e}function et(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e}function tt(e,t){var n=e[0],r=e[1],i=e[2],o=t[0],a=t[1],s=t[2],u=Math.sqrt(n*n+r*r+i*i)*Math.sqrt(o*o+a*a+s*s),c=u&&Xe(e,t)/u;return Math.acos(Math.min(Math.max(c,-1),1))}function nt(e){return e[0]=0,e[1]=0,e[2]=0,e}function rt(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function it(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function ot(e,t){var n=e[0],r=e[1],i=e[2],o=t[0],a=t[1],s=t[2];return Math.abs(n-o)<=ge*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-a)<=ge*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-s)<=ge*Math.max(1,Math.abs(i),Math.abs(s))}Math.PI,Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var at,st=Ce,ut=Me,ct=Pe,lt=Le,ht=ke,ft=Re,dt=Ue,pt=(at=Ee(),function(e,t,n,r,i,o){var a,s;for(t||(t=3),n||(n=0),s=r?Math.min(r*t+n,e.length):e.length,a=n;a<s;a+=t)at[0]=e[a],at[1]=e[a+1],at[2]=e[a+2],i(at,at,o),e[a]=at[0],e[a+1]=at[1],e[a+2]=at[2];return e});function vt(){var e=new _e(4);return _e!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function gt(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,e[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,e[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,e[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,e}function _t(){var e=new _e(4);return _e!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function yt(e,t,n){n*=.5;var r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e}function mt(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=n[0],u=n[1],c=n[2],l=n[3];return e[0]=r*l+a*s+i*c-o*u,e[1]=i*l+a*u+o*s-r*c,e[2]=o*l+a*c+r*u-i*s,e[3]=a*l-r*s-i*u-o*c,e}function Et(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=n*n+r*r+i*i+o*o,s=a?1/a:0;return e[0]=-n*s,e[1]=-r*s,e[2]=-i*s,e[3]=o*s,e}function Tt(e,t,n,r){var i=.5*Math.PI/180;t*=i,n*=i,r*=i;var o=Math.sin(t),a=Math.cos(t),s=Math.sin(n),u=Math.cos(n),c=Math.sin(r),l=Math.cos(r);return e[0]=o*u*l-a*s*c,e[1]=a*s*l+o*u*c,e[2]=a*u*c-o*s*l,e[3]=a*u*l+o*s*c,e}vt();var Rt=function(e,t,n,r){var i=new _e(4);return i[0]=e,i[1]=t,i[2]=n,i[3]=r,i},At=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},St=mt;function bt(){var e=new _e(16);return _e!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function xt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Ct(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Mt(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],c=t[7],l=t[8],h=t[9],f=t[10],d=t[11],p=t[12],v=t[13],g=t[14],_=t[15],y=n*s-r*a,m=n*u-i*a,E=n*c-o*a,T=r*u-i*s,R=r*c-o*s,A=i*c-o*u,S=l*v-h*p,b=l*g-f*p,x=l*_-d*p,C=h*g-f*v,M=h*_-d*v,P=f*_-d*g,N=y*P-m*M+E*C+T*x-R*b+A*S;return N?(N=1/N,e[0]=(s*P-u*M+c*C)*N,e[1]=(i*M-r*P-o*C)*N,e[2]=(v*A-g*R+_*T)*N,e[3]=(f*R-h*A-d*T)*N,e[4]=(u*x-a*P-c*b)*N,e[5]=(n*P-i*x+o*b)*N,e[6]=(g*E-p*A-_*m)*N,e[7]=(l*A-f*E+d*m)*N,e[8]=(a*M-s*x+c*S)*N,e[9]=(r*x-n*M-o*S)*N,e[10]=(p*R-v*E+_*y)*N,e[11]=(h*E-l*R-d*y)*N,e[12]=(s*b-a*C-u*S)*N,e[13]=(n*C-r*b+i*S)*N,e[14]=(v*m-p*T-g*y)*N,e[15]=(l*T-h*m+f*y)*N,e):null}function Pt(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],c=t[6],l=t[7],h=t[8],f=t[9],d=t[10],p=t[11],v=t[12],g=t[13],_=t[14],y=t[15],m=n[0],E=n[1],T=n[2],R=n[3];return e[0]=m*r+E*s+T*h+R*v,e[1]=m*i+E*u+T*f+R*g,e[2]=m*o+E*c+T*d+R*_,e[3]=m*a+E*l+T*p+R*y,m=n[4],E=n[5],T=n[6],R=n[7],e[4]=m*r+E*s+T*h+R*v,e[5]=m*i+E*u+T*f+R*g,e[6]=m*o+E*c+T*d+R*_,e[7]=m*a+E*l+T*p+R*y,m=n[8],E=n[9],T=n[10],R=n[11],e[8]=m*r+E*s+T*h+R*v,e[9]=m*i+E*u+T*f+R*g,e[10]=m*o+E*c+T*d+R*_,e[11]=m*a+E*l+T*p+R*y,m=n[12],E=n[13],T=n[14],R=n[15],e[12]=m*r+E*s+T*h+R*v,e[13]=m*i+E*u+T*f+R*g,e[14]=m*o+E*c+T*d+R*_,e[15]=m*a+E*l+T*p+R*y,e}function Nt(e,t,n){var r,i,o,a,s,u,c,l,h,f,d,p,v=n[0],g=n[1],_=n[2];return t===e?(e[12]=t[0]*v+t[4]*g+t[8]*_+t[12],e[13]=t[1]*v+t[5]*g+t[9]*_+t[13],e[14]=t[2]*v+t[6]*g+t[10]*_+t[14],e[15]=t[3]*v+t[7]*g+t[11]*_+t[15]):(r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],c=t[6],l=t[7],h=t[8],f=t[9],d=t[10],p=t[11],e[0]=r,e[1]=i,e[2]=o,e[3]=a,e[4]=s,e[5]=u,e[6]=c,e[7]=l,e[8]=h,e[9]=f,e[10]=d,e[11]=p,e[12]=r*v+s*g+h*_+t[12],e[13]=i*v+u*g+f*_+t[13],e[14]=o*v+c*g+d*_+t[14],e[15]=a*v+l*g+p*_+t[15]),e}function Ot(e,t,n){var r=n[0],i=n[1],o=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Bt(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function It(e,t){var n=t[0],r=t[1],i=t[2],o=t[4],a=t[5],s=t[6],u=t[8],c=t[9],l=t[10];return e[0]=Math.hypot(n,r,i),e[1]=Math.hypot(o,a,s),e[2]=Math.hypot(u,c,l),e}function Dt(e,t){var n=new _e(3);It(n,t);var r=1/n[0],i=1/n[1],o=1/n[2],a=t[0]*r,s=t[1]*i,u=t[2]*o,c=t[4]*r,l=t[5]*i,h=t[6]*o,f=t[8]*r,d=t[9]*i,p=t[10]*o,v=a+l+p,g=0;return v>0?(g=2*Math.sqrt(v+1),e[3]=.25*g,e[0]=(h-d)/g,e[1]=(f-u)/g,e[2]=(s-c)/g):a>l&&a>p?(g=2*Math.sqrt(1+a-l-p),e[3]=(h-d)/g,e[0]=.25*g,e[1]=(s+c)/g,e[2]=(f+u)/g):l>p?(g=2*Math.sqrt(1+l-a-p),e[3]=(f-u)/g,e[0]=(s+c)/g,e[1]=.25*g,e[2]=(h+d)/g):(g=2*Math.sqrt(1+p-a-l),e[3]=(s-c)/g,e[0]=(f+u)/g,e[1]=(h+d)/g,e[2]=.25*g),e}function Ft(e,t,n,r,i){var o=t[0],a=t[1],s=t[2],u=t[3],c=o+o,l=a+a,h=s+s,f=o*c,d=o*l,p=o*h,v=a*l,g=a*h,_=s*h,y=u*c,m=u*l,E=u*h,T=r[0],R=r[1],A=r[2],S=i[0],b=i[1],x=i[2],C=(1-(v+_))*T,M=(d+E)*T,P=(p-m)*T,N=(d-E)*R,O=(1-(f+_))*R,B=(g+y)*R,I=(p+m)*A,D=(g-y)*A,F=(1-(f+v))*A;return e[0]=C,e[1]=M,e[2]=P,e[3]=0,e[4]=N,e[5]=O,e[6]=B,e[7]=0,e[8]=I,e[9]=D,e[10]=F,e[11]=0,e[12]=n[0]+S-(C*S+N*b+I*x),e[13]=n[1]+b-(M*S+O*b+D*x),e[14]=n[2]+x-(P*S+B*b+F*x),e[15]=1,e}function wt(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=n+n,s=r+r,u=i+i,c=n*a,l=r*a,h=r*s,f=i*a,d=i*s,p=i*u,v=o*a,g=o*s,_=o*u;return e[0]=1-h-p,e[1]=l+_,e[2]=f-g,e[3]=0,e[4]=l-_,e[5]=1-c-p,e[6]=d+v,e[7]=0,e[8]=f+g,e[9]=d-v,e[10]=1-c-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}Ee(),Ae(1,0,0),Ae(0,1,0),_t(),_t(),me();var Lt,kt=function(){function e(e,t){this.min=Ee(),this.max=Ee(),this.update(e,t)}return e.prototype.update=function(e,t){this.center=Se(Ee(),e||Ee()),this.halfExtents=Se(Ee(),t||Ae(0,0,0)),this.min=st(this.min,this.center,this.halfExtents),this.max=xe(this.max,this.center,this.halfExtents)},e.prototype.setMinMax=function(e,t){xe(this.center,t,e),Fe(this.center,this.center,.5),st(this.halfExtents,t,e),Fe(this.halfExtents,this.halfExtents,.5),Se(this.min,e),Se(this.max,t)},e.prototype.getMin=function(){return this.min},e.prototype.getMax=function(){return this.max},e.prototype.add=function(e){var t=this.center,n=t[0],r=t[1],i=t[2],o=this.halfExtents,a=o[0],s=o[1],u=o[2],c=n-a,l=n+a,h=r-s,f=r+s,d=i-u,p=i+u,v=e.center,g=v[0],_=v[1],y=v[2],m=e.halfExtents,E=m[0],T=m[1],R=m[2],A=g-E,S=g+E,b=_-T,x=_+T,C=y-R,M=y+R;A<c&&(c=A),S>l&&(l=S),b<h&&(h=b),x>f&&(f=x),C<d&&(d=C),M>p&&(p=M),t[0]=.5*(c+l),t[1]=.5*(h+f),t[2]=.5*(d+p),o[0]=.5*(l-c),o[1]=.5*(f-h),o[2]=.5*(p-d),this.min[0]=c,this.min[1]=h,this.min[2]=d,this.max[0]=l,this.max[1]=f,this.max[2]=p},e.prototype.setFromTransformedAABB=function(e,t){var n=this.center,r=this.halfExtents,i=e.center,o=e.halfExtents,a=t[0],s=t[4],u=t[8],c=t[1],l=t[5],h=t[9],f=t[2],d=t[6],p=t[10],v=Math.abs(a),g=Math.abs(s),_=Math.abs(u),y=Math.abs(c),m=Math.abs(l),E=Math.abs(h),T=Math.abs(f),R=Math.abs(d),A=Math.abs(p);be(n,t[12]+a*i[0]+s*i[1]+u*i[2],t[13]+c*i[0]+l*i[1]+h*i[2],t[14]+f*i[0]+d*i[1]+p*i[2]),be(r,v*o[0]+g*o[1]+_*o[2],y*o[0]+m*o[1]+E*o[2],T*o[0]+R*o[1]+A*o[2]),this.min=st(this.min,n,r),this.max=xe(this.max,n,r)},e.prototype.intersects=function(e){var t=this.getMax(),n=this.getMin(),r=e.getMax(),i=e.getMin();return n[0]<=r[0]&&t[0]>=i[0]&&n[1]<=r[1]&&t[1]>=i[1]&&n[2]<=r[2]&&t[2]>=i[2]},e.prototype.intersection=function(t){if(!this.intersects(t))return null;var n=new e,r=Ie(Ee(),this.getMin(),t.getMin()),i=Be(Ee(),this.getMax(),t.getMax());return n.setMinMax(r,i),n},e.prototype.containsPoint=function(e){var t=this.getMin(),n=this.getMax();return!(e[0]<t[0]||e[0]>n[0]||e[1]<t[1]||e[1]>n[1]||e[2]<t[2]||e[2]>n[2])},e.prototype.getNegativeFarPoint=function(e){return 273===e.pnVertexFlag?Se(Ee(),this.min):272===e.pnVertexFlag?Ae(this.min[0],this.min[1],this.max[2]):257===e.pnVertexFlag?Ae(this.min[0],this.max[1],this.min[2]):256===e.pnVertexFlag?Ae(this.min[0],this.max[1],this.max[2]):17===e.pnVertexFlag?Ae(this.max[0],this.min[1],this.min[2]):16===e.pnVertexFlag?Ae(this.max[0],this.min[1],this.max[2]):1===e.pnVertexFlag?Ae(this.max[0],this.max[1],this.min[2]):Ae(this.max[0],this.max[1],this.max[2])},e.prototype.getPositiveFarPoint=function(e){return 273===e.pnVertexFlag?Se(Ee(),this.max):272===e.pnVertexFlag?Ae(this.max[0],this.max[1],this.min[2]):257===e.pnVertexFlag?Ae(this.max[0],this.min[1],this.max[2]):256===e.pnVertexFlag?Ae(this.max[0],this.min[1],this.min[2]):17===e.pnVertexFlag?Ae(this.min[0],this.max[1],this.max[2]):16===e.pnVertexFlag?Ae(this.min[0],this.max[1],this.min[2]):1===e.pnVertexFlag?Ae(this.min[0],this.min[1],this.max[2]):Ae(this.min[0],this.min[1],this.min[2])},e}(),Ut=Ee(),Gt=(function(){function e(e,t){this.center=e||Ee(),this.radius=t||.5}e.prototype.containsPoint=function(e){return st(Ut,e,this.center),Re(Ut)<this.radius*this.radius},e.prototype.intersects=function(e){st(Ut,e.center,this.center);var t=e.radius+this.radius;return Re(Ut)<=t*t}}(),function(){function e(e,t){this.distance=e||0,this.normal=t||Ae(0,1,0),this.updatePNVertexFlag()}return e.prototype.updatePNVertexFlag=function(){this.pnVertexFlag=(Number(this.normal[0]>=0)<<8)+(Number(this.normal[1]>=0)<<4)+Number(this.normal[2]>=0)},e.prototype.distanceToPoint=function(e){return Xe(e,this.normal)-this.distance},e.prototype.normalize=function(){var e=1/ft(this.normal);Fe(this.normal,this.normal,e),this.distance*=e},e.prototype.intersectsLine=function(e,t,n){var r=this.distanceToPoint(e),i=r/(r-this.distanceToPoint(t)),o=i>=0&&i<=1;return o&&n&&je(n,e,t,i),o},e}());!function(e){e[e.OUTSIDE=4294967295]="OUTSIDE",e[e.INSIDE=0]="INSIDE",e[e.INDETERMINATE=2147483647]="INDETERMINATE"}(Lt||(Lt={}));var Wt,Vt=function(){function e(e){if(this.planes=[],e)this.planes=e;else for(var t=0;t<6;t++)this.planes.push(new Gt)}return e.prototype.extractFromVPMatrix=function(e){var t=h(e,16),n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],c=t[7],l=t[8],f=t[9],d=t[10],p=t[11],v=t[12],g=t[13],_=t[14],y=t[15];be(this.planes[0].normal,o-n,c-a,p-l),this.planes[0].distance=y-v,be(this.planes[1].normal,o+n,c+a,p+l),this.planes[1].distance=y+v,be(this.planes[2].normal,o+r,c+s,p+f),this.planes[2].distance=y+g,be(this.planes[3].normal,o-r,c-s,p-f),this.planes[3].distance=y-g,be(this.planes[4].normal,o-i,c-u,p-d),this.planes[4].distance=y-_,be(this.planes[5].normal,o+i,c+u,p+d),this.planes[5].distance=y+_,this.planes.forEach((function(e){e.normalize(),e.updatePNVertexFlag()}))},e}(),Xt=Ee(),Ht=Ee(),jt=Ee(),zt=Ee(),Yt=Ee(),qt=(function(){function e(e,t){this.origin=e||Ee(),this.direction=t||Ae(0,0,-1)}e.prototype.intersectsAABB=function(e,t){return t?this.intersectAABBWithIntersection(e,t):this.intersectsAABBWithoutIntersection(e)},e.prototype.intersectsSphere=function(e,t){var n=st(Xt,this.origin,e.center);Ve(Ht,Se(Ht,this.direction));var r=Xe(n,Ht),i=Xe(n,n)-e.radius*e.radius;if(i>0&&r>0)return null;var o=r*r-i;if(o<0)return!1;var a=Math.abs(-r-Math.sqrt(o));return t&&(Se(t,this.direction),we(t,this.origin,t,a)),!0},e.prototype.intersectsPlane=function(e,t){var n=(e.distance-Xe(e.normal,this.origin))/Xe(e.normal,this.direction),r=n>=0;return r&&t&&we(t,this.origin,this.direction,n),r},e.prototype.intersectsAABBWithoutIntersection=function(e){var t=Xt,n=Ht,r=jt,i=zt,o=Yt,a=this.direction;return st(t,this.origin,e.center),be(i,Math.abs(t[0]),Math.abs(t[1]),Math.abs(t[2])),ut(r,t,a),!(i[0]>e.halfExtents[0]&&r[0]>=0||i[1]>e.halfExtents[1]&&r[1]>=0||i[2]>e.halfExtents[2]&&r[2]>=0||(be(o,Math.abs(a[0]),Math.abs(a[1]),Math.abs(a[2])),He(n,a,t),be(n,Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2])),n[0]>e.halfExtents[1]*o[2]+e.halfExtents[2]*o[1]||n[1]>e.halfExtents[0]*o[2]+e.halfExtents[2]*o[0]||n[2]>e.halfExtents[0]*o[1]+e.halfExtents[1]*o[0]))},e.prototype.intersectAABBWithIntersection=function(e,t){var n=Se(Ee(),e.getMin());st(n,n,this.origin);var r=Se(Ee(),e.getMax());st(r,r,this.origin);var i=this.direction;0===i[0]?(n[0]=n[0]<0?-Number.MAX_VALUE:Number.MAX_VALUE,r[0]=r[0]<0?-Number.MAX_VALUE:Number.MAX_VALUE):(n[0]/=i[0],r[0]/=i[0]),0===i[1]?(n[1]=n[1]<0?-Number.MAX_VALUE:Number.MAX_VALUE,r[1]=r[1]<0?-Number.MAX_VALUE:Number.MAX_VALUE):(n[1]/=i[1],r[1]/=i[1]),0===i[2]?(n[2]=n[2]<0?-Number.MAX_VALUE:Number.MAX_VALUE,r[2]=r[2]<0?-Number.MAX_VALUE:Number.MAX_VALUE):(n[2]/=i[2],r[2]/=i[2]);var o=be(jt,Math.min(n[0],r[0]),Math.min(n[1],r[1]),Math.min(n[2],r[2])),a=be(zt,Math.max(n[0],r[0]),Math.max(n[1],r[1]),Math.max(n[2],r[2])),s=Math.min(Math.min(a[0],a[1]),a[2]),u=Math.max(Math.max(o[0],o[1]),o[2]),c=s>=u&&u>=0;return c&&(Se(t,this.direction),we(t,this.origin,t,u)),c}}(),function(){function e(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.x=0,this.y=0,this.x=e,this.y=t}return e.prototype.clone=function(){return new e(this.x,this.y)},e.prototype.copyFrom=function(e){this.x=e.x,this.y=e.y},e}()),Kt=function(){function e(e,t,n,r){this.x=e,this.y=t,this.width=n,this.height=r,this.left=e,this.right=e+n,this.top=t,this.bottom=t+r}return e.prototype.toJSON=function(){},e}(),Zt=(function(){function e(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Array.isArray(e[0])?e[0]:e;if("number"!=typeof n[0]){for(var r=[],i=0,o=n.length;i<o;i++)r.push(n[i].x,n[i].y);n=r}this.points=n,this.closeStroke=!0}e.prototype.clone=function(){var t=new e(this.points.slice());return t.closeStroke=this.closeStroke,t},e.prototype.contains=function(e,t){for(var n=!1,r=this.points.length/2,i=0,o=r-1;i<r;o=i++){var a=this.points[2*i],s=this.points[2*i+1],u=this.points[2*o],c=this.points[2*o+1];s>t!=c>t&&e<(t-s)/(c-s)*(u-a)+a&&(n=!n)}return n}}(),"SceneGraphSelectorFactory"),$t="SceneGraphSelector",Qt=function(){function e(){}return e.prototype.selectOne=function(e,t){return e.startsWith("#")?t.find((function(t){return t.id===e.substring(1)})):null},e.prototype.selectAll=function(e,t){return e.startsWith(".")?t.findAll((function(t){return t.className===e.substring(1)})):e.startsWith("#")?t.findAll((function(t){return t.id===e.substring(1)})):e.startsWith("[name=")?t.findAll((function(t){return t.name===e.substring(7,e.length-2)})):t.findAll((function(t){return t.nodeName===e}))},e.prototype.is=function(){return!0},a([I()],e)}();function Jt(e,t){var n=Number(e.style.zIndex),r=Number(t.style.zIndex);if(n===r){var i=e.parentNode;if(i){var o=i.childNodes||[];return o.indexOf(e)-o.indexOf(t)}}return n-r}function en(e,t){void 0===t&&(t=!1);for(var n=e;n;){var r=n.renderable;r&&(r.renderBoundsDirty=!0,r.boundsDirty=!0,r.dirty=!0),n=n.parentNode}e.emit(Wt.BOUNDS_CHANGED,{affectChildren:t})}!function(e){e.DESTROY="destroy",e.ATTRIBUTE_CHANGED="attribute-changed",e.INSERTED="inserted",e.CHILD_INSERTED="child-inserted",e.REMOVED="removed",e.CHILD_REMOVED="child-removed",e.MOUNTED="mounted",e.UNMOUNTED="unmounted",e.BOUNDS_CHANGED="bounds-changed",e.RENDER_ORDER_CHANGED="render-order-changed"}(Wt||(Wt={}));var tn,nn,rn="SceneGraphService",on=function(){function e(){var e,t,n,r,i,o=this;this.sort=function(e,t){if(!e.parentNode)return-1;if(!t.parentNode)return 1;var n=e.transformable.graphDepth-t.transformable.graphDepth,r=e,i=t;if(n<0){if((i=t.getAncestor(-n))===r)return-1}else if(n>0&&i===(r=e.getAncestor(n)))return 1;for(;r&&i&&r.parentNode!==i.parentNode;)r=r.parentNode,i=i.parentNode;var o=r.parentNode;if(o){var a=o.sortable;if(a)return a.sorted||(a.sorted=o.childNodes.slice()),a.dirty&&(a.sorted=o.childNodes.slice().sort(Jt),a.dirty=!1),a.sorted.indexOf(r)-a.sorted.indexOf(i)}return-1},this.rotate=(e=_t(),function(t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=0),"number"==typeof n&&(n=Ae(n,r,i));var a=t.transformable;if(null===t.parentNode)o.rotateLocal(t,n);else{var s=_t();Tt(s,n[0],n[1],n[2]);var u=o.getRotation(t),c=o.getRotation(t.parentNode);At(e,c),Et(e,e),mt(e,e,s),mt(a.localRotation,s,u),function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=n*n+r*r+i*i+o*o;a>0&&(a=1/Math.sqrt(a)),e[0]=n*a,e[1]=r*a,e[2]=i*a,e[3]=o*a}(a.localRotation,a.localRotation),o.dirtifyLocal(t,a)}}),this.rotateLocal=(t=_t(),function(e,n,r,i){void 0===r&&(r=0),void 0===i&&(i=0),"number"==typeof n&&(n=Ae(n,r,i));var a=e.transformable;Tt(t,n[0],n[1],n[2]),St(a.localRotation,a.localRotation,t),o.dirtifyLocal(e,a)}),this.setEulerAngles=(n=_t(),function(e,t,r,i){void 0===r&&(r=0),void 0===i&&(i=0),"number"==typeof t&&(t=Ae(t,r,i));var a=e.transformable;if(null===e.parentNode)o.setLocalEulerAngles(e,t);else{Tt(a.localRotation,t[0],t[1],t[2]);var s=o.getRotation(e.parentNode);At(n,Et(_t(),s)),St(a.localRotation,a.localRotation,n),o.dirtifyLocal(e,a)}}),this.translateLocal=function(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=0),"number"==typeof t&&(t=Ae(t,n,r));var i=e.transformable;ot(t,Ee())||($e(t,t,i.localRotation),xe(i.localPosition,i.localPosition,t),o.dirtifyLocal(e,i))},this.setPosition=(r=bt(),function(e,t){var n=e.transformable;if(t=Ae(t[0],t[1],t[2]||n.position[2]),!ot(o.getPosition(e),t)){if(n.position=t,null===e.parentNode)Se(n.localPosition,t);else{var i=e.parentNode.transformable;xt(r,i.worldTransform),Mt(r,r),Ke(n.localPosition,t,r)}o.dirtifyLocal(e,n)}}),this.translate=(i=Ee(),function(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=0),"number"==typeof t&&(t=Ae(t,n,r)),ot(t,Ee())||(xe(i,o.getPosition(e),t),o.setPosition(e,i))})}return e.prototype.matches=function(e,t){return this.sceneGraphSelectorFactory().is(e,t)},e.prototype.querySelector=function(e,t){return this.sceneGraphSelectorFactory().selectOne(e,t)},e.prototype.querySelectorAll=function(e,t){return this.sceneGraphSelectorFactory().selectAll(e,t)},e.prototype.attach=function(e,t,n){e.parentNode&&this.detach(e),e.parentNode=t,ce(n)?e.parentNode.childNodes.push(e):e.parentNode.childNodes.splice(n,0,e);var r=t.sortable;r&&(r.dirty=!0),this.updateGraphDepth(e);var i=e.transformable;i&&this.dirtifyWorld(e,i),i.frozen&&this.unfreezeParentToRoot(e)},e.prototype.detach=function(e){if(e.parentNode){var t=e.transformable;if(t){var n=this.getWorldTransform(e,t);It(t.localScale,n),Bt(t.localPosition,n),Dt(t.localRotation,n),t.localDirtyFlag=!0}var r=e.parentNode.sortable;r&&(r.dirty=!0);var i=e.parentNode.childNodes.indexOf(e);i>-1&&e.parentNode.childNodes.splice(i,1),t&&this.dirtifyWorld(e,t),e.parentNode=null}},e.prototype.getOrigin=function(e){return e.transformable.origin},e.prototype.setOrigin=function(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=0),"number"==typeof t&&(t=Ae(t,n,r));var i=e.transformable;if(!ot(t,i.origin)){var o=i.origin;o[0]=t[0],o[1]=t[1],o[2]=t[2]||0,this.dirtifyLocal(e,i)}},e.prototype.setLocalEulerAngles=function(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=0),"number"==typeof t&&(t=Ae(t,n,r));var i=e.transformable;Tt(i.localRotation,t[0],t[1],t[2]),this.dirtifyLocal(e,i)},e.prototype.setLocalPosition=function(e,t){var n=e.transformable;t=Ae(t[0],t[1],t[2]||n.localPosition[2]),ot(n.localPosition,t)||(Se(n.localPosition,t),this.dirtifyLocal(e,n))},e.prototype.scaleLocal=function(e,t){var n=e.transformable;Me(n.localScale,n.localScale,Ae(t[0],t[1],t[2]||1)),this.dirtifyLocal(e,n)},e.prototype.setLocalScale=function(e,t){var n=e.transformable,r=Ae(t[0],t[1],t[2]||n.localScale[2]);ot(r,n.localScale)||(Se(n.localScale,r),this.dirtifyLocal(e,n))},e.prototype.dirtifyLocal=function(e,t){t.localDirtyFlag||(t.localDirtyFlag=!0,t.dirtyFlag||this.dirtifyWorld(e,t))},e.prototype.dirtifyWorld=function(e,t){t.dirtyFlag||this.unfreezeParentToRoot(e),this.dirtifyWorldInternal(e,t),en(e,!0)},e.prototype.getPosition=function(e){var t=e.transformable;return Bt(t.position,this.getWorldTransform(e,t))},e.prototype.getRotation=function(e){var t=e.transformable;return Dt(t.rotation,this.getWorldTransform(e,t))},e.prototype.getScale=function(e){var t=e.transformable;return It(t.scaling,this.getWorldTransform(e,t))},e.prototype.getWorldTransform=function(e,t){return void 0===t&&(t=e.transformable),t.localDirtyFlag||t.dirtyFlag?(e.parentNode&&this.getWorldTransform(e.parentNode),this.sync(e,t),t.worldTransform):t.worldTransform},e.prototype.getLocalPosition=function(e){return e.transformable.localPosition},e.prototype.getLocalRotation=function(e){return e.transformable.localRotation},e.prototype.getLocalScale=function(e){return e.transformable.localScale},e.prototype.getLocalTransform=function(e){var t=e.transformable;return t.localDirtyFlag&&(Ft(t.localTransform,t.localRotation,t.localPosition,t.localScale,t.origin),t.localDirtyFlag=!1),t.localTransform},e.prototype.resetLocalTransform=function(e){this.setLocalScale(e,[1,1,1]),this.setLocalPosition(e,[0,0,0]),this.setLocalEulerAngles(e,[0,0,0])},e.prototype.getTransformedGeometryBounds=function(e,t){void 0===t&&(t=!1);var n=this.getGeometryBounds(e,t);if(n){var r=new kt;return r.setFromTransformedAABB(n,this.getWorldTransform(e)),r}return null},e.prototype.getGeometryBounds=function(e,t){void 0===t&&(t=!1);var n=e.geometry,r=t?n.renderBounds:n.contentBounds||null;return r&&new kt(r.center,r.halfExtents)||null},e.prototype.getBounds=function(e,t){var n=this;void 0===t&&(t=!1);var r=e.renderable;if(!r.boundsDirty&&!t&&r.bounds)return r.bounds;if(!r.renderBoundsDirty&&t&&r.renderBounds)return r.renderBounds;var i=this.getTransformedGeometryBounds(e,t);e.childNodes.forEach((function(e){var r=n.getBounds(e,t);r&&(i?i.add(r):(i=new kt).update(r.center,r.halfExtents))}));var o=e.style.clipPath;if(o){var a=this.getTransformedGeometryBounds(o,!0),s=void 0;a&&(s=new kt).setFromTransformedAABB(a,this.getWorldTransform(e)),i?s&&(i=s.intersection(i)):i=s}return i&&(t?r.renderBounds=i:r.bounds=i),t?r.renderBoundsDirty=!1:r.boundsDirty=!1,i||null},e.prototype.getLocalBounds=function(e){if(e.parentNode){var t=bt();e.parentNode.transformable&&(t=Mt(bt(),this.getWorldTransform(e.parentNode)));var n=this.getBounds(e);if(n){var r=new kt;return r.setFromTransformedAABB(n,t),r}}return this.getBounds(e)},e.prototype.getBoundingClientRect=function(e){var t,n,r,i=this.getGeometryBounds(e);i&&(r=new kt).setFromTransformedAABB(i,this.getWorldTransform(e));var o=null===(n=null===(t=e.ownerDocument)||void 0===t?void 0:t.defaultView)||void 0===n?void 0:n.getContextService().getBoundingClientRect();if(r){var a=h(r.getMin(),2),s=a[0],u=a[1],c=h(r.getMax(),2),l=c[0],f=c[1];return new Kt(s+((null==o?void 0:o.left)||0),u+((null==o?void 0:o.top)||0),l-s,f-u)}return new Kt((null==o?void 0:o.left)||0,(null==o?void 0:o.top)||0,0,0)},e.prototype.dirtifyWorldInternal=function(e,t){var n=this;if(!t.dirtyFlag){t.dirtyFlag=!0,t.frozen=!1,e.childNodes.forEach((function(e){var t=e.transformable;t.dirtyFlag||n.dirtifyWorldInternal(e,t)}));var r=e.renderable;r&&(r.renderBoundsDirty=!0,r.boundsDirty=!0,r.dirty=!0),e.emit(Wt.ATTRIBUTE_CHANGED,{attributeName:"modelMatrix",oldValue:null,newValue:null})}},e.prototype.syncHierarchy=function(e){var t=e.transformable;if(!t.frozen){t.frozen=!0,(t.localDirtyFlag||t.dirtyFlag)&&this.sync(e,t);for(var n=e.childNodes,r=0;r<n.length;r++)this.syncHierarchy(n[r])}},e.prototype.sync=function(e,t){if(t.localDirtyFlag&&(Ft(t.localTransform,t.localRotation,t.localPosition,t.localScale,t.origin),t.localDirtyFlag=!1),t.dirtyFlag){var n=e.parentNode,r=n&&n.transformable;null!==n&&r?Pt(t.worldTransform,r.worldTransform,t.localTransform):xt(t.worldTransform,t.localTransform),t.dirtyFlag=!1}},e.prototype.updateGraphDepth=function(e){var t=e.transformable;e.parentNode?t.graphDepth=e.parentNode.transformable.graphDepth+1:t.graphDepth=0;for(var n=e.childNodes,r=0;r<n.length;r++)this.updateGraphDepth(n[r])},e.prototype.unfreezeParentToRoot=function(e){for(var t=e.parentNode;t;){var n=t.transformable;n&&(n.frozen=!1),t=t.parentNode}},a([D(Zt),s("design:type",Function)],e.prototype,"sceneGraphSelectorFactory",void 0),a([I()],e)}(),an="GeometryUpdaterFactory",sn="GeometryAABBGenerator";(nn=tn||(tn={})).Group="group",nn.Circle="circle",nn.Ellipse="ellipse",nn.Image="image",nn.Rect="rect",nn.Line="line",nn.Polyline="polyline",nn.Polygon="polygon",nn.Text="text",nn.Path="path",nn.HTML="html";var un,cn="CanvasConfig",ln=function(){function e(){}return e.prototype.update=function(e){var t=e.r,n=void 0===t?0:t,r=e.x,i=void 0===r?0:r,o=e.y;return{width:2*n,height:2*n,x:i,y:void 0===o?0:o}},a([I({token:{token:sn,named:tn.Circle}})],e)}(),hn=function(){function e(){}return e.prototype.update=function(e){var t=e.rx,n=void 0===t?0:t,r=e.ry,i=void 0===r?0:r,o=e.x,a=void 0===o?0:o,s=e.y;return{width:2*n,height:2*i,x:a,y:void 0===s?0:s}},a([I({token:{token:sn,named:tn.Ellipse}})],e)}(),fn=function(){function e(){}return e.prototype.update=function(e){var t,n,r=e.img,i=e.x,o=void 0===i?0:i,a=e.y,s=void 0===a?0:a,u=e.width,c=void 0===u?0:u,l=e.height,h=void 0===l?0:l;return r&&!re(r)&&(e.width||(t=r.width),e.height||(n=r.height)),{width:t||c,height:n||h,x:o,y:s}},a([I({token:[{token:sn,named:tn.Rect},{token:sn,named:tn.Image}]})],e)}(),dn=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],pn=function(){function e(){}return e.prototype.getOrCreateCanvas=function(){if(this.canvas)return this.canvas;try{this.canvas=new window.OffscreenCanvas(0,0),this.context=this.canvas.getContext("2d"),this.context&&this.context.measureText||(this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"))}catch(e){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d")}return this.canvas.width=10,this.canvas.height=10,this.canvas},e.prototype.getOrCreateContext=function(){return this.context||this.getOrCreateCanvas(),this.context},a([I()],e)}(),vn={MetricsString:"|ÉqÅ",BaselineSymbol:"M",BaselineMultiplier:1.4,HeightMultiplier:2,Newlines:[10,13],BreakingSpaces:[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288]},gn=/[a-zA-Z0-9\u00C0-\u00D6\u00D8-\u00f6\u00f8-\u00ff!"#$%&'()*+,-./:;]/,_n=new RegExp(/[!%),.:;?\]}¢°·'""†‡›℃∶、。〃〆〕〗〞﹚﹜！＂％＇），．：；？！］｝～]/.source+"|"+/[!),.:;?\]}¢·–—'"•"、。〆〞〕〉》」︰︱︲︳﹐﹑﹒﹓﹔﹕﹖﹘﹚﹜！），．：；？︶︸︺︼︾﹀﹂﹗］｜｝､]/.source+"|"+/[)\]｝〕〉》」』】〙〗〟'"｠»ヽヾーァィゥェォッャュョヮヵヶぁぃぅぇぉっゃゅょゎゕゖㇰㇱㇲㇳㇴㇵㇶㇷㇸㇹㇺㇻㇼㇽㇾㇿ々〻‐゠–〜?!‼⁇⁈⁉・、:;,。.]/.source+"|"+/[!%),.:;?\]}¢°'"†‡℃〆〈《「『〕！％），．：；？］｝]/.source),yn=new RegExp(/[$(£¥·'"〈《「『【〔〖〝﹙﹛＄（．［｛￡￥]/.source+"|"+/[([{£¥'"‵〈《「『〔〝︴﹙﹛（｛︵︷︹︻︽︿﹁﹃﹏]/.source+"|"+/[([｛〔〈《「『【〘〖〝'"｟«—...‥〳〴〵]/.source+"|"+/[$([{£¥'"々〇〉》」〔＄（［｛｠￥￦#]/.source),mn=function(){function e(){var e=this;this.cache={},this.shouldBreakByKinsokuShorui=function(t,n){return!e.isBreakingSpace(n)&&!(!t||!yn.exec(n)&&!_n.exec(t))},this.trimByKinsokuShorui=function(e){var t=f([],h(e),!1),n=t[t.length-2];if(!n)return e;var r=n[n.length-1];return t[t.length-2]=n.slice(0,-1),t[t.length-1]=r+t[t.length-1],t}}return e.prototype.measureFont=function(e){if(this.cache[e])return this.cache[e];var t={ascent:0,descent:0,fontSize:0},n=this.offscreenCanvas.getOrCreateCanvas(),r=this.offscreenCanvas.getOrCreateContext();r.font=e;var i=vn.MetricsString+vn.BaselineSymbol,o=Math.ceil(r.measureText(i).width),a=Math.ceil(r.measureText(vn.BaselineSymbol).width),s=vn.HeightMultiplier*a;a=a*vn.BaselineMultiplier|0,n.width=o,n.height=s,r.fillStyle="#f00",r.fillRect(0,0,o,s),r.font=e,r.textBaseline="alphabetic",r.fillStyle="#000",r.fillText(i,0,a);var u=r.getImageData(0,0,o,s).data,c=u.length,l=4*o,h=0,f=0,d=!1;for(h=0;h<a;++h){for(var p=0;p<l;p+=4)if(255!==u[f+p]){d=!0;break}if(d)break;f+=l}for(t.ascent=a-h,f=c-l,d=!1,h=s;h>a;--h){for(p=0;p<l;p+=4)if(255!==u[f+p]){d=!0;break}if(d)break;f-=l}return t.descent=h-a,t.fontSize=t.ascent+t.descent,this.cache[e]=t,t},e.prototype.measureText=function(e,t){var n=t.fontSize,r=void 0===n?0:n,i=t.wordWrap,o=t.lineHeight,a=void 0===o?0:o,s=t.lineWidth,u=void 0===s?0:s,c=t.textBaseline,l=t.textAlign,h=t.letterSpacing,f=void 0===h?0:h,d=t.dropShadow,p=t.dropShadowDistance,v=void 0===p?0:p,g=t.leading,_=void 0===g?0:g,y=function(e){var t=e.fontSize,n=e.fontFamily,r=e.fontStyle,i=e.fontVariant,o=e.fontWeight,a=oe(t)?t+"px":t,s=n;Array.isArray(n)||(s=n.split(","));for(var u=s.length-1;u>=0;u--){var c=s[u].trim();!/([\"\'])[^\'\"]+\1/.test(c)&&dn.indexOf(c)<0&&(c='"'+c+'"'),s[u]=c}return r+" "+i+" "+o+" "+a+" "+s.join(",")}(t),m=this.measureFont(y);0===m.fontSize&&(m.fontSize=r,m.ascent=r);var E=this.offscreenCanvas.getOrCreateContext();E.font=y;for(var T=(i?this.wordWrap(e,t):e).split(/(?:\r\n|\r|\n)/),R=new Array(T.length),A=0,S=0;S<T.length;S++){var b=E.measureText(T[S]).width+(T[S].length-1)*f;R[S]=b,A=Math.max(A,b)}var x=A+u;d&&(x+=v);var C=a||m.fontSize+u,M=Math.max(C,m.fontSize+u)+(T.length-1)*(C+_);d&&(M+=v);var P=0;return"middle"===c?P=-M/2:"bottom"===c||"alphabetic"===c||"ideographic"===c?P=-M:"top"!==c&&"hanging"!==c||(P=0),{font:y,width:x,height:M,lines:T,lineWidths:R,lineHeight:C+=_,maxLineWidth:A,fontProperties:m,lineMetrics:R.map((function(e,t){var n=0;return"center"===l?n-=e/2:"right"!==l&&"end"!==l||(n-=e),new Kt(n-u/2,P+t*C,e+u,C)}))}},e.prototype.wordWrap=function(e,t){var n=this,r=t.wordWrapWidth,i=void 0===r?0:r,o=t.letterSpacing,a=void 0===o?0:o,s=this.offscreenCanvas.getOrCreateContext(),u=i+a,c=[],l=0,h=0,f={},d=function(e){return n.getFromCache(e,a,f,s)};return Array.from(e).forEach((function(t,r){var i=e[r-1],o=e[r+1],a=d(t);if(n.isNewline(t))return l++,h=0,void(c[l]="");if(h>0&&h+a>u){if(l++,h=0,c[l]="",n.isBreakingSpace(t))return;n.canBreakInLastChar(t)||(c=n.trimToBreakable(c),h=n.sumTextWidthByCache(c[l]||"",f)),n.shouldBreakByKinsokuShorui(t,o)&&(c=n.trimByKinsokuShorui(c),h+=d(i||""))}h+=a,c[l]=(c[l]||"")+t})),c.join("\n")},e.prototype.isBreakingSpace=function(e){return"string"==typeof e&&vn.BreakingSpaces.indexOf(e.charCodeAt(0))>=0},e.prototype.isNewline=function(e){return"string"==typeof e&&vn.Newlines.indexOf(e.charCodeAt(0))>=0},e.prototype.trimToBreakable=function(e){var t=f([],h(e),!1),n=t[t.length-2],r=this.findBreakableIndex(n);if(-1===r||!n)return t;var i=n.slice(r,r+1),o=r+1,a=r+(this.isBreakingSpace(i)?0:1);return t[t.length-1]+=n.slice(o,n.length),t[t.length-2]=n.slice(0,a),t},e.prototype.canBreakInLastChar=function(e){return!e||!gn.test(e)},e.prototype.sumTextWidthByCache=function(e,t){return e.split("").reduce((function(e,n){if(!t[n])throw Error("cannot count the word without cache");return e+t[n]}),0)},e.prototype.findBreakableIndex=function(e){for(var t=e.length-1;t>=0;t--)if(!gn.test(e[t]))return t;return-1},e.prototype.getFromCache=function(e,t,n,r){var i=n[e];if("number"!=typeof i){var o=e.length*t;i=r.measureText(e).width+o,n[e]=i}return i},a([D(pn),s("design:type",pn)],e.prototype,"offscreenCanvas",void 0),a([I()],e)}(),En=function(){function e(){}return e.prototype.update=function(e){var t=e.text,n=void 0===t?"":t,r=e.textAlign,i=e.lineWidth,o=void 0===i?0:i,a=e.textBaseline,s=e.x,u=void 0===s?0:s,c=e.y,l=void 0===c?0:c,h=this.textService.measureText(n,e);e.metrics=h;var f=h.width,d=h.height,p=h.lineHeight,v=h.fontProperties,g=Ae(f/2,d/2,0),_=[0,1],y=0;"center"===r?(y=o/2,_=[.5,1]):"right"!==r&&"end"!==r||(y=o,_=[1,1]),e.anchor=_;var m=0;return"middle"===a?m=g[1]:"top"===a||"hanging"===a?m=2*g[1]:"alphabetic"===a?m=p-v.ascent:"bottom"!==a&&"ideographic"!==a||(m=0),{width:2*g[0],height:2*g[1],x:u,y:l,offsetX:y,offsetY:m}},a([D(mn),s("design:type",mn)],e.prototype,"textService",void 0),a([I({token:{token:sn,named:tn.Text}})],e)}(),Tn=function(){function e(){}return e.prototype.update=function(e){var t=e.x1,n=e.y1,r=e.x2,i=e.y2,o=Math.min(t,r),a=Math.max(t,r),s=Math.min(n,i);return{width:a-o,height:Math.max(n,i)-s,x:o,y:s}},a([I({token:{token:sn,named:tn.Line}})],e)}(),Rn=function(){function e(){}return e.prototype.update=function(e){var t=e.points.points,n=Math.min.apply(Math,f([],h(t.map((function(e){return e[0]}))),!1)),r=Math.max.apply(Math,f([],h(t.map((function(e){return e[0]}))),!1)),i=Math.min.apply(Math,f([],h(t.map((function(e){return e[1]}))),!1));return{width:r-n,height:Math.max.apply(Math,f([],h(t.map((function(e){return e[1]}))),!1))-i,x:n,y:i}},a([I({token:[{token:sn,named:tn.Polyline},{token:sn,named:tn.Polygon}]})],e)}(),An=function(){function e(){}return e.prototype.update=function(e){var t=e.path.rect,n=t.x,r=t.y;return{width:t.width,height:t.height,x:n,y:r}},a([I({token:{token:sn,named:tn.Path}})],e)}(),Sn=p.defineToken("ContextService",{multiple:!1});!function(e){e[e.CameraChanged=0]="CameraChanged",e[e.DisplayObjectChanged=1]="DisplayObjectChanged",e[e.DisplayObjectRemoved=2]="DisplayObjectRemoved",e[e.None=3]="None"}(un||(un={}));var bn,xn="RenderingContext",Cn=n(9991),Mn=function(){function e(t){this.eventPhase=e.prototype.NONE,this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.defaultPrevented=!1,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new qt,this.page=new qt,this.canvas=new qt,this.viewport=new qt,this.composed=!1,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}return Object.defineProperty(e.prototype,"name",{get:function(){return this.type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"originalEvent",{get:function(){return this.nativeEvent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"layerX",{get:function(){return this.layer.x},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"layerY",{get:function(){return this.layer.y},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pageX",{get:function(){return this.page.x},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pageY",{get:function(){return this.page.y},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this.canvas.x},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.canvas.y},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canvasX",{get:function(){return this.canvas.x},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canvasY",{get:function(){return this.canvas.y},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewportX",{get:function(){return this.viewport.x},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewportY",{get:function(){return this.viewport.y},enumerable:!1,configurable:!0}),e.prototype.composedPath=function(){return!this.manager||this.path&&this.path[0]===this.target||(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path},Object.defineProperty(e.prototype,"propagationPath",{get:function(){return this.composedPath()},enumerable:!1,configurable:!0}),e.prototype.preventDefault=function(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0},e.prototype.stopImmediatePropagation=function(){this.propagationImmediatelyStopped=!0},e.prototype.stopPropagation=function(){this.propagationStopped=!0},e.prototype.initEvent=function(){},e.prototype.initUIEvent=function(){},e}(),Pn=function(e){function t(t,n){var r=e.call(this,null)||this;return r.type=t,r.detail=n,Object.assign(r,n),r}return r(t,e),t}(Mn),Nn=function(){function e(){this.emitter=new z.EventEmitter}return e.prototype.on=function(e,t,n){return this.addEventListener(e,t,n),this},e.prototype.addEventListener=function(e,t,n){var r=ue(n)&&n||Q(n)&&n.capture,i=Q(n)&&n.once,o=Z(t)?void 0:t,a=!1,s="";if(e.indexOf(":")>-1){var u=h(e.split(":"),2),c=u[0];e=u[1],s=c,a=!0}if(e=r?e+"capture":e,t=Z(t)?t:t.handleEvent,a){var l=t;t=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(null===(e=t[0].target)||void 0===e?void 0:e.name)===s&&l.apply(void 0,f([],h(t),!1))}}return i?this.emitter.once(e,t,o):this.emitter.on(e,t,o),this},e.prototype.off=function(e,t,n){return e?this.removeEventListener(e,t,n):this.removeAllEventListeners(),this},e.prototype.removeAllEventListeners=function(){this.emitter.removeAllListeners()},e.prototype.removeEventListener=function(e,t,n){var r=ue(n)&&n||Q(n)&&n.capture,i=Z(t)?void 0:t;return e=r?e+"capture":e,t=Z(t)?t:t.handleEvent,this.emitter.off(e,t,i),this},e.prototype.emit=function(e,t){this.dispatchEvent(new Pn(e,t))},e.prototype.dispatchEvent=function(e){var t,n;if(!(e instanceof Mn))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");var r=this.ownerDocument||this.document;return r&&(e.manager=(null===(t=r.defaultView)||void 0===t?void 0:t.getEventService())||null,e.defaultPrevented=!1,e.path=[],e.target=this,null===(n=e.manager)||void 0===n||n.dispatchEvent(e)),!e.defaultPrevented},e}(),On=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.shadow=!1,t.ownerDocument=null,t.isConnected=!1,t.baseURI="",t.childNodes=[],t.nodeType=0,t.nodeName="",t.nodeValue=null,t.textContent=null,t.parentNode=null,t}return r(t,e),t.isNode=function(e){return!!e.childNodes},t.prototype.getRootNode=function(){for(var e=this;e.parentNode;)e=e.parentNode;return e},t.prototype.hasChildNodes=function(){return this.childNodes.length>0},t.prototype.isDefaultNamespace=function(e){throw new Error("Method not implemented.")},t.prototype.compareDocumentPosition=function(e){throw new Error("Method not implemented.")},t.prototype.lookupNamespaceURI=function(e){throw new Error("Method not implemented.")},t.prototype.lookupPrefix=function(e){throw new Error("Method not implemented.")},t.prototype.normalize=function(){throw new Error("Method not implemented.")},t.prototype.isEqualNode=function(e){return this===e},t.prototype.isSameNode=function(e){return this.isEqualNode(e)},Object.defineProperty(t.prototype,"parent",{get:function(){return this.parentNode},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parentElement",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"nextSibling",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"previousSibling",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"firstChild",{get:function(){return this.childNodes.length>0?this.childNodes[0]:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastChild",{get:function(){return this.childNodes.length>0?this.childNodes[this.childNodes.length-1]:null},enumerable:!1,configurable:!0}),t.prototype.contain=function(e){return this.contains(e)},t.prototype.contains=function(e){for(var t=e;t&&this!==t;)t=t.parentNode;return!!t},t.prototype.getAncestor=function(e){for(var t=this;e>0&&t;)t=t.parentNode,e--;return t},t.prototype.forEach=function(e){e(this)||this.childNodes.forEach((function(t){t.forEach(e)}))},t}(Nn),Bn=function(){function e(){}return e.tag="c-geometry",e}(),In=function(){function e(){this.boundsDirty=!0,this.renderBoundsDirty=!0,this.dirty=!1}return e.tag="c-renderable",e}(),Dn=function(){function e(){this.dirtyFlag=!1,this.localDirtyFlag=!1,this.frozen=!1,this.graphDepth=0,this.localPosition=Ae(0,0,0),this.localRotation=Rt(0,0,0,1),this.localScale=Ae(1,1,1),this.localTransform=bt(),this.position=Ae(0,0,0),this.rotation=Rt(0,0,0,1),this.scaling=Ae(1,1,1),this.worldTransform=bt(),this.origin=Ae(0,0,0)}return e.tag="c-transform",e}();!function(e){e[e.Standard=0]="Standard"}(bn||(bn={}));var Fn=function(){function e(){this.strategy=bn.Standard,this.visibilityPlaneMask=-1,this.visible=!0,this.enable=!0}return e.prototype.isCulled=function(){return this.enable&&!this.visible},e.tag="c-cullable",e}(),wn=function(){function e(){this.dirty=!1,this.renderOrder=0}return e.tag="c-sortable",e}(),Ln=0,kn=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.sceneGraphService=Ca.get(rn),t.entity=Ln++,t.renderable=new In,t.cullable=new Fn,t.transformable=new Dn,t.sortable=new wn,t.geometry=new Bn,t.scrollLeft=0,t.scrollTop=0,t.destroyed=!1,t.style={},t.parsedStyle={},t.attributes={},t}return r(t,e),t.isElement=function(e){return!!e.getAttribute},Object.defineProperty(t.prototype,"classList",{get:function(){return this.className.split(" ")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tagName",{get:function(){return this.nodeName},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"children",{get:function(){return this.childNodes},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"childElementCount",{get:function(){return this.childNodes.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"firstElementChild",{get:function(){return this.firstChild},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastElementChild",{get:function(){return this.lastChild},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parentElement",{get:function(){return this.parentNode},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"nextSibling",{get:function(){if(this.parentNode){var e=this.parentNode.childNodes.indexOf(this);return this.parentNode.childNodes[e+1]||null}return null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"previousSibling",{get:function(){if(this.parentNode){var e=this.parentNode.childNodes.indexOf(this);return this.parentNode.childNodes[e-1]||null}return null},enumerable:!1,configurable:!0}),t.prototype.cloneNode=function(e){throw new Error("Method not implemented.")},t.prototype.appendChild=function(e,t){return this.sceneGraphService.attach(e,this,t),this.emit(Wt.CHILD_INSERTED,{child:e}),e.emit(Wt.INSERTED,{parent:this}),e},t.prototype.insertBefore=function(e,t){if(t){var n=this.childNodes.indexOf(t);this.appendChild(e,n-1)}else this.appendChild(e);return e},t.prototype.replaceChild=function(e,t,n){var r=this.childNodes.indexOf(t);return this.removeChild(t,n),this.appendChild(e,r),t},t.prototype.removeChild=function(e,t){return void 0===t&&(t=!0),e.emit(Wt.REMOVED,{parent:this}),t&&(e.emit(Wt.DESTROY,{}),e.destroyed=!0),this.emit(Wt.CHILD_REMOVED,{child:e}),this.sceneGraphService.detach(e),t&&e.emitter.removeAllListeners(),e},t.prototype.removeChildren=function(e){var t=this;void 0===e&&(e=!0),this.childNodes.slice().forEach((function(n){t.removeChild(n,e)}))},t.prototype.matches=function(e){return this.sceneGraphService.matches(e,this)},t.prototype.getElementById=function(e){return this.sceneGraphService.querySelector("#"+e,this)},t.prototype.getElementsByName=function(e){return this.sceneGraphService.querySelectorAll('[name="'+e+'"]',this)},t.prototype.getElementsByClassName=function(e){return this.sceneGraphService.querySelectorAll("."+e,this)},t.prototype.getElementsByTagName=function(e){return this.sceneGraphService.querySelectorAll(e,this)},t.prototype.querySelector=function(e){return this.sceneGraphService.querySelector(e,this)},t.prototype.querySelectorAll=function(e){return this.sceneGraphService.querySelectorAll(e,this)},t.prototype.find=function(e){var t=this,n=null;return this.forEach((function(r){return!(r===t||!e(r)||(n=r,0))})),n},t.prototype.findAll=function(e){var t=this,n=[];return this.forEach((function(r){r!==t&&e(r)&&n.push(r)})),n},t.prototype.after=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(this.parentNode){var r=this.parentNode.childNodes.indexOf(this);t.forEach((function(t,n){var i;return null===(i=e.parentNode)||void 0===i?void 0:i.appendChild(t,r+n+1)}))}},t.prototype.before=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(this.parentNode){var r=this.parentNode.childNodes.indexOf(this),i=h(t),o=i[0],a=i.slice(1);this.parentNode.appendChild(o,r),(e=o).after.apply(e,f([],h(a),!1))}},t.prototype.replaceWith=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.after.apply(this,f([],h(e),!1)),this.remove()},t.prototype.append=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t.forEach((function(t){return e.appendChild(t)}))},t.prototype.prepend=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t.forEach((function(t,n){return e.appendChild(t,n)}))},t.prototype.replaceChildren=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(;this.childNodes.length&&this.firstChild;)this.removeChild(this.firstChild);this.append.apply(this,f([],h(e),!1))},t.prototype.remove=function(e){return void 0===e&&(e=!0),this.parentNode?this.parentNode.removeChild(this,e):this},t.prototype.destroy=function(){this.emit(Wt.DESTROY,{}),this.remove(!1),this.emitter.removeAllListeners(),this.destroyed=!0},t.prototype.getGeometryBounds=function(){return this.sceneGraphService.getGeometryBounds(this)},t.prototype.getRenderBounds=function(){return this.sceneGraphService.getBounds(this,!0)},t.prototype.getBounds=function(){return this.sceneGraphService.getBounds(this)},t.prototype.getLocalBounds=function(){return this.sceneGraphService.getLocalBounds(this)},t.prototype.getBoundingClientRect=function(){return this.sceneGraphService.getBoundingClientRect(this)},t.prototype.getClientRects=function(){return[this.getBoundingClientRect()]},t.prototype.getAttribute=function(e){var t=this.attributes[e];return ce(t)?void 0:t},t.prototype.removeAttribute=function(e){delete this.attributes[e]},t.prototype.setAttribute=function(e,t,n){void 0===n&&(n=!1),this.attributes[e]=t},t}(On),Un=function(e){function t(t,n,r,i){var o=e.call(this,t)||this;return o.currentTime=r,o.timelineTime=i,o.target=n,o.type="finish",o.bubbles=!1,o.currentTarget=n,o.defaultPrevented=!1,o.eventPhase=o.AT_TARGET,o.timeStamp=Date.now(),o.currentTime=r,o.timelineTime=i,o}return r(t,e),t}(Mn),Gn=0,Wn=function(){function e(e,t){this.currentTimePending=!1,this._idle=!0,this._paused=!1,this._finishedFlag=!0,this._currentTime=0,this._playbackRate=1,this._inTimeline=!0,this.effect=e,e.animation=this,this.timeline=t,this.id=""+Gn++,this._inEffect=!!this.effect.update(0),this._holdTime=0,this._paused=!1,this.oldPlayState="idle",this.updatePromises()}return Object.defineProperty(e.prototype,"pending",{get:function(){return null===this._startTime&&!this._paused&&0!==this.playbackRate||this.currentTimePending},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playState",{get:function(){return this._idle?"idle":this._isFinished?"finished":this._paused?"paused":"running"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ready",{get:function(){var e=this;return this.readyPromise||(-1===this.timeline.animationsWithPromises.indexOf(this)&&this.timeline.animationsWithPromises.push(this),this.readyPromise=new Promise((function(t,n){e.resolveReadyPromise=function(){t(e)},e.rejectReadyPromise=function(){n(new Error)}})),this.pending||this.resolveReadyPromise()),this.readyPromise},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"finished",{get:function(){var e=this;return this.finishedPromise||(-1===this.timeline.animationsWithPromises.indexOf(this)&&this.timeline.animationsWithPromises.push(this),this.finishedPromise=new Promise((function(t,n){e.resolveFinishedPromise=function(){t(e)},e.rejectFinishedPromise=function(){n(new Error)}})),"finished"===this.playState&&this.resolveFinishedPromise()),this.finishedPromise},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentTime",{get:function(){return this.updatePromises(),this._idle||this.currentTimePending?null:this._currentTime},set:function(e){var t;e=Number(e),isNaN(e)||(this.timeline.restart(),this._paused||null===this._startTime||(this._startTime=Number(null===(t=this.timeline)||void 0===t?void 0:t.currentTime)-e/this.playbackRate),this.currentTimePending=!1,this._currentTime!==e&&(this._idle&&(this._idle=!1,this._paused=!0),this.tickCurrentTime(e,!0),this.timeline.applyDirtiedAnimation(this)))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"startTime",{get:function(){return this._startTime},set:function(e){if(null!==e){if(this.updatePromises(),e=Number(e),isNaN(e))return;if(this._paused||this._idle)return;this._startTime=e,this.tickCurrentTime((Number(this.timeline.currentTime)-this._startTime)*this.playbackRate),this.timeline.applyDirtiedAnimation(this),this.updatePromises()}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(e){if(e!==this._playbackRate){this.updatePromises();var t=this.currentTime;this._playbackRate=e,this.startTime=null,"paused"!==this.playState&&"idle"!==this.playState&&(this._finishedFlag=!1,this._idle=!1,this.ensureAlive(),this.timeline.applyDirtiedAnimation(this)),null!==t&&(this.currentTime=t),this.updatePromises()}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_isFinished",{get:function(){return!this._idle&&(this._playbackRate>0&&Number(this._currentTime)>=this.totalDuration||this._playbackRate<0&&Number(this._currentTime)<=0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"totalDuration",{get:function(){var e;return Number(null===(e=this.effect)||void 0===e?void 0:e.getComputedTiming().activeDuration)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_needsTick",{get:function(){return this.pending||"running"===this.playState||!this._finishedFlag},enumerable:!1,configurable:!0}),e.prototype.updatePromises=function(){var e=this.oldPlayState,t=this.pending?"pending":this.playState;return this.readyPromise&&t!==e&&("idle"===t?(this.rejectReadyPromise(),this.readyPromise=void 0):"pending"===e?this.resolveReadyPromise():"pending"===t&&(this.readyPromise=void 0)),this.finishedPromise&&t!==e&&("idle"===t?(this.rejectFinishedPromise(),this.finishedPromise=void 0):"finished"===t?this.resolveFinishedPromise():"finished"===e&&(this.finishedPromise=void 0)),this.oldPlayState=t,this.readyPromise||this.finishedPromise},e.prototype.play=function(){this.updatePromises(),this._paused=!1,(this._isFinished||this._idle)&&(this.rewind(),this._startTime=null),this._finishedFlag=!1,this._idle=!1,this.ensureAlive(),this.timeline.applyDirtiedAnimation(this),-1===this.timeline.animations.indexOf(this)&&this.timeline.animations.push(this),this.updatePromises()},e.prototype.pause=function(){this.updatePromises(),this.currentTime&&(this._holdTime=this.currentTime),this._isFinished||this._paused||this._idle?this._idle&&(this.rewind(),this._idle=!1):this.currentTimePending=!0,this._startTime=null,this._paused=!0,this.updatePromises()},e.prototype.finish=function(){this.updatePromises(),this._idle||(this.currentTime=this._playbackRate>0?this.totalDuration:0,this._startTime=this.totalDuration-this.currentTime,this.currentTimePending=!1,this.timeline.applyDirtiedAnimation(this),this.updatePromises())},e.prototype.cancel=function(){this.updatePromises(),this._inEffect&&(this._inEffect=!1,this._idle=!0,this._paused=!1,this._finishedFlag=!0,this._currentTime=0,this._startTime=null,this.effect.update(null),this.timeline.applyDirtiedAnimation(this),this.updatePromises())},e.prototype.reverse=function(){this.updatePromises();var e=this.currentTime;this.playbackRate*=-1,this.play(),null!==e&&(this.currentTime=e),this.updatePromises()},e.prototype.updatePlaybackRate=function(e){this.playbackRate=e},e.prototype.targetAnimations=function(){var e;return(null===(e=this.effect)||void 0===e?void 0:e.target).getAnimations()},e.prototype.markTarget=function(){var e=this.targetAnimations();-1===e.indexOf(this)&&e.push(this)},e.prototype.unmarkTarget=function(){var e=this.targetAnimations(),t=e.indexOf(this);-1!==t&&e.splice(t,1)},e.prototype.tick=function(e,t){this._idle||this._paused||(null===this._startTime?t&&(this.startTime=e-this._currentTime/this.playbackRate):this._isFinished||this.tickCurrentTime((e-this._startTime)*this.playbackRate)),t&&(this.currentTimePending=!1,this.fireEvents(e))},e.prototype.rewind=function(){if(this.playbackRate>=0)this.currentTime=0;else{if(!(this.totalDuration<1/0))throw new Error("Unable to rewind negative playback rate animation with infinite duration");this.currentTime=this.totalDuration}},e.prototype.persist=function(){throw new Error("Method not implemented.")},e.prototype.addEventListener=function(e,t,n){throw new Error("Method not implemented.")},e.prototype.removeEventListener=function(e,t,n){throw new Error("Method not implemented.")},e.prototype.dispatchEvent=function(e){throw new Error("Method not implemented.")},e.prototype.commitStyles=function(){throw new Error("Method not implemented.")},e.prototype.ensureAlive=function(){var e,t;this.playbackRate<0&&0===this.currentTime?this._inEffect=!!(null===(e=this.effect)||void 0===e?void 0:e.update(-1)):this._inEffect=!!(null===(t=this.effect)||void 0===t?void 0:t.update(this.currentTime)),this._inTimeline||!this._inEffect&&this._finishedFlag||(this._inTimeline=!0,this.timeline.animations.push(this))},e.prototype.tickCurrentTime=function(e,t){e!==this._currentTime&&(this._currentTime=e,this._isFinished&&!t&&(this._currentTime=this._playbackRate>0?this.totalDuration:0),this.ensureAlive())},e.prototype.fireEvents=function(e){var t=this;if(this._isFinished){if(!this._finishedFlag){if(this.onfinish){var n=new Un(null,this,this.currentTime,e);setTimeout((function(){t.onfinish&&t.onfinish(n)}))}this._finishedFlag=!0}}else{if(this.onframe&&"running"===this.playState){var r=new Un(null,this,this.currentTime,e);this.onframe(r)}this._finishedFlag=!1}},e}();function Vn(e){return Vn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Vn(e)}function Xn(e){return("object"===("undefined"==typeof window?"undefined":Vn(window))&&window.requestAnimationFrame?window.requestAnimationFrame:function(e){return setTimeout(e,16)})(e)}function Hn(e){return("object"===("undefined"==typeof window?"undefined":Vn(window))&&window.cancelAnimationFrame?window.cancelAnimationFrame:clearTimeout)(e)}function jn(e,t){return Number(e.id)-Number(t.id)}var zn=function(){function e(){var e=this;this.animations=[],this.ticking=!1,this.timelineTicking=!1,this.hasRestartedThisFrame=!1,this.animationsWithPromises=[],this.inTick=!1,this.pendingEffects=[],this.currentTime=null,this.rafId=0,this.rafCallbacks=[],this.webAnimationsNextTick=function(t){e.currentTime=t,e.discardAnimations(),0===e.animations.length?e.timelineTicking=!1:e.requestAnimationFrame(e.webAnimationsNextTick)},this.processRafCallbacks=function(t){var n=e.rafCallbacks;e.rafCallbacks=[],t<Number(e.currentTime)&&(t=Number(e.currentTime)),e.animations.sort(jn),e.animations=e.tick(t,!0,e.animations)[0],n.forEach((function(e){e[1](t)})),e.applyPendingEffects()}}return e.prototype.getAnimations=function(){return this.discardAnimations(),this.animations.slice()},e.prototype.isTicking=function(){return this.inTick},e.prototype.play=function(e){var t=new Wn(e,this);return this.animations.push(t),this.restartWebAnimationsNextTick(),t.updatePromises(),t.play(),t.updatePromises(),t},e.prototype.applyDirtiedAnimation=function(e){var t=this;if(!this.inTick){e.markTarget();var n=e.targetAnimations();n.sort(jn),this.tick(Number(this.currentTime),!1,n.slice())[1].forEach((function(e){var n=t.animations.indexOf(e);-1!==n&&t.animations.splice(n,1)})),this.applyPendingEffects()}},e.prototype.restart=function(){return this.ticking||(this.ticking=!0,this.requestAnimationFrame((function(){})),this.hasRestartedThisFrame=!0),this.hasRestartedThisFrame},e.prototype.destroy=function(){Hn(this.frameId)},e.prototype.applyPendingEffects=function(){this.pendingEffects.forEach((function(e){null==e||e.applyInterpolations()})),this.pendingEffects=[]},e.prototype.updateAnimationsPromises=function(){this.animationsWithPromises=this.animationsWithPromises.filter((function(e){return e.updatePromises()}))},e.prototype.discardAnimations=function(){this.updateAnimationsPromises(),this.animations=this.animations.filter((function(e){return"finished"!==e.playState&&"idle"!==e.playState}))},e.prototype.restartWebAnimationsNextTick=function(){this.timelineTicking||(this.timelineTicking=!0,this.requestAnimationFrame(this.webAnimationsNextTick))},e.prototype.rAF=function(e){var t=this.rafId++;return 0===this.rafCallbacks.length&&(this.frameId=Xn(this.processRafCallbacks)),this.rafCallbacks.push([t,e]),t},e.prototype.requestAnimationFrame=function(e){var t=this;return this.rAF((function(n){t.updateAnimationsPromises(),e(n),t.updateAnimationsPromises()}))},e.prototype.tick=function(e,t,n){var r,i,o=this;this.inTick=!0,this.hasRestartedThisFrame=!1,this.currentTime=e,this.ticking=!1;var a=[],s=[],u=[],c=[];return n.forEach((function(n){n.tick(e,t),n._inEffect?(s.push(n.effect),n.markTarget()):(a.push(n.effect),n.unmarkTarget()),n._needsTick&&(o.ticking=!0);var r=n._inEffect||n._needsTick;n._inTimeline=r,r?u.push(n):c.push(n)})),(r=this.pendingEffects).push.apply(r,f([],h(a),!1)),(i=this.pendingEffects).push.apply(i,f([],h(s),!1)),this.ticking&&this.requestAnimationFrame((function(){})),this.inTick=!1,[u,c]},e}(),Yn=.1,qn="function"==typeof Float32Array,Kn=function(e,t){return 1-3*t+3*e},Zn=function(e,t){return 3*t-6*e},$n=function(e){return 3*e},Qn=function(e,t,n){return((Kn(t,n)*e+Zn(t,n))*e+$n(t))*e},Jn=function(e,t,n){return 3*Kn(t,n)*e*e+2*Zn(t,n)*e+$n(t)},er=function(e,t,n,r){if(!(0<=e&&e<=1&&0<=n&&n<=1))throw new Error("bezier x values must be in [0, 1] range");if(e===t&&n===r)return function(e){return e};for(var i=qn?new Float32Array(11):new Array(11),o=0;o<11;++o)i[o]=Qn(o*Yn,e,n);return function(o){return 0===o||1===o?o:Qn(function(t){for(var r=0,o=1;10!==o&&i[o]<=t;++o)r+=Yn;--o;var a=r+(t-i[o])/(i[o+1]-i[o])*Yn,s=Jn(a,e,n);return s>=.001?function(e,t,n,r){for(var i=0;i<4;++i){var o=Jn(t,n,r);if(0===o)return t;t-=(Qn(t,n,r)-e)/o}return t}(t,a,e,n):0===s?a:function(e,t,n,r,i){var o,a,s=0;do{(o=Qn(a=t+(n-t)/2,r,i)-e)>0?n=a:t=a}while(Math.abs(o)>1e-7&&++s<10);return a}(t,r,r+Yn,e,n)}(o),t,r)}},tr=function(e,t,n){return Math.min(Math.max(e,t),n)},nr=function(e){return Math.pow(e,2)},rr=function(e){return Math.pow(e,3)},ir=function(e){return Math.pow(e,4)},or=function(e){return Math.pow(e,5)},ar=function(e){return Math.pow(e,6)},sr=function(e){return 1-Math.cos(e*Math.PI/2)},ur=function(e){return 1-Math.sqrt(1-e*e)},cr=function(e){return e*e*(3*e-2)},lr=function(e){for(var t,n=4;e<((t=Math.pow(2,--n))-1)/11;);return 1/Math.pow(4,3-n)-7.5625*Math.pow((3*t-2)/22-e,2)},hr=function(e,t){void 0===t&&(t=[]);var n=h(t,2),r=n[0],i=void 0===r?1:r,o=n[1],a=void 0===o?.5:o,s=tr(Number(i),1,10),u=tr(Number(a),.1,2);return 0===e||1===e?e:-s*Math.pow(2,10*(e-1))*Math.sin((e-1-u/(2*Math.PI)*Math.asin(1/s))*(2*Math.PI)/u)},fr=function(e,t,n){void 0===t&&(t=[]);var r=h(t,4),i=r[0],o=void 0===i?1:i,a=r[1],s=void 0===a?100:a,u=r[2],c=void 0===u?10:u,l=r[3],f=void 0===l?0:l;o=tr(o,.1,1e3),s=tr(s,.1,1e3),c=tr(c,.1,1e3),f=tr(f,.1,1e3);var d=Math.sqrt(s/o),p=c/(2*Math.sqrt(s*o)),v=p<1?d*Math.sqrt(1-p*p):0,g=p<1?(p*d-f)/v:-f+d,_=n?n*e/1e3:e;return _=p<1?Math.exp(-_*p*d)*(1*Math.cos(v*_)+g*Math.sin(v*_)):(1+g*_)*Math.exp(-_*d),0===e||1===e?e:1-_},dr=(new Map,function(e,t){void 0===t&&(t=[]);var n=h(t,2),r=n[0],i=void 0===r?10:r;return("start"==n[1]?Math.ceil:Math.floor)(tr(e,0,1)*i)/i}),pr=function(e,t){void 0===t&&(t=[]);var n=h(t,4),r=n[0],i=n[1],o=n[2],a=n[3];return er(r,i,o,a)(e)},vr=er(.42,0,1,1),gr=function(e){return function(t,n,r){return void 0===n&&(n=[]),1-e(1-t,n,r)}},_r=function(e){return function(t,n,r){return void 0===n&&(n=[]),t<.5?e(2*t,n,r)/2:1-e(-2*t+2,n,r)/2}},yr=function(e){return function(t,n,r){return void 0===n&&(n=[]),t<.5?(1-e(1-2*t,n,r))/2:(e(2*t-1,n,r)+1)/2}},mr={steps:dr,"step-start":function(e){return dr(e,[1,"start"])},"step-end":function(e){return dr(e,[1,"end"])},linear:function(e){return e},"cubic-bezier":pr,ease:function(e){return pr(e,[.25,.1,.25,1])},in:vr,out:gr(vr),"in-out":_r(vr),"out-in":yr(vr),"in-quad":nr,"out-quad":gr(nr),"in-out-quad":_r(nr),"out-in-quad":yr(nr),"in-cubic":rr,"out-cubic":gr(rr),"in-out-cubic":_r(rr),"out-in-cubic":yr(rr),"in-quart":ir,"out-quart":gr(ir),"in-out-quart":_r(ir),"out-in-quart":yr(ir),"in-quint":or,"out-quint":gr(or),"in-out-quint":_r(or),"out-in-quint":yr(or),"in-expo":ar,"out-expo":gr(ar),"in-out-expo":_r(ar),"out-in-expo":yr(ar),"in-sine":sr,"out-sine":gr(sr),"in-out-sine":_r(sr),"out-in-sine":yr(sr),"in-circ":ur,"out-circ":gr(ur),"in-out-circ":_r(ur),"out-in-circ":yr(ur),"in-back":cr,"out-back":gr(cr),"in-out-back":_r(cr),"out-in-back":yr(cr),"in-bounce":lr,"out-bounce":gr(lr),"in-out-bounce":_r(lr),"out-in-bounce":yr(lr),"in-elastic":hr,"out-elastic":gr(hr),"in-out-elastic":_r(hr),"out-in-elastic":yr(hr),spring:fr,"spring-in":fr,"spring-out":gr(fr),"spring-in-out":_r(fr),"spring-out-in":yr(fr)},Er=function(e){return e};function Tr(e,t){return function(n){if(n>=1)return 1;var r=1/e;return(n+=t*r)-n%r}}var Rr="\\s*(-?\\d+\\.?\\d*|-?\\.\\d+)\\s*",Ar=new RegExp("cubic-bezier\\("+Rr+","+Rr+","+Rr+","+Rr+"\\)"),Sr=/steps\(\s*(\d+)\s*\)/,br=/steps\(\s*(\d+)\s*,\s*(start|middle|end)\s*\)/;function xr(e){var t=Ar.exec(e);if(t)return er.apply(void 0,f([],h(t.slice(1).map(Number)),!1));var n=Sr.exec(e);if(n)return Tr(Number(n[1]),0);var r=br.exec(e);return r?Tr(Number(r[1]),{start:1,middle:.5,end:0}[r[2]]):mr[function(e){return(t=e,"-"===(t=t.replace(/([A-Z])/g,(function(e){return"-"+e.toLowerCase()}))).charAt(0)?t.substr(1):t).replace(/^ease-/,"").replace(/(\(|\s).+/,"").toLowerCase().trim();var t}(e)]||mr.linear}var Cr=(Object.keys({in:"ease-in",out:"ease-out","in-out":"ease-in-out","in-sine":"cubic-bezier(0.47, 0, 0.745, 0.715)","out-sine":"cubic-bezier(0.39, 0.575, 0.565, 1)","in-out-sine":"cubic-bezier(0.445, 0.05, 0.55, 0.95)","in-quad":"cubic-bezier(0.55, 0.085, 0.68, 0.53)","out-quad":"cubic-bezier(0.25, 0.46, 0.45, 0.94)","in-out-quad":"cubic-bezier(0.455, 0.03, 0.515, 0.955)","in-cubic":"cubic-bezier(0.55, 0.055, 0.675, 0.19)","out-cubic":"cubic-bezier(0.215, 0.61, 0.355, 1)","in-out-cubic":"cubic-bezier(0.645, 0.045, 0.355, 1)","in-quart":"cubic-bezier(0.895, 0.03, 0.685, 0.22)","out-quart":"cubic-bezier(0.165, 0.84, 0.44, 1)","in-out-quart":"cubic-bezier(0.77, 0, 0.175, 1)","in-quint":"cubic-bezier(0.755, 0.05, 0.855, 0.06)","out-quint":"cubic-bezier(0.23, 1, 0.32, 1)","in-out-quint":"cubic-bezier(0.86, 0, 0.07, 1)","in-expo":"cubic-bezier(0.95, 0.05, 0.795, 0.035)","out-expo":"cubic-bezier(0.19, 1, 0.22, 1)","in-out-expo":"cubic-bezier(1, 0, 0, 1)","in-circ":"cubic-bezier(0.6, 0.04, 0.98, 0.335)","out-circ":"cubic-bezier(0.075, 0.82, 0.165, 1)","in-out-circ":"cubic-bezier(0.785, 0.135, 0.15, 0.86)","in-back":"cubic-bezier(0.6, -0.28, 0.735, 0.045)","out-back":"cubic-bezier(0.175, 0.885, 0.32, 1.275)","in-out-back":"cubic-bezier(0.68, -0.55, 0.265, 1.55)"}),function(){function e(){this.delay=0,this.direction="normal",this.duration="auto",this._easing="linear",this.easingFunction=Er,this.endDelay=0,this.fill="auto",this.iterationStart=0,this.iterations=1,this.currentIteration=null,this.progress=null}return Object.defineProperty(e.prototype,"easing",{get:function(){return this._easing},set:function(e){this.easingFunction=xr(e),this._easing=e},enumerable:!1,configurable:!0}),e}());function Mr(e,t){if(null===e)return[];Array.isArray(e)||(e=function(e){var t=[];for(var n in e)if(!(n in["easing","offset","composite"])){var r=e[n];Array.isArray(r)||(r=[r]);for(var i=r.length,o=0;o<i;o++){if(!t[o]){var a={};"offset"in e&&(a.offset=Number(e.offset)),"easing"in e&&(a.easing=e.easing),"composite"in e&&(a.composite=e.composite),t[o]=a}void 0!==r[o]&&null!==r[o]&&(t[o][n]=r[o])}}return t.sort((function(e,t){return(e.computedOffset||0)-(t.computedOffset||0)})),t}(e));for(var n=e.map((function(e){var n={};for(var r in(null==t?void 0:t.composite)&&(n.composite="auto"),e){var i=e[r];if("offset"===r){if(null!==i){if(i=Number(i),!isFinite(i))throw new Error("Keyframe offsets must be numbers.");if(i<0||i>1)throw new Error("Keyframe offsets must be between 0 and 1.");n.computedOffset=i}}else if("composite"===r&&-1===["replace","add","accumulate","auto"].indexOf(i))throw new Error(i+" compositing is not supported");n[r]=i}return void 0===n.offset&&(n.offset=null),void 0===n.easing&&(n.easing=(null==t?void 0:t.easing)||"linear"),void 0===n.composite&&(n.composite="auto"),n})),r=!0,i=-1/0,o=0;o<n.length;o++){var a=n[o].offset;if(null!=a){if(a<i)throw new TypeError("Keyframes are not loosely sorted by offset. Sort or specify offsets.");i=a}else r=!1}return n=n.filter((function(e){return Number(e.offset)>=0&&Number(e.offset)<=1})),r||function(){var e,t,r=n.length;n[r-1].computedOffset=Number(null!==(e=n[r-1].offset)&&void 0!==e?e:1),r>1&&(n[0].computedOffset=Number(null!==(t=n[0].offset)&&void 0!==t?t:0));for(var i=0,o=Number(n[0].computedOffset),a=1;a<r;a++){var s=Number(n[a].computedOffset);if(null!=s&&null!=o){for(var u=1;u<a-i;u++)n[i+u].computedOffset=o+(s-o)*u/(a-i);i=a,o=s}}}(),n}function Pr(e){return"offset"!==e&&"easing"!==e&&"composite"!==e&&"computedOffset"!==e}function Nr(e,t,n,r){var i=t,o=n,a=Ma[e],s=Na[e];a&&(i=a(t,r),o=a(n,r));var u=s&&s(i,o,r);if(u){var c=Br.apply(void 0,f([],h(u),!1));return function(e){return 0===e?t:1===e?n:c(e)}}return Br(!1,!0,(function(e){return e?n:t}))}function Or(e,t,n){if("number"==typeof e&&"number"==typeof t)return e*(1-n)+t*n;if("boolean"==typeof e&&"boolean"==typeof t||"string"==typeof e&&"string"==typeof t)return n<.5?e:t;if(Array.isArray(e)&&Array.isArray(t)&&e.length===t.length){for(var r=[],i=0;i<e.length;i++)r.push(Or(e[i],t[i],n));return r}throw new Error("Mismatched interpolation arguments "+e+":"+t)}var Br=function(e,t,n){return function(r){return n(Or(e,t,r))}},Ir="backwards|forwards|both|none".split("|"),Dr="reverse|alternate|alternate-reverse".split("|");var Fr,wr=function(){function e(e,t,n){var r,i=this;this.composite="replace",this.iterationComposite="replace",this.target=e,this.timing=function(e,t){return function(e,t){var n=new Cr;return t&&(n.fill="both",n.duration="auto"),"number"!=typeof e||isNaN(e)?void 0!==e&&Object.keys(e).forEach((function(t){if(void 0!==e[t]&&null!==e[t]&&"auto"!==e[t]){if(("number"==typeof n[t]||"duration"===t)&&("number"!=typeof e[t]||isNaN(e[t])))return;if("fill"===t&&-1===Ir.indexOf(e[t]))return;if("direction"===t&&-1===Dr.indexOf(e[t]))return;n[t]=e[t]}})):n.duration=e,n}(e=function(e){return"number"==typeof e&&(e=isNaN(e)?{duration:"auto"}:{duration:e}),e}(null!=e?e:{duration:"auto"}),t)}(n,!1),this.timing.effect=this,this.timing.activeDuration=(r=this.timing,Math.abs(function(e){var t;return 0===e.duration||0===e.iterations?0:("auto"===e.duration?0:Number(e.duration))*(null!==(t=e.iterations)&&void 0!==t?t:1)}(r)/(r.playbackRate||1))),this.timing.endTime=Math.max(0,this.timing.delay+this.timing.activeDuration+this.timing.endDelay),this.normalizedKeyframes=Mr(t,this.timing),this.interpolations=function(e,t,n){var r=function(e,t){for(var n={},r=0;r<e.length;r++)for(var i in e[r])if(Pr(i)){var o={offset:e[r].offset,computedOffset:e[r].computedOffset,easing:e[r].easing,easingFunction:xr(e[r].easing)||t.easingFunction,value:e[r][i]};n[i]=n[i]||[],n[i].push(o)}return n}(e,t),i=function(e,t){var n=[];for(var r in e)for(var i=e[r],o=0;o<i.length-1;o++){var a=o,s=o+1,u=i[a].computedOffset,c=i[s].computedOffset,l=u,h=c;0===o&&(l=-1/0,0===c&&(s=a)),o===i.length-2&&(h=1/0,1===u&&(a=s)),n.push({applyFrom:l,applyTo:h,startOffset:i[a].computedOffset,endOffset:i[s].computedOffset,easingFunction:i[a].easingFunction,property:r,interpolation:Nr(r,i[a].value,i[s].value,t)})}return n.sort((function(e,t){return e.startOffset-t.startOffset})),n}(r,n);return function(e,t){if(null!==t)i.filter((function(e){return t>=e.applyFrom&&t<e.applyTo})).forEach((function(n){var r=t-n.startOffset,i=n.endOffset-n.startOffset,o=0===i?0:n.easingFunction(r/i);e.style[n.property]=n.interpolation(o)}));else for(var n in r)Pr(n)&&(e.style[n]=null)}}(this.normalizedKeyframes,this.timing,this.target),this.computedTiming=new Proxy(this.timing,{get:function(e,t){return"duration"===t?"auto"===e.duration?0:e.duration:"fill"===t?"auto"===e.fill?"none":e.fill:"localTime"===t?i.animation&&i.animation.currentTime||null:"currentIteration"===t?i.animation&&"running"===i.animation.playState?e.currentIteration||0:null:"progress"===t?i.animation&&"running"===i.animation.playState?e.progress||0:null:e[t]},set:function(){return!0}})}return e.prototype.applyInterpolations=function(){this.interpolations(this.target,Number(this.timeFraction))},e.prototype.update=function(e){return null!==e&&(this.timeFraction=function(e,t,n){var r=function(e,t,n){if(null===t)return 0;var r=n.delay+e+n.endDelay;return t<Math.min(n.delay,r)?1:t>=Math.min(n.delay+e,r)?2:3}(e,t,n),i=function(e,t,n,r,i){switch(r){case 1:return"backwards"===t||"both"===t?0:null;case 3:return n-i;case 2:return"forwards"===t||"both"===t?e:null;case 0:return null}}(e,n.fill,t,r,n.delay);if(null===i)return null;var o="auto"===n.duration?0:n.duration,a=function(e,t,n,r,i){var o=i;return 0===e?1!==t&&(o+=n):o+=r/e,o}(o,r,n.iterations,i,n.iterationStart),s=function(e,t,n,r,i,o){var a=e===1/0?t%1:e%1;return 0!==a||2!==n||0===r||0===i&&0!==o||(a=1),a}(a,n.iterationStart,r,n.iterations,i,o),u=function(e,t,n,r){return 2===e&&t===1/0?1/0:1===n?Math.floor(r)-1:Math.floor(r)}(r,n.iterations,s,a),c=function(e,t,n){var r=e;if("normal"!==e&&"reverse"!==e){var i=t;"alternate-reverse"===e&&(i+=1),r="normal",i!==1/0&&i%2!=0&&(r="reverse")}return"normal"===r?n:1-n}(n.direction,u,s);return n.currentIteration=u,n.progress=c,n.easingFunction(c)}(this.timing.activeDuration,e,this.timing),null!==this.timeFraction)},e.prototype.getKeyframes=function(){return this.normalizedKeyframes},e.prototype.setKeyframes=function(e){this.normalizedKeyframes=Mr(e)},e.prototype.getComputedTiming=function(){return this.computedTiming},e.prototype.getTiming=function(){return this.timing},e.prototype.updateTiming=function(e){var t=this;Object.keys(e||{}).forEach((function(n){t.timing=e[n]}))},e}();function Lr(e){return void 0===e?0:e>360||e<-360?e%360:e}function kr(e,t,n){return oe(e)?Ae(e,t,n):3===e.length?Te(e):Ae(e[0],e[1],e[2]||0)}function Ur(e){return e*(180/Math.PI)}function Gr(e,t){return 16===t.length?function(e,t){var n,r,i=.5*Math.PI,o=h(It(Ee(),t),3),a=o[0],s=o[1],u=o[2],c=Math.asin(-t[2]/a);return c<i?c>-i?(n=Math.atan2(t[6]/s,t[10]/u),r=Math.atan2(t[1]/a,t[0]/a)):(r=0,n=-Math.atan2(t[4]/s,t[5]/s)):(r=0,n=Math.atan2(t[4]/s,t[5]/s)),e[0]=n,e[1]=c,e[2]=r,e}(e,t):function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=r*r,s=i*i,u=o*o,c=n*n+a+s+u,l=n*o-r*i;return l>.499995*c?(e[0]=Math.PI/2,e[1]=2*Math.atan2(r,n),e[2]=0):l<-.499995*c?(e[0]=-Math.PI/2,e[1]=2*Math.atan2(r,n),e[2]=0):(e[0]=Math.asin(2*(n*i-o*r)),e[1]=Math.atan2(2*(n*o+r*i),1-2*(s+u)),e[2]=Math.atan2(2*(n*r+i*o),1-2*(a+s))),e}(e,t)}function Wr(e,t,n,r){var i=e-n,o=t-r;return Math.sqrt(i*i+o*o)}function Vr(e,t){return Math.abs(e-t)<.001}function Xr(e,t){var n=te(e),r=te(t);return{x:n,y:r,width:ee(e)-n,height:ee(t)-r}}Fr=new _e(2),_e!=Float32Array&&(Fr[0]=0,Fr[1]=0);const Hr=function(e,t,n,r){return Wr(e,t,n,r)},jr=function(e,t,n,r,i){return{x:(1-i)*e+i*n,y:(1-i)*t+i*r}};function zr(e,t,n,r,i){var o=1-i;return o*o*o*e+3*t*i*o*o+3*n*i*i*o+r*i*i*i}function Yr(e,t,n,r,i){var o=1-i;return 3*(o*o*(t-e)+2*o*i*(n-t)+i*i*(r-n))}function qr(e,t,n,r){var i,o,a,s=-3*e+9*t-9*n+3*r,u=6*e-12*t+6*n,c=3*t-3*e,l=[];if(Vr(s,0))Vr(u,0)||(i=-c/u)>=0&&i<=1&&l.push(i);else{var h=u*u-4*s*c;Vr(h,0)?l.push(-u/(2*s)):h>0&&(o=(-u-(a=Math.sqrt(h)))/(2*s),(i=(-u+a)/(2*s))>=0&&i<=1&&l.push(i),o>=0&&o<=1&&l.push(o))}return l}function Kr(e,t,n,r,i,o,a,s,u){var c=zr(e,n,i,a,u),l=zr(t,r,o,s,u),h=jr(e,t,n,r,u),f=jr(n,r,i,o,u),d=jr(i,o,a,s,u),p=jr(h.x,h.y,f.x,f.y,u),v=jr(f.x,f.y,d.x,d.y,u);return[[e,t,h.x,h.y,p.x,p.y,c,l],[c,l,v.x,v.y,d.x,d.y,a,s]]}function Zr(e,t,n,r,i,o,a,s,u){if(0===u)return function(e,t){for(var n=0,r=e.length,i=0;i<r;i++)n+=Wr(e[i],t[i],e[(i+1)%r],t[(i+1)%r]);return n/2}([e,n,i,a],[t,r,o,s]);var c=Kr(e,t,n,r,i,o,a,s,.5),l=f(f([],h(c[0]),!1),[u-1],!1),d=f(f([],h(c[1]),!1),[u-1],!1);return Zr.apply(null,l)+Zr.apply(null,d)}const $r={extrema:qr,box:function(e,t,n,r,i,o,a,s){for(var u=[e,a],c=[t,s],l=qr(e,n,i,a),h=qr(t,r,o,s),f=0;f<l.length;f++)u.push(zr(e,n,i,a,l[f]));for(f=0;f<h.length;f++)c.push(zr(t,r,o,s,h[f]));return Xr(u,c)},length:function(e,t,n,r,i,o,a,s){return Zr(e,t,n,r,i,o,a,s,3)},nearestPoint:function(e,t,n,r,i,o,a,s,u,c,l){return function(e,t,n,r,i,o){var a=-1,s=1/0,u=[n,r],c=20;o&&o>200&&(c=o/10);for(var l=1/c,h=l/10,f=0;f<=c;f++){var d=f*l,p=[i.apply(null,e.concat([d])),i.apply(null,t.concat([d]))];(y=Wr(u[0],u[1],p[0],p[1]))<s&&(a=d,s=y)}if(0===a)return{x:e[0],y:t[0]};if(1===a){var v=e.length;return{x:e[v-1],y:t[v-1]}}for(s=1/0,f=0;f<32&&!(h<1e-4);f++){var g=a-h,_=a+h,y=(p=[i.apply(null,e.concat([g])),i.apply(null,t.concat([g]))],Wr(u[0],u[1],p[0],p[1]));if(g>=0&&y<s)a=g,s=y;else{var m=[i.apply(null,e.concat([_])),i.apply(null,t.concat([_]))],E=Wr(u[0],u[1],m[0],m[1]);_<=1&&E<s?(a=_,s=E):h*=.5}}return{x:i.apply(null,e.concat([a])),y:i.apply(null,t.concat([a]))}}([e,n,i,a],[t,r,o,s],u,c,zr,l)},pointDistance:function(e,t,n,r,i,o,a,s,u,c,l){var h=this.nearestPoint(e,t,n,r,i,o,a,s,u,c,l);return Wr(h.x,h.y,u,c)},interpolationAt:zr,pointAt:function(e,t,n,r,i,o,a,s,u){return{x:zr(e,n,i,a,u),y:zr(t,r,o,s,u)}},divide:function(e,t,n,r,i,o,a,s,u){return Kr(e,t,n,r,i,o,a,s,u)},tangentAngle:function(e,t,n,r,i,o,a,s,u){var c=Yr(e,n,i,a,u),l=Yr(t,r,o,s,u);return function(e){return(e+2*Math.PI)%(2*Math.PI)}(Math.atan2(l,c))}};const Qr=function(e){return function(e){if(e.length<2)return 0;for(var t=0,n=0;n<e.length-1;n++){var r=e[n],i=e[n+1];t+=Wr(r[0],r[1],i[0],i[1])}return t}(e)};function Jr(e,t,n){var r=e[0],i=e[1];return[r+(t[0]-r)*n,i+(t[1]-i)*n]}function ei(e){return e.map((function(e,t,n){var r=t&&n[t-1].slice(-2).concat(e.slice(1)),i=t?$r.length.apply($r,f([],h(r),!1)):0;return{s:e,ss:t?i?function(e,t){void 0===t&&(t=.5);var n=e.slice(0,2),r=e.slice(2,4),i=e.slice(4,6),o=e.slice(6,8),a=Jr(n,r,t),s=Jr(r,i,t),u=Jr(i,o,t),c=Jr(a,s,t),l=Jr(s,u,t),h=Jr(c,l,t);return[["C"].concat(a,c,h),["C"].concat(l,u,o)]}(r):[e,e]:[e],l:i}}))}function ti(e,t,n){var r=ei(e),i=ei(t),o=r.length,a=i.length,s=r.filter((function(e){return e.l})).length,u=i.filter((function(e){return e.l})).length,c=r.filter((function(e){return e.l})).reduce((function(e,t){return e+t.l}),0)/s||0,l=i.filter((function(e){return e.l})).reduce((function(e,t){return e+t.l}),0)/u||0,h=n||Math.max(o,a),f=[c,l],d=[h-o,h-a],p=0,v=[r,i].map((function(e,t){return e.l===h?e.map((function(e){return e.s})):e.map((function(e,n){return p=n&&d[t]&&e.l>=f[t],d[t]-=p?1:0,p?e.ss:[e.s]})).flat()}));return v[0].length===v[1].length?v:ti(v[0],v[1],h)}function ni(e){return function(e){var t=0,n=0,r=0,i=0,o=0;return e.map((function(e){var a;switch(e[0]){case"M":case"Z":return r="M"===e[0]?e[1]:r,i="M"===e[0]?e[2]:i,t=r,n=i,0;default:return o=ri.apply(0,[t,n].concat(e.slice(1))),a=h(e.slice(-2),2),t=a[0],n=a[1],o}})).reduce((function(e,t){return e+t}),0)}(e)>=0}function ri(e,t,n,r,i,o,a,s){return 3*((s-t)*(n+i)-(a-e)*(r+o)+r*(e-i)-n*(t-o)+s*(i+e/3)-a*(o+t/3))/20}function ii(e){return e.map((function(e){return Array.isArray(e)?ii(e):Number.isNaN(+e)?e:+e}))}var oi,ai={anchor:[0,0,0],origin:[0,0,0],opacity:1,fillOpacity:1,strokeOpacity:1},si=function(e){function t(t){var n,r,o,a=e.call(this)||this;return a.activeAnimations=[],a.config=t,a.config.interactive=null!==(n=a.config.capture)&&void 0!==n?n:a.config.interactive,a.id=a.config.id||"",a.name=a.config.name||"",a.className=a.config.className||"",a.interactive=null===(r=a.config.interactive)||void 0===r||r,a.nodeName=a.config.type||tn.Group,a.config.style=i(i(i(i({},ai),{zIndex:null!==(o=a.config.zIndex)&&void 0!==o?o:0,visibility:!1===a.config.visible?"hidden":"visible"}),a.config.style),a.config.attrs),a.style=new Proxy(a.attributes,{get:function(e,t){return a.getAttribute(t)},set:function(e,t,n){return a.setAttribute(t,n),!0}}),a.initAttributes(a.config.style),Ca.get(Y).add(a.entity,a),a}return r(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),Ca.get(Y).remove(this.entity),this.getAnimations().forEach((function(e){e.cancel()}))},t.prototype.cloneNode=function(e){var t=new this.constructor({id:this.id,name:this.name,className:this.name,interactive:this.interactive,style:i({},this.style)});return e&&this.children.forEach((function(n){var r=n.cloneNode(e);t.appendChild(r)})),t},t.prototype.initAttributes=function(e){var t=this;void 0===e&&(e={});var n=this.renderable;for(var r in e){var i=e[r];this.attributes[r]=i,this.parseStyleProperty(r,i)}var o={x:1e3,y:1e3};Object.keys(e).sort((function(e,t){return(o[e]||0)-(o[t]||0)})).forEach((function(e){t.updateStyleProperty(e,void 0,t.parsedStyle[e])})),n.dirty=!0},t.prototype.setAttribute=function(t,n,r){void 0===r&&(r=!1),!r&&pe(n,this.attributes[t])&&"transformOrigin"!==t&&"visibility"!==t||("visibility"===t?this.forEach((function(e){e.changeAttribute(t,n)})):this.changeAttribute(t,n),e.prototype.setAttribute.call(this,t,n))},t.prototype.parseStyleProperty=function(e,t){var n=Ma[e];this.parsedStyle[e]=n?n(t,this):t},t.prototype.updateStyleProperty=function(e,t,n){var r=this,i=Pa[e];i&&i.forEach((function(e){e(t,n,r,r.sceneGraphService)}))},t.prototype.changeAttribute=function(e,t){var n=this,r=this.renderable,i=this.attributes[e],o=this.parsedStyle[e];this.attributes[e]=t,this.parseStyleProperty(e,t),this.updateStyleProperty(e,o,this.parsedStyle[e]),this.attributes.clipPathTargets&&this.attributes.clipPathTargets.length&&this.attributes.clipPathTargets.forEach((function(e){en(e),e.emit(Wt.ATTRIBUTE_CHANGED,{attributeName:"clipPath",oldValue:n,newValue:n})})),r.dirty=!0,this.emit(Wt.ATTRIBUTE_CHANGED,{attributeName:e,oldValue:i,newValue:t})},t.prototype.setOrigin=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=0),this.sceneGraphService.setOrigin(this,kr(e,t,n)),this.attributes.origin=this.getOrigin(),this},t.prototype.getOrigin=function(){return this.sceneGraphService.getOrigin(this)},t.prototype.setPosition=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=0),this.sceneGraphService.setPosition(this,kr(e,t,n)),this.syncLocalPosition(),this},t.prototype.setLocalPosition=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=0),this.sceneGraphService.setLocalPosition(this,kr(e,t,n)),this.syncLocalPosition(),this},t.prototype.translate=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=0),this.sceneGraphService.translate(this,kr(e,t,n)),this.syncLocalPosition(),this},t.prototype.translateLocal=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=0),this.sceneGraphService.translateLocal(this,kr(e,t,n)),this.syncLocalPosition(),this},t.prototype.getPosition=function(){return this.sceneGraphService.getPosition(this)},t.prototype.getLocalPosition=function(){return this.sceneGraphService.getLocalPosition(this)},t.prototype.scale=function(e,t,n){return this.scaleLocal(e,t,n)},t.prototype.scaleLocal=function(e,t,n){return"number"==typeof e&&(e=kr(e,t=t||e,n=n||e)),this.sceneGraphService.scaleLocal(this,e),this},t.prototype.setLocalScale=function(e,t,n){return"number"==typeof e&&(e=kr(e,t=t||e,n=n||e)),this.sceneGraphService.setLocalScale(this,e),this},t.prototype.getLocalScale=function(){return this.sceneGraphService.getLocalScale(this)},t.prototype.getScale=function(){return this.sceneGraphService.getScale(this)},t.prototype.getEulerAngles=function(){var e=h(Gr(Ee(),this.sceneGraphService.getWorldTransform(this)),3);return e[0],e[1],Ur(e[2])},t.prototype.getLocalEulerAngles=function(){var e=h(Gr(Ee(),this.sceneGraphService.getLocalRotation(this)),3);return e[0],e[1],Ur(e[2])},t.prototype.setEulerAngles=function(e){return this.sceneGraphService.setEulerAngles(this,0,0,e),this},t.prototype.setLocalEulerAngles=function(e){return this.sceneGraphService.setLocalEulerAngles(this,0,0,e),this},t.prototype.rotateLocal=function(e,t,n){return ce(t)&&ce(n)?this.sceneGraphService.rotateLocal(this,0,0,e):this.sceneGraphService.rotateLocal(this,e,t,n),this},t.prototype.rotate=function(e,t,n){return ce(t)&&ce(n)?this.sceneGraphService.rotate(this,0,0,e):this.sceneGraphService.rotate(this,e,t,n),this},t.prototype.getRotation=function(){return this.sceneGraphService.getRotation(this)},t.prototype.getLocalRotation=function(){return this.sceneGraphService.getLocalRotation(this)},t.prototype.getLocalTransform=function(){return this.sceneGraphService.getLocalTransform(this)},t.prototype.getWorldTransform=function(){return this.sceneGraphService.getWorldTransform(this)},t.prototype.resetLocalTransform=function(){this.sceneGraphService.resetLocalTransform(this)},t.prototype.syncLocalPosition=function(){var e=this.getLocalPosition();this.attributes.x=e[0],this.attributes.y=e[1]},t.prototype.getAnimations=function(){return this.activeAnimations},t.prototype.animate=function(e,t){var n,r,i=null===(n=this.ownerDocument)||void 0===n?void 0:n.timeline;return this.attributes.clipPathTargets&&this.attributes.clipPathTargets.length&&(i=null===(r=this.attributes.clipPathTargets[0].ownerDocument)||void 0===r?void 0:r.timeline),this.parsedStyle.transform=void 0,i?i.play(new wr(this,e,t)):null},t.prototype.show=function(){this.style.visibility="visible"},t.prototype.hide=function(){this.style.visibility="hidden"},t.prototype.isVisible=function(){var e=this.cullable;return"visible"===this.style.visibility&&(!e||e&&!e.isCulled())},t.prototype.toFront=function(){return this.parentNode&&(this.style.zIndex=Math.max.apply(Math,f([],h(this.parentNode.children.map((function(e){return Number(e.style.zIndex)}))),!1))+1),this},t.prototype.toBack=function(){return this.parentNode&&(this.style.zIndex=Math.min.apply(Math,f([],h(this.parentNode.children.map((function(e){return Number(e.style.zIndex)}))),!1))-1),this},t.prototype.getCount=function(){return this.childElementCount},t.prototype.getParent=function(){return this.parentElement},t.prototype.getChildren=function(){return this.children},t.prototype.getFirst=function(){return this.firstElementChild},t.prototype.getLast=function(){return this.lastElementChild},t.prototype.getChildByIndex=function(e){return this.children[e]||null},t.prototype.add=function(e,t){return this.appendChild(e,t)},t.prototype.setClip=function(e){this.style.clipPath=e},t.prototype.getClip=function(){return this.style.clipPath||null},t.prototype.set=function(e,t){this.config[e]=t},t.prototype.get=function(e){return this.config[e]},t.prototype.getConfig=function(){return this.config},t.prototype.attr=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=h(t,2),i=r[0],o=r[1];return i?Q(i)?(Object.keys(i).forEach((function(t){e.setAttribute(t,i[t])})),this):2===t.length?(this.setAttribute(i,o),this):this.attributes[i]:this.attributes},t.prototype.moveTo=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=0),this.setPosition(e,t,n),this},t.prototype.move=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=0),this.setPosition(e,t,n),this},t.prototype.setZIndex=function(e){return this.style.zIndex=e,this},t.prototype.getMatrix=function(){var e=this.getWorldTransform(),t=h(Bt(Ee(),e),2),n=t[0],r=t[1],i=h(It(Ee(),e),2),o=i[0],a=i[1],s=Dt(_t(),e),u=h(Gr(Ee(),s),3),c=u[0],l=(u[1],u[2]);return function(e,t,n,r,i){var o,a,s,u,c,l,h,f=Math.cos(e),d=Math.sin(e);return o=r*f,a=i*d,s=-r*d,u=i*f,c=t,l=n,(h=new _e(9))[0]=o,h[1]=a,h[2]=0,h[3]=s,h[4]=u,h[5]=0,h[6]=c,h[7]=l,h[8]=1,h}(c||l,n,r,o,a)},t.prototype.setMatrix=function(e){var t=e[0],n=e[3],r=e[1],i=e[4],o=Math.sqrt(t*t+n*n),a=Math.sqrt(r*r+i*i);t*i-n*r<0&&(t<i?o=-o:a=-a),o&&(t*=1/o,n*=1/o),a&&(r*=1/a,i*=1/a);var s=Math.atan2(n,t);this.setEulerAngles(s).setPosition(e[6],e[7]).setLocalScale(o,a)},t}(kn),ui=function(e){function t(t){var n=t||{},r=n.style,a=o(n,["style"]);return e.call(this,i({type:tn.Group,style:i({},r)},a))||this}return r(t,e),t}(si),ci=function(e){function t(){var t=e.call(this)||this;return t.defaultView=null,t.ownerDocument=null,t.nodeName="document",t.timeline=new zn,t.documentElement=new ui({id:"g-root"}),t.documentElement.ownerDocument=t,t.documentElement.parentNode=t,t.childNodes=[t.documentElement],t}return r(t,e),Object.defineProperty(t.prototype,"children",{get:function(){return this.childNodes},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"childElementCount",{get:function(){return this.childNodes.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"firstElementChild",{get:function(){return this.firstChild},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastElementChild",{get:function(){return this.lastChild},enumerable:!1,configurable:!0}),t.prototype.createElement=function(e,t){return new(this.defaultView.customElements.get(e))(t)},t.prototype.cloneNode=function(e){throw new Error("Method not implemented.")},t.prototype.destroy=function(){try{this.documentElement.destroy()}catch(e){}this.timeline.destroy()},t.prototype.appendChild=function(e,t){throw new Error("Use document.documentElement instead.")},t.prototype.insertBefore=function(e,t){throw new Error("Use document.documentElement instead.")},t.prototype.removeChild=function(e,t){throw new Error("Use document.documentElement instead.")},t.prototype.replaceChild=function(e,t,n){throw new Error("Use document.documentElement instead.")},t.prototype.append=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Use document.documentElement instead.")},t.prototype.prepend=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Use document.documentElement instead.")},t.prototype.getElementById=function(e){return this.documentElement.getElementById(e)},t.prototype.getElementsByName=function(e){return this.documentElement.getElementsByName(e)},t.prototype.getElementsByTagName=function(e){return this.documentElement.getElementsByTagName(e)},t.prototype.getElementsByClassName=function(e){return this.documentElement.getElementsByClassName(e)},t.prototype.querySelector=function(e){return this.documentElement.querySelector(e)},t.prototype.querySelectorAll=function(e){return this.documentElement.querySelectorAll(e)},t.prototype.find=function(e){return this.documentElement.find(e)},t.prototype.findAll=function(e){return this.documentElement.findAll(e)},t}(On),li=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.client=new qt,t.movement=new qt,t.offset=new qt,t.global=new qt,t.screen=new qt,t}return r(t,e),Object.defineProperty(t.prototype,"clientX",{get:function(){return this.client.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"clientY",{get:function(){return this.client.y},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"movementX",{get:function(){return this.movement.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"movementY",{get:function(){return this.movement.y},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"offsetX",{get:function(){return this.offset.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"offsetY",{get:function(){return this.offset.y},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"globalX",{get:function(){return this.global.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"globalY",{get:function(){return this.global.y},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"screenX",{get:function(){return this.screen.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"screenY",{get:function(){return this.screen.y},enumerable:!1,configurable:!0}),t.prototype.getModifierState=function(e){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(e)},t.prototype.initMouseEvent=function(){throw new Error("Method not implemented.")},t}(Mn),hi=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.width=0,t.height=0,t.isPrimary=!1,t}return r(t,e),t.prototype.getCoalescedEvents=function(){return"pointermove"===this.type||"mousemove"===this.type||"touchmove"===this.type?[this]:[]},t.prototype.getPredictedEvents=function(){throw new Error("getPredictedEvents is not supported!")},t}(li),fi=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.DOM_DELTA_LINE=0,t.DOM_DELTA_PAGE=1,t.DOM_DELTA_PIXEL=2,t}return r(t,e),t}(li),di=(r((function(e){var t=oi.call(this,e)||this;return t.handleMounted=function(e){e.target===e.currentTarget&&t.connectedCallback&&t.connectedCallback()},t.handleUnmounted=function(e){e.target===e.currentTarget&&t.disconnectedCallback&&t.disconnectedCallback()},t.handleAttributeChanged=function(e){if(e.target===t){var n=e.detail,r=n.attributeName,i=n.oldValue,o=n.newValue;t.attributeChangedCallback&&t.attributeChangedCallback(r,i,o)}},t.attributeChangedCallback&&t.addEventListener(Wt.ATTRIBUTE_CHANGED,t.handleAttributeChanged),t.connectedCallback&&t.addEventListener(Wt.MOUNTED,t.handleMounted),t.disconnectedCallback&&t.addEventListener(Wt.UNMOUNTED,t.handleUnmounted),t}),oi=si),function(e){function t(t){var n=t.style,r=o(t,["style"]);return e.call(this,i({type:tn.Circle,style:i({r:0,anchor:[.5,.5]},n)},r))||this}return r(t,e),t}(si)),pi=function(e){function t(t){var n=t.style,r=o(t,["style"]);return e.call(this,i({type:tn.Ellipse,style:i({rx:0,ry:0,anchor:[.5,.5]},n)},r))||this}return r(t,e),t}(si),vi=function(e){function t(t){var n=t.style,r=o(t,["style"]);return e.call(this,i({type:tn.Image,style:i({img:""},n)},r))||this}return r(t,e),t}(si),gi=function(e){function t(t){var n=t.style,r=o(t,["style"]);return e.call(this,i({type:tn.Line,style:i({x1:0,y1:0,x2:0,y2:0,z1:0,z2:0,lineJoin:"miter",lineCap:"butt",lineWidth:1},n)},r))||this}return r(t,e),t.prototype.getPoint=function(e){var t=this.parsedStyle,n=t.x1,r=t.y1,i=t.x2,o=t.y2,a=jr(n,r,i,o,e);return new qt(a.x,a.y)},t.prototype.getTotalLength=function(){var e=this.parsedStyle,t=e.x1,n=e.y1,r=e.x2,i=e.y2;return Hr(t,n,r,i)},t}(si),_i=function(e){function t(t){var n=t.style,r=o(t,["style"]);return e.call(this,i({type:tn.Path,style:i({path:"",lineJoin:"miter",lineCap:"butt",lineWidth:1},n)},r))||this}return r(t,e),t.prototype.getTotalLength=function(){return this.parsedStyle.path.totalLength},t.prototype.getPoint=function(e){var t=0,n=0,r=this.parsedStyle.path.curve;if(!this.parsedStyle.path.curveSegments.length)return r?new qt(r[0][1],r[0][2]):null;this.parsedStyle.path.curveSegments.forEach((function(r,i){e>=r[0]&&e<=r[1]&&(t=(e-r[0])/(r[1]-r[0]),n=i)}));var i=r[n];if(ce(i)||ce(n))return null;var o=i.length,a=r[n+1],s=$r.pointAt(i[o-2],i[o-1],a[1],a[2],a[3],a[4],a[5],a[6],t),u=s.x,c=s.y;return new qt(u,c)},t.prototype.getStartTangent=function(){var e=this.parsedStyle.path.segments,t=[];if(e.length>1){var n=e[0].currentPoint,r=e[1].currentPoint,i=e[1].startTangent;t=[],i?(t.push([n[0]-i[0],n[1]-i[1]]),t.push([n[0],n[1]])):(t.push([r[0],r[1]]),t.push([n[0],n[1]]))}return t},t.prototype.getEndTangent=function(){var e=this.parsedStyle.path.segments,t=e.length,n=[];if(t>1){var r=e[t-2].currentPoint,i=e[t-1].currentPoint,o=e[t-1].endTangent;n=[],o?(n.push([i[0]-o[0],i[1]-o[1]]),n.push([i[0],i[1]])):(n.push([r[0],r[1]]),n.push([i[0],i[1]]))}return n},t}(si),yi=function(e){function t(t){var n=t.style,r=o(t,["style"]);return e.call(this,i({type:tn.Polygon,style:i({points:[]},n)},r))||this}return r(t,e),t}(si),mi=function(e){function t(t){var n=t.style,r=o(t,["style"]);return e.call(this,i({type:tn.Polyline,style:i({points:[],lineJoin:"miter",lineCap:"butt",lineWidth:1},n)},r))||this}return r(t,e),t.prototype.getTotalLength=function(){return this.parsedStyle.points.totalLength},t.prototype.getPoint=function(e){var t=this.parsedStyle.points,n=t.points,r=t.segments,i=0,o=0;r.forEach((function(t,n){e>=t[0]&&e<=t[1]&&(i=(e-t[0])/(t[1]-t[0]),o=n)}));var a=jr(n[o][0],n[o][1],n[o+1][0],n[o+1][1],i),s=a.x,u=a.y;return new qt(s,u)},t.prototype.getStartTangent=function(){var e=this.parsedStyle.points.points,t=[];return t.push([e[1][0],e[1][1]]),t.push([e[0][0],e[0][1]]),t},t.prototype.getEndTangent=function(){var e=this.parsedStyle.points.points,t=e.length-1,n=[];return n.push([e[t-1][0],e[t-1][1]]),n.push([e[t][0],e[t][1]]),n},t}(si),Ei=function(e){function t(t){var n=t.style,r=o(t,["style"]);return e.call(this,i({type:tn.Rect,style:i({width:0,height:0},n)},r))||this}return r(t,e),t}(si),Ti=function(e){function t(t){var n=t.style,r=o(t,["style"]);return e.call(this,i({type:tn.Text,style:i({text:"",fontSize:12,fontFamily:"sans-serif",fontStyle:"normal",fontWeight:"normal",fontVariant:"normal",textAlign:"start",textBaseline:"alphabetic",dropShadow:!1,dropShadowDistance:5,fill:"#000",letterSpacing:0,lineHeight:0,lineJoin:"miter",lineCap:"butt",lineWidth:0,miterLimit:10,padding:0,stroke:"#000",whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100,leading:0},n)},r))||this}return r(t,e),t.prototype.getLineBoundingRects=function(){var e;return(null===(e=this.parsedStyle.metrics)||void 0===e?void 0:e.lineMetrics)||[]},t}(si),Ri=function(e){function t(t){var n=t.style,r=o(t,["style"]),a=e.call(this,i({type:tn.HTML,style:i({innerHTML:"",className:"",style:""},n)},r))||this;return a.cullable.enable=!1,a}return r(t,e),t.prototype.getDomElement=function(){return this.parsedStyle.$el},t.prototype.getBoundingClientRect=function(){return this.parsedStyle.$el.getBoundingClientRect()},t.prototype.getClientRects=function(){return[this.getBoundingClientRect()]},t.prototype.getBounds=function(){var e,t,n=this.getBoundingClientRect(),r=null===(t=null===(e=this.ownerDocument)||void 0===e?void 0:e.defaultView)||void 0===t?void 0:t.getContextService().getBoundingClientRect();if(r){var i=n.left-r.left,o=n.top-r.top,a=new kt;return a.setMinMax(Ae(i,o,0),Ae(i+n.width,o+n.height,0)),a}return null},t.prototype.getLocalBounds=function(){if(this.parentNode){var e=Mt(bt(),this.parentNode.getWorldTransform()),t=this.getBounds();if(t){var n=new kt;return n.setFromTransformedAABB(t,e),n}}return this.getBounds()},t}(si),Ai=function(){function e(){this.registry={},this.define(tn.Circle,di),this.define(tn.Ellipse,pi),this.define(tn.Rect,Ei),this.define(tn.Image,vi),this.define(tn.Line,gi),this.define(tn.Group,ui),this.define(tn.Path,_i),this.define(tn.Polygon,yi),this.define(tn.Polyline,mi),this.define(tn.Text,Ti),this.define(tn.HTML,Ri)}return e.prototype.define=function(e,t){this.registry[e]=t},e.prototype.get=function(e){return this.registry[e]},e}(),Si=p.defineToken("RenderingPluginContribution"),bi=function(){function e(){this.inited=!1,this.stats={total:0,rendered:0},this.zIndexCounter=0,this.hooks={init:new Cn.AsyncSeriesHook,prepare:new Cn.SyncWaterfallHook(["object"]),beginFrame:new Cn.SyncHook([]),beforeRender:new Cn.SyncHook(["objectToRender"]),render:new Cn.SyncHook(["objectToRender"]),afterRender:new Cn.SyncHook(["objectToRender"]),endFrame:new Cn.SyncHook([]),destroy:new Cn.SyncHook([]),pick:new Cn.AsyncSeriesWaterfallHook(["result"]),pointerDown:new Cn.SyncHook(["event"]),pointerUp:new Cn.SyncHook(["event"]),pointerMove:new Cn.SyncHook(["event"]),pointerOut:new Cn.SyncHook(["event"]),pointerOver:new Cn.SyncHook(["event"]),pointerWheel:new Cn.SyncHook(["event"])}}return e.prototype.init=function(){return u(this,void 0,void 0,(function(){var e=this;return c(this,(function(t){switch(t.label){case 0:return this.renderingPluginProvider.getContributions({cache:!1}).forEach((function(t){t.apply(e)})),[4,this.hooks.init.promise()];case 1:return t.sent(),this.inited=!0,[2]}}))}))},e.prototype.getStats=function(){return this.stats},e.prototype.render=function(){this.stats.total=0,this.stats.rendered=0,this.zIndexCounter=0,this.sceneGraphService.syncHierarchy(this.renderingContext.root),this.renderingContext.renderReasons.size&&this.inited&&(this.renderDisplayObject(this.renderingContext.root),this.renderingContext.dirty?(this.hooks.endFrame.call(),this.renderingContext.dirty=!1):this.renderingContext.renderReasons.has(un.DisplayObjectRemoved)&&(this.hooks.beginFrame.call(),this.hooks.endFrame.call()),this.renderingContext.renderReasons.clear())},e.prototype.renderDisplayObject=function(e){var t=this,n=this.hooks.prepare.call(e);e.sortable.renderOrder=this.zIndexCounter++,this.stats.total++,n&&(this.stats.rendered++,this.renderingContext.dirty||(this.renderingContext.dirty=!0,this.hooks.beginFrame.call()),this.hooks.beforeRender.call(n),this.hooks.render.call(n),this.hooks.afterRender.call(n),e.renderable.dirty=!1);var r=e.sortable,i=!1;r.dirty&&(r.sorted=e.childNodes.slice().sort(Jt),i=!0,r.dirty=!1),(r.sorted||e.childNodes).forEach((function(e){t.renderDisplayObject(e)})),i&&e.forEach((function(e){e.emit(Wt.RENDER_ORDER_CHANGED,{renderOrder:e.sortable.renderOrder})}))},e.prototype.destroy=function(){this.inited=!1,this.hooks.destroy.call()},e.prototype.dirtify=function(){this.renderingContext.renderReasons.add(un.DisplayObjectChanged)},a([j(Si),s("design:type",Object)],e.prototype,"renderingPluginProvider",void 0),a([D(xn),s("design:type",Object)],e.prototype,"renderingContext",void 0),a([D(rn),s("design:type",Object)],e.prototype,"sceneGraphService",void 0),a([I()],e)}(),xi=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cursor="default",t.mappingTable={},t.mappingState={trackingData:{}},t.eventPool=new Map,t.onPointerDown=function(e){return u(t,void 0,void 0,(function(){var t,n;return c(this,(function(r){switch(r.label){case 0:return e instanceof hi?[4,this.createPointerEvent(e)]:[2];case 1:return t=r.sent(),this.dispatchEvent(t,"pointerdown"),"touch"===t.pointerType?this.dispatchEvent(t,"touchstart"):"mouse"!==t.pointerType&&"pen"!==t.pointerType||(n=2===t.button,this.dispatchEvent(t,n?"rightdown":"mousedown")),this.trackingData(e.pointerId).pressTargetsByButton[e.button]=t.composedPath(),this.freeEvent(t),[2]}}))}))},t.onPointerUp=function(e){return u(t,void 0,void 0,(function(){var t,n,r,i,o,a,s,u,l;return c(this,(function(c){switch(c.label){case 0:return e instanceof hi?(t=performance.now(),[4,this.createPointerEvent(e)]):[2];case 1:if(n=c.sent(),this.dispatchEvent(n,"pointerup"),"touch"===n.pointerType?this.dispatchEvent(n,"touchend"):"mouse"!==n.pointerType&&"pen"!==n.pointerType||(s=2===n.button,this.dispatchEvent(n,s?"rightup":"mouseup")),r=this.trackingData(e.pointerId),i=this.findMountedTarget(r.pressTargetsByButton[e.button]),o=i,i&&!n.composedPath().includes(i)){for(a=i;a&&!n.composedPath().includes(a);)n.currentTarget=a,this.notifyTarget(n,"pointerupoutside"),"touch"===n.pointerType?this.notifyTarget(n,"touchendoutside"):"mouse"!==n.pointerType&&"pen"!==n.pointerType||(s=2===n.button,this.notifyTarget(n,s?"rightupoutside":"mouseupoutside")),On.isNode(a)&&(a=a.parentNode);delete r.pressTargetsByButton[e.button],o=a}return o&&((u=this.clonePointerEvent(n,"click")).target=o,u.path=[],r.clicksByButton[e.button]||(r.clicksByButton[e.button]={clickCount:0,target:u.target,timeStamp:t}),(l=r.clicksByButton[e.button]).target===u.target&&t-l.timeStamp<200?++l.clickCount:l.clickCount=1,l.target=u.target,l.timeStamp=t,u.detail=l.clickCount,"mouse"===u.pointerType?this.dispatchEvent(u,"click"):"touch"===u.pointerType?this.dispatchEvent(u,"tap"):this.dispatchEvent(u,"pointertap"),this.freeEvent(u)),this.freeEvent(n),[2]}}))}))},t.onPointerMove=function(e){return u(t,void 0,void 0,(function(){var t,n,r,i,o,a,s,u,l,h,f;return c(this,(function(c){switch(c.label){case 0:return e instanceof hi?[4,this.createPointerEvent(e)]:[2];case 1:return t=c.sent(),n="mouse"===t.pointerType||"pen"===t.pointerType,r=this.trackingData(e.pointerId),i=this.findMountedTarget(r.overTargets),r.overTargets&&i!==t.target?(o="mousemove"===e.type?"mouseout":"pointerout",[4,this.createPointerEvent(e,o,i||void 0)]):[3,5];case 2:return a=c.sent(),this.dispatchEvent(a,"pointerout"),n&&this.dispatchEvent(a,"mouseout"),t.composedPath().includes(i)?[3,4]:[4,this.createPointerEvent(e,"pointerleave",i||void 0)];case 3:for((s=c.sent()).eventPhase=s.AT_TARGET;s.target&&!t.composedPath().includes(s.target);)s.currentTarget=s.target,this.notifyTarget(s),n&&this.notifyTarget(s,"mouseleave"),On.isNode(s.target)&&(s.target=s.target.parentNode);this.freeEvent(s),c.label=4;case 4:this.freeEvent(a),c.label=5;case 5:if(i!==t.target){for(u="mousemove"===e.type?"mouseover":"pointerover",l=this.clonePointerEvent(t,u),this.dispatchEvent(l,"pointerover"),n&&this.dispatchEvent(l,"mouseover"),h=i&&On.isNode(i)&&i.parentNode;h&&h!==(On.isNode(this.rootTarget)&&this.rootTarget.parentNode)&&h!==t.target;)h=h.parentNode;if(!h||h===(On.isNode(this.rootTarget)&&this.rootTarget.parentNode)){for((f=this.clonePointerEvent(t,"pointerenter")).eventPhase=f.AT_TARGET;f.target&&f.target!==i&&f.target!==(On.isNode(this.rootTarget)&&this.rootTarget.parentNode);)f.currentTarget=f.target,this.notifyTarget(f),n&&this.notifyTarget(f,"mouseenter"),On.isNode(f.target)&&(f.target=f.target.parentNode);this.freeEvent(f)}this.freeEvent(l)}return this.dispatchEvent(t,"pointermove"),"touch"===t.pointerType&&this.dispatchEvent(t,"touchmove"),n&&(this.dispatchEvent(t,"mousemove"),this.cursor=this.getCursor(t.target)),r.overTargets=t.composedPath(),this.freeEvent(t),[2]}}))}))},t.onPointerOut=function(e){return u(t,void 0,void 0,(function(){var t,n,r,i,o;return c(this,(function(a){switch(a.label){case 0:return e instanceof hi?(t=this.trackingData(e.pointerId)).overTargets?(n="mouse"===e.pointerType||"pen"===e.pointerType,r=this.findMountedTarget(t.overTargets),[4,this.createPointerEvent(e,"pointerout",r||void 0)]):[3,3]:[2];case 1:return i=a.sent(),this.dispatchEvent(i),n&&this.dispatchEvent(i,"mouseout"),[4,this.createPointerEvent(e,"pointerleave",r||void 0)];case 2:for((o=a.sent()).eventPhase=o.AT_TARGET;o.target&&o.target!==(On.isNode(this.rootTarget)&&this.rootTarget.parentNode);)o.currentTarget=o.target,this.notifyTarget(o),n&&this.notifyTarget(o,"mouseleave"),On.isNode(o.target)&&(o.target=o.target.parentNode);t.overTargets=null,this.freeEvent(i),this.freeEvent(o),a.label=3;case 3:return this.cursor=null,[2]}}))}))},t.onPointerOver=function(e){return u(t,void 0,void 0,(function(){var t,n,r,i;return c(this,(function(o){switch(o.label){case 0:return e instanceof hi?(t=this.trackingData(e.pointerId),[4,this.createPointerEvent(e)]):[2];case 1:for(n=o.sent(),r="mouse"===n.pointerType||"pen"===n.pointerType,this.dispatchEvent(n,"pointerover"),r&&this.dispatchEvent(n,"mouseover"),"mouse"===n.pointerType&&(this.cursor=this.getCursor(n.target)),(i=this.clonePointerEvent(n,"pointerenter")).eventPhase=i.AT_TARGET;i.target&&i.target!==(On.isNode(this.rootTarget)&&this.rootTarget.parentNode);)i.currentTarget=i.target,this.notifyTarget(i),r&&this.notifyTarget(i,"mouseenter"),On.isNode(i.target)&&(i.target=i.target.parentNode);return t.overTargets=n.composedPath(),this.freeEvent(n),this.freeEvent(i),[2]}}))}))},t.onPointerUpOutside=function(e){return u(t,void 0,void 0,(function(){var t,n,r,i;return c(this,(function(o){switch(o.label){case 0:return e instanceof hi?(t=this.trackingData(e.pointerId),n=this.findMountedTarget(t.pressTargetsByButton[e.button]),[4,this.createPointerEvent(e)]):[2];case 1:if(r=o.sent(),n){for(i=n;i;)r.currentTarget=i,this.notifyTarget(r,"pointerupoutside"),"touch"===r.pointerType?this.notifyTarget(r,"touchendoutside"):"mouse"!==r.pointerType&&"pen"!==r.pointerType||this.notifyTarget(r,2===r.button?"rightupoutside":"mouseupoutside"),On.isNode(i)&&(i=i.parentNode);delete t.pressTargetsByButton[e.button]}return this.freeEvent(r),[2]}}))}))},t.onWheel=function(e){return u(t,void 0,void 0,(function(){var t;return c(this,(function(n){switch(n.label){case 0:return e instanceof fi?[4,this.createWheelEvent(e)]:[2];case 1:return t=n.sent(),this.dispatchEvent(t),this.freeEvent(t),[2]}}))}))},t}return r(t,e),t.prototype.init=function(){this.rootTarget=this.renderingContext.root.parentNode,this.addEventMapping("pointerdown",this.onPointerDown),this.addEventMapping("pointerup",this.onPointerUp),this.addEventMapping("pointermove",this.onPointerMove),this.addEventMapping("pointerout",this.onPointerOut),this.addEventMapping("pointerleave",this.onPointerOut),this.addEventMapping("pointerover",this.onPointerOver),this.addEventMapping("pointerupoutside",this.onPointerUpOutside),this.addEventMapping("wheel",this.onWheel)},t.prototype.client2Viewport=function(e){var t=this.contextService.getBoundingClientRect();return new qt(e.x-((null==t?void 0:t.left)||0),e.y-((null==t?void 0:t.top)||0))},t.prototype.viewport2Client=function(e){var t=this.contextService.getBoundingClientRect();return new qt(e.x+((null==t?void 0:t.left)||0),e.y+((null==t?void 0:t.top)||0))},t.prototype.viewport2Canvas=function(e){var t=e.x,n=e.y,r=this.rootTarget.defaultView.getCamera(),i=this.canvasConfig,o=i.width,a=i.height,s=r.getPerspectiveInverse(),u=r.getWorldTransform(),c=Pt(bt(),u,s),l=Ae(t/o*2-1,2*(1-n/a)-1,0);return Ke(l,l,c),new qt(l[0],l[1])},t.prototype.canvas2Viewport=function(e){var t=this.rootTarget.defaultView.getCamera(),n=t.getPerspective(),r=t.getViewTransform(),i=Pt(bt(),n,r),o=Ae(e.x,e.y,0);Ke(o,o,i);var a=this.canvasConfig,s=a.width,u=a.height;return new qt((o[0]+1)/2*s,(1-(o[1]+1)/2)*u)},t.prototype.setPickHandler=function(e){this.pickHandler=e},t.prototype.addEventMapping=function(e,t){this.mappingTable[e]||(this.mappingTable[e]=[]),this.mappingTable[e].push({fn:t,priority:0}),this.mappingTable[e].sort((function(e,t){return e.priority-t.priority}))},t.prototype.mapEvent=function(e){if(this.rootTarget){var t=this.mappingTable[e.type];if(t)for(var n=0,r=t.length;n<r;n++)t[n].fn(e);else console.warn("[EventService]: Event mapping not defined for "+e.type)}},t.prototype.dispatchEvent=function(e,t){e.propagationStopped=!1,e.propagationImmediatelyStopped=!1,this.propagate(e,t),this.emit(t||e.type,e)},t.prototype.propagate=function(e,t){if(e.target){var n=e.composedPath();e.eventPhase=e.CAPTURING_PHASE;for(var r=n.length-1;r>=1;r--)if(e.currentTarget=n[r],this.notifyTarget(e,t),e.propagationStopped||e.propagationImmediatelyStopped)return;if(e.eventPhase=e.AT_TARGET,e.currentTarget=e.target,this.notifyTarget(e,t),!e.propagationStopped&&!e.propagationImmediatelyStopped)for(e.eventPhase=e.BUBBLING_PHASE,r=1;r<n.length;r++)if(e.currentTarget=n[r],this.notifyTarget(e,t),e.propagationStopped||e.propagationImmediatelyStopped)return}},t.prototype.propagationPath=function(e){var t=[e],n=this.rootTarget.defaultView||null;if(n&&n===e)return t.unshift(n.document),t;for(var r=0;r<2048&&e!==this.rootTarget;r++)On.isNode(e)&&e.parentNode&&(t.push(e.parentNode),e=e.parentNode);return n&&t.push(n),t},t.prototype.hitTest=function(e){return u(this,void 0,void 0,(function(){var t,n,r,i,o;return c(this,(function(a){switch(a.label){case 0:return t=e.viewportX,n=e.viewportY,r=this.canvasConfig,i=r.width,o=r.height,t<0||n<0||t>i||n>o?[2,null]:[4,this.pickHandler(e)];case 1:return[2,a.sent()||this.rootTarget||null]}}))}))},t.prototype.createPointerEvent=function(e,t,n){return u(this,void 0,void 0,(function(){var r,i,o;return c(this,(function(a){switch(a.label){case 0:return r=this.allocateEvent(hi),this.copyPointerData(e,r),this.copyMouseData(e,r),this.copyData(e,r),r.nativeEvent=e.nativeEvent,r._originalEvent=e,i=r,null==n?[3,1]:(o=n,[3,3]);case 1:return[4,this.hitTest({clientX:r.clientX,clientY:r.clientY,viewportX:r.viewportX,viewportY:r.viewportY,x:r.global.x,y:r.global.y})];case 2:o=a.sent(),a.label=3;case 3:return i.target=o,"string"==typeof t&&(r.type=t),[2,r]}}))}))},t.prototype.createWheelEvent=function(e){return u(this,void 0,void 0,(function(){var t,n;return c(this,(function(r){switch(r.label){case 0:return t=this.allocateEvent(fi),this.copyWheelData(e,t),this.copyMouseData(e,t),this.copyData(e,t),t.nativeEvent=e.nativeEvent,t._originalEvent=e,n=t,[4,this.hitTest({clientX:t.clientX,clientY:t.clientY,viewportX:t.viewportX,viewportY:t.viewportY,x:t.global.x,y:t.global.y})];case 1:return n.target=r.sent(),[2,t]}}))}))},t.prototype.trackingData=function(e){return this.mappingState.trackingData[e]||(this.mappingState.trackingData[e]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[e]},t.prototype.clonePointerEvent=function(e,t){var n=this.allocateEvent(hi);return n.nativeEvent=e.nativeEvent,n._originalEvent=e._originalEvent,this.copyPointerData(e,n),this.copyMouseData(e,n),this.copyData(e,n),n.target=e.target,n.path=e.composedPath().slice(),n.type=null!=t?t:n.type,n},t.prototype.copyPointerData=function(e,t){e instanceof hi&&t instanceof hi&&(t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist)},t.prototype.copyMouseData=function(e,t){e instanceof li&&t instanceof li&&(t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.client.copyFrom(e.client),t.movement.copyFrom(e.movement),t.canvas.copyFrom(e.canvas),t.screen.copyFrom(e.screen),t.global.copyFrom(e.global),t.offset.copyFrom(e.offset))},t.prototype.copyWheelData=function(e,t){t.deltaMode=e.deltaMode,t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ},t.prototype.copyData=function(e,t){t.isTrusted=e.isTrusted,t.timeStamp=performance.now(),t.type=e.type,t.detail=e.detail,t.view=e.view,t.page.copyFrom(e.page),t.viewport.copyFrom(e.viewport)},t.prototype.allocateEvent=function(e){this.eventPool.has(e)||this.eventPool.set(e,[]);var t=this.eventPool.get(e).pop()||new e(this);return t.eventPhase=t.NONE,t.currentTarget=null,t.path=[],t.target=null,t},t.prototype.freeEvent=function(e){if(e.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");var t=e.constructor;this.eventPool.has(t)||this.eventPool.set(t,[]),this.eventPool.get(t).push(e)},t.prototype.notifyTarget=function(e,t){t=null!=t?t:e.type;var n=e.eventPhase===e.CAPTURING_PHASE||e.eventPhase===e.AT_TARGET?t+"capture":t;this.notifyListeners(e,n),e.eventPhase===e.AT_TARGET&&this.notifyListeners(e,t)},t.prototype.notifyListeners=function(e,t){var n=e.currentTarget.emitter,r=n._events[t];if(r)if("fn"in r)r.once&&n.removeListener(t,r.fn,void 0,!0),r.fn.call(r.context,e);else for(var i=0;i<r.length&&!e.propagationImmediatelyStopped;i++)r[i].once&&n.removeListener(t,r[i].fn,void 0,!0),r[i].fn.call(r[i].context,e)},t.prototype.findMountedTarget=function(e){if(!e)return null;for(var t=e[e.length-1],n=e.length-2;n>=0;n--){var r=e[n];if(!(r===this.rootTarget||On.isNode(r)&&r.parentNode===t))break;t=e[n]}return t},t.prototype.getCursor=function(e){for(var t=e;t;){var n=kn.isElement(t)&&t.getAttribute("cursor");if(n)return n;t=On.isNode(t)&&t.parentNode}},a([D(xn),s("design:type",Object)],t.prototype,"renderingContext",void 0),a([D(Sn),s("design:type",Object)],t.prototype,"contextService",void 0),a([D(cn),s("design:type",Object)],t.prototype,"canvasConfig",void 0),a([(0,g.zY)(),s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",void 0)],t.prototype,"init",null),a([I()],t)}(z.EventEmitter);function Ci(t,n,r){var i=r.getGeometryBounds();if(i){var o=r.geometry;if(o&&o.contentBounds){var a=Me(Ee(),Ae.apply(e,f([],h(i.halfExtents.map((function(e){return 2*e}))),!1)),Ce(Ee(),kr(n||Ee()),kr(t||Ee())));o.contentBounds.update(Ce(o.contentBounds.center,o.contentBounds.center,a),o.contentBounds.halfExtents),o.renderBounds.update(Ce(o.renderBounds.center,o.renderBounds.center,a),o.renderBounds.halfExtents),en(r)}}}function Mi(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Pi(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function Ni(){}var Oi,Bi=.7,Ii=1/Bi,Di="\\s*([+-]?\\d+)\\s*",Fi="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",wi="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Li=/^#([0-9a-f]{3,8})$/,ki=new RegExp("^rgb\\("+[Di,Di,Di]+"\\)$"),Ui=new RegExp("^rgb\\("+[wi,wi,wi]+"\\)$"),Gi=new RegExp("^rgba\\("+[Di,Di,Di,Fi]+"\\)$"),Wi=new RegExp("^rgba\\("+[wi,wi,wi,Fi]+"\\)$"),Vi=new RegExp("^hsl\\("+[Fi,wi,wi]+"\\)$"),Xi=new RegExp("^hsla\\("+[Fi,wi,wi,Fi]+"\\)$"),Hi={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function ji(){return this.rgb().formatHex()}function zi(){return this.rgb().formatRgb()}function Yi(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Li.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?qi(t):3===n?new $i(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?Ki(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?Ki(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=ki.exec(e))?new $i(t[1],t[2],t[3],1):(t=Ui.exec(e))?new $i(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=Gi.exec(e))?Ki(t[1],t[2],t[3],t[4]):(t=Wi.exec(e))?Ki(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=Vi.exec(e))?to(t[1],t[2]/100,t[3]/100,1):(t=Xi.exec(e))?to(t[1],t[2]/100,t[3]/100,t[4]):Hi.hasOwnProperty(e)?qi(Hi[e]):"transparent"===e?new $i(NaN,NaN,NaN,0):null}function qi(e){return new $i(e>>16&255,e>>8&255,255&e,1)}function Ki(e,t,n,r){return r<=0&&(e=t=n=NaN),new $i(e,t,n,r)}function Zi(e){return e instanceof Ni||(e=Yi(e)),e?new $i((e=e.rgb()).r,e.g,e.b,e.opacity):new $i}function $i(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function Qi(){return"#"+eo(this.r)+eo(this.g)+eo(this.b)}function Ji(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}function eo(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function to(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new ro(e,t,n,r)}function no(e){if(e instanceof ro)return new ro(e.h,e.s,e.l,e.opacity);if(e instanceof Ni||(e=Yi(e)),!e)return new ro;if(e instanceof ro)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),o=Math.max(t,n,r),a=NaN,s=o-i,u=(o+i)/2;return s?(a=t===o?(n-r)/s+6*(n<r):n===o?(r-t)/s+2:(t-n)/s+4,s/=u<.5?o+i:2-o-i,a*=60):s=u>0&&u<1?0:a,new ro(a,s,u,e.opacity)}function ro(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function io(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}Mi(Ni,Yi,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:ji,formatHex:ji,formatHsl:function(){return no(this).formatHsl()},formatRgb:zi,toString:zi}),Mi($i,(function(e,t,n,r){return 1===arguments.length?Zi(e):new $i(e,t,n,null==r?1:r)}),Pi(Ni,{brighter:function(e){return e=null==e?Ii:Math.pow(Ii,e),new $i(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?Bi:Math.pow(Bi,e),new $i(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Qi,formatHex:Qi,formatRgb:Ji,toString:Ji})),Mi(ro,(function(e,t,n,r){return 1===arguments.length?no(e):new ro(e,t,n,null==r?1:r)}),Pi(Ni,{brighter:function(e){return e=null==e?Ii:Math.pow(Ii,e),new ro(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?Bi:Math.pow(Bi,e),new ro(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new $i(io(e>=240?e-240:e+120,i,r),io(e,i,r),io(e<120?e+240:e-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===e?")":", "+e+")")}})),function(e){e[e.Constant=0]="Constant",e[e.LinearGradient=1]="LinearGradient",e[e.RadialGradient=2]="RadialGradient",e[e.Pattern=3]="Pattern"}(Oi||(Oi={}));var oo=/^l\s*\(\s*([\d.]+)\s*\)\s*(.*)/i,ao=/^r\s*\(\s*([\d.]+)\s*,\s*([\d.]+)\s*,\s*([\d.]+)\s*\)\s*(.*)/i,so=/^p\s*\(\s*([axyn])\s*\)\s*(.*)/i,uo=/[\d.]+:(#[^\s]+|[^\)]+\))/gi;function co(e){if(void 0===e&&(e=""),"transparent"===e)return{type:Oi.Constant,value:[0,0,0,0],formatted:"rgba(0,0,0,0)"};var t=e[0];if("("===e[1]||"("===e[2])if("l"===t){var n=function(e){var t,n=oo.exec(e);if(n){var r=parseFloat(n[1])%360*(Math.PI/180),i=(null===(t=n[2].match(uo))||void 0===t?void 0:t.map((function(e){return e.split(":")})))||[],o=h([1,1],2),a=o[0],s=o[1],u=h([0,0],2),c=u[0],l=u[1],f=void 0,d=void 0;r>=0&&r<.5*Math.PI?(f={x:c,y:l},d={x:a,y:s}):.5*Math.PI<=r&&r<Math.PI?(f={x:a,y:l},d={x:c,y:s}):Math.PI<=r&&r<1.5*Math.PI?(f={x:a,y:s},d={x:c,y:l}):(f={x:c,y:s},d={x:a,y:l});var p=Math.tan(r),v=p*p,g=(d.x-f.x+p*(d.y-f.y))/(v+1)+f.x,_=p*(d.x-f.x+p*(d.y-f.y))/(v+1)+f.y;return{x0:f.x,y0:f.y,x1:g,y1:_,steps:i,hash:e}}return null}(e);if(n)return{type:Oi.LinearGradient,value:n,formatted:""}}else if("r"===t){var r=function(e){var t,n=ao.exec(e);if(n){var r=parseFloat(n[1]),i=parseFloat(n[2]),o=parseFloat(n[3]),a=(null===(t=n[4].match(uo))||void 0===t?void 0:t.map((function(e){return e.split(":")})))||[];if(0===o){var s=n[4].match(uo);return s[s.length-1].split(":")[1]}return{x0:r,y0:i,r0:0,x1:.5,y1:.5,r1:o,steps:a,hash:e}}return null}(e);if(r){if(!re(r))return{type:Oi.RadialGradient,value:r,formatted:""};e=r}}else if("p"===t){var i=function(e){var t=so.exec(e);if(t){var n=t[1],r=t[2];switch(n){case"a":n="repeat";break;case"x":n="repeat-x";break;case"y":n="repeat-y";break;default:n="no-repeat"}return{src:r,repetition:n,hash:e}}return null}(e);if(i)return{type:Oi.Pattern,value:i,formatted:""}}var o=Yi(e),a=[0,0,0,0];return null!==o&&(a[0]=o.r/255,a[1]=o.g/255,a[2]=o.b/255,a[3]=o.opacity),{type:Oi.Constant,value:a,formatted:o&&"rgba("+o.r+","+o.g+","+o.b+","+o.opacity+")"||"rgba(0,0,0,0)"}}function lo(e,t){if(e.type===Oi.Constant&&t.type===Oi.Constant)return[e.value,t.value,function(e){var t=e.slice();if(t[3])for(var n=0;n<3;n++)t[n]=Math.round(ie(255*t[n],0,255));return t[3]=ie(t[3],0,1),"rgba("+t.join(",")+")"}]}function ho(e,t,n){var r=Ca.get(an)(n.nodeName);if(r){var i=n.geometry;i.contentBounds||(i.contentBounds=new kt),i.renderBounds||(i.renderBounds=new kt);var o=r.update(n.parsedStyle,n),a=o.width,s=o.height,u=o.depth,c=void 0===u?0:u,l=o.x,h=void 0===l?0:l,f=o.y,d=void 0===f?0:f,p=o.offsetX,v=void 0===p?0:p,g=o.offsetY,_=void 0===g?0:g,y=o.offsetZ,m=void 0===y?0:y;n.parsedStyle.width=a,n.parsedStyle.height=s,n.parsedStyle.depth=c,n.nodeName===tn.Line||n.nodeName===tn.Polyline||n.nodeName===tn.Polygon||n.nodeName===tn.Path?(n.parsedStyle.offsetX=h-(n.parsedStyle.defX||0),n.parsedStyle.offsetY=d-(n.parsedStyle.defY||0),n.parsedStyle.defX=h,n.parsedStyle.defY=d,n.translateLocal(n.parsedStyle.offsetX,n.parsedStyle.offsetY),n.parsedStyle.x=n.style.x,n.parsedStyle.y=n.style.y):(n.parsedStyle.x=h,n.parsedStyle.y=d);var E=Ae(a/2,s/2,c/2),T=n.parsedStyle,R=T.lineWidth,A=void 0===R?0:R,S=T.anchor,b=void 0===S?[0,0]:S,x=T.shadowColor,C=T.filter,M=void 0===C?[]:C;n.nodeName===tn.Text&&delete n.parsedStyle.anchor;var P=Ae((1-2*b[0])*E[0]+v,(1-2*b[1])*E[1]+_,(1-2*(b[2]||0))*E[2]+m);if(i.contentBounds.update(P,E),A&&xe(E,E,Ae(A/2,A/2,0)),i.renderBounds.update(P,E),x&&x.type===Oi.Constant){var N=i.renderBounds,O=N.min,B=N.max,I=n.parsedStyle,D=I.shadowBlur,F=void 0===D?0:D,w=I.shadowOffsetX,L=void 0===w?0:w,k=I.shadowOffsetY,U=void 0===k?0:k,G=O[0]-F+L,W=B[0]+F+L,V=O[1]-F+U,X=B[1]+F+U;O[0]=Math.min(O[0],G),B[0]=Math.max(B[0],W),O[1]=Math.min(O[1],V),B[1]=Math.max(B[1],X),i.renderBounds.setMinMax(O,B)}M.forEach((function(e){var t=e.name,n=e.params;if("blur"===t){var r=n[0].value;i.renderBounds.update(i.renderBounds.center,xe(i.renderBounds.halfExtents,i.renderBounds.halfExtents,Ae(r,r,0)))}else if("drop-shadow"===t){var o=n[0].value,a=n[1].value,s=n[2].value,u=i.renderBounds,c=u.min,l=u.max,h=c[0]-s+o,f=l[0]+s+o,d=c[1]-s+a,p=l[1]+s+a;c[0]=Math.min(c[0],h),l[0]=Math.max(l[0],f),c[1]=Math.min(c[1],d),l[1]=Math.max(l[1],p),i.renderBounds.setMinMax(c,l)}})),en(n)}}function fo(e,t,n){var r=n.parsedStyle,i=r.x,o=void 0===i?0:i,a=r.y,s=void 0===a?0:a,u=r.z,c=void 0===u?0:u;n.setLocalPosition(o,s,c)}function po(e){return e.toFixed(3).replace(/0+$/,"").replace(/\.$/,"")}function vo(e){return"number"==typeof e?e:/^\s*[-+]?(\d*\.)?\d+\s*$/.test(e)?Number(e):0}function go(e,t){return[e,t,po]}function _o(e,t){return function(n,r){return[n,r,function(n){return po(ie(n,e,t))}]}}function yo(e,t){if(e.length==t.length)return[e,t,function(e){return e}]}function mo(e,t,n){if(e&&e!==t&&e.style.offsetPathTargets){var r=e.style.offsetPathTargets.indexOf(n);e.style.offsetPathTargets.splice(r,1)}t&&(t.style.offsetPathTargets||(t.style.offsetPathTargets=[]),t.style.offsetPathTargets.push(n))}function Eo(e,t,n){if(n.attributes.offsetPath){var r=n.attributes.offsetPath.nodeName;if(r===tn.Line||r===tn.Path||r===tn.Polyline){var i=n.attributes.offsetPath.getPoint(t);i&&n.setLocalPosition(i.x,i.y)}}}function To(e,t,n){if(e&&e!==t&&e.style.clipPathTargets){var r=e.style.clipPathTargets.indexOf(n);e.style.clipPathTargets.splice(r,1)}t&&(t.style.clipPathTargets||(t.style.clipPathTargets=[]),t.style.clipPathTargets.push(n)),en(n)}function Ro(e,t,n){if(n.parentNode){var r=n.parentNode,i=r.renderable,o=r.sortable;i&&(i.dirty=!0),o&&(o.dirty=!0)}}function Ao(e){return"px"===e||"%"===e}function So(e){return"deg"===e||"rad"===e||"turn"===e}function bo(e,t){if("0"===(t=t.trim().toLowerCase())){if("px".search(e)>=0)return{unit:"px",value:0};if("%".search(e)>=0)return{unit:"%",value:0}}if(n=Number(t),oe(n)&&isFinite(n))return{unit:"",value:Number(t)};var n,r=[];t=t.replace(e,(function(e){return r.push(e),"U"+e}));var i="U("+e.source+")";return r.map((function(e){return{unit:e,value:Number(t.replace(new RegExp("U"+e,"g"),"").replace(new RegExp(i,"g"),"*0"))}}))[0]}function xo(e,t,n,r,i){void 0===r&&(r=null),void 0===i&&(i=0);var o=e.unit,a=e.value||0,s=t.value||0;return(Ao(e.unit)||Ao(t.unit))&&(a=No(e,i,r),s=No(t,i,r),o="px"),(So(e.unit)||So(t.unit))&&(a=Oo(e),s=Oo(t),o="deg"),[a,s,function(e){return n&&(e=Math.max(e,0)),po(e)+o}]}var Co=bo.bind(null,new RegExp("px","g")),Mo=bo.bind(null,new RegExp("px|%","g")),Po=bo.bind(null,/deg|rad|grad|turn/g);function No(e,t,n){if("px"===e.unit)return Number(e.value);if("%"===e.unit&&n){var r=n.getBounds(),i=0;return r&&(i=2*r.halfExtents[t]),Number(e.value)/100*i}return 0}function Oo(e){var t=0;return"deg"===e.unit?t=Number(e.value):"rad"===e.unit?t=Ur(Number(e.value)):"turn"===e.unit&&(t=360*Number(e.value)),t}function Bo(e,t,n){n.setOrigin(t[0],t[1],t[2])}function Io(e,t,n){var r,i,o=t.split(" ");if(1===o.length&&("top"===o[0]||"bottom"===o[0]?(o[1]=o[0],o[0]="center"):o[1]="center"),2===o.length){var a=Mo(Do(o[0])),s=Mo(Do(o[1]));a&&(r=No(a,0,n)),s&&(i=No(s,1,n))}ce(r)||ce(i)||n.setOrigin([r,i])}function Do(e){return"center"===e?"50%":"left"===e||"top"===e?"0":"right"===e||"bottom"===e?"100%":e}var Fo=null,wo={unit:"px",value:0},Lo={unit:"deg",value:0};function ko(e){return function(t){var n=0;return e.map((function(e){return e===Fo?t[n++]:e}))}}function Uo(e){return e}var Go={rotate:["A"],rotatex:["A"],rotatey:["A"],rotatez:["A"],rotate3d:["NNNA"],scale:["Nn",ko([Fo,Fo,1]),Uo],scalex:["N",ko([Fo,1,1]),ko([Fo,1])],scaley:["N",ko([1,Fo,1]),ko([1,Fo])],scalez:["N",ko([1,1,Fo])],scale3d:["NNN",Uo],translate:["Tt",ko([Fo,Fo,wo]),Uo],translatex:["T",ko([Fo,wo,wo]),ko([Fo,wo])],translatey:["T",ko([wo,Fo,wo]),ko([wo,Fo])],translatez:["L",ko([wo,wo,Fo])],translate3d:["TTL",Uo]};function Wo(e){if("none"===(e=e.toLowerCase().trim()))return[];for(var t,n=/\s*(\w+)\(([^)]*)\)/g,r=[],i=0;t=n.exec(e);){if(t.index!==i)return[];i=t.index+t[0].length;var o=t[1],a=Go[o];if(!a)return[];var s=t[2].split(","),u=a[0];if(u.length<s.length)return[];for(var c=[],l=0;l<u.length;l++){var h,f=s[l],d=u[l];if(void 0===(h=f?{A:function(e){return"0"===e.trim()?Lo:Po(e)},N:vo,T:Mo,L:Co}[d.toUpperCase()](f):{a:Lo,n:c[0],t:wo}[d]))return[];c.push(h)}if(r.push({t:o,d:c}),n.lastIndex===e.length)return r}return[]}function Vo(e){return e.replace(/[xy]/,"")}function Xo(e){return e.replace(/(x|y|z|3d)?$/,"3d")}function Ho(e,t,n){var r=!1;if(!e.length||!t.length){e.length||(r=!0,e=t,t=[]);for(var i=function(n){var r=e[n],i=r.t,o=r.d,a="scale"===i.substr(0,5)?1:0;t.push({t:i,d:o.map((function(e){return"number"==typeof e?a:{unit:e.unit,value:a}}))})},o=0;o<e.length;o++)i(o)}var a,s,u=[],c=[],l=[];if(e.length!==t.length);else for(o=0;o<e.length;o++){var h=e[o].t,f=t[o].t,d=e[o].d,p=t[o].d,v=Go[h],g=Go[f],_=void 0;if(s=f,("perspective"!==(a=h)||"perspective"!==s)&&("matrix"!==a&&"matrix3d"!==a||"matrix"!==s&&"matrix3d"!==s)){if(h===f)_=h;else if(v[2]&&g[2]&&Vo(h)===Vo(f))_=Vo(h),d=v[2](d),p=g[2](p);else{if(!v[1]||!g[1]||Xo(h)!==Xo(f))break;_=Xo(h),d=v[1](d),p=g[1](p)}for(var y=[],m=[],E=[],T=0;T<d.length;T++){var R=("number"==typeof d[T]?go:xo)(d[T],p[T],!1,n,T);y[T]=R[0],m[T]=R[1],E.push(R[2])}u.push(y),c.push(m),l.push([_,E])}}if(r){var A=u;u=c,c=A}return[u,c,function(e){return e.map((function(e,t){var n=e.map((function(e,n){return l[t][1][n](e)})).join(",");return"matrix"===l[t][0]&&16===n.split(",").length&&(l[t][0]="matrix3d"),l[t][0]+"("+n+")"})).join(" ")}]}function jo(e,t,n){var r=function(e,t){void 0===t&&(t=new Map);var n=[];if(Array.isArray(e))for(var r=0,i=e.length;r<i;r++){var o=e[r];t.has(o)||(n.push(o),t.set(o,!0))}return n}(f(f([],h((e||[]).map((function(e){return e.t}))),!1),h((t||[]).map((function(e){return e.t}))),!1));r.forEach((function(r){var i=(t||[]).find((function(e){return e.t===r})),o=(e||[]).find((function(e){return e.t===r}));if("scale"===r){var a=i&&i.d||[1,1],s=o&&o.d||[1,1];n.scaleLocal(a[0]/s[0],a[1]/s[1],1)}else if("scalex"===r)a=i&&i.d||[1],s=o&&o.d||[1],n.scaleLocal(a[0]/s[0],1,1);else if("scaley"===r)a=i&&i.d||[1],s=o&&o.d||[1],n.scaleLocal(1,a[0]/s[0],1);else if("scalez"===r)a=i&&i.d||[1],s=o&&o.d||[1],n.scaleLocal(1,1,a[0]/s[0]);else if("scale3d"===r)a=i&&i.d||[1,1,1],s=o&&o.d||[1,1,1],n.scaleLocal(a[0]/s[0],a[1]/s[1],a[2]/s[2]);else if("translate"===r){var u=i&&i.d||[wo,wo],c=o&&o.d||[wo,wo];n.translateLocal(u[0].value-c[0].value,u[1].value-c[1].value,0)}else if("translatex"===r)u=i&&i.d||[wo],c=o&&o.d||[wo],n.translateLocal(u[0].value-c[0].value,0,0);else if("translatey"===r)u=i&&i.d||[wo],c=o&&o.d||[wo],n.translateLocal(0,u[0].value-c[0].value,0);else if("translatez"===r)u=i&&i.d||[wo],c=o&&o.d||[wo],n.translateLocal(0,0,u[0].value-c[0].value);else if("translate3d"===r)u=i&&i.d||[wo,wo,wo],c=o&&o.d||[wo,wo,wo],n.translateLocal(u[0].value-c[0].value,u[1].value-c[1].value,u[2].value-c[2].value);else if("rotate"===r){var l=i&&i.d||[Lo],h=o&&o.d||[Lo];n.rotateLocal(0,0,l[0].value-h[0].value)}else"rotatex"===r?(l=i&&i.d||[Lo],h=o&&o.d||[Lo],n.rotateLocal(l[0].value-h[0].value,0,0)):"rotatey"===r?(l=i&&i.d||[Lo],h=o&&o.d||[Lo],n.rotateLocal(0,l[0].value-h[0].value,0)):"rotatez"===r&&(l=i&&i.d||[Lo],h=o&&o.d||[Lo],n.rotateLocal(0,0,l[0].value-h[0].value))}))}var zo=/[MLHVQTCSAZ]([^MLHVQTCSAZ]*)/gi,Yo=/[^\s\,]+/gi;var qo="\t\n\v\f\r   ᠎             　\u2028\u2029",Ko=new RegExp("([a-z])["+qo+",]*((-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?["+qo+"]*,?["+qo+"]*)+)","ig"),Zo=new RegExp("(-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?)["+qo+"]*,?["+qo+"]*","ig"),$o=/[a-z]/;function Qo(e,t){return[t[0]+(t[0]-e[0]),t[1]+(t[1]-e[1])]}function Jo(e){var t=function(e){if(!e)return null;if($(e))return e;var t={a:7,c:6,o:2,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,u:3,z:0},n=[];return String(e).replace(Ko,(function(e,r,i){var o=[],a=r.toLowerCase();if(i.replace(Zo,(function(e,t){t&&o.push(+t)})),"m"===a&&o.length>2&&(n.push([r].concat(o.splice(0,2))),a="l",r="m"===r?"l":"L"),"o"===a&&1===o.length&&n.push([r,o[0]]),"r"===a)n.push([r].concat(o));else for(;o.length>=t[a]&&(n.push([r].concat(o.splice(0,t[a]))),t[a]););return""})),n}(e);if(!t||!t.length)return[["M",0,0]];for(var n=!1,r=0;r<t.length;r++){var i=t[r][0];if($o.test(i)||["V","H","T","S"].indexOf(i)>=0){n=!0;break}}if(!n)return t;var o=[],a=0,s=0,u=0,c=0,l=0,h=t[0];"M"!==h[0]&&"m"!==h[0]||(u=a=+h[1],c=s=+h[2],l++,o[0]=["M",a,s]),r=l;for(var f=t.length;r<f;r++){var d=t[r],p=o[r-1],v=[],g=(i=d[0]).toUpperCase();if(i!==g)switch(v[0]=g,g){case"A":v[1]=d[1],v[2]=d[2],v[3]=d[3],v[4]=d[4],v[5]=d[5],v[6]=+d[6]+a,v[7]=+d[7]+s;break;case"V":v[1]=+d[1]+s;break;case"H":v[1]=+d[1]+a;break;case"M":u=+d[1]+a,c=+d[2]+s,v[1]=u,v[2]=c;break;default:for(var _=1,y=d.length;_<y;_++)v[_]=+d[_]+(_%2?a:s)}else v=t[r];switch(g){case"Z":a=+u,s=+c;break;case"H":v=["L",a=v[1],s];break;case"V":v=["L",a,s=v[1]];break;case"T":a=v[1],s=v[2];var m=Qo([p[1],p[2]],[p[3],p[4]]);v=["Q",m[0],m[1],a,s];break;case"S":a=v[v.length-2],s=v[v.length-1];var E=p.length,T=Qo([p[E-4],p[E-3]],[p[E-2],p[E-1]]);v=["C",T[0],T[1],v[1],v[2],a,s];break;case"M":u=v[v.length-2],c=v[v.length-1];break;default:a=v[v.length-2],s=v[v.length-1]}o.push(v)}return o}var ea=2*Math.PI,ta=function(e,t,n,r,i,o,a){var s=e.x,u=e.y;return{x:r*(s*=t)-i*(u*=n)+o,y:i*s+r*u+a}},na=function(e,t){var n=1.5707963267948966===t?.551915024494:-1.5707963267948966===t?-.551915024494:4/3*Math.tan(t/4),r=Math.cos(e),i=Math.sin(e),o=Math.cos(e+t),a=Math.sin(e+t);return[{x:r-i*n,y:i+r*n},{x:o+a*n,y:a-o*n},{x:o,y:a}]},ra=function(e,t,n,r){var i=e*n+t*r;return i>1&&(i=1),i<-1&&(i=-1),(e*r-t*n<0?-1:1)*Math.acos(i)};function ia(e,t,n,r,i,o,a,s,u){return function(e){var t=e.px,n=e.py,r=e.cx,i=e.cy,o=e.rx,a=e.ry,s=e.xAxisRotation,u=void 0===s?0:s,c=e.largeArcFlag,l=void 0===c?0:c,h=e.sweepFlag,f=void 0===h?0:h,d=[];if(0===o||0===a)return[{x1:0,y1:0,x2:0,y2:0,x:r,y:i}];var p=Math.sin(u*ea/360),v=Math.cos(u*ea/360),g=v*(t-r)/2+p*(n-i)/2,_=-p*(t-r)/2+v*(n-i)/2;if(0===g&&0===_)return[{x1:0,y1:0,x2:0,y2:0,x:r,y:i}];o=Math.abs(o),a=Math.abs(a);var y=Math.pow(g,2)/Math.pow(o,2)+Math.pow(_,2)/Math.pow(a,2);y>1&&(o*=Math.sqrt(y),a*=Math.sqrt(y));var m=function(e,t,n,r,i,o,a,s,u,c,l,h){var f=Math.pow(i,2),d=Math.pow(o,2),p=Math.pow(l,2),v=Math.pow(h,2),g=f*d-f*v-d*p;g<0&&(g=0),g/=f*v+d*p;var _=(g=Math.sqrt(g)*(a===s?-1:1))*i/o*h,y=g*-o/i*l,m=c*_-u*y+(e+n)/2,E=u*_+c*y+(t+r)/2,T=(l-_)/i,R=(h-y)/o,A=(-l-_)/i,S=(-h-y)/o,b=ra(1,0,T,R),x=ra(T,R,A,S);return 0===s&&x>0&&(x-=ea),1===s&&x<0&&(x+=ea),[m,E,b,x]}(t,n,r,i,o,a,l,f,p,v,g,_),E=m[0],T=m[1],R=m[2],A=m[3],S=Math.abs(A)/(ea/4);Math.abs(1-S)<1e-7&&(S=1);var b=Math.max(Math.ceil(S),1);A/=b;for(var x=0;x<b;x++)d.push(na(R,A)),R+=A;return d.map((function(e){var t=ta(e[0],o,a,v,p,E,T),n=t.x,r=t.y,i=ta(e[1],o,a,v,p,E,T),s=i.x,u=i.y,c=ta(e[2],o,a,v,p,E,T);return{x1:n,y1:r,x2:s,y2:u,x:c.x,y:c.y}}))}({px:e,py:t,cx:s,cy:u,rx:n,ry:r,xAxisRotation:i,largeArcFlag:o,sweepFlag:a}).reduce((function(e,t){var n=t.x1,r=t.y1,i=t.x2,o=t.y2,a=t.x,s=t.y;return e.push(n,r,i,o,a,s),e}),[])}function oa(e,t,n,r,i,o){var a=1/3,s=2/3;return[a*e+s*n,a*t+s*r,a*i+s*n,a*o+s*r,i,o]}function aa(e,t,n,r){return[e,t,n,r,n,r]}function sa(e,t){"TQ".indexOf(e[0])<0&&(t.qx=null,t.qy=null);var n=e.slice(1),r=n[0],i=n[1];switch(e[0]){case"M":return t.x=r,t.y=i,e;case"A":return["C"].concat(ia.apply(0,[t.x1,t.y1].concat(e.slice(1))));case"Q":return t.qx=r,t.qy=i,["C"].concat(oa.apply(0,[t.x1,t.y1].concat(e.slice(1))));case"L":return["C"].concat(aa(t.x1,t.y1,e[1],e[2]));case"H":return["C"].concat(aa(t.x1,t.y1,e[1],t.y1));case"V":return["C"].concat(aa(t.x1,t.y1,t.x1,e[1]));case"Z":return["C"].concat(aa(t.x1,t.y1,t.x,t.y))}return e}function ua(e,t,n){if(e[n].length>7){e[n].shift();for(var r=e[n],i=n;r.length;)t[n]="A",e.splice(i+=1,0,["C"].concat(r.splice(0,6)));e.splice(n,1)}}function ca(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function la(e,t){return ca(e)*ca(t)?(e[0]*t[0]+e[1]*t[1])/(ca(e)*ca(t)):1}function ha(e,t){return(e[0]*t[1]<e[1]*t[0]?-1:1)*Math.acos(la(e,t))}function fa(e,t){return e[0]===t[0]&&e[1]===t[1]}function da(e,t){var n,r,i,o=t[1],a=t[2],s=(i=t[3],n=ae*i,r=2*Math.PI,(n%r+r)%r),u=t[4],c=t[5],l=e[0],h=e[1],f=t[6],d=t[7],p=Math.cos(s)*(l-f)/2+Math.sin(s)*(h-d)/2,v=-1*Math.sin(s)*(l-f)/2+Math.cos(s)*(h-d)/2,g=p*p/(o*o)+v*v/(a*a);g>1&&(o*=Math.sqrt(g),a*=Math.sqrt(g));var _=o*o*(v*v)+a*a*(p*p),y=_?Math.sqrt((o*o*(a*a)-_)/_):1;u===c&&(y*=-1),isNaN(y)&&(y=0);var m=a?y*o*v/a:0,E=o?y*-a*p/o:0,T=(l+f)/2+Math.cos(s)*m-Math.sin(s)*E,R=(h+d)/2+Math.sin(s)*m+Math.cos(s)*E,A=[(p-m)/o,(v-E)/a],S=[(-1*p-m)/o,(-1*v-E)/a],b=ha([1,0],A),x=ha(A,S);return la(A,S)<=-1&&(x=Math.PI),la(A,S)>=1&&(x=0),0===c&&x>0&&(x-=2*Math.PI),1===c&&x<0&&(x+=2*Math.PI),{cx:T,cy:R,rx:fa(e,[f,d])?0:o,ry:fa(e,[f,d])?0:a,startAngle:b,endAngle:b+x,xRotation:s,arcFlag:u,sweepFlag:c}}function pa(e,t){return[t[0]+(t[0]-e[0]),t[1]+(t[1]-e[1])]}var va=function(){function e(e,t,n,r){this.x=e,this.y=t,this.width=n,this.height=r,this.left=e,this.right=e+n,this.top=t,this.bottom=t+r,this.width=n,this.height=r,this.x=e,this.y=t}return e.prototype.toJSON=function(){},e}();function ga(e){var t=Jo(e),n=function(e){for(var t=!1,n=e.length,r=0;r<n;r++){var i=e[r][0];if("C"===i||"A"===i||"Q"===i){t=!0;break}}return t}(t),r=t.slice(),i=function(e){for(var t=[],n=[],r=[],i=0;i<e.length;i++){var o=e[i],a=o[0];"M"===a?(r.length&&(n.push(r),r=[]),r.push([o[1],o[2]])):"Z"===a?r.length&&(t.push(r),r=[]):r.push([o[1],o[2]])}return r.length>0&&n.push(r),{polygons:t,polylines:n}}(r),o=i.polygons,a=i.polylines,s=h(function(e,t){void 0===t&&(t=!1);for(var n,r,i=Jo(e),o={x1:0,y1:0,x2:0,y2:0,x:0,y:0,qx:null,qy:null},a=[],s="",u=i.length,c=[],l=0;l<u;l+=1)i[l]&&(s=i[l][0]),a[l]=s,i[l]=sa(i[l],o),ua(i,a,l),u=i.length,"Z"===s&&c.push(l),r=(n=i[l]).length,o.x1=+n[r-2],o.y1=+n[r-1],o.x2=+n[r-4]||o.x1,o.y2=+n[r-3]||o.y1;return t?[i,c]:i}(r,!0),2),u=s[0],c=s[1],l=function(e){for(var t=[],n=null,r=null,i=null,o=0,a=(e=function(e){var t=e||[];return $(t)?t:re(t)?(t=t.match(zo),J(t,(function(e,n){if((e=e.match(Yo))[0].length>1){var r=e[0].charAt(0);e.splice(1,0,e[0].substr(1)),e[0]=r}J(e,(function(t,n){isNaN(t)||(e[n]=+t)})),t[n]=e})),t):void 0}(e)).length,s=0;s<a;s++){var u=e[s];r=e[s+1];var c=u[0],l={command:c,prePoint:n,params:u,startTangent:null,endTangent:null};switch(c){case"M":i=[u[1],u[2]],o=s;break;case"A":var h=da(n,u);l.arcParams=h}if("Z"===c)n=i,r=e[o+1];else{var f=u.length;n=[u[f-2],u[f-1]]}r&&"Z"===r[0]&&(r=e[o],t[o]&&(t[o].prePoint=n)),l.currentPoint=n,t[o]&&fa(n,t[o].currentPoint)&&(t[o].prePoint=l.prePoint);var d=r?[r[r.length-2],r[r.length-1]]:null;l.nextPoint=d;var p=l.prePoint;if(["L","H","V"].includes(c))l.startTangent=[p[0]-n[0],p[1]-n[1]],l.endTangent=[n[0]-p[0],n[1]-p[1]];else if("Q"===c){var v=[u[1],u[2]];l.startTangent=[p[0]-v[0],p[1]-v[1]],l.endTangent=[n[0]-v[0],n[1]-v[1]]}else if("T"===c)v=pa((y=t[s-1]).currentPoint,p),"Q"===y.command?(l.command="Q",l.startTangent=[p[0]-v[0],p[1]-v[1]],l.endTangent=[n[0]-v[0],n[1]-v[1]]):(l.command="TL",l.startTangent=[p[0]-n[0],p[1]-n[1]],l.endTangent=[n[0]-p[0],n[1]-p[1]]);else if("C"===c){var g=[u[1],u[2]],_=[u[3],u[4]];l.startTangent=[p[0]-g[0],p[1]-g[1]],l.endTangent=[n[0]-_[0],n[1]-_[1]],0===l.startTangent[0]&&0===l.startTangent[1]&&(l.startTangent=[g[0]-_[0],g[1]-_[1]]),0===l.endTangent[0]&&0===l.endTangent[1]&&(l.endTangent=[_[0]-g[0],_[1]-g[1]])}else if("S"===c){var y;g=pa((y=t[s-1]).currentPoint,p),_=[u[1],u[2]],"C"===y.command?(l.command="C",l.startTangent=[p[0]-g[0],p[1]-g[1]],l.endTangent=[n[0]-_[0],n[1]-_[1]]):(l.command="SQ",l.startTangent=[p[0]-_[0],p[1]-_[1]],l.endTangent=[n[0]-_[0],n[1]-_[1]])}else if("A"===c){var m=.001,E=l.arcParams||{},T=E.cx,R=void 0===T?0:T,A=E.cy,S=void 0===A?0:A,b=E.rx,x=void 0===b?0:b,C=E.ry,M=void 0===C?0:C,P=E.sweepFlag,N=void 0===P?0:P,O=E.startAngle,B=void 0===O?0:O,I=E.endAngle,D=void 0===I?0:I;0===N&&(m*=-1);var F=x*Math.cos(B-m)+R,w=M*Math.sin(B-m)+S;l.startTangent=[F-i[0],w-i[1]];var L=x*Math.cos(B+D+m)+R,k=M*Math.sin(B+D-m)+S;l.endTangent=[p[0]-L,p[1]-k]}t.push(l)}return t}(r),f=function(e){var t,n,r,i,o=0,a=0,s=[];return e?(e.forEach((function(t,n){r=e[n+1],i=t.length,r&&(o+=$r.length(t[i-2],t[i-1],r[1],r[2],r[3],r[4],r[5],r[6])||0)})),0===o?{curveSegments:[],totalLength:o}:(e.forEach((function(u,c){r=e[c+1],i=u.length,r&&((t=[])[0]=a/o,n=$r.length(u[i-2],u[i-1],r[1],r[2],r[3],r[4],r[5],r[6]),a+=n||0,t[1]=a/o,s.push(t))})),{curveSegments:s,totalLength:o})):{curveSegments:[],totalLength:o}}(u);return{absolutePath:t,hasArc:n,segments:l,polygons:o,polylines:a,curve:u,totalLength:f.totalLength,curveSegments:f.curveSegments,zCommandIndexes:c,rect:_a(u)}}function _a(e){var t=0,n=0,r=[],i=[];e.forEach((function(e){var o=h(e.slice(-2),2),a=o[0],s=o[1];if("M"===e[0])t=a,n=s,r.push(a),i.push(s);else if("C"===e[0]){var u=$r.box.apply($r,f([],h([t,n].concat(e.slice(1))),!1));r=r.concat(u.x,u.x+u.width),i=i.concat(u.y,u.y+u.height),t=a,n=s}}));var o=Math.min.apply(0,r),a=Math.min.apply(0,i),s=Math.max.apply(0,r),u=Math.max.apply(0,i);return new va(o,a,s-o,u-a)}function ya(e,t){var n=e.curve,r=t.curve,i=[n,r];n.length!==r.length&&(i=ti(n,r));var o,a,s,u,c,l,h,f,d=ni(i[0])!==ni(i[1])?(a=(o=i[0]).slice(1).map((function(e,t,n){return t?n[t-1].slice(-2).concat(e.slice(1)):o[0].slice(1).concat(e.slice(1))})).map((function(e){return e.map((function(t,n){return e[e.length-n-2*(1-n%2)]}))})).reverse(),[["M"].concat(a[0].slice(0,2))].concat(a.map((function(e){return["C"].concat(e.slice(2))})))):ii(i[0]);return[d,(s=i[1],u=d,c=s.length-1,l=[],h=0,f=function(e){var t=e.length,n=t-1;return e.map((function(r,i){return e.map((function(r,o){var a,s=i+o;return 0===o||e[s]&&"M"===e[s][0]?(a=e[s],["M"].concat(a.slice(-2))):(s>=t&&(s-=n),e[s])}))}))}(s),f.forEach((function(e,t){s.slice(1).forEach((function(e,n){h+=function(e,t){return Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]))}(s[(t+n)%c].slice(-2),u[n%c].slice(-2))})),l[t]=h,h=0})),f[l.indexOf(Math.min.apply(null,l))]),function(e){return e}]}function ma(e){var t,n,r=[],i=0,o=Qr(e);return e.forEach((function(a,s){e[s+1]&&((t=[0,0])[0]=i/o,n=Hr(a[0],a[1],e[s+1][0],e[s+1][1]),i+=n,t[1]=i/o,r.push(t))})),{points:e,totalLength:o,segments:r}}var Ea=bo.bind(null,/deg|rad|grad|turn|px|%/g),Ta=["blur","brightness","drop-shadow","contrast","grayscale","sepia","saturate","hue-rotate","invert"];function Ra(e){if(void 0===e&&(e=""),"none"===(e=e.toLowerCase().trim()))return[];for(var t,n=/\s*([\w-]+)\(([^)]*)\)/g,r=[],i=0;t=n.exec(e);){if(t.index!==i)return[];if(i=t.index+t[0].length,Ta.indexOf(t[1])>-1&&r.push({name:t[1],params:t[2].split(" ").map((function(e){return Ea(e)||co(e)}))}),n.lastIndex===e.length)return r}return[]}function Aa(e){return e&&1===e.length?[e[0],e[0]]:[e[0],e[1]]}var Sa,ba,xa,Ca=L,Ma={},Pa={},Na={},Oa=X((function(e){function t(e,t,n,r){t&&(Ma[e]=t),n&&(Na[e]=n),r&&(Pa[e]||(Pa[e]=[]),Pa[e].push(r))}function n(e,n,r,i){for(var o=0;o<e.length;o++)t(e[o],n,r,i)}(0,g.GW)(B(),z.EventEmitter),e(Y),e({token:$t,useClass:Qt}),e({token:Zt,useFactory:function(e){return function(){return e.container.get($t)}}}),e({token:rn,useClass:on}),e(pn),e(mn),e(ln),e(hn),e(fn),e(En),e(Tn),e(Rn),e(An),e({token:an,useFactory:function(e){var t={};return function(n){return t[n]||e.container.isBoundNamed(sn,n)&&(t[n]=e.container.getNamed(sn,n)),t[n]}}}),n(["opacity","fillOpacity","strokeOpacity","offsetDistance"],vo,_o(0,1),void 0),n(["r","rx","ry","lineWidth","width","height","shadowBlur"],vo,_o(0,1/0),void 0),n(["lineDash"],Aa,yo,void 0),n(["x1","x2","y1","y2","lineDashOffset","shadowOffsetX","shadowOffsetY"],vo,go,void 0),n(["x1","x2","y1","y2","r","rx","ry","width","height","path","points","text","shadowBlur","shadowOffsetX","shadowOffsetY","lineWidth","filter","font","fontSize","fontFamily","fontStyle","fontWeight","fontVariant","lineHeight","letterSpacing","padding","wordWrap","wordWrapWidth","leading","textBaseline","textAlign","whiteSpace"],void 0,void 0,ho),n(["fill","stroke","shadowColor"],co,lo,void 0),t("clipPath",void 0,void 0,To),t("zIndex",void 0,void 0,Ro),t("offsetPath",void 0,void 0,mo),t("offsetDistance",void 0,void 0,Eo),t("origin",void 0,void 0,Bo),t("transformOrigin",void 0,void 0,Io),t("transform",Wo,Ho,jo),t("path",ga,ya,void 0),t("points",ma,void 0,void 0),n(["x","y","z","points","path","x1","x2","y1","y2","z1","z2"],void 0,void 0,fo),t("filter",Ra,void 0,void 0),t("anchor",void 0,void 0,Ci)})),Ba=function(){function e(e){this.plugins=[],this.config=i({enableAutoRendering:!0,enableDirtyRectangleRendering:!0,enableDirtyRectangleRenderingDebug:!1,enableTAA:!1},e)}return e.prototype.registerPlugin=function(e){this.plugins.push(e)},e.prototype.getPlugins=function(){return this.plugins},e.prototype.getConfig=function(){return this.config},e.prototype.setConfig=function(e){Object.assign(this.config,e)},e}(),Ia={},Da=0,Fa=function(){function e(e,t){var n,r;this.azimuth=0,this.elevation=0,this.roll=0,this.relAzimuth=0,this.relElevation=0,this.relRoll=0,this.name=e,this.matrix=(n=t.matrix,(r=new _e(16))[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r[8]=n[8],r[9]=n[9],r[10]=n[10],r[11]=n[11],r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15],r),this.right=Te(t.right),this.up=Te(t.up),this.forward=Te(t.forward),this.position=Te(t.position),this.focalPoint=Te(t.focalPoint),this.distanceVector=Te(t.distanceVector),this.azimuth=t.azimuth,this.elevation=t.elevation,this.roll=t.roll,this.relAzimuth=t.relAzimuth,this.relElevation=t.relElevation,this.relRoll=t.relRoll,this.dollyingStep=t.dollyingStep,this.distance=t.distance}return e.prototype.getPosition=function(){return this.position},e.prototype.getFocalPoint=function(){return this.focalPoint},e.prototype.getRoll=function(){return this.roll},e.prototype.retrieve=function(e){e.matrix=xt(e.matrix,this.matrix),e.right=Se(e.right,this.right),e.up=Se(e.up,this.up),e.forward=Se(e.forward,this.forward),e.position=Se(e.position,this.position),e.focalPoint=Se(e.focalPoint,this.focalPoint),e.distanceVector=Se(e.distanceVector,this.distanceVector),e.azimuth=this.azimuth,e.elevation=this.elevation,e.roll=this.roll,e.relAzimuth=this.relAzimuth,e.relElevation=this.relElevation,e.relRoll=this.relRoll,e.dollyingStep=this.dollyingStep,e.distance=this.distance},e}(),wa="DefaultCamera";!function(e){e.ORBITING="ORBITING",e.EXPLORING="EXPLORING",e.TRACKING="TRACKING"}(Sa||(Sa={})),function(e){e.DEFAULT="DEFAULT",e.ROTATIONAL="ROTATIONAL",e.TRANSLATIONAL="TRANSLATIONAL",e.CINEMATIC="CINEMATIC"}(ba||(ba={})),function(e){e.ORTHOGRAPHIC="ORTHOGRAPHIC",e.PERSPECTIVE="PERSPECTIVE"}(xa||(xa={}));var La="updated",ka=Math.PI/180,Ua=180/Math.PI,Ga=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.matrix=bt(),t.right=Ae(1,0,0),t.up=Ae(0,1,0),t.forward=Ae(0,0,1),t.position=Ae(0,0,1),t.focalPoint=Ae(0,0,0),t.distanceVector=Ae(0,0,0),t.distance=1,t.azimuth=0,t.elevation=0,t.roll=0,t.relAzimuth=0,t.relElevation=0,t.relRoll=0,t.dollyingStep=0,t.maxDistance=1/0,t.minDistance=-1/0,t.zoom=1,t.rotateWorld=!1,t.fov=30,t.near=.1,t.far=1e3,t.aspect=1,t.projectionMatrix=bt(),t.projectionMatrixInverse=bt(),t.jitteredProjectionMatrix=void 0,t.following=void 0,t.type=Sa.EXPLORING,t.trackingMode=ba.DEFAULT,t.projectionMode=xa.PERSPECTIVE,t.frustum=new Vt,t.landmarks=[],t.orthoMatrix=bt(),t}return r(t,e),t.prototype.isOrtho=function(){return this.projectionMode===xa.ORTHOGRAPHIC},t.prototype.clone=function(){var e=new t;return e.setType(this.type,void 0),e},t.prototype.getProjectionMode=function(){return this.projectionMode},t.prototype.getPerspective=function(){return this.jitteredProjectionMatrix||this.projectionMatrix},t.prototype.getPerspectiveInverse=function(){return this.projectionMatrixInverse},t.prototype.getFrustum=function(){return this.frustum},t.prototype.getPosition=function(){return this.position},t.prototype.getFocalPoint=function(){return this.focalPoint},t.prototype.getNear=function(){return this.near},t.prototype.getFar=function(){return this.far},t.prototype.getZoom=function(){return this.zoom},t.prototype.getOrthoMatrix=function(){return this.orthoMatrix},t.prototype.setType=function(e,t){return this.type=e,this.type===Sa.EXPLORING?this.setWorldRotation(!0):this.setWorldRotation(!1),this._getAngles(),this.type===Sa.TRACKING&&void 0!==t&&this.setTrackingMode(t),this},t.prototype.setProjectionMode=function(e){return this.projectionMode=e,this},t.prototype.setTrackingMode=function(e){if(this.type!==Sa.TRACKING)throw new Error("Impossible to set a tracking mode if the camera is not of tracking type");return this.trackingMode=e,this},t.prototype.setWorldRotation=function(e){this.rotateWorld=e,this._getAngles()},t.prototype.getViewTransform=function(){return Mt(bt(),this.matrix)},t.prototype.getWorldTransform=function(){return this.matrix},t.prototype.jitterProjectionMatrix=function(e,t){var n,r,i=(r=[e,t,0],(n=bt())[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=r[0],n[13]=r[1],n[14]=r[2],n[15]=1,n);this.jitteredProjectionMatrix=Pt(bt(),i,this.projectionMatrix)},t.prototype.clearJitterProjectionMatrix=function(){this.jitteredProjectionMatrix=void 0},t.prototype.setMatrix=function(e){return this.matrix=e,this._update(),this},t.prototype.setFov=function(e){return this.setPerspective(this.near,this.far,e,this.aspect),this},t.prototype.setAspect=function(e){return this.setPerspective(this.near,this.far,this.fov,e),this},t.prototype.setNear=function(e){return this.projectionMode===xa.PERSPECTIVE?this.setPerspective(e,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,e,this.far),this},t.prototype.setFar=function(e){return this.projectionMode===xa.PERSPECTIVE?this.setPerspective(this.near,e,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,e),this},t.prototype.setViewOffset=function(e,t,n,r,i,o){return this.aspect=e/t,void 0===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.projectionMode===xa.PERSPECTIVE?this.setPerspective(this.near,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far),this},t.prototype.clearViewOffset=function(){return void 0!==this.view&&(this.view.enabled=!1),this.projectionMode===xa.PERSPECTIVE?this.setPerspective(this.near,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far),this},t.prototype.setZoom=function(e){return this.zoom=e,this.projectionMode===xa.ORTHOGRAPHIC?this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far):this.projectionMode===xa.PERSPECTIVE&&this.setPerspective(this.near,this.far,this.fov,this.aspect),this},t.prototype.setPerspective=function(e,t,n,r){this.projectionMode=xa.PERSPECTIVE,this.fov=n,this.near=e,this.far=t,this.aspect=r;var i=this.near*Math.tan(.5*ka*this.fov)/this.zoom,o=2*i,a=this.aspect*o,s=-.5*a;if(void 0!==this.view&&this.view.enabled){var u=this.view.fullWidth,c=this.view.fullHeight;s+=this.view.offsetX*a/u,i-=this.view.offsetY*o/c,a*=this.view.width/u,o*=this.view.height/c}return function(e,t,n,r,i,o,a){var s=2*o/(n-t),u=2*o/(r-i),c=(n+t)/(n-t),l=(r+i)/(r-i),h=-(a+o)/(a-o),f=-2*a*o/(a-o);e[0]=s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u,e[6]=0,e[7]=0,e[8]=c,e[9]=l,e[10]=h,e[11]=-1,e[12]=0,e[13]=0,e[14]=f,e[15]=0}(this.projectionMatrix,s,s+a,i,i-o,e,this.far),Ot(this.projectionMatrix,this.projectionMatrix,Ae(1,-1,1)),Mt(this.projectionMatrixInverse,this.projectionMatrix),this.emit(La),this},t.prototype.setOrthographic=function(e,t,n,r,i,o){this.projectionMode=xa.ORTHOGRAPHIC,this.rright=t,this.left=e,this.top=n,this.bottom=r,this.near=i,this.far=o;var a=(this.rright-this.left)/(2*this.zoom),s=(this.top-this.bottom)/(2*this.zoom),u=(this.rright+this.left)/2,c=(this.top+this.bottom)/2,l=u-a,h=u+a,f=c+s,d=c-s;if(void 0!==this.view&&this.view.enabled){var p=(this.rright-this.left)/this.view.fullWidth/this.zoom,v=(this.top-this.bottom)/this.view.fullHeight/this.zoom;h=(l+=p*this.view.offsetX)+p*this.view.width,d=(f-=v*this.view.offsetY)-v*this.view.height}return function(e,t,n,r,i,o,a){var s=1/(t-n),u=1/(r-i),c=1/(o-a);e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*s,e[13]=(i+r)*u,e[14]=(a+o)*c,e[15]=1}(this.projectionMatrix,l,h,d,f,i,o),Ot(this.projectionMatrix,this.projectionMatrix,Ae(1,-1,1)),Mt(this.projectionMatrixInverse,this.projectionMatrix),this._getOrthoMatrix(),this.emit(La),this},t.prototype.setPosition=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=0),this._setPosition(e,t,n),this.setFocalPoint(this.focalPoint),this},t.prototype.setFocalPoint=function(e,t,n){var r,i,o,a,s,u,c,l,h,f,d,p,v,g=Ae(0,1,0);if(this.focalPoint=kr(e,t,n),this.trackingMode===ba.CINEMATIC){var _=Ce(Ee(),this.focalPoint,this.position);e=_[0],t=_[1],n=_[2];var y=Re(_),m=Math.asin(t/y)*Ua,E=90+Math.atan2(n,e)*Ua,T=bt();r=T,i=T,o=E*ka,a=Math.sin(o),s=Math.cos(o),u=i[0],c=i[1],l=i[2],h=i[3],f=i[8],d=i[9],p=i[10],v=i[11],i!==r&&(r[4]=i[4],r[5]=i[5],r[6]=i[6],r[7]=i[7],r[12]=i[12],r[13]=i[13],r[14]=i[14],r[15]=i[15]),r[0]=u*s-f*a,r[1]=c*s-d*a,r[2]=l*s-p*a,r[3]=h*s-v*a,r[8]=u*a+f*s,r[9]=c*a+d*s,r[10]=l*a+p*s,r[11]=h*a+v*s,function(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[4],a=t[5],s=t[6],u=t[7],c=t[8],l=t[9],h=t[10],f=t[11];t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*i+c*r,e[5]=a*i+l*r,e[6]=s*i+h*r,e[7]=u*i+f*r,e[8]=c*i-o*r,e[9]=l*i-a*r,e[10]=h*i-s*r,e[11]=f*i-u*r}(T,T,m*ka),g=Ke(Ee(),[0,1,0],T)}return Mt(this.matrix,function(e,t,n,r){var i,o,a,s,u,c,l,h,f,d,p=t[0],v=t[1],g=t[2],_=r[0],y=r[1],m=r[2],E=n[0],T=n[1],R=n[2];return Math.abs(p-E)<ge&&Math.abs(v-T)<ge&&Math.abs(g-R)<ge?Ct(e):(l=p-E,h=v-T,f=g-R,i=y*(f*=d=1/Math.hypot(l,h,f))-m*(h*=d),o=m*(l*=d)-_*f,a=_*h-y*l,(d=Math.hypot(i,o,a))?(i*=d=1/d,o*=d,a*=d):(i=0,o=0,a=0),s=h*a-f*o,u=f*i-l*a,c=l*o-h*i,(d=Math.hypot(s,u,c))?(s*=d=1/d,u*=d,c*=d):(s=0,u=0,c=0),e[0]=i,e[1]=s,e[2]=l,e[3]=0,e[4]=o,e[5]=u,e[6]=h,e[7]=0,e[8]=a,e[9]=c,e[10]=f,e[11]=0,e[12]=-(i*p+o*v+a*g),e[13]=-(s*p+u*v+c*g),e[14]=-(l*p+h*v+f*g),e[15]=1,e)}(bt(),this.position,this.focalPoint,g)),this._getAxes(),this._getDistance(),this._getAngles(),this},t.prototype.setDistance=function(e){if(!(this.distance===e||e<0)){this.distance=e,this.distance<2e-4&&(this.distance=2e-4),this.dollyingStep=this.distance/100;var t=Ee();e=this.distance;var n=this.forward,r=this.focalPoint;return t[0]=e*n[0]+r[0],t[1]=e*n[1]+r[1],t[2]=e*n[2]+r[2],this._setPosition(t),this}},t.prototype.setMaxDistance=function(e){return this.maxDistance=e,this},t.prototype.setMinDistance=function(e){return this.minDistance=e,this},t.prototype.changeAzimuth=function(e){return this.setAzimuth(this.azimuth+e),this},t.prototype.changeElevation=function(e){return this.setElevation(this.elevation+e),this},t.prototype.changeRoll=function(e){return this.setRoll(this.roll+e),this},t.prototype.setAzimuth=function(e){return this.azimuth=Lr(e),this.computeMatrix(),this._getAxes(),this.type===Sa.ORBITING||this.type===Sa.EXPLORING?this._getPosition():this.type===Sa.TRACKING&&this._getFocalPoint(),this},t.prototype.getAzimuth=function(){return this.azimuth},t.prototype.setElevation=function(e){return this.elevation=Lr(e),this.computeMatrix(),this._getAxes(),this.type===Sa.ORBITING||this.type===Sa.EXPLORING?this._getPosition():this.type===Sa.TRACKING&&this._getFocalPoint(),this},t.prototype.setRoll=function(e){return this.roll=Lr(e),this.computeMatrix(),this._getAxes(),this.type===Sa.ORBITING||this.type===Sa.EXPLORING?this._getPosition():this.type===Sa.TRACKING&&this._getFocalPoint(),this},t.prototype.rotate=function(e,t,n){if(this.relElevation=Lr(t),this.relAzimuth=Lr(e),this.relRoll=Lr(n),this.elevation+=this.relElevation,this.azimuth+=this.relAzimuth,this.roll+=this.relRoll,this.type===Sa.EXPLORING){var r=yt(_t(),[1,0,0],(this.rotateWorld?1:-1)*this.relElevation*ka),i=yt(_t(),[0,1,0],(this.rotateWorld?1:-1)*this.relAzimuth*ka),o=yt(_t(),[0,0,1],this.relRoll*ka),a=mt(_t(),i,r);a=mt(_t(),a,o);var s=wt(bt(),a);Nt(this.matrix,this.matrix,[0,0,-this.distance]),Pt(this.matrix,this.matrix,s),Nt(this.matrix,this.matrix,[0,0,this.distance])}else{if(Math.abs(this.elevation)>90)return;this.computeMatrix()}return this._getAxes(),this.type===Sa.ORBITING||this.type===Sa.EXPLORING?this._getPosition():this.type===Sa.TRACKING&&this._getFocalPoint(),this._update(),this},t.prototype.pan=function(e,t){var n=kr(e,t,0),r=Te(this.position);return xe(r,r,Fe(Ee(),this.right,n[0])),xe(r,r,Fe(Ee(),this.up,n[1])),this._setPosition(r),this.emit(La),this},t.prototype.dolly=function(e){var t=this.forward,n=Te(this.position),r=this.dollyingStep,i=this.distance+e*this.dollyingStep;return r=Math.max(Math.min(i,this.maxDistance),this.minDistance)-this.distance,n[0]+=r*t[0],n[1]+=r*t[1],n[2]+=r*t[2],this._setPosition(n),this.type===Sa.ORBITING||this.type===Sa.EXPLORING?this._getDistance():this.type===Sa.TRACKING&&xe(this.focalPoint,n,this.distanceVector),this.emit(La),this},t.prototype.createLandmark=function(e,t){var n=this.clone();n.setPosition(t.position),n.setFocalPoint(t.focalPoint),void 0!==t.roll&&n.setRoll(t.roll);var r=new Fa(e,n);return this.landmarks.push(r),r},t.prototype.setLandmark=function(e){var t=new Fa(e,this);return this.landmarks.push(t),this},t.prototype.gotoLandmark=function(e,t){var n=this;void 0===t&&(t=1e3);var r=this.landmarks.find((function(t){return t.name===e}));if(r){if(0===t)return void r.retrieve(this);void 0!==this.landmarkAnimationID&&Hn(this.landmarkAnimationID);var i,o=r.getPosition(),a=r.getFocalPoint(),s=r.getRoll();Xn((function e(r){void 0===i&&(i=r);var u,c=r-i,l=(1-Math.cos(c/t*Math.PI))/2,h=Ee(),f=Ee();if(je(h,n.focalPoint,a,l),je(f,n.position,o,l),u=n.roll*(1-l)+s*l,n.setFocalPoint(h),n.setPosition(f),n.setRoll(u),n.computeMatrix(),n.emit(La),!(lt(h,a)+lt(f,o)>.01))return n.setFocalPoint(h),n.setPosition(f),n.setRoll(u),void n.computeMatrix();c<t&&(n.landmarkAnimationID=Xn(e))}))}},t.prototype._update=function(){this._getAxes(),this._getPosition(),this._getDistance(),this._getAngles(),this._getOrthoMatrix(),this.emit(La)},t.prototype.computeMatrix=function(){var e=yt(_t(),[0,0,1],this.roll*ka);Ct(this.matrix);var t=yt(_t(),[1,0,0],(this.rotateWorld&&this.type!==Sa.TRACKING||this.type===Sa.TRACKING?1:-1)*this.elevation*ka),n=yt(_t(),[0,1,0],(this.rotateWorld&&this.type!==Sa.TRACKING||this.type===Sa.TRACKING?1:-1)*this.azimuth*ka),r=mt(_t(),n,t);r=mt(_t(),r,e);var i=wt(bt(),r);this.type===Sa.ORBITING||this.type===Sa.EXPLORING?(Nt(this.matrix,this.matrix,this.focalPoint),Pt(this.matrix,this.matrix,i),Nt(this.matrix,this.matrix,[0,0,this.distance])):this.type===Sa.TRACKING&&(Nt(this.matrix,this.matrix,this.position),Pt(this.matrix,this.matrix,i))},t.prototype._setPosition=function(e,t,n){this.position=kr(e,t,n);var r=this.matrix;r[12]=this.position[0],r[13]=this.position[1],r[14]=this.position[2],r[15]=1,this._getOrthoMatrix()},t.prototype._getAxes=function(){Se(this.right,kr(gt(vt(),[1,0,0,0],this.matrix))),Se(this.up,kr(gt(vt(),[0,1,0,0],this.matrix))),Se(this.forward,kr(gt(vt(),[0,0,1,0],this.matrix))),Ve(this.right,this.right),Ve(this.up,this.up),Ve(this.forward,this.forward)},t.prototype._getAngles=function(){var e=this.distanceVector[0],t=this.distanceVector[1],n=this.distanceVector[2],r=Re(this.distanceVector);if(0===r)return this.elevation=0,void(this.azimuth=0);this.type===Sa.TRACKING||this.rotateWorld?(this.elevation=Math.asin(t/r)*Ua,this.azimuth=Math.atan2(-e,-n)*Ua):(this.elevation=-Math.asin(t/r)*Ua,this.azimuth=-Math.atan2(-e,-n)*Ua)},t.prototype._getPosition=function(){Se(this.position,kr(gt(vt(),[0,0,0,1],this.matrix))),this._getDistance()},t.prototype._getFocalPoint=function(){var e,t;Ze(this.distanceVector,[0,0,-this.distance],(e=me(),t=this.matrix,e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e)),xe(this.focalPoint,this.position,this.distanceVector),this._getDistance()},t.prototype._getDistance=function(){this.distanceVector=Ce(Ee(),this.focalPoint,this.position),this.distance=Re(this.distanceVector),this.dollyingStep=this.distance/100},t.prototype._getOrthoMatrix=function(){if(this.projectionMode===xa.ORTHOGRAPHIC){var e=this.position,t=yt(_t(),[0,0,1],-this.roll*Math.PI/180);Ft(this.orthoMatrix,t,Ae((this.rright-this.left)/2-e[0],(this.top-this.bottom)/2-e[1],0),Ae(this.zoom,this.zoom,1),e)}},t.ProjectionMode={ORTHOGRAPHIC:"ORTHOGRAPHIC",PERSPECTIVE:"PERSPECTIVE"},t}(z.EventEmitter),Wa=function(){function e(){}var t;return t=e,e.prototype.apply=function(e){var n=this;e.hooks.prepare.tap(t.tag,(function(e){if(e){var t=n.canvasConfig.renderer.getConfig().enableDirtyRectangleRendering;return e.renderable.dirty||n.renderingContext.renderReasons.has(un.CameraChanged)||!t?e:null}return e}))},e.tag="DirtyCheckPlugin",a([D(cn),s("design:type",Object)],e.prototype,"canvasConfig",void 0),a([D(xn),s("design:type",Object)],e.prototype,"renderingContext",void 0),t=a([I({contrib:Si})],e)}(),Va=p.defineToken("CullingStrategyContribution"),Xa=function(){function e(){}var t;return t=e,e.prototype.apply=function(e){var n=this,r=this.strategyProvider.getContributions();e.hooks.prepare.tap(t.tag,(function(e){if(e){var t=e.cullable;if(0===r.length?t.visible=!0:t.visible=r.every((function(t){return t.isVisible(e)})),e.isVisible())return e;if(n.canvasConfig.renderer.getConfig().enableDirtyRectangleRendering){var i=e.getRenderBounds();i&&(n.renderingContext.removedRenderBoundsList.push(i),n.renderingContext.renderReasons.add(un.DisplayObjectRemoved))}return null}return e})),e.hooks.afterRender.tap(t.tag,(function(e){e.cullable.visibilityPlaneMask=-1}))},e.tag="CullingPlugin",a([D(cn),s("design:type",Object)],e.prototype,"canvasConfig",void 0),a([j(Va),s("design:type",Object)],e.prototype,"strategyProvider",void 0),a([D(xn),s("design:type",Object)],e.prototype,"renderingContext",void 0),t=a([I({contrib:Si})],e)}(),Ha=function(){function e(){}var t;return t=e,e.prototype.apply=function(e){var n=this,r=function(){n.renderingContext.renderReasons.add(un.DisplayObjectChanged)},i=function(){e.dirtify()},o=function(t){en(t.target),e.dirtify()},a=function(t){en(t.target),e.dirtify()};e.hooks.init.tap(t.tag,(function(){n.renderingContext.root.addEventListener(Wt.MOUNTED,o),n.renderingContext.root.addEventListener(Wt.UNMOUNTED,a),n.renderingContext.root.addEventListener(Wt.ATTRIBUTE_CHANGED,r),n.renderingContext.root.addEventListener(Wt.BOUNDS_CHANGED,i)})),e.hooks.destroy.tap(t.tag,(function(){n.renderingContext.root.removeEventListener(Wt.MOUNTED,o),n.renderingContext.root.removeEventListener(Wt.UNMOUNTED,a),n.renderingContext.root.removeEventListener(Wt.ATTRIBUTE_CHANGED,r),n.renderingContext.root.removeEventListener(Wt.BOUNDS_CHANGED,i)}))},e.tag="PrepareRendererPlugin",a([D(xn),s("design:type",Object)],e.prototype,"renderingContext",void 0),t=a([I({contrib:Si})],e)}(),ja=function(){function e(){}return e.prototype.isVisible=function(e){return!0},e.prototype.computeVisibilityWithPlaneMask=function(e,t,n){if(t===Lt.OUTSIDE||t===Lt.INSIDE)return t;for(var r=Lt.INSIDE,i=0,o=n.length;i<o;++i){var a=i<31?1<<i:0;if(!(i<31&&0==(t&a))){var s=n[i],u=s.normal,c=s.distance;if(Xe(u,e.getPositiveFarPoint(n[i]))+c<0)return Lt.OUTSIDE;Xe(u,e.getNegativeFarPoint(n[i]))+c<0&&(r|=a)}}return r},a([I({contrib:Va})],e)}(),za=!!self.TouchEvent,Ya=!!self.PointerEvent,qa={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"};function Ka(e){var t=[];if(function(e){return za&&e instanceof TouchEvent}(e))for(var n=0;n<e.changedTouches.length;n++){var r=e.changedTouches[n];le(r.button)&&(r.button=e.touches.length?1:0),le(r.buttons)&&(r.buttons=e.touches.length?1:0),le(r.isPrimary)&&(r.isPrimary=1===e.touches.length&&"touchstart"===e.type),le(r.width)&&(r.width=r.radiusX||1),le(r.height)&&(r.height=r.radiusY||1),le(r.tiltX)&&(r.tiltX=0),le(r.tiltY)&&(r.tiltY=0),le(r.pointerType)&&(r.pointerType="touch"),le(r.pointerId)&&(r.pointerId=r.identifier||0),le(r.pressure)&&(r.pressure=r.force||.5),le(r.twist)&&(r.twist=0),le(r.tangentialPressure)&&(r.tangentialPressure=0),r.isNormalized=!0,r.type=e.type,t.push(r)}else if(function(e){return!self.MouseEvent||e instanceof MouseEvent&&(!Ya||!(e instanceof self.PointerEvent))}(e)){var i=e;le(i.isPrimary)&&(i.isPrimary=!0),le(i.width)&&(i.width=1),le(i.height)&&(i.height=1),le(i.tiltX)&&(i.tiltX=0),le(i.tiltY)&&(i.tiltY=0),le(i.pointerType)&&(i.pointerType="mouse"),le(i.pointerId)&&(i.pointerId=1),le(i.pressure)&&(i.pressure=.5),le(i.twist)&&(i.twist=0),le(i.tangentialPressure)&&(i.tangentialPressure=0),i.isNormalized=!0,t.push(i)}else t.push(e);return t}var Za,$a=function(){function e(){var e=this;this.autoPreventDefault=!0,this.rootPointerEvent=new hi(null),this.rootWheelEvent=new fi(null),this.onPointerMove=function(t){var n,r;if(!za||"touch"!==t.pointerType){var i=Ka(t);try{for(var o=l(i),a=o.next();!a.done;a=o.next()){var s=a.value,u=e.bootstrapEvent(e.rootPointerEvent,s);e.eventService.mapEvent(u)}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}e.setCursor(e.eventService.cursor)}}}var t;return t=e,e.prototype.apply=function(e){var n=this;this.eventService.setPickHandler((function(e){return u(n,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,this.renderingService.hooks.pick.promise({position:e,picked:null})];case 1:return[2,t.sent().picked]}}))}))})),e.hooks.pointerWheel.tap(t.tag,(function(e){var t=n.normalizeWheelEvent(e);n.eventService.mapEvent(t)})),e.hooks.pointerDown.tap(t.tag,(function(e){var t,r;if(!za||"touch"!==e.pointerType){var i=Ka(e);n.autoPreventDefault&&i[0].isNormalized&&(e.cancelable||!("cancelable"in e))&&e.preventDefault();try{for(var o=l(i),a=o.next();!a.done;a=o.next()){var s=a.value,u=n.bootstrapEvent(n.rootPointerEvent,s);n.eventService.mapEvent(u)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}n.setCursor(n.eventService.cursor)}})),e.hooks.pointerUp.tap(t.tag,(function(e){var t,r;if(!za||"touch"!==e.pointerType){var i=n.contextService.getDomElement(),o=i&&e.target&&e.target!==i&&i.contains&&!i.contains(e.target)?"outside":"",a=Ka(e);try{for(var s=l(a),u=s.next();!u.done;u=s.next()){var c=u.value,h=n.bootstrapEvent(n.rootPointerEvent,c);h.type+=o,n.eventService.mapEvent(h)}}catch(e){t={error:e}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}n.setCursor(n.eventService.cursor)}})),e.hooks.pointerMove.tap(t.tag,this.onPointerMove),e.hooks.pointerOver.tap(t.tag,this.onPointerMove),e.hooks.pointerOut.tap(t.tag,this.onPointerMove)},e.prototype.bootstrapEvent=function(e,t){e._originalEvent=null,e.nativeEvent=t,e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist,this.transferMouseData(e,t);var n=this.eventService.client2Viewport(new qt(t.clientX,t.clientY)),r=n.x,i=n.y;e.viewport.x=r,e.viewport.y=i;var o=this.eventService.viewport2Canvas(e.viewport),a=o.x,s=o.y;return e.canvas.x=a,e.canvas.y=s,e.global.copyFrom(e.canvas),e.offset.copyFrom(e.canvas),e.isTrusted=t.isTrusted,"pointerleave"===e.type&&(e.type="pointerout"),e.type.startsWith("mouse")&&(e.type=e.type.replace("mouse","pointer")),e.type.startsWith("touch")&&(e.type=qa[e.type]||e.type),e},e.prototype.normalizeWheelEvent=function(e){var t=this.rootWheelEvent;this.transferMouseData(t,e),t.deltaMode=e.deltaMode,t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ;var n=this.eventService.client2Viewport(new qt(e.clientX,e.clientY)),r=n.x,i=n.y;t.viewport.x=r,t.viewport.y=i;var o=this.eventService.viewport2Canvas(t.viewport),a=o.x,s=o.y;return t.canvas.x=a,t.canvas.y=s,t.global.copyFrom(t.canvas),t.offset.copyFrom(t.canvas),t.nativeEvent=e,t.type=e.type,t},e.prototype.transferMouseData=function(e,t){e.isTrusted=t.isTrusted,e.timeStamp=performance.now(),e.type=t.type,e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.x=t.clientX,e.client.y=t.clientY,e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.x=t.movementX,e.movement.y=t.movementY,e.page.x=t.pageX,e.page.y=t.pageY,e.screen.x=t.screenX,e.screen.y=t.screenY,e.relatedTarget=null},e.prototype.setCursor=function(e){this.contextService.applyCursorStyle(e||this.canvasConfig.cursor||"default")},e.tag="EventPlugin",a([D(cn),s("design:type",Object)],e.prototype,"canvasConfig",void 0),a([D(Sn),s("design:type",Object)],e.prototype,"contextService",void 0),a([D(bi),s("design:type",bi)],e.prototype,"renderingService",void 0),a([D(xi),s("design:type",xi)],e.prototype,"eventService",void 0),t=a([I({contrib:Si})],e)}(),Qa=X((function(e,t){t.container.isBound(bi)?(t.container.remove(Si),t.container.remove(bi),t.container.remove(ja)):(H.register(e,Si,{cache:!1}),H.register(e,Va,{cache:!1})),e(bi),e(xi),e($a),e(Ha),e(Wa),e(Xa),e(ja)}));!function(e){e.READY="ready",e.BEFORE_RENDER="beforerender",e.AFTER_RENDER="afterrender",e.BEFORE_DESTROY="beforedestroy",e.AFTER_DESTROY="afterdestroy",e.RESIZE="resize"}(Za||(Za={}));var Ja=function(e){function t(t){var n=e.call(this)||this;n.container=Ca.createChild(),n.Element=si,n.document=new ci,n.document.defaultView=n,n.customElements=new Ai,function(e,t){var n="string"==typeof e?e:e.id||Da++;Ia[n]&&Ia[n].destroy(),Ia[n]=t}(t.container,n);var r=i({width:300,height:150,cursor:"default",background:"white"},t);return n.initRenderingContext(r),n.initDefaultCamera(r.width,r.height),n.initRenderer(r.renderer),n}return r(t,e),t.prototype.initRenderingContext=function(e){var t=this;this.container.register({token:cn,useValue:e}),this.container.register({token:xn,useValue:{root:this.document.documentElement,removedRenderBoundsList:[],renderReasons:new Set,force:!1,dirty:!1}}),this.document.documentElement.addEventListener(Wt.CHILD_INSERTED,(function(e){t.mountChildren(e.detail.child)})),this.document.documentElement.addEventListener(Wt.CHILD_REMOVED,(function(e){t.unmountChildren(e.detail.child)}))},t.prototype.initDefaultCamera=function(e,t){var n=(new Ga).setPosition(e/2,t/2,500).setFocalPoint(e/2,t/2,0).setOrthographic(e/-2,e/2,t/2,t/-2,.1,1e3),r=this.container.get(xn);n.on(La,(function(){r.renderReasons.add(un.CameraChanged)})),this.container.register({token:wa,useValue:n})},t.prototype.getConfig=function(){return this.container.get(cn)},t.prototype.getContainer=function(){return this.container},t.prototype.getRoot=function(){return this.document.documentElement},t.prototype.getCamera=function(){return this.container.get(wa)},t.prototype.getContextService=function(){return this.container.get(Sn)},t.prototype.getEventService=function(){return this.eventService},t.prototype.getRenderingService=function(){return this.renderingService},t.prototype.getRenderingContext=function(){return this.container.get(xn)},t.prototype.getStats=function(){return this.getRenderingService().getStats()},t.prototype.getComputedStyle=function(e){return e.parsedStyle},t.prototype.destroy=function(e){void 0===e&&(e=!0),this.emit(Za.BEFORE_DESTROY,(function(){})),this.frameId&&Hn(this.frameId);var t=this.getRoot();this.unmountChildren(t),e&&this.document.destroy(),this.getContextService().destroy(),this.getRenderingService().destroy(),this.emit(Za.AFTER_DESTROY,{})},t.prototype.changeSize=function(e,t){this.resize(e,t)},t.prototype.resize=function(e,t){var n=this.container.get(cn);n.width=e,n.height=t,this.getContextService().resize(e,t);var r=this.container.get(wa),i=r.getProjectionMode();r.setPosition(e/2,t/2,500).setFocalPoint(e/2,t/2,0),i===xa.ORTHOGRAPHIC?r.setOrthographic(e/-2,e/2,t/2,t/-2,r.getNear(),r.getFar()):r.setAspect(e/t),this.emit(Za.RESIZE,{width:e,height:t})},t.prototype.appendChild=function(e,t){return this.document.documentElement.appendChild(e,t)},t.prototype.insertBefore=function(e,t){return this.document.documentElement.insertBefore(e,t)},t.prototype.removeChild=function(e,t){return void 0===t&&(t=!0),this.document.documentElement.removeChild(e,t)},t.prototype.removeChildren=function(e){void 0===e&&(e=!0),this.document.documentElement.removeChildren(e)},t.prototype.render=function(){this.emit(Za.BEFORE_RENDER,{}),this.container.isBound(bi)&&this.container.get(bi).render(),this.emit(Za.AFTER_RENDER,{})},t.prototype.run=function(){var e=this;!function t(){e.render(),e.frameId=requestAnimationFrame(t)}()},t.prototype.initRenderer=function(e){var t=this;if(!e)throw new Error("Renderer is required.");this.loadCommonContainerModule(),this.loadRendererContainerModule(e);var n=this.container.get(Sn);this.renderingService=this.container.get(bi),this.eventService=this.container.get(xi),n.init(),this.renderingService.init().then((function(){t.emit(Za.READY,{})})),e.getConfig().enableAutoRendering&&this.run(),this.getRoot().forEach((function(e){var t=e.renderable;t&&(t.renderBoundsDirty=!0,t.boundsDirty=!0,t.dirty=!0)})),this.mountChildren(this.getRoot())},t.prototype.loadCommonContainerModule=function(){this.container.load(Qa,!0)},t.prototype.loadRendererContainerModule=function(e){var t=this;e.getPlugins().forEach((function(e){e.init(t.container)}))},t.prototype.setRenderer=function(e){var t=this,n=this.getConfig();if(n.renderer!==e){var r=n.renderer;n.renderer=e,this.destroy(!1),null==r||r.getPlugins().reverse().forEach((function(e){e.destroy(t.container)})),this.initRenderer(e)}},t.prototype.unmountChildren=function(e){var t=[];e.forEach((function(e){e.isConnected&&t.push(e)})),t.reverse().forEach((function(e){e.emit(Wt.UNMOUNTED,{}),e.ownerDocument=null,e.isConnected=!1}))},t.prototype.mountChildren=function(e){var t=this;e.forEach((function(e){e.isConnected||(e.ownerDocument=t.document,e.isConnected=!0,e.emit(Wt.MOUNTED,{}))}))},t.prototype.client2Viewport=function(e){return this.getEventService().client2Viewport(e)},t.prototype.viewport2Client=function(e){return this.getEventService().viewport2Client(e)},t.prototype.viewport2Canvas=function(e){return this.getEventService().viewport2Canvas(e)},t.prototype.canvas2Viewport=function(e){return this.getEventService().canvas2Viewport(e)},t.prototype.getPointByClient=function(e,t){return this.client2Viewport({x:e,y:t})},t.prototype.getClientByPoint=function(e,t){return this.viewport2Client({x:e,y:t})},t}(Nn);Ca.load(Oa);var es="ontouchstart"in self,ts=!!self.PointerEvent,ns=function(){function e(){}var t;return t=e,e.prototype.apply=function(e){var n=this,r=function(t){e.hooks.pointerMove.call(t)},i=function(t){e.hooks.pointerUp.call(t)},o=function(t){e.hooks.pointerDown.call(t)},a=function(t){e.hooks.pointerOver.call(t)},s=function(t){e.hooks.pointerOut.call(t)},u=function(t){e.hooks.pointerWheel.call(t)};e.hooks.init.tap(t.tag,(function(){var e=n.contextService.getDomElement();ts?(self.document.addEventListener("pointermove",r,!0),e.addEventListener("pointerdown",o,!0),e.addEventListener("pointerleave",s,!0),e.addEventListener("pointerover",a,!0),self.addEventListener("pointerup",i,!0)):(self.document.addEventListener("mousemove",r,!0),e.addEventListener("mousedown",o,!0),e.addEventListener("mouseout",s,!0),e.addEventListener("mouseover",a,!0),self.addEventListener("mouseup",i,!0)),es&&(e.addEventListener("touchstart",o,!0),e.addEventListener("touchend",i,!0),e.addEventListener("touchmove",r,!0)),e.addEventListener("wheel",u,{passive:!0,capture:!0})})),e.hooks.destroy.tap(t.tag,(function(){var e=n.contextService.getDomElement();ts?(self.document.removeEventListener("pointermove",r,!0),e.removeEventListener("pointerdown",o,!0),e.removeEventListener("pointerleave",s,!0),e.removeEventListener("pointerover",a,!0),self.removeEventListener("pointerup",i,!0)):(self.document.removeEventListener("mousemove",r,!0),e.removeEventListener("mousedown",o,!0),e.removeEventListener("mouseout",s,!0),e.removeEventListener("mouseover",a,!0),self.removeEventListener("mouseup",i,!0)),es&&(e.removeEventListener("touchstart",o,!0),e.removeEventListener("touchend",i,!0),e.removeEventListener("touchmove",r,!0)),e.removeEventListener("wheel",u,!0)}))},e.tag="DOMInteractionPlugin",a([D(Sn),s("design:type",Object)],e.prototype,"contextService",void 0),t=a([I({contrib:Si})],e)}(),rs=X((function(e){e(ns)})),is=function(){function e(){}return e.prototype.init=function(e){e.load(rs,!0)},e.prototype.destroy=function(e){e.remove(ns)},e}(),os=(n(5666),n(9296)),as=n.n(os),ss=n(9187),us=n.n(ss);function cs(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ls(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?cs(Object(n),!0).forEach((function(t){gs(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cs(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function hs(e,t,n,r,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function fs(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){hs(o,r,i,a,s,"next",e)}function s(e){hs(o,r,i,a,s,"throw",e)}a(void 0)}))}}function ds(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ps(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function vs(e,t,n){return t&&ps(e.prototype,t),n&&ps(e,n),e}function gs(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ms(e,t)}function ys(e){return ys=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ys(e)}function ms(e,t){return ms=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ms(e,t)}function Es(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function Ts(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Rs(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Ts(e)}function As(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ys(e);if(t){var i=ys(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Rs(this,n)}}function Ss(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ys(e)););return e}function bs(){return bs="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=Ss(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},bs.apply(this,arguments)}function xs(e,t){return Ms(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(e){s=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}}(e,t)||Ns(e,t)||Bs()}function Cs(e){return function(e){if(Array.isArray(e))return Os(e)}(e)||Ps(e)||Ns(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ms(e){if(Array.isArray(e))return e}function Ps(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function Ns(e,t){if(e){if("string"==typeof e)return Os(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Os(e,t):void 0}}function Os(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Bs(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Is(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=Ns(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}var Ds=function e(){ds(this,e),this.pickingId=void 0,this.encodedPickingColor=void 0,this.batchId=void 0};Ds.tag="c-renderable-3d";var Fs=function(){function e(){ds(this,e),this.counter=0,this.id2DisplayObjectMap={}}return vs(e,[{key:"getId",value:function(e){var t=this.counter++;return this.id2DisplayObjectMap[t]=e,t}},{key:"getById",value:function(e){return this.id2DisplayObjectMap[e]}},{key:"reset",value:function(){this.counter=0,this.id2DisplayObjectMap={}}},{key:"decodePickingColor",value:function(e){var t=xs(e,3);return t[0]+256*t[1]+65536*t[2]-1}},{key:"encodePickingColor",value:function(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}}]),e}();Fs=a([I()],Fs);var ws,Ls,ks,Us,Gs,Ws,Vs,Xs,Hs="WebGLRendererPluginOptions";function js(e,t,n){return e<<16|t<<8|n}function zs(e){return e>>>8&255}function Ys(e){return e>>>16&255}function qs(e){return 255&e}function Ks(e){switch(e){case 8:case 3:case 6:return 4;case 2:case 5:case 7:return 2;case 1:case 4:return 1;default:throw"whoops"}}function Zs(e){return Ks(Ys(e))}function $s(e){return Ks(Ys(e))*zs(e)}function Qs(e){var t=qs(e);if(4&t)return 3;if(1&t)return 0;var n=Ys(e);if(7===n||8===n)return 0;if(1===n||2===n||3===n)return 1;if(4===n||5===n||6===n)return 2;throw"whoops"}function Js(e,t,n,r){return{dimension:0,pixelFormat:e,width:t,height:n,depth:1,numLevels:r,usage:1}}function eu(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!e)throw console.error((new Error).stack),new Error("Assert fail: ".concat(t))}function tu(e){if(null!=e)return e;throw new Error("Missing object")}function nu(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a}function ru(e,t){e.r=t.r,e.g=t.g,e.b=t.b,e.a=t.a}function iu(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}function ou(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return{r:e,g:t,b:n,a:r}}!function(e){e[e.ALPHA=js(1,5,0)]="ALPHA",e[e.F16_RG=js(7,2,0)]="F16_RG",e[e.F16_RGB=js(7,3,0)]="F16_RGB",e[e.F16_RGBA=js(7,4,0)]="F16_RGBA",e[e.F32_R=js(8,1,0)]="F32_R",e[e.F32_RG=js(8,2,0)]="F32_RG",e[e.F32_RGB=js(8,3,0)]="F32_RGB",e[e.F32_RGBA=js(8,4,0)]="F32_RGBA",e[e.U8_R=js(1,1,0)]="U8_R",e[e.U8_R_NORM=js(1,1,1)]="U8_R_NORM",e[e.U8_RG=js(1,2,0)]="U8_RG",e[e.U8_RG_NORM=js(1,2,1)]="U8_RG_NORM",e[e.U8_RGB=js(1,3,0)]="U8_RGB",e[e.U8_RGB_NORM=js(1,3,1)]="U8_RGB_NORM",e[e.U8_RGB_SRGB=js(1,3,3)]="U8_RGB_SRGB",e[e.U8_RGBA=js(1,4,0)]="U8_RGBA",e[e.U8_RGBA_NORM=js(1,4,1)]="U8_RGBA_NORM",e[e.U8_RGBA_SRGB=js(1,4,3)]="U8_RGBA_SRGB",e[e.U16_R=js(2,1,0)]="U16_R",e[e.U16_R_NORM=js(2,1,1)]="U16_R_NORM",e[e.U16_RG_NORM=js(2,2,1)]="U16_RG_NORM",e[e.U16_RGBA_NORM=js(2,4,1)]="U16_RGBA_NORM",e[e.U16_RGB=js(2,3,0)]="U16_RGB",e[e.U32_R=js(3,1,0)]="U32_R",e[e.U32_RG=js(3,2,0)]="U32_RG",e[e.S8_R=js(4,1,0)]="S8_R",e[e.S8_R_NORM=js(4,1,1)]="S8_R_NORM",e[e.S8_RG_NORM=js(4,2,1)]="S8_RG_NORM",e[e.S8_RGB_NORM=js(4,3,1)]="S8_RGB_NORM",e[e.S8_RGBA_NORM=js(4,4,1)]="S8_RGBA_NORM",e[e.S16_R=js(5,1,0)]="S16_R",e[e.S16_RG=js(5,2,0)]="S16_RG",e[e.S16_RG_NORM=js(5,2,1)]="S16_RG_NORM",e[e.S16_RGB_NORM=js(5,3,1)]="S16_RGB_NORM",e[e.S16_RGBA=js(5,4,0)]="S16_RGBA",e[e.S16_RGBA_NORM=js(5,4,1)]="S16_RGBA_NORM",e[e.S32_R=js(6,1,0)]="S32_R",e[e.U16_RGBA_5551=js(97,4,1)]="U16_RGBA_5551",e[e.BC1=js(65,4,0)]="BC1",e[e.BC1_SRGB=js(65,4,2)]="BC1_SRGB",e[e.BC2=js(66,4,0)]="BC2",e[e.BC2_SRGB=js(66,4,2)]="BC2_SRGB",e[e.BC3=js(67,4,0)]="BC3",e[e.BC3_SRGB=js(67,4,2)]="BC3_SRGB",e[e.BC4_UNORM=js(68,1,0)]="BC4_UNORM",e[e.BC4_SNORM=js(69,1,0)]="BC4_SNORM",e[e.BC5_UNORM=js(70,2,0)]="BC5_UNORM",e[e.BC5_SNORM=js(71,2,0)]="BC5_SNORM",e[e.D24=js(129,1,4)]="D24",e[e.D24_S8=js(131,2,12)]="D24_S8",e[e.D32F=js(130,1,4)]="D32F",e[e.D32F_S8=js(132,2,12)]="D32F_S8",e[e.U8_RGB_RT=js(1,3,16)]="U8_RGB_RT",e[e.U8_RGBA_RT=js(1,4,16)]="U8_RGBA_RT",e[e.U8_RGBA_RT_SRGB=js(1,4,18)]="U8_RGBA_RT_SRGB"}(ws||(ws={})),function(e){e[e.Buffer=0]="Buffer",e[e.Texture=1]="Texture",e[e.RenderTarget=2]="RenderTarget",e[e.Sampler=3]="Sampler",e[e.Program=4]="Program",e[e.Bindings=5]="Bindings",e[e.InputLayout=6]="InputLayout",e[e.InputState=7]="InputState",e[e.RenderPipeline=8]="RenderPipeline",e[e.ComputePipeline=9]="ComputePipeline",e[e.Readback=10]="Readback",e[e.QueryPool=11]="QueryPool"}(Ls||(Ls={})),function(e){e[e.Never=512]="Never",e[e.Less=513]="Less",e[e.Equal=514]="Equal",e[e.LessEqual=515]="LessEqual",e[e.Greater=516]="Greater",e[e.NotEqual=517]="NotEqual",e[e.GreaterEqual=518]="GreaterEqual",e[e.Always=519]="Always"}(ks||(ks={})),function(e){e[e.CCW=2305]="CCW",e[e.CW=2304]="CW"}(Us||(Us={})),function(e){e[e.Zero=0]="Zero",e[e.One=1]="One",e[e.Src=768]="Src",e[e.OneMinusSrc=769]="OneMinusSrc",e[e.Dst=774]="Dst",e[e.OneMinusDst=775]="OneMinusDst",e[e.SrcAlpha=770]="SrcAlpha",e[e.OneMinusSrcAlpha=771]="OneMinusSrcAlpha",e[e.DstAlpha=772]="DstAlpha",e[e.OneMinusDstAlpha=773]="OneMinusDstAlpha"}(Gs||(Gs={})),function(e){e[e.Add=32774]="Add",e[e.Subtract=32778]="Subtract",e[e.ReverseSubtract=32779]="ReverseSubtract"}(Ws||(Ws={})),function(e){e[e.Keep=7680]="Keep",e[e.Zero=0]="Zero",e[e.Replace=7681]="Replace",e[e.Invert=5386]="Invert",e[e.IncrementClamp=7682]="IncrementClamp",e[e.DecrementClamp=7683]="DecrementClamp",e[e.IncrementWrap=34055]="IncrementWrap",e[e.DecrementWrap=34056]="DecrementWrap"}(Vs||(Vs={})),function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",e[e.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.CULL_FACE=2884]="CULL_FACE",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.BLEND=3042]="BLEND",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.DITHER=3024]="DITHER",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DOUBLE=5130]="DOUBLE",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.ALWAYS=519]="ALWAYS",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.GEQUAL=518]="GEQUAL",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",e[e.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.READ_BUFFER=3074]="READ_BUFFER",e[e.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",e[e.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",e[e.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",e[e.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",e[e.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",e[e.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",e[e.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",e[e.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",e[e.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",e[e.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",e[e.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",e[e.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",e[e.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",e[e.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",e[e.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",e[e.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",e[e.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",e[e.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",e[e.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",e[e.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",e[e.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",e[e.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",e[e.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",e[e.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",e[e.RED=6403]="RED",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB10_A2=32857]="RGB10_A2",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",e[e.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",e[e.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",e[e.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",e[e.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",e[e.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",e[e.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",e[e.SRGB=35904]="SRGB",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",e[e.RGBA32F=34836]="RGBA32F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.RGB16F=34843]="RGB16F",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R16F=33325]="R16F",e[e.R32F=33326]="R32F",e[e.RG16F=33327]="RG16F",e[e.RG32F=33328]="RG32F",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2UI=36975]="RGB10_A2UI",e[e.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",e[e.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.RG=33319]="RG",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",e[e.CURRENT_QUERY=34917]="CURRENT_QUERY",e[e.QUERY_RESULT=34918]="QUERY_RESULT",e[e.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",e[e.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",e[e.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",e[e.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",e[e.DRAW_BUFFER0=34853]="DRAW_BUFFER0",e[e.DRAW_BUFFER1=34854]="DRAW_BUFFER1",e[e.DRAW_BUFFER2=34855]="DRAW_BUFFER2",e[e.DRAW_BUFFER3=34856]="DRAW_BUFFER3",e[e.DRAW_BUFFER4=34857]="DRAW_BUFFER4",e[e.DRAW_BUFFER5=34858]="DRAW_BUFFER5",e[e.DRAW_BUFFER6=34859]="DRAW_BUFFER6",e[e.DRAW_BUFFER7=34860]="DRAW_BUFFER7",e[e.DRAW_BUFFER8=34861]="DRAW_BUFFER8",e[e.DRAW_BUFFER9=34862]="DRAW_BUFFER9",e[e.DRAW_BUFFER10=34863]="DRAW_BUFFER10",e[e.DRAW_BUFFER11=34864]="DRAW_BUFFER11",e[e.DRAW_BUFFER12=34865]="DRAW_BUFFER12",e[e.DRAW_BUFFER13=34866]="DRAW_BUFFER13",e[e.DRAW_BUFFER14=34867]="DRAW_BUFFER14",e[e.DRAW_BUFFER15=34868]="DRAW_BUFFER15",e[e.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",e[e.MAX_SAMPLES=36183]="MAX_SAMPLES",e[e.SAMPLER_BINDING=35097]="SAMPLER_BINDING",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",e[e.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",e[e.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",e[e.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",e[e.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",e[e.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",e[e.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",e[e.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",e[e.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",e[e.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",e[e.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",e[e.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",e[e.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",e[e.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",e[e.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",e[e.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",e[e.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",e[e.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",e[e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",e[e.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",e[e.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",e[e.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",e[e.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",e[e.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",e[e.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",e[e.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",e[e.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",e[e.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",e[e.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",e[e.UNIFORM_TYPE=35383]="UNIFORM_TYPE",e[e.UNIFORM_SIZE=35384]="UNIFORM_SIZE",e[e.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",e[e.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",e[e.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",e[e.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",e[e.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",e[e.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",e[e.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",e[e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",e[e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS",e[e.SYNC_FENCE=37142]="SYNC_FENCE",e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED",e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED",e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",e[e.COLOR=6144]="COLOR",e[e.DEPTH=6145]="DEPTH",e[e.STENCIL=6146]="STENCIL",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STREAM_COPY=35042]="STREAM_COPY",e[e.STATIC_READ=35045]="STATIC_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.INVALID_INDEX=4294967295]="INVALID_INDEX",e[e.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",e[e.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE",e[e.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",e[e.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",e[e.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",e[e.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.UNSIGNED_INT_24_8_WEBGL=34042]="UNSIGNED_INT_24_8_WEBGL",e[e.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",e[e.RGBA32F_EXT=34836]="RGBA32F_EXT",e[e.RGB32F_EXT=34837]="RGB32F_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT",e[e.UNSIGNED_NORMALIZED_EXT=35863]="UNSIGNED_NORMALIZED_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.SRGB_EXT=35904]="SRGB_EXT",e[e.SRGB_ALPHA_EXT=35906]="SRGB_ALPHA_EXT",e[e.SRGB8_ALPHA8_EXT=35907]="SRGB8_ALPHA8_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT_OES=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT_OES",e[e.COLOR_ATTACHMENT0_WEBGL=36064]="COLOR_ATTACHMENT0_WEBGL",e[e.COLOR_ATTACHMENT1_WEBGL=36065]="COLOR_ATTACHMENT1_WEBGL",e[e.COLOR_ATTACHMENT2_WEBGL=36066]="COLOR_ATTACHMENT2_WEBGL",e[e.COLOR_ATTACHMENT3_WEBGL=36067]="COLOR_ATTACHMENT3_WEBGL",e[e.COLOR_ATTACHMENT4_WEBGL=36068]="COLOR_ATTACHMENT4_WEBGL",e[e.COLOR_ATTACHMENT5_WEBGL=36069]="COLOR_ATTACHMENT5_WEBGL",e[e.COLOR_ATTACHMENT6_WEBGL=36070]="COLOR_ATTACHMENT6_WEBGL",e[e.COLOR_ATTACHMENT7_WEBGL=36071]="COLOR_ATTACHMENT7_WEBGL",e[e.COLOR_ATTACHMENT8_WEBGL=36072]="COLOR_ATTACHMENT8_WEBGL",e[e.COLOR_ATTACHMENT9_WEBGL=36073]="COLOR_ATTACHMENT9_WEBGL",e[e.COLOR_ATTACHMENT10_WEBGL=36074]="COLOR_ATTACHMENT10_WEBGL",e[e.COLOR_ATTACHMENT11_WEBGL=36075]="COLOR_ATTACHMENT11_WEBGL",e[e.COLOR_ATTACHMENT12_WEBGL=36076]="COLOR_ATTACHMENT12_WEBGL",e[e.COLOR_ATTACHMENT13_WEBGL=36077]="COLOR_ATTACHMENT13_WEBGL",e[e.COLOR_ATTACHMENT14_WEBGL=36078]="COLOR_ATTACHMENT14_WEBGL",e[e.COLOR_ATTACHMENT15_WEBGL=36079]="COLOR_ATTACHMENT15_WEBGL",e[e.DRAW_BUFFER0_WEBGL=34853]="DRAW_BUFFER0_WEBGL",e[e.DRAW_BUFFER1_WEBGL=34854]="DRAW_BUFFER1_WEBGL",e[e.DRAW_BUFFER2_WEBGL=34855]="DRAW_BUFFER2_WEBGL",e[e.DRAW_BUFFER3_WEBGL=34856]="DRAW_BUFFER3_WEBGL",e[e.DRAW_BUFFER4_WEBGL=34857]="DRAW_BUFFER4_WEBGL",e[e.DRAW_BUFFER5_WEBGL=34858]="DRAW_BUFFER5_WEBGL",e[e.DRAW_BUFFER6_WEBGL=34859]="DRAW_BUFFER6_WEBGL",e[e.DRAW_BUFFER7_WEBGL=34860]="DRAW_BUFFER7_WEBGL",e[e.DRAW_BUFFER8_WEBGL=34861]="DRAW_BUFFER8_WEBGL",e[e.DRAW_BUFFER9_WEBGL=34862]="DRAW_BUFFER9_WEBGL",e[e.DRAW_BUFFER10_WEBGL=34863]="DRAW_BUFFER10_WEBGL",e[e.DRAW_BUFFER11_WEBGL=34864]="DRAW_BUFFER11_WEBGL",e[e.DRAW_BUFFER12_WEBGL=34865]="DRAW_BUFFER12_WEBGL",e[e.DRAW_BUFFER13_WEBGL=34866]="DRAW_BUFFER13_WEBGL",e[e.DRAW_BUFFER14_WEBGL=34867]="DRAW_BUFFER14_WEBGL",e[e.DRAW_BUFFER15_WEBGL=34868]="DRAW_BUFFER15_WEBGL",e[e.MAX_COLOR_ATTACHMENTS_WEBGL=36063]="MAX_COLOR_ATTACHMENTS_WEBGL",e[e.MAX_DRAW_BUFFERS_WEBGL=34852]="MAX_DRAW_BUFFERS_WEBGL",e[e.VERTEX_ARRAY_BINDING_OES=34229]="VERTEX_ARRAY_BINDING_OES",e[e.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",e[e.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",e[e.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",e[e.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",e[e.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",e[e.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",e[e.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT"}(Xs||(Xs={}));var au=ou(0,0,0,0),su=ou(1,1,1,1);function uu(e){return e&&0==(e&e-1)}function cu(e,t){return null!=e?e:t}function lu(e){return void 0===e?null:e}function hu(e,t,n){e.length=t,e.fill(n)}function fu(e,t){return((e+t-1)/t|0)*t}function du(e,t,n){return n?e|=t:e&=~t,e}function pu(e,t){for(var n=new Array(e),r=0;r<e;r++)n[r]=t();return n}function vu(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"0";e.length<t;)e="".concat(n).concat(e);return e}function gu(e,t){e.blendDstFactor=t.blendDstFactor,e.blendSrcFactor=t.blendSrcFactor,e.blendMode=t.blendMode}function _u(e,t){return void 0===e&&(e={rgbBlendState:{},alphaBlendState:{},channelWriteMask:0}),gu(e.rgbBlendState,t.rgbBlendState),gu(e.alphaBlendState,t.alphaBlendState),e.channelWriteMask=t.channelWriteMask,e}function yu(e,t){e.length!==t.length&&(e.length=t.length);for(var n=0;n<t.length;n++)e[n]=_u(e[n],t[n])}function mu(e,t){void 0!==t.attachmentsState&&yu(e.attachmentsState,t.attachmentsState),void 0!==t.blendConstant&&ru(e.blendConstant,t.blendConstant),e.depthCompare=cu(t.depthCompare,e.depthCompare),e.depthWrite=cu(t.depthWrite,e.depthWrite),e.stencilCompare=cu(t.stencilCompare,e.stencilCompare),e.stencilWrite=cu(t.stencilWrite,e.stencilWrite),e.stencilPassOp=cu(t.stencilPassOp,e.stencilPassOp),e.cullMode=cu(t.cullMode,e.cullMode),e.frontFace=cu(t.frontFace,e.frontFace),e.polygonOffset=cu(t.polygonOffset,e.polygonOffset)}function Eu(e){var t=Object.assign({},e);return t.attachmentsState=[],yu(t.attachmentsState,e.attachmentsState),t.blendConstant=iu(t.blendConstant),t}var Tu={blendMode:Ws.Add,blendSrcFactor:Gs.One,blendDstFactor:Gs.Zero},Ru={attachmentsState:[{channelWriteMask:7,rgbBlendState:Tu,alphaBlendState:Tu}],blendConstant:iu(au),depthWrite:!0,depthCompare:ks.LessEqual,stencilCompare:ks.Never,stencilWrite:!1,stencilPassOp:Vs.Keep,cullMode:0,frontFace:Us.CCW,polygonOffset:!1};function Au(e,t,n){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(!n(e[r],t[r]))return!1;return!0}function Su(e,t){for(var n=Array(e.length),r=0;r<e.length;r++)n[r]=t(e[r]);return n}function bu(e,t){return e.buffer===t.buffer&&e.wordCount===t.wordCount}function xu(e,t){return null===e?null===t:null!==t&&e.sampler===t.sampler&&e.texture===t.texture}function Cu(e,t){return e.numSamplers===t.numSamplers&&e.numUniformBuffers===t.numUniformBuffers}function Mu(e,t){return e.samplerBindings.length===t.samplerBindings.length&&!!Au(e.samplerBindings,t.samplerBindings,xu)&&!!Au(e.uniformBufferBindings,t.uniformBufferBindings,bu)&&!!Ou(e.bindingLayout,t.bindingLayout)}function Pu(e,t){return e.blendMode==t.blendMode&&e.blendSrcFactor===t.blendSrcFactor&&e.blendDstFactor===t.blendDstFactor}function Nu(e,t){return!!Pu(e.rgbBlendState,t.rgbBlendState)&&!!Pu(e.alphaBlendState,t.alphaBlendState)&&e.channelWriteMask===t.channelWriteMask}function Ou(e,t){return e.numSamplers===t.numSamplers&&e.numUniformBuffers===t.numUniformBuffers}function Bu(e,t){return e===t}function Iu(e,t){return!!(e.topology===t.topology&&e.inputLayout===t.inputLayout&&e.sampleCount===t.sampleCount&&function(e,t){return!!Au(e.attachmentsState,t.attachmentsState,Nu)&&!!nu(e.blendConstant,t.blendConstant)&&e.depthCompare===t.depthCompare&&e.depthWrite===t.depthWrite&&e.stencilCompare===t.stencilCompare&&e.stencilWrite===t.stencilWrite&&e.stencilPassOp===t.stencilPassOp&&e.cullMode===t.cullMode&&e.frontFace===t.frontFace&&e.polygonOffset===t.polygonOffset}(e.megaStateDescriptor,t.megaStateDescriptor)&&function(e,t){return e.id===t.id}(e.program,t.program)&&Au(e.bindingLayouts,t.bindingLayouts,Ou)&&Au(e.colorAttachmentFormats,t.colorAttachmentFormats,Bu)&&e.depthStencilAttachmentFormat===t.depthStencilAttachmentFormat)}function Du(e,t){return e.bufferIndex===t.bufferIndex&&e.bufferByteOffset===t.bufferByteOffset&&e.location===t.location&&e.format===t.format}function Fu(e,t){return null===e?null===t:null!==t&&e.byteStride===t.byteStride&&e.frequency===t.frequency}function wu(e,t){return e.indexBufferFormat===t.indexBufferFormat&&!!Au(e.vertexBufferDescriptors,t.vertexBufferDescriptors,Fu)&&!!Au(e.vertexAttributeDescriptors,t.vertexAttributeDescriptors,Du)}function Lu(e,t){return e.wrapS===t.wrapS&&e.wrapT===t.wrapT&&e.minFilter===t.minFilter&&e.magFilter===t.magFilter&&e.mipFilter===t.mipFilter&&e.minLOD===t.minLOD&&e.maxLOD===t.maxLOD}function ku(e){return{sampler:e.sampler,texture:e.texture,lateBinding:e.lateBinding}}function Uu(e){return{buffer:e.buffer,wordCount:e.wordCount}}function Gu(e){return{dimension:e.dimension,formatKind:e.formatKind}}function Wu(e){return{numSamplers:e.numSamplers,numUniformBuffers:e.numUniformBuffers,samplerEntries:void 0!==e.samplerEntries?Su(e.samplerEntries,Gu):void 0}}function Vu(e){return{location:e.location,format:e.format,bufferIndex:e.bufferIndex,bufferByteOffset:e.bufferByteOffset,byteStride:e.byteStride,divisor:e.divisor}}function Xu(e){return null!==e?{byteStride:e.byteStride,frequency:e.frequency}:null}!function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ru,n=Eu(t);null!==e&&mu(n,e)}({depthCompare:ks.Always,depthWrite:!1},Ru);var Hu,ju=new Uint16Array([65279]),zu=(new DataView(ju.buffer).getUint8(0),/([^[]*)(\[[0-9]+\])?/);function Yu(e){if("]"!==e[e.length-1])return{name:e,length:1,isArray:!1};var t=e.match(zu);if(!t||t.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(e));return{name:t[1],length:Number(t[2])||1,isArray:Boolean(t[2])}}function qu(e,t,n){var r=sc[n.type];if(!r)throw new Error("Unknown GLSL uniform type ".concat(n.type));return r().bind(null,e,t)}function Ku(){var e=null;return function(t,n,r){var i=e!==r;return i&&(t.uniform1i(n,r),e=r),i}}function Zu(e,t,n,r){var i=null,o=null;return function(a,s,u){var c=t(u,n),l=c.length,h=!1;if(null===i)i=new Float32Array(l),o=l,h=!0;else{eu(o===l,"Uniform length cannot change.");for(var f=0;f<l;++f)if(c[f]!==i[f]){h=!0;break}}return h&&(r(a,e,s,c),i.set(c)),h}}function $u(e,t,n,r){e[t](n,r)}function Qu(e,t,n,r){e[t](n,!1,r)}var Ju={},ec={},tc={},nc=[0];function rc(e,t,n,r){1===t&&"boolean"==typeof e&&(e=e?1:0),Number.isFinite(e)&&(nc[0]=e,e=nc);var i=e.length;if(e instanceof n)return e;var o=r[i];o||(o=new n(i),r[i]=o);for(var a=0;a<i;a++)o[a]=e[a];return o}function ic(e,t){return rc(e,t,Float32Array,Ju)}function oc(e,t){return rc(e,t,Int32Array,ec)}function ac(e,t){return rc(e,t,Uint32Array,tc)}var sc=(gs(Hu={},Xs.FLOAT,Zu.bind(null,"uniform1fv",ic,1,$u)),gs(Hu,Xs.FLOAT_VEC2,Zu.bind(null,"uniform2fv",ic,2,$u)),gs(Hu,Xs.FLOAT_VEC3,Zu.bind(null,"uniform3fv",ic,3,$u)),gs(Hu,Xs.FLOAT_VEC4,Zu.bind(null,"uniform4fv",ic,4,$u)),gs(Hu,Xs.INT,Zu.bind(null,"uniform1iv",oc,1,$u)),gs(Hu,Xs.INT_VEC2,Zu.bind(null,"uniform2iv",oc,2,$u)),gs(Hu,Xs.INT_VEC3,Zu.bind(null,"uniform3iv",oc,3,$u)),gs(Hu,Xs.INT_VEC4,Zu.bind(null,"uniform4iv",oc,4,$u)),gs(Hu,Xs.BOOL,Zu.bind(null,"uniform1iv",oc,1,$u)),gs(Hu,Xs.BOOL_VEC2,Zu.bind(null,"uniform2iv",oc,2,$u)),gs(Hu,Xs.BOOL_VEC3,Zu.bind(null,"uniform3iv",oc,3,$u)),gs(Hu,Xs.BOOL_VEC4,Zu.bind(null,"uniform4iv",oc,4,$u)),gs(Hu,Xs.FLOAT_MAT2,Zu.bind(null,"uniformMatrix2fv",ic,4,Qu)),gs(Hu,Xs.FLOAT_MAT3,Zu.bind(null,"uniformMatrix3fv",ic,9,Qu)),gs(Hu,Xs.FLOAT_MAT4,Zu.bind(null,"uniformMatrix4fv",ic,16,Qu)),gs(Hu,Xs.SAMPLER_2D,Ku),gs(Hu,Xs.SAMPLER_CUBE,Ku),gs(Hu,Xs.UNSIGNED_INT,Zu.bind(null,"uniform1uiv",ac,1,$u)),gs(Hu,Xs.UNSIGNED_INT_VEC2,Zu.bind(null,"uniform2uiv",ac,2,$u)),gs(Hu,Xs.UNSIGNED_INT_VEC3,Zu.bind(null,"uniform3uiv",ac,3,$u)),gs(Hu,Xs.UNSIGNED_INT_VEC4,Zu.bind(null,"uniform4uiv",ac,4,$u)),gs(Hu,Xs.FLOAT_MAT2x3,Zu.bind(null,"uniformMatrix2x3fv",ic,6,Qu)),gs(Hu,Xs.FLOAT_MAT2x4,Zu.bind(null,"uniformMatrix2x4fv",ic,8,Qu)),gs(Hu,Xs.FLOAT_MAT3x2,Zu.bind(null,"uniformMatrix3x2fv",ic,6,Qu)),gs(Hu,Xs.FLOAT_MAT3x4,Zu.bind(null,"uniformMatrix3x4fv",ic,12,Qu)),gs(Hu,Xs.FLOAT_MAT4x2,Zu.bind(null,"uniformMatrix4x2fv",ic,8,Qu)),gs(Hu,Xs.FLOAT_MAT4x3,Zu.bind(null,"uniformMatrix4x3fv",ic,12,Qu)),gs(Hu,Xs.SAMPLER_2D,Ku),gs(Hu,Xs.SAMPLER_CUBE,Ku),gs(Hu,Xs.SAMPLER_3D,Ku),gs(Hu,Xs.SAMPLER_2D_SHADOW,Ku),gs(Hu,Xs.SAMPLER_2D_ARRAY,Ku),gs(Hu,Xs.SAMPLER_2D_ARRAY_SHADOW,Ku),gs(Hu,Xs.SAMPLER_CUBE_SHADOW,Ku),gs(Hu,Xs.INT_SAMPLER_2D,Ku),gs(Hu,Xs.INT_SAMPLER_3D,Ku),gs(Hu,Xs.INT_SAMPLER_CUBE,Ku),gs(Hu,Xs.INT_SAMPLER_2D_ARRAY,Ku),gs(Hu,Xs.UNSIGNED_INT_SAMPLER_2D,Ku),gs(Hu,Xs.UNSIGNED_INT_SAMPLER_3D,Ku),gs(Hu,Xs.UNSIGNED_INT_SAMPLER_CUBE,Ku),gs(Hu,Xs.UNSIGNED_INT_SAMPLER_2D_ARRAY,Ku),Hu),uc=function(){function e(t){var n=t.id,r=t.device;ds(this,e),this.id=void 0,this.name=void 0,this.device=void 0,this.id=n,this.device=r,null!==this.device.resourceCreationTracker&&this.device.resourceCreationTracker.trackResourceCreated(this)}return vs(e,[{key:"destroy",value:function(){null!==this.device.resourceCreationTracker&&this.device.resourceCreationTracker.trackResourceDestroyed(this)}}]),e}(),cc=function(e){_s(n,e);var t=As(n);function n(e){var r,i=e.id,o=e.device,a=e.descriptor;ds(this,n),(r=t.call(this,{id:i,device:o})).type=Ls.Bindings,r.uniformBufferBindings=void 0,r.samplerBindings=void 0;var s=a.bindingLayout,u=a.uniformBufferBindings,c=a.samplerBindings;eu(u.length>=s.numUniformBuffers),eu(c.length>=s.numSamplers);for(var l=0;l<s.numUniformBuffers;l++)eu(u[l].wordCount>0);return r.uniformBufferBindings=a.uniformBufferBindings,r.samplerBindings=a.samplerBindings,r}return n}(uc);function lc(e){return"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||Boolean(e&&2===e._version)}function hc(e){switch(Ys(e)){case 65:case 66:case 67:case 68:case 69:case 70:case 71:return!0;default:return!1}}function fc(e){switch(e){case 1:return Xs.ELEMENT_ARRAY_BUFFER;case 2:return Xs.ARRAY_BUFFER;case 3:return Xs.UNIFORM_BUFFER}}function dc(e){var t=Ys(e),n=zs(e),r=qs(e),i=function(e){switch(e){case 1:return Xs.UNSIGNED_BYTE;case 2:return Xs.UNSIGNED_SHORT;case 3:return Xs.UNSIGNED_INT;case 4:return Xs.BYTE;case 5:return Xs.SHORT;case 6:return Xs.INT;case 7:return Xs.HALF_FLOAT;case 8:return Xs.FLOAT;default:throw"whoops"}}(t),o=function(e){switch(e){case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4}}(n);return{size:o,type:i,normalized:!!(1&r)}}function pc(e){switch(e){case 0:return Xs.CLAMP_TO_EDGE;case 1:return Xs.REPEAT;case 2:return Xs.MIRRORED_REPEAT;default:throw"whoops"}}function vc(e,t){if(2===t&&1===e)return Xs.LINEAR_MIPMAP_LINEAR;if(2===t&&0===e)return Xs.NEAREST_MIPMAP_LINEAR;if(1===t&&1===e)return Xs.LINEAR_MIPMAP_NEAREST;if(1===t&&0===e)return Xs.NEAREST_MIPMAP_NEAREST;if(0===t&&1===e)return Xs.LINEAR;if(0===t&&0===e)return Xs.NEAREST;throw new Error("Unknown texture filter mode")}function gc(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=e;return n.gl_buffer_pages[t/n.pageByteSize|0]}function _c(e){return e.gl_texture}function yc(e){return e.gl_sampler}function mc(e,t){e.name=t,e.__SPECTOR_Metadata={name:t}}function Ec(e,t){for(var n=[];;){var r=t.exec(e);if(!r)break;n.push(r)}return n}function Tc(e){return e.blendMode==Ws.Add&&e.blendSrcFactor==Gs.One&&e.blendDstFactor===Gs.Zero}function Rc(e){if(0===e)return Xs.TEXTURE_2D;if(1===e)return Xs.TEXTURE_2D_ARRAY;if(3===e)return Xs.TEXTURE_CUBE_MAP;if(2===e)return Xs.TEXTURE_3D;throw"whoops"}var Ac=function(e){_s(n,e);var t=As(n);function n(e){var r,i=e.id,o=e.device,a=e.descriptor;ds(this,n),(r=t.call(this,{id:i,device:o})).type=Ls.Buffer,r.gl_buffer_pages=void 0,r.gl_target=void 0,r.usage=void 0,r.byteSize=void 0,r.pageByteSize=void 0;var s=a.viewOrSize,u=a.usage,c=a.hint,l=o.uniformBufferMaxPageByteSize,h=o.gl,f=3===u;f||(lc(h)?h.bindVertexArray(null):o.OES_vertex_array_object.bindVertexArrayOES(null));var d,p=oe(s)?4*s:4*s.byteLength;if(r.gl_buffer_pages=[],f){eu(p%l==0);for(var v=p;v>0;)r.gl_buffer_pages.push(r.createBufferPage(Math.min(v,l),u,c)),v-=l;d=l}else r.gl_buffer_pages.push(r.createBufferPage(p,u,c)),d=p;return r.pageByteSize=d,r.byteSize=p,r.usage=u,r.gl_target=fc(u),f||(lc(h)?h.bindVertexArray(r.device.currentBoundVAO):o.OES_vertex_array_object.bindVertexArrayOES(r.device.currentBoundVAO)),r}return vs(n,[{key:"setSubData",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.byteLength-n,i=this.device.gl,o=this.gl_target,a=this.byteSize,s=this.pageByteSize;if(lc(i)&&o===i.UNIFORM_BUFFER){if(e%s!=0)throw new Error("Assert fail: (dstByteOffset [".concat(e,"] % dstPageByteSize [").concat(s,"]) === 0"));if(r%s!=0)throw new Error("Assert fail: (byteSize [".concat(r,"] % dstPageByteSize [").concat(s,"]) === 0"))}if(!(e+r<=a))throw new Error("Assert fail: (dstByteOffset [".concat(e,"] + byteSize [").concat(r,"]) <= dstByteSize [").concat(a,"], gl_target ").concat(o));for(var u=e+r,c=e,l=e%s;c<u;){var h=lc(i)?i.COPY_WRITE_BUFFER:this.gl_target;i.bindBuffer(h,gc(this,c)),lc(i)?i.bufferSubData(h,l,t,n,Math.min(u-c,s)):i.bufferSubData(h,l,t),c+=s,l=0,n+=s,this.device.debugGroupStatisticsBufferUpload()}}},{key:"destroy",value:function(){bs(ys(n.prototype),"destroy",this).call(this);for(var e=0;e<this.gl_buffer_pages.length;e++)this.gl_buffer_pages[e].ubo||this.device.gl.deleteBuffer(this.gl_buffer_pages[e])}},{key:"createBufferPage",value:function(e,t,n){var r=this.device.gl,i=3===t;if(!lc(r)&&i)return{ubo:!0};var o=this.device.ensureResourceExists(r.createBuffer()),a=fc(t),s=function(e){switch(e){case 1:return Xs.STATIC_DRAW;case 2:return Xs.DYNAMIC_DRAW}}(n);return r.bindBuffer(a,o),r.bufferData(a,e,s),o}}]),n}(uc),Sc=function(e){_s(n,e);var t=As(n);function n(e){var r,i=e.id,o=e.device,a=e.descriptor;ds(this,n),(r=t.call(this,{id:i,device:o})).type=Ls.InputLayout,r.vertexAttributeDescriptors=void 0,r.vertexBufferDescriptors=void 0,r.indexBufferFormat=void 0;var s=a.vertexAttributeDescriptors,u=a.vertexBufferDescriptors,c=a.indexBufferFormat;return eu(c===ws.U16_R||c===ws.U32_R||null===c),r.vertexAttributeDescriptors=s,r.vertexBufferDescriptors=u,r.indexBufferFormat=c,r}return n}(uc),bc=function(e){_s(n,e);var t=As(n);function n(e){var r,i=e.id,o=e.device,a=e.inputLayout,s=e.vertexBuffers,u=e.indexBufferBinding,c=e.program;ds(this,n),(r=t.call(this,{id:i,device:o})).type=Ls.InputState,r.vao=void 0,r.indexBufferByteOffset=void 0,r.indexBufferType=void 0,r.indexBufferCompByteSize=void 0,r.inputLayout=void 0,r.vertexBuffers=void 0;var l=r.device.gl,h=r.device.ensureResourceExists(lc(l)?l.createVertexArray():o.OES_vertex_array_object.createVertexArrayOES());lc(l)?l.bindVertexArray(h):o.OES_vertex_array_object.bindVertexArrayOES(h);for(var f=0;f<a.vertexAttributeDescriptors.length;f++){var d=a.vertexAttributeDescriptors[f],p=d.format,v=d.divisor,g=void 0===v?1:v,_=d.byteStride,y=d.bufferByteOffset,m=d.bufferIndex,E=lc(l)?d.location:c.attributes[f].location,T=dc(p),R=T.size,A=T.type,S=T.normalized,b=s[m];if(null!==b){var x=tu(a.vertexBufferDescriptors[m]);eu(2===b.buffer.usage),l.bindBuffer(l.ARRAY_BUFFER,gc(b.buffer));var C=b.byteOffset+y;l.vertexAttribPointer(E,R,A,S,_||x.byteStride,C),2===x.frequency&&(lc(l)?l.vertexAttribDivisor(E,g):o.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(E,g)),l.enableVertexAttribArray(E)}}var M=null,P=null,N=null;return null!==u&&(eu(1===u.buffer.usage),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,gc(u.buffer)),M=function(e){switch(e){case ws.U8_R:return Xs.UNSIGNED_BYTE;case ws.U16_R:return Xs.UNSIGNED_SHORT;case ws.U32_R:return Xs.UNSIGNED_INT;default:throw"whoops"}}(tu(a.indexBufferFormat)),P=Zs(a.indexBufferFormat),N=u.byteOffset),lc(l)?l.bindVertexArray(null):o.OES_vertex_array_object.bindVertexArrayOES(null),r.vao=h,r.indexBufferByteOffset=N,r.indexBufferType=M,r.indexBufferCompByteSize=P,r.inputLayout=a,r.vertexBuffers=s,r}return vs(n,[{key:"destroy",value:function(){bs(ys(n.prototype),"destroy",this).call(this),this.device.currentBoundVAO===this.vao&&(lc(this.device.gl)?(this.device.gl.bindVertexArray(null),this.device.gl.deleteVertexArray(this.vao)):(this.device.OES_vertex_array_object.bindVertexArrayOES(null),this.device.OES_vertex_array_object.deleteVertexArrayOES(this.vao)),this.device.currentBoundVAO=null)}}]),n}(uc),xc=function(e){_s(n,e);var t=As(n);function n(e){var r,i=e.id,o=e.device,a=e.descriptor;ds(this,n),(r=t.call(this,{id:i,device:o})).type=Ls.Program,r.gl_program=void 0,r.gl_shader_vert=void 0,r.gl_shader_frag=void 0,r.compileState=void 0,r.descriptor=void 0,r.uniformSetters={},r.attributes=[];var s=r.device.gl;return r.descriptor=a,r.gl_program=r.device.ensureResourceExists(s.createProgram()),r.gl_shader_vert=null,r.gl_shader_frag=null,r.compileState=0,r.tryCompileProgram(),r}return vs(n,[{key:"destroy",value:function(){bs(ys(n.prototype),"destroy",this).call(this),this.device.gl.deleteProgram(this.gl_program),this.device.gl.deleteShader(this.gl_shader_vert),this.device.gl.deleteShader(this.gl_shader_frag)}},{key:"tryCompileProgram",value:function(){eu(0===this.compileState);var e=this.descriptor,t=this.device.gl;null!==this.gl_shader_vert&&t.deleteShader(this.gl_shader_vert),null!==this.gl_shader_frag&&t.deleteShader(this.gl_shader_frag),this.gl_shader_vert=this.compileShader(e.preprocessedVert,t.VERTEX_SHADER),this.gl_shader_frag=this.compileShader(e.preprocessedFrag,t.FRAGMENT_SHADER),t.attachShader(this.gl_program,this.gl_shader_vert),t.attachShader(this.gl_program,this.gl_shader_frag),t.linkProgram(this.gl_program),this.compileState=1,lc(t)||(this.readUniformLocationsFromLinkedProgram(),this.readAttributesFromProgram())}},{key:"readAttributesFromProgram",value:function(){for(var e=this.device.gl,t=e.getProgramParameter(this.gl_program,e.ACTIVE_ATTRIBUTES),n=0;n<t;n++){var r=e.getActiveAttrib(this.gl_program,n),i=r.name,o=r.type,a=r.size,s=e.getAttribLocation(this.gl_program,i);s>=0&&this.attributes.push({name:i,location:s,type:o,size:a})}this.attributes.sort((function(e,t){return e.location-t.location}))}},{key:"readUniformLocationsFromLinkedProgram",value:function(){for(var e=this.device.gl,t=e.getProgramParameter(this.gl_program,e.ACTIVE_UNIFORMS),n=0;n<t;n++){var r=e.getActiveUniform(this.gl_program,n),i=Yu(r.name).name,o=e.getUniformLocation(this.gl_program,i);if(this.uniformSetters[i]=qu(e,o,r),r&&r.size>1)for(var a=0;a<r.size;a++)o=e.getUniformLocation(this.gl_program,"".concat(i,"[").concat(a,"]")),this.uniformSetters["".concat(i,"[").concat(a,"]")]=qu(e,o,r)}}},{key:"compileShader",value:function(e,t){var n=this.device.gl,r=this.device.ensureResourceExists(n.createShader(t));return n.shaderSource(r,e),n.compileShader(r),r}},{key:"setUniforms",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.device.gl;for(var n in t.useProgram(this.gl_program),e){var r=e[n],i=this.uniformSetters[n];if(i){var o=r;i(o)}}return this}}]),n}(uc);function Cc(e){if(e===ws.U8_RGBA_RT)return"bgra8unorm";if(e===ws.U8_RGBA_NORM)return"rgba8unorm";if(e===ws.U8_RG_NORM)return"rg8unorm";if(e===ws.U32_R)return"r32uint";if(e===ws.D24)return"depth24plus";if(e===ws.D24_S8)return"depth24plus-stencil8";if(e===ws.D32F)return"depth32float";if(e===ws.D32F_S8)return"depth32float-stencil8";if(e===ws.BC1)return"bc1-rgba-unorm";if(e===ws.BC1_SRGB)return"bc1-rgba-unorm-srgb";if(e===ws.BC2)return"bc2-rgba-unorm";if(e===ws.BC2_SRGB)return"bc2-rgba-unorm-srgb";if(e===ws.BC3)return"bc3-rgba-unorm";if(e===ws.BC3_SRGB)return"bc3-rgba-unorm-srgb";if(e===ws.BC4_SNORM)return"bc4-r-snorm";if(e===ws.BC4_UNORM)return"bc4-r-unorm";if(e===ws.BC5_SNORM)return"bc5-rg-snorm";if(e===ws.BC5_UNORM)return"bc5-rg-unorm";throw"whoops"}function Mc(e){if(0===e)return"clamp-to-edge";if(1===e)return"repeat";if(2===e)return"mirror-repeat";throw"whoops"}function Pc(e){if(1===e)return"linear";if(0===e)return"nearest";throw"whoops"}function Nc(e){if(2===e)return"linear";if(1===e)return"nearest";if(0===e)return"nearest";throw"whoops"}function Oc(e){if(0===e)return"float";if(3===e)return"depth";throw"whoops"}function Bc(e){if(0===e)return"2d";if(1===e)return"2d-array";if(2===e)return"3d";if(3===e)return"cube";throw"whoops"}function Ic(e){return e.gpuBuffer}function Dc(e){return e.querySet}function Fc(e){if(0===e)return"occlusion";throw"whoops"}function wc(e){switch(e){case 1:return"triangle-list";case 0:return"point-list";case 2:return"triangle-strip";case 3:return"line-list";case 4:return"line-strip";default:throw new Error("Unknown primitive topology mode")}}function Lc(e){if(0===e)return"none";if(1===e)return"front";if(2===e)return"back";throw"whoops"}function kc(e){if(e===Us.CCW)return"ccw";if(e===Us.CW)return"cw";throw"whoops"}function Uc(e){if(e===Gs.Zero)return"zero";if(e===Gs.One)return"one";if(e===Gs.Src)return"src";if(e===Gs.OneMinusSrc)return"one-minus-src";if(e===Gs.Dst)return"dst";if(e===Gs.OneMinusDst)return"one-minus-dst";if(e===Gs.SrcAlpha)return"src-alpha";if(e===Gs.OneMinusSrcAlpha)return"one-minus-src-alpha";if(e===Gs.DstAlpha)return"dst-alpha";if(e===Gs.OneMinusDstAlpha)return"one-minus-dst-alpha";throw"whoops"}function Gc(e){if(e===Ws.Add)return"add";if(e===Ws.Subtract)return"subtract";if(e===Ws.ReverseSubtract)return"reverse-subtract";throw"whoops"}function Wc(e){return{operation:Gc(e.blendMode),srcFactor:Uc(e.blendSrcFactor),dstFactor:Uc(e.blendDstFactor)}}function Vc(e){if(e===ks.Never)return"never";if(e===ks.Less)return"less";if(e===ks.Equal)return"equal";if(e===ks.LessEqual)return"less-equal";if(e===ks.Greater)return"greater";if(e===ks.NotEqual)return"not-equal";if(e===ks.GreaterEqual)return"greater-equal";if(e===ks.Always)return"always";throw"whoops"}function Xc(e){if(1===e)return"vertex";if(2===e)return"instance";throw"whoops"}function Hc(e){if(e===ws.U8_R)return"uint8x2";if(e===ws.U8_RG)return"uint8x2";if(e===ws.U8_RGB)return"uint8x4";if(e===ws.U8_RGBA)return"uint8x4";if(e===ws.U8_RGBA_NORM)return"unorm8x4";if(e===ws.S8_RGB_NORM)return"snorm8x4";if(e===ws.S8_RGBA_NORM)return"snorm8x4";if(e===ws.S16_RG)return"uint16x2";if(e===ws.F32_R)return"float32";if(e===ws.F32_RG)return"float32x2";if(e===ws.F32_RGB)return"float32x3";if(e===ws.F32_RGBA)return"float32x4";throw"whoops"}function jc(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0;switch(e){case ws.S8_R:case ws.S8_R_NORM:case ws.S8_RG_NORM:case ws.S8_RGB_NORM:case ws.S8_RGBA_NORM:var i=(ArrayBuffer,new Int8Array(t));return r&&i.set(new Int8Array(r)),i;case ws.U8_R:case ws.U8_R_NORM:case ws.U8_RG:case ws.U8_RG_NORM:case ws.U8_RGB:case ws.U8_RGB_NORM:case ws.U8_RGB_SRGB:case ws.U8_RGBA:case ws.U8_RGBA_NORM:case ws.U8_RGBA_SRGB:var o=(ArrayBuffer,new Uint8Array(t));return r&&o.set(new Uint8Array(r)),o;case ws.S16_R:case ws.S16_RG:case ws.S16_RG_NORM:case ws.S16_RGB_NORM:case ws.S16_RGBA:case ws.S16_RGBA_NORM:var a=t instanceof ArrayBuffer?new Int16Array(t):new Int16Array(n?t/2:t);return r&&a.set(new Int16Array(r)),a;case ws.U16_R:case ws.U16_RGB:case ws.U16_RGBA_5551:case ws.U16_RGBA_NORM:case ws.U16_RG_NORM:case ws.U16_R_NORM:var s=t instanceof ArrayBuffer?new Uint16Array(t):new Uint16Array(n?t/2:t);return r&&s.set(new Uint16Array(r)),s;case ws.S32_R:var u=t instanceof ArrayBuffer?new Int32Array(t):new Int32Array(n?t/4:t);return r&&u.set(new Int32Array(r)),u;case ws.U32_R:case ws.U32_RG:var c=t instanceof ArrayBuffer?new Uint32Array(t):new Uint32Array(n?t/4:t);return r&&c.set(new Uint32Array(r)),c;case ws.F32_R:case ws.F32_RG:case ws.F32_RGB:case ws.F32_RGBA:var l=t instanceof ArrayBuffer?new Float32Array(t):new Float32Array(n?t/4:t);return r&&l.set(new Float32Array(r)),l}var h=(ArrayBuffer,new Uint8Array(t));return r&&h.set(new Uint8Array(r)),h}var zc=function(e){_s(n,e);var t=As(n);function n(e){var r,i=e.id,o=e.device,a=e.descriptor;ds(this,n),(r=t.call(this,{id:i,device:o})).type=Ls.QueryPool,r.gl_query_type=void 0,r.gl_query=void 0;var s=r.device.gl;if(lc(s)){var u=a.elemCount,c=a.type;r.gl_query=pu(u,(function(){return r.device.ensureResourceExists(s.createQuery())})),r.gl_query_type=function(e){if(0===e)return Xs.ANY_SAMPLES_PASSED_CONSERVATIVE;throw"whoops"}(c)}return r}return vs(n,[{key:"queryResultOcclusion",value:function(e){var t=this.device.gl;if(lc(t)){var n=this.gl_query[e];return t.getQueryParameter(n,t.QUERY_RESULT_AVAILABLE)?!!t.getQueryParameter(n,t.QUERY_RESULT):null}return null}},{key:"destroy",value:function(){bs(ys(n.prototype),"destroy",this).call(this),Dc(this).destroy()}}]),n}(uc),Yc=function(e){_s(o,e);var t,n,r,i=As(o);function o(e){var t,n=e.id,r=e.device;return ds(this,o),(t=i.call(this,{id:n,device:r})).type=Ls.Readback,t.gl_pbo=null,t.gl_sync=null,t}return vs(o,[{key:"clientWaitAsync",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,r=this.device.gl;return new Promise((function(i,o){!function a(){var s=r.clientWaitSync(e,t,0);s!=r.WAIT_FAILED?s!=r.TIMEOUT_EXPIRED?i():setTimeout(a,ie(n,0,r.MAX_CLIENT_WAIT_TIMEOUT_WEBGL)):o()}()}))}},{key:"getBufferSubDataAsync",value:(r=fs(regeneratorRuntime.mark((function e(t,n,r,i){var o,a,s,u=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=u.length>4&&void 0!==u[4]?u[4]:0,a=u.length>5&&void 0!==u[5]?u[5]:i.byteLength||0,!lc(s=this.device.gl)){e.next=12;break}return this.gl_sync=s.fenceSync(s.SYNC_GPU_COMMANDS_COMPLETE,0),s.flush(),e.next=8,this.clientWaitAsync(this.gl_sync,0,10);case 8:return s.bindBuffer(t,n),s.getBufferSubData(t,r,i,o,a),s.bindBuffer(t,null),e.abrupt("return",i);case 12:case"end":return e.stop()}}),e,this)}))),function(e,t,n,i){return r.apply(this,arguments)})},{key:"readTexture",value:(n=fs(regeneratorRuntime.mark((function e(t,n,r,i,o,a){var s,u,c,l,h,f,d,p=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=p.length>6&&void 0!==p[6]?p[6]:0,u=p.length>7&&void 0!==p[7]?p[7]:a.byteLength||0,c=this.device.gl,l=t,h=this.device.translateTextureFormat(l.pixelFormat),f=this.device.translateTextureType(l.pixelFormat),d=$s(l.pixelFormat),!lc(c)){e.next=20;break}return this.gl_pbo=this.device.ensureResourceExists(c.createBuffer()),c.bindBuffer(c.PIXEL_PACK_BUFFER,this.gl_pbo),c.bufferData(c.PIXEL_PACK_BUFFER,u,c.STREAM_READ),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),c.bindFramebuffer(Xs.READ_FRAMEBUFFER,this.device.readbackFramebuffer),c.framebufferTexture2D(Xs.READ_FRAMEBUFFER,Xs.COLOR_ATTACHMENT0,Xs.TEXTURE_2D,l.gl_texture,0),c.bindBuffer(c.PIXEL_PACK_BUFFER,this.gl_pbo),c.readPixels(n,r,i,o,h,f,s*d),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),e.abrupt("return",this.getBufferSubDataAsync(c.PIXEL_PACK_BUFFER,this.gl_pbo,0,a,s,u));case 20:return c.pixelStorei(c.PACK_ALIGNMENT,4),c.readPixels(n,r,i,o,c.RGBA,f,a),e.abrupt("return",Promise.resolve(a));case 23:case"end":return e.stop()}}),e,this)}))),function(e,t,r,i,o,a){return n.apply(this,arguments)})},{key:"readBuffer",value:(t=fs(regeneratorRuntime.mark((function e(t,n,r,i,o){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!lc(a=this.device.gl)){e.next=3;break}return e.abrupt("return",this.getBufferSubDataAsync(a.ARRAY_BUFFER,gc(t,n),n,r,i,o));case 3:return e.abrupt("return",Promise.reject());case 4:case"end":return e.stop()}}),e,this)}))),function(e,n,r,i,o){return t.apply(this,arguments)})},{key:"destroy",value:function(){bs(ys(o.prototype),"destroy",this).call(this),lc(this.device.gl)&&(null!==this.gl_sync&&this.device.gl.deleteSync(this.gl_sync),null!==this.gl_pbo&&this.device.gl.deleteBuffer(this.gl_pbo))}}]),o}(uc),qc=function(){function e(t){var n=t.id,r=t.device;ds(this,e),this.type=void 0,this.id=void 0,this.name=void 0,this.device=void 0,this.id=n,this.device=r}return vs(e,[{key:"destroy",value:function(){}}]),e}(),Kc={formatKind:0,dimension:0},Zc=function(e){_s(n,e);var t=As(n);function n(e){var r,i=e.id,o=e.device,a=e.descriptor;ds(this,n),(r=t.call(this,{id:i,device:o})).type=Ls.Bindings,r.bindingLayout=void 0,r.gpuBindGroup=void 0;var s=a.pipeline,u=a.bindingLayout;eu(!!s);for(var c=r._createBindGroupLayout(u),l=[[],[]],h=0,f=0;f<u.numUniformBuffers;f++){var d=a.uniformBufferBindings[f];eu(d.wordCount>0);var p={buffer:Ic(d.buffer),offset:0,size:d.wordCount<<2};l[0].push({binding:h++,resource:p})}h=0;for(var v=0;v<u.numSamplers;v++){var g=void 0!==u.samplerEntries?u.samplerEntries[v]:Kc,_=a.samplerBindings[v],y=null!==_.texture?_.texture:r.device.getFallbackTexture(g);eu(g.dimension===y.dimension),eu(g.formatKind===Qs(y.pixelFormat));var m=y.gpuTextureView;l[1].push({binding:h++,resource:m});var E=(null!==_.sampler?_.sampler:r.device.fallbackSampler).gpuSampler;l[1].push({binding:h++,resource:E})}return r.gpuBindGroup=l.map((function(e,t){return r.device.device.createBindGroup({layout:c.gpuBindGroupLayout[t],entries:e})})),r.bindingLayout=a.bindingLayout,r}return vs(n,[{key:"_createBindGroupLayout",value:function(e){var t=this.device.bindGroupLayoutCache.get(e);return null===t&&(t=this._createBindGroupLayoutInternal(e),this.device.bindGroupLayoutCache.add(e,t)),t}},{key:"_createBindGroupLayoutInternal",value:function(e){for(var t,n=this,r=[[],[]],i=0;i<e.numUniformBuffers;i++)r[0].push({binding:r[0].length,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{type:"uniform",hasDynamicOffset:!0}});for(var o=0;o<e.numSamplers;o++){var a=void 0!==e.samplerEntries?e.samplerEntries[o]:Kc;r[1].push({binding:r[1].length,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,texture:(t=a,{sampleType:Oc(t.formatKind),viewDimension:Bc(t.dimension)})}),r[1].push({binding:r[1].length,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,sampler:{type:"filtering"}})}return{gpuBindGroupLayout:r.map((function(e){return n.device.device.createBindGroupLayout({entries:e})}))}}}]),n}(qc),$c=function(e){_s(n,e);var t=As(n);function n(e){var r,i=e.id,o=e.device,a=e.descriptor;return ds(this,n),(r=t.call(this,{id:i,device:o})).type=Ls.RenderPipeline,r.bindingLayouts=void 0,r.program=void 0,r.drawMode=void 0,r.megaState=void 0,r.inputLayout=void 0,r.colorAttachmentFormats=void 0,r.depthStencilAttachmentFormat=void 0,r.sampleCount=void 0,r.bindingLayouts=r.createBindingLayouts(a.bindingLayouts),r.drawMode=function(e){switch(e){case 1:return Xs.TRIANGLES;case 0:return Xs.POINTS;case 2:return Xs.TRIANGLE_STRIP;case 3:return Xs.LINES;case 4:return Xs.LINE_STRIP;default:throw new Error("Unknown primitive topology mode")}}(a.topology),r.program=a.program,r.inputLayout=a.inputLayout,r.megaState=a.megaStateDescriptor,r.colorAttachmentFormats=a.colorAttachmentFormats.slice(),r.depthStencilAttachmentFormat=a.depthStencilAttachmentFormat,r.sampleCount=a.sampleCount,r}return vs(n,[{key:"createBindingLayouts",value:function(e){for(var t=0,n=0,r=[],i=0;i<e.length;i++){var o=e[i],a=o.numUniformBuffers,s=o.numSamplers,u=o.samplerEntries,c=[];void 0!==u&&eu(u.length===s);for(var l=0;l<s;l++){var h=void 0!==u?u[l]:Kc,f=h.dimension,d=h.formatKind;c.push({gl_target:Rc(f),formatKind:d})}r.push({firstUniformBuffer:t,numUniformBuffers:a,firstSampler:n,numSamplers:s,samplerEntries:c}),t+=a,n+=s}return{numUniformBuffers:t,numSamplers:n,bindingLayoutTables:r}}}]),n}(uc),Qc=function(e){_s(n,e);var t=As(n);function n(e){var r,i=e.id,o=e.device,a=e.descriptor;ds(this,n),(r=t.call(this,{id:i,device:o})).type=Ls.RenderTarget,r.gl_renderbuffer=null,r.texture=null,r.pixelFormat=void 0,r.width=void 0,r.height=void 0,r.sampleCount=void 0;var s=r.device.gl,u=a.pixelFormat,c=a.width,l=a.height,h=a.texture,f=a.sampleCount;if(h)r.texture=h;else{r.gl_renderbuffer=r.device.ensureResourceExists(s.createRenderbuffer()),s.bindRenderbuffer(s.RENDERBUFFER,r.gl_renderbuffer);var d=r.device.translateTextureInternalFormat(u);lc(s)&&f>0?s.renderbufferStorageMultisample(Xs.RENDERBUFFER,f,d,c,l):s.renderbufferStorage(Xs.RENDERBUFFER,d,c,l)}return r.pixelFormat=u,r.width=c,r.height=l,r.sampleCount=f,r}return vs(n,[{key:"destroy",value:function(){bs(ys(n.prototype),"destroy",this).call(this),null!==this.gl_renderbuffer&&this.device.gl.deleteRenderbuffer(this.gl_renderbuffer)}}]),n}(uc),Jc=function(){function e(){ds(this,e),this.liveObjects=new Set,this.creationStacks=new Map,this.deletionStacks=new Map}return vs(e,[{key:"trackResourceCreated",value:function(e){this.creationStacks.set(e,(new Error).stack),this.liveObjects.add(e)}},{key:"trackResourceDestroyed",value:function(e){this.deletionStacks.has(e)&&console.warn("Object double freed:",e,"\n\nCreation stack: ",this.creationStacks.get(e),"\n\nDeletion stack: ",this.deletionStacks.get(e),"\n\nThis stack: ",(new Error).stack),this.deletionStacks.set(e,(new Error).stack),this.liveObjects.delete(e)}},{key:"checkForLeaks",value:function(){var e,t=Is(this.liveObjects.values());try{for(t.s();!(e=t.n()).done;){var n=e.value;console.warn("Object leaked:",n,"Creation stack:",this.creationStacks.get(n))}}catch(e){t.e(e)}finally{t.f()}}},{key:"setResourceLeakCheck",value:function(e,t){t?this.liveObjects.add(e):this.liveObjects.delete(e)}}]),e}(),el=function(e){_s(n,e);var t=As(n);function n(e){var r,i=e.id,o=e.device,a=e.descriptor;ds(this,n),(r=t.call(this,{id:i,device:o})).type=Ls.Sampler,r.gl_sampler=void 0,r.descriptor=void 0;var s=r.device.gl;if(lc(s)){var u,c,l=r.device.ensureResourceExists(s.createSampler());s.samplerParameteri(l,Xs.TEXTURE_WRAP_S,pc(a.wrapS)),s.samplerParameteri(l,Xs.TEXTURE_WRAP_T,pc(a.wrapT)),s.samplerParameteri(l,Xs.TEXTURE_WRAP_R,pc(null!==(u=a.wrapQ)&&void 0!==u?u:a.wrapS)),s.samplerParameteri(l,Xs.TEXTURE_MIN_FILTER,vc(a.minFilter,a.mipFilter)),s.samplerParameteri(l,Xs.TEXTURE_MAG_FILTER,vc(a.magFilter,0)),void 0!==a.minLOD&&s.samplerParameterf(l,Xs.TEXTURE_MIN_LOD,a.minLOD),void 0!==a.maxLOD&&s.samplerParameterf(l,Xs.TEXTURE_MAX_LOD,a.maxLOD),void 0!==a.compareMode&&(s.samplerParameteri(l,s.TEXTURE_COMPARE_MODE,s.COMPARE_REF_TO_TEXTURE),s.samplerParameteri(l,s.TEXTURE_COMPARE_FUNC,a.compareMode));var h=null!==(c=a.maxAnisotropy)&&void 0!==c?c:1;h>1&&null!==r.device.EXT_texture_filter_anisotropic&&(eu(1===a.minFilter&&1===a.magFilter&&2===a.mipFilter),s.samplerParameterf(l,r.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,h)),r.gl_sampler=l}else r.descriptor=a;return r}return vs(n,[{key:"setTextureParameters",value:function(e,t){var n,r=this.device.gl,i=this.descriptor;r.texParameteri(e,Xs.TEXTURE_WRAP_S,pc(i.wrapS)),r.texParameteri(e,Xs.TEXTURE_WRAP_T,pc(i.wrapT)),r.texParameteri(e,Xs.TEXTURE_MIN_FILTER,vc(i.minFilter,i.mipFilter)),r.texParameteri(e,Xs.TEXTURE_MAG_FILTER,vc(i.magFilter,0));var o=null!==(n=i.maxAnisotropy)&&void 0!==n?n:1;o>1&&null!==this.device.EXT_texture_filter_anisotropic&&(eu(1===i.minFilter&&1===i.magFilter&&2===i.mipFilter),r.texParameteri(e,this.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o))}},{key:"destroy",value:function(){bs(ys(n.prototype),"destroy",this).call(this),lc(this.device.gl)&&this.device.gl.deleteSampler(yc(this))}}]),n}(uc),tl=function(e){_s(n,e);var t=As(n);function n(e){var r,i=e.id,o=e.device,a=e.descriptor,s=e.fake;ds(this,n),(r=t.call(this,{id:i,device:o})).type=Ls.Texture,r.gl_texture=void 0,r.gl_target=void 0,r.pixelFormat=void 0,r.width=void 0,r.height=void 0,r.depth=void 0,r.numLevels=void 0,r.immutable=void 0,r.flipY=void 0,r.mipmaps=void 0,r.formatKind=void 0;var u,c,l=r.device.gl,h=r.clampNumLevels(a);if(r.immutable=!!a.immutable,r.flipY=!!a.flipY,r.pixelFormat=a.pixelFormat,r.formatKind=Qs(a.pixelFormat),r.width=a.width,r.height=a.height,r.depth=a.depth,r.mipmaps=h>=1,!s){c=r.device.ensureResourceExists(l.createTexture());var f=r.device.translateTextureType(a.pixelFormat),d=r.device.translateTextureInternalFormat(a.pixelFormat);if(r.device.setActiveTexture(l.TEXTURE0),r.device.currentTextures[0]=null,r.flipY&&l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,1),0===a.dimension){if(u=Xs.TEXTURE_2D,l.bindTexture(u,c),lc(l))r.immutable&&l.texStorage2D(u,h,d,a.width,a.height);else if(r.immutable){var p=d===Xs.DEPTH_COMPONENT||r.isNPOT()?0:h;l.texImage2D(u,p,d,a.width,a.height,0,d,f,null),r.mipmaps&&r.isNPOT()&&(r.mipmaps=!1,l.texParameteri(Xs.TEXTURE_2D,Xs.TEXTURE_MIN_FILTER,Xs.LINEAR),l.texParameteri(Xs.TEXTURE_2D,Xs.TEXTURE_WRAP_S,Xs.CLAMP_TO_EDGE),l.texParameteri(Xs.TEXTURE_2D,Xs.TEXTURE_WRAP_T,Xs.CLAMP_TO_EDGE))}eu(1===a.depth)}else if(1===a.dimension)u=Xs.TEXTURE_2D_ARRAY,l.bindTexture(u,c),lc(l)&&l.texStorage3D(u,h,d,a.width,a.height,a.depth);else if(2===a.dimension)u=Xs.TEXTURE_3D,l.bindTexture(u,c),lc(l)&&l.texStorage3D(u,h,d,a.width,a.height,a.depth);else{if(3!==a.dimension)throw"whoops";u=Xs.TEXTURE_CUBE_MAP,l.bindTexture(u,c),lc(l)&&l.texStorage2D(u,h,d,a.width,a.height),eu(6===a.depth)}}return r.gl_texture=c,r.gl_target=u,r.numLevels=h,r.mipmaps&&r.generateMipmap(),r}return vs(n,[{key:"setImageData",value:function(e,t){var n,r,i=this.device.gl,o=(hc(this.pixelFormat),this.gl_target===Xs.TEXTURE_3D||(this.gl_target,Xs.TEXTURE_2D_ARRAY),this.gl_target,Xs.TEXTURE_CUBE_MAP,Array.isArray(e));this.device.setActiveTexture(i.TEXTURE0),this.device.currentTextures[0]=null,o?(n=this.width,r=this.height):(n=e.width,r=e.height),i.bindTexture(this.gl_target,this.gl_texture);var a=this.device.translateTextureFormat(this.pixelFormat),s=this.device.translateTextureType(this.pixelFormat);if(this.flipY&&i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,1),this.immutable){if(!lc(i))throw"WebGL1 don't support immutable texture";i.texSubImage2D(this.gl_target,t,0,0,n,r,a,s,o?e[0]:e)}else lc(i)?i.texImage2D(this.gl_target,t,a,n,r,0,a,s,o?e[0]:e):i.texImage2D(this.gl_target,t,a,a,s,e);this.mipmaps&&this.generateMipmap()}},{key:"destroy",value:function(){bs(ys(n.prototype),"destroy",this).call(this),this.device.gl.deleteTexture(_c(this))}},{key:"clampNumLevels",value:function(e){if(1===e.dimension&&e.depth>1&&65===Ys(e.pixelFormat))for(var t=e.width,n=e.height,r=0;r<e.numLevels;r++){if(t<=2||n<=2)return r-1;t=Math.max(t/2|0,1),n=Math.max(n/2|0,1)}return e.numLevels}},{key:"generateMipmap",value:function(){return this.device.gl,this.isNPOT(),this}},{key:"isNPOT",value:function(){return!(lc(this.device.gl)||uu(this.width)&&uu(this.height))}}]),n}(uc),nl=function(){function e(t,n){ds(this,e),this.shaderDebug=!1,this.contextAttributes=void 0,this.OES_vertex_array_object=null,this.ANGLE_instanced_arrays=null,this.OES_texture_float=null,this.OES_draw_buffers_indexed=null,this.WEBGL_draw_buffers=null,this.WEBGL_depth_texture=null,this.WEBGL_compressed_texture_s3tc=null,this.WEBGL_compressed_texture_s3tc_srgb=null,this.EXT_texture_compression_rgtc=null,this.EXT_texture_filter_anisotropic=null,this.KHR_parallel_shader_compile=null,this.EXT_texture_norm16=null,this.scTexture=null,this.scPlatformFramebuffer=null,this.currentActiveTexture=null,this.currentBoundVAO=null,this.currentProgram=null,this.resourceCreationTracker=null,this.resourceUniqueId=0,this.currentColorAttachments=[],this.currentColorResolveTos=[],this.currentDepthStencilAttachment=void 0,this.currentDepthStencilResolveTo=null,this.currentSampleCount=-1,this.currentPipeline=void 0,this.currentInputState=void 0,this.currentMegaState=Eu(Ru),this.currentSamplers=[],this.currentTextures=[],this.currentUniformBuffers=[],this.currentUniformBufferByteOffsets=[],this.currentUniformBufferByteSizes=[],this.currentScissorEnabled=!1,this.currentStencilRef=null,this.currentRenderPassDescriptor=null,this.debugGroupStack=[],this.resolveColorAttachmentsChanged=!1,this.resolveColorReadFramebuffer=void 0,this.resolveColorDrawFramebuffer=void 0,this.resolveDepthStencilAttachmentsChanged=!1,this.resolveDepthStencilReadFramebuffer=void 0,this.resolveDepthStencilDrawFramebuffer=void 0,this.renderPassDrawFramebuffer=void 0,this.readbackFramebuffer=void 0,this.fallbackTexture2D=void 0,this.fallbackTexture2DDepth=void 0,this.fallbackTexture2DArray=void 0,this.fallbackTexture3D=void 0,this.fallbackTextureCube=void 0,this.platformString=void 0,this.glslVersion=void 0,this.explicitBindingLocations=!1,this.separateSamplerTextures=!1,this.viewportOrigin=0,this.clipSpaceNearZ=0,this.supportMRT=!1,this.uniformBufferMaxPageByteSize=void 0,this.uniformBufferWordAlignment=void 0,this.uniformBufferMaxPageWordSize=void 0,this.supportedSampleCounts=[],this.gl=void 0,this.gl=t,this.contextAttributes=tu(t.getContextAttributes()),lc(t)?(this.EXT_texture_norm16=t.getExtension("EXT_texture_norm16"),this.supportMRT=!0):(this.OES_vertex_array_object=t.getExtension("OES_vertex_array_object"),this.ANGLE_instanced_arrays=t.getExtension("ANGLE_instanced_arrays"),this.OES_texture_float=t.getExtension("OES_texture_float"),this.WEBGL_draw_buffers=t.getExtension("WEBGL_draw_buffers"),this.WEBGL_depth_texture=t.getExtension("WEBGL_depth_texture"),t.getExtension("EXT_frag_depth"),t.getExtension("OES_element_index_uint"),this.WEBGL_draw_buffers&&(this.supportMRT=!0)),this.WEBGL_compressed_texture_s3tc=t.getExtension("WEBGL_compressed_texture_s3tc"),this.WEBGL_compressed_texture_s3tc_srgb=t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),this.EXT_texture_compression_rgtc=t.getExtension("EXT_texture_compression_rgtc"),this.EXT_texture_filter_anisotropic=t.getExtension("EXT_texture_filter_anisotropic"),this.KHR_parallel_shader_compile=t.getExtension("KHR_parallel_shader_compile"),this.OES_draw_buffers_indexed=t.getExtension("OES_draw_buffers_indexed"),lc(t)?(this.platformString="WebGL2",this.glslVersion="#version 300 es"):(this.platformString="WebGL1",this.glslVersion="#version 100"),this.scTexture=new tl({id:this.getNextUniqueId(),device:this,descriptor:{width:0,height:0,depth:1,dimension:0,numLevels:1,usage:2,pixelFormat:!1===this.contextAttributes.alpha?ws.U8_RGB_RT:ws.U8_RGBA_RT},fake:!0}),this.scTexture.formatKind=0,this.scTexture.gl_target=null,this.scTexture.gl_texture=null,this.resolveColorReadFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.resolveColorDrawFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.resolveDepthStencilReadFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.resolveDepthStencilDrawFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.renderPassDrawFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.readbackFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.fallbackTexture2D=this.createFallbackTexture(0,0),this.fallbackTexture2DDepth=this.createFallbackTexture(0,3),lc(t),this.currentMegaState.depthCompare=ks.Less,this.currentMegaState.depthWrite=!1,this.currentMegaState.attachmentsState[0].channelWriteMask=15,t.enable(t.DEPTH_TEST),this.checkLimits(),n.shaderDebug&&(this.shaderDebug=!0),n.trackResources&&(this.resourceCreationTracker=new Jc)}return vs(e,[{key:"createFallbackTexture",value:function(e,t){var n=3===e?6:1,r=3===t?ws.D24:ws.U8_RGBA_NORM,i=this.createTexture({dimension:e,pixelFormat:r,usage:1,width:1,height:1,depth:n,numLevels:1,immutable:!0});return 0===t&&i.setImageData([new Uint8Array(4*n)],0),_c(i)}},{key:"getNextUniqueId",value:function(){return++this.resourceUniqueId}},{key:"checkLimits",value:function(){var e=this.gl;if(lc(e)){this.uniformBufferMaxPageByteSize=Math.min(e.getParameter(e.MAX_UNIFORM_BLOCK_SIZE),65536),this.uniformBufferWordAlignment=e.getParameter(e.UNIFORM_BUFFER_OFFSET_ALIGNMENT)/4;var t=e.getInternalformatParameter(e.RENDERBUFFER,e.DEPTH32F_STENCIL8,e.SAMPLES);this.supportedSampleCounts=t?Cs(t):[]}else this.uniformBufferWordAlignment=64,this.uniformBufferMaxPageByteSize=65536;this.uniformBufferMaxPageWordSize=this.uniformBufferMaxPageByteSize/4,this.supportedSampleCounts.includes(1)||this.supportedSampleCounts.push(1),this.supportedSampleCounts.sort((function(e,t){return e-t}))}},{key:"configureSwapChain",value:function(e,t,n){var r=this.scTexture;r.width=e,r.height=t,this.scPlatformFramebuffer=lu(n)}},{key:"getDevice",value:function(){return this}},{key:"getCanvas",value:function(){return this.gl.canvas}},{key:"getOnscreenTexture",value:function(){return this.scTexture}},{key:"present",value:function(){var e=this.gl;8!==this.currentMegaState.attachmentsState[0].channelWriteMask&&(e.colorMask(!1,!1,!1,!0),this.currentMegaState.attachmentsState[0].channelWriteMask=8);var t=su.r,n=su.g,r=su.b,i=su.a;lc(e)&&e.clearBufferfv(e.COLOR,0,[t,n,r,i])}},{key:"translateTextureInternalFormat",value:function(e){switch(e){case ws.ALPHA:return Xs.ALPHA;case ws.F16_RGBA:return Xs.RGBA16F;case ws.F32_R:return Xs.R32F;case ws.F32_RG:return Xs.RG32F;case ws.F32_RGB:return Xs.RGB32F;case ws.F32_RGBA:return Xs.RGBA32F;case ws.U8_R_NORM:return Xs.R8;case ws.U8_RG_NORM:return Xs.RG8;case ws.U8_RGB_NORM:case ws.U8_RGB_RT:return Xs.RGB8;case ws.U8_RGB_SRGB:return Xs.SRGB8;case ws.U8_RGBA_NORM:case ws.U8_RGBA_RT:return lc(this.gl)?Xs.RGBA8:Xs.RGBA;case ws.U8_RGBA_SRGB:case ws.U8_RGBA_RT_SRGB:return Xs.SRGB8_ALPHA8;case ws.U16_R:return Xs.R16UI;case ws.U16_R_NORM:return this.EXT_texture_norm16.R16_EXT;case ws.U16_RG_NORM:return this.EXT_texture_norm16.RG16_EXT;case ws.U16_RGBA_NORM:return this.EXT_texture_norm16.RGBA16_EXT;case ws.U16_RGBA_5551:return Xs.RGB5_A1;case ws.U32_R:return Xs.R32UI;case ws.S8_RGBA_NORM:return Xs.RGBA8_SNORM;case ws.S8_RG_NORM:return Xs.RG8_SNORM;case ws.U16_RGBA_5551:return Xs.UNSIGNED_SHORT_5_5_5_1;case ws.BC1:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT1_EXT;case ws.BC1_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case ws.BC2:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT3_EXT;case ws.BC2_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case ws.BC3:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT;case ws.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case ws.BC4_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_RGTC1_EXT;case ws.BC4_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_RGTC1_EXT;case ws.BC5_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_GREEN_RGTC2_EXT;case ws.BC5_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT;case ws.D32F_S8:return Xs.DEPTH32F_STENCIL8;case ws.D24_S8:return Xs.DEPTH24_STENCIL8;case ws.D32F:return Xs.DEPTH_COMPONENT32F;case ws.D24:return lc(this.gl)?Xs.DEPTH_COMPONENT24:Xs.DEPTH_COMPONENT;default:throw"whoops"}}},{key:"translateTextureType",value:function(e){switch(Ys(e)){case 1:return Xs.UNSIGNED_BYTE;case 2:return Xs.UNSIGNED_SHORT;case 3:return Xs.UNSIGNED_INT;case 4:return Xs.BYTE;case 7:return Xs.HALF_FLOAT;case 8:case 130:return Xs.FLOAT;case 97:return Xs.UNSIGNED_SHORT_5_5_5_1;case 129:return lc(this.gl)?Xs.UNSIGNED_INT_24_8:Xs.UNSIGNED_SHORT;case 131:return Xs.UNSIGNED_INT_24_8;case 132:return Xs.FLOAT_32_UNSIGNED_INT_24_8_REV;default:throw"whoops"}}},{key:"translateTextureFormat",value:function(e){if(hc(e))return this.translateTextureInternalFormat(e);switch(e){case ws.D24_S8:case ws.D32F_S8:return Xs.DEPTH_STENCIL;case ws.D24:case ws.D32F:return Xs.DEPTH_COMPONENT}var t=function(e){if(1&qs(e))return!1;var t=Ys(e);return 4===t||5===t||6===t||1===t||2===t||3===t}(e);switch(zs(e)){case 5:return Xs.ALPHA;case 1:return t?Xs.RED_INTEGER:Xs.RED;case 2:return t?Xs.RG_INTEGER:Xs.RG;case 3:return t?Xs.RGB_INTEGER:Xs.RGB;case 4:return Xs.RGBA}}},{key:"setActiveTexture",value:function(e){this.currentActiveTexture!==e&&(this.gl.activeTexture(e),this.currentActiveTexture=e)}},{key:"bindVAO",value:function(e){this.currentBoundVAO!==e&&(lc(this.gl)?this.gl.bindVertexArray(e):this.OES_vertex_array_object.bindVertexArrayOES(e),this.currentBoundVAO=e)}},{key:"programCompiled",value:function(e){eu(0!==e.compileState),1===e.compileState&&(e.compileState=2,this.shaderDebug&&this.checkProgramCompilationForErrors(e))}},{key:"useProgram",value:function(e){this.currentProgram!==e&&(this.programCompiled(e),this.gl.useProgram(e.gl_program),this.currentProgram=e)}},{key:"ensureResourceExists",value:function(e){if(null===e){var t=this.gl.getError();throw new Error("Created resource is null; GL error encountered: ".concat(t))}return e}},{key:"createBuffer",value:function(e){return new Ac({id:this.getNextUniqueId(),device:this,descriptor:e})}},{key:"createTexture",value:function(e){return new tl({id:this.getNextUniqueId(),device:this,descriptor:e})}},{key:"createSampler",value:function(e){return new el({id:this.getNextUniqueId(),device:this,descriptor:e})}},{key:"createRenderTarget",value:function(e){return new Qc({id:this.getNextUniqueId(),device:this,descriptor:e})}},{key:"createRenderTargetFromTexture",value:function(e){var t=e.pixelFormat,n=e.width,r=e.height;return eu(1===e.numLevels),this.createRenderTarget({pixelFormat:t,width:n,height:r,sampleCount:1,texture:e})}},{key:"createProgram",value:function(e){return e.ensurePreprocessed(this.queryVendorInfo()),this.createProgramSimple(e)}},{key:"createProgramSimple",value:function(e){return new xc({id:this.getNextUniqueId(),device:this,descriptor:e})}},{key:"createBindings",value:function(e){var t=e.bindingLayout,n=e.uniformBufferBindings,r=e.samplerBindings;return eu(n.length>=t.numUniformBuffers),eu(r.length>=t.numSamplers),new cc({id:this.getNextUniqueId(),device:this,descriptor:e})}},{key:"createInputLayout",value:function(e){return new Sc({id:this.getNextUniqueId(),device:this,descriptor:e})}},{key:"createInputState",value:function(e,t,n,r){var i=e;return new bc({id:this.getNextUniqueId(),device:this,inputLayout:i,vertexBuffers:t,indexBufferBinding:n,program:r})}},{key:"createRenderPipeline",value:function(e){return new $c({id:this.getNextUniqueId(),device:this,descriptor:e})}},{key:"createComputePass",value:function(e){throw new Error("Method not implemented.")}},{key:"createComputePipeline",value:function(e){throw new Error("Method not implemented.")}},{key:"createReadback",value:function(){return new Yc({id:this.getNextUniqueId(),device:this})}},{key:"createQueryPool",value:function(e,t){return new zc({id:this.getNextUniqueId(),device:this,descriptor:{type:e,elemCount:t}})}},{key:"createRenderPass",value:function(e){eu(null===this.currentRenderPassDescriptor),this.currentRenderPassDescriptor=e;var t=e.colorAttachment,n=e.colorClearColor,r=e.colorResolveTo,i=e.depthStencilAttachment,o=e.depthClearValue,a=e.stencilClearValue,s=e.depthStencilResolveTo;this.setRenderPassParametersBegin(t.length);for(var u=0;u<t.length;u++)this.setRenderPassParametersColor(u,t[u],r[u]);this.setRenderPassParametersDepthStencil(i,s),this.validateCurrentAttachments();for(var c=0;c<t.length;c++){var l=n[c];"load"!==l&&this.setRenderPassParametersClearColor(c,l.r,l.g,l.b,l.a)}return this.setRenderPassParametersClearDepthStencil(o,a),this}},{key:"submitPass",value:function(e){eu(null!==this.currentRenderPassDescriptor),this.endPass(),this.currentRenderPassDescriptor=null}},{key:"copySubTexture2D",value:function(e,t,n,r,i,o){var a=this.gl,s=e,u=r;eu(1===u.numLevels),eu(1===s.numLevels),lc(a)&&(s===this.scTexture?a.bindFramebuffer(a.DRAW_FRAMEBUFFER,this.scPlatformFramebuffer):(a.bindFramebuffer(a.DRAW_FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.bindFramebufferAttachment(a.DRAW_FRAMEBUFFER,a.COLOR_ATTACHMENT0,s)),a.bindFramebuffer(a.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.bindFramebufferAttachment(a.READ_FRAMEBUFFER,a.COLOR_ATTACHMENT0,u),a.blitFramebuffer(i,o,i+u.width,o+u.height,t,n,t+u.width,n+u.height,a.COLOR_BUFFER_BIT,a.LINEAR),a.bindFramebuffer(a.READ_FRAMEBUFFER,null),a.bindFramebuffer(a.DRAW_FRAMEBUFFER,null))}},{key:"queryLimits",value:function(){return this}},{key:"queryTextureFormatSupported",value:function(e){switch(e){case ws.BC1_SRGB:case ws.BC2_SRGB:case ws.BC3_SRGB:return null!==this.WEBGL_compressed_texture_s3tc_srgb;case ws.BC1:case ws.BC2:case ws.BC3:return null!==this.WEBGL_compressed_texture_s3tc;case ws.BC4_UNORM:case ws.BC4_SNORM:case ws.BC5_UNORM:case ws.BC5_SNORM:return null!==this.EXT_texture_compression_rgtc;default:return!0}}},{key:"queryProgramReady",value:function(e){var t,n=this.gl;if(0===e.compileState)throw"whoops";return 1===e.compileState?((t=null===this.KHR_parallel_shader_compile||n.getProgramParameter(e.gl_program,this.KHR_parallel_shader_compile.COMPLETION_STATUS_KHR))&&this.programCompiled(e),t):2===e.compileState||3===e.compileState}},{key:"queryPipelineReady",value:function(e){var t=e;return this.queryProgramReady(t.program)}},{key:"queryPlatformAvailable",value:function(){return this.gl.isContextLost()}},{key:"queryVendorInfo",value:function(){return this}},{key:"queryRenderPass",value:function(e){return this.currentRenderPassDescriptor}},{key:"queryRenderTarget",value:function(e){return e}},{key:"setResourceName",value:function(e,t){if(e.name=t,e.type===Ls.Buffer)for(var n=e.gl_buffer_pages,r=0;r<n.length;r++)mc(n[r],"".concat(t," Page ").concat(r));else if(e.type===Ls.Texture)mc(_c(e),t);else if(e.type===Ls.Sampler)mc(yc(e),t);else if(e.type===Ls.RenderTarget){var i=e.gl_renderbuffer;null!==i&&mc(i,t)}else e.type===Ls.InputState&&mc(e.vao,t)}},{key:"setResourceLeakCheck",value:function(e,t){null!==this.resourceCreationTracker&&this.resourceCreationTracker.setResourceLeakCheck(e,t)}},{key:"checkForLeaks",value:function(){null!==this.resourceCreationTracker&&this.resourceCreationTracker.checkForLeaks()}},{key:"pushDebugGroup",value:function(e){this.debugGroupStack.push(e)}},{key:"popDebugGroup",value:function(){this.debugGroupStack.pop()}},{key:"programPatched",value:function(e,t){eu(this.shaderDebug)}},{key:"getBufferData",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=this.gl;lc(r)&&(r.bindBuffer(r.COPY_READ_BUFFER,gc(e,4*n)),r.getBufferSubData(r.COPY_READ_BUFFER,4*n,t))}},{key:"debugGroupStatisticsDrawCall",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].drawCallCount+=e}},{key:"debugGroupStatisticsBufferUpload",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].bufferUploadCount+=e}},{key:"debugGroupStatisticsTextureBind",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].textureBindCount+=e}},{key:"debugGroupStatisticsTriangles",value:function(e){for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].triangleCount+=e}},{key:"reportShaderError",value:function(e,t){var n=this.gl,r=n.getShaderParameter(e,n.COMPILE_STATUS);if(!r){console.error(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e.split("\n").map((function(e,n){return"".concat(vu(""+(t+n),4," "),"  ").concat(e)})).join("\n")}(t));var i=n.getExtension("WEBGL_debug_shaders");i&&console.error(i.getTranslatedShaderSource(e)),console.error(n.getShaderInfoLog(e))}return r}},{key:"checkProgramCompilationForErrors",value:function(e){var t=this.gl,n=e.gl_program;if(!t.getProgramParameter(n,t.LINK_STATUS)){var r=e.descriptor;if(!this.reportShaderError(e.gl_shader_vert,r.preprocessedVert))return;if(!this.reportShaderError(e.gl_shader_frag,r.preprocessedFrag))return;console.error(t.getProgramInfoLog(e.gl_program))}}},{key:"bindFramebufferAttachment",value:function(e,t,n){var r=this.gl;null===n?r.framebufferRenderbuffer(e,t,r.RENDERBUFFER,null):n.type===Ls.RenderTarget?null!==n.gl_renderbuffer?r.framebufferRenderbuffer(e,t,r.RENDERBUFFER,n.gl_renderbuffer):null!==n.texture&&r.framebufferTexture2D(e,t,Xs.TEXTURE_2D,_c(n.texture),0):n.type===Ls.Texture&&r.framebufferTexture2D(e,t,Xs.TEXTURE_2D,_c(n),0)}},{key:"bindFramebufferDepthStencilAttachment",value:function(e,t){var n=this.gl,r=null!==t?qs(t.pixelFormat):12,i=!!(4&r),o=!!(8&r);i&&o?this.bindFramebufferAttachment(e,n.DEPTH_STENCIL_ATTACHMENT,t):i?(this.bindFramebufferAttachment(e,n.DEPTH_ATTACHMENT,t),this.bindFramebufferAttachment(e,n.STENCIL_ATTACHMENT,null)):o&&(this.bindFramebufferAttachment(e,n.STENCIL_ATTACHMENT,t),this.bindFramebufferAttachment(e,n.DEPTH_ATTACHMENT,null))}},{key:"validateCurrentAttachments",value:function(){for(var e=-1,t=-1,n=-1,r=0;r<this.currentColorAttachments.length;r++){var i=this.currentColorAttachments[r];null!==i&&(-1===e?(e=i.sampleCount,t=i.width,n=i.height):(eu(e===i.sampleCount),eu(t===i.width),eu(n===i.height)))}null!==this.currentDepthStencilAttachment&&(-1===e?(e=this.currentDepthStencilAttachment.sampleCount,t=this.currentDepthStencilAttachment.width,n=this.currentDepthStencilAttachment.height):(eu(e===this.currentDepthStencilAttachment.sampleCount),eu(t===this.currentDepthStencilAttachment.width),eu(n===this.currentDepthStencilAttachment.height))),this.currentSampleCount=e}},{key:"setRenderPassParametersBegin",value:function(e){var t=this.gl;lc(t)?t.bindFramebuffer(Xs.DRAW_FRAMEBUFFER,this.renderPassDrawFramebuffer):t.bindFramebuffer(Xs.FRAMEBUFFER,this.renderPassDrawFramebuffer);for(var n=e;n<this.currentColorAttachments.length;n++){var r=lc(t)?Xs.DRAW_FRAMEBUFFER:Xs.FRAMEBUFFER,i=lc(t)?Xs.COLOR_ATTACHMENT0:Xs.COLOR_ATTACHMENT0_WEBGL;t.framebufferRenderbuffer(r,i+n,Xs.RENDERBUFFER,null),t.framebufferTexture2D(r,i+n,Xs.TEXTURE_2D,null,0)}this.currentColorAttachments.length=e,lc(t)?t.drawBuffers([Xs.COLOR_ATTACHMENT0,Xs.COLOR_ATTACHMENT1,Xs.COLOR_ATTACHMENT2,Xs.COLOR_ATTACHMENT3]):this.WEBGL_draw_buffers.drawBuffersWEBGL([Xs.COLOR_ATTACHMENT0_WEBGL,Xs.COLOR_ATTACHMENT1_WEBGL,Xs.COLOR_ATTACHMENT2_WEBGL,Xs.COLOR_ATTACHMENT3_WEBGL])}},{key:"setRenderPassParametersColor",value:function(e,t,n){var r=this.gl;this.currentColorAttachments[e]!==t&&(this.currentColorAttachments[e]=t,this.bindFramebufferAttachment(lc(r)?Xs.DRAW_FRAMEBUFFER:Xs.FRAMEBUFFER,(lc(r)?Xs.COLOR_ATTACHMENT0:Xs.COLOR_ATTACHMENT0_WEBGL)+e,t),this.resolveColorAttachmentsChanged=!0),this.currentColorResolveTos[e]!==n&&(this.currentColorResolveTos[e]=n,null!==n&&(this.resolveColorAttachmentsChanged=!0))}},{key:"setRenderPassParametersDepthStencil",value:function(e,t){var n=this.gl;this.currentDepthStencilAttachment!==e&&(this.currentDepthStencilAttachment=e,this.bindFramebufferDepthStencilAttachment(lc(n)?Xs.DRAW_FRAMEBUFFER:Xs.FRAMEBUFFER,this.currentDepthStencilAttachment),this.resolveDepthStencilAttachmentsChanged=!0),this.currentDepthStencilResolveTo!==t&&(this.currentDepthStencilResolveTo=t,null!==t&&(this.resolveDepthStencilAttachmentsChanged=!0))}},{key:"setRenderPassParametersClearColor",value:function(e,t,n,r,i){var o=this.gl;if(null!==this.OES_draw_buffers_indexed){var a=this.currentMegaState.attachmentsState[e];15!==a.channelWriteMask&&(this.OES_draw_buffers_indexed.colorMaskiOES(e,!0,!0,!0,!0),a.channelWriteMask=15)}else{var s=this.currentMegaState.attachmentsState[0];15!==s.channelWriteMask&&(o.colorMask(!0,!0,!0,!0),s.channelWriteMask=15)}this.setScissorEnabled(!1),lc(o)?o.clearBufferfv(o.COLOR,e,[t,n,r,i]):(o.clearColor(t,n,r,i),o.clear(o.COLOR_BUFFER_BIT))}},{key:"setRenderPassParametersClearDepthStencil",value:function(e,t){var n=this.gl;"load"!==e&&(eu(null!==this.currentDepthStencilAttachment),this.currentMegaState.depthWrite||(n.depthMask(!0),this.currentMegaState.depthWrite=!0),lc(n)?n.clearBufferfv(n.DEPTH,0,[e]):(n.clearDepth(e),n.clear(n.DEPTH_BUFFER_BIT))),"load"!==t&&(eu(null!==this.currentDepthStencilAttachment),this.currentMegaState.stencilWrite||(n.stencilMask(255),this.currentMegaState.stencilWrite=!0),lc(n)?n.clearBufferiv(n.STENCIL,0,[t]):(n.clearStencil(t),n.clear(n.STENCIL_BUFFER_BIT)))}},{key:"setBindings",value:function(e,t,n){var r=this.gl;eu(e<this.currentPipeline.bindingLayouts.bindingLayoutTables.length);var i=this.currentPipeline.bindingLayouts.bindingLayoutTables[e],o=t.uniformBufferBindings,a=t.samplerBindings;eu(o.length>=i.numUniformBuffers),eu(a.length>=i.numSamplers),eu(n.length>=o.length);for(var s=0;s<o.length;s++){var u=o[s];if(0!==u.wordCount){var c=i.firstUniformBuffer+s,l=u.buffer,h=n[s],f=4*u.wordCount;if(l!==this.currentUniformBuffers[c]||h!==this.currentUniformBufferByteOffsets[c]||f!==this.currentUniformBufferByteSizes[c]){var d=h%l.pageByteSize,p=l.gl_buffer_pages[h/l.pageByteSize|0];eu(d+f<=l.pageByteSize),lc(r)&&r.bindBufferRange(r.UNIFORM_BUFFER,c,p,d,f),this.currentUniformBuffers[c]=l,this.currentUniformBufferByteOffsets[c]=h,this.currentUniformBufferByteSizes[c]=f}}}for(var v=0;v<i.numSamplers;v++){var g=a[v],_=i.firstSampler+v,y=i.samplerEntries[v],m=null!==g&&null!==g.sampler?yc(g.sampler):null,E=null!==g&&null!==g.texture?_c(g.texture):null;if(this.currentSamplers[_]!==m&&(lc(r)&&r.bindSampler(_,m),this.currentSamplers[_]=m),this.currentTextures[_]!==E){if(this.setActiveTexture(r.TEXTURE0+_),null!==E){var T,R=tu(g).texture,A=R.gl_target;R.formatKind,r.bindTexture(A,E),lc(r)||null===(T=g.sampler)||void 0===T||T.setTextureParameters(A,E),this.debugGroupStatisticsTextureBind(),eu(y.gl_target===A)}else r.bindTexture(y.gl_target,this.getFallbackTexture(y));this.currentTextures[_]=E}}}},{key:"setViewport",value:function(e,t,n,r){this.gl.viewport(e,t,n,r)}},{key:"setScissor",value:function(e,t,n,r){var i=this.gl;this.setScissorEnabled(!0),i.scissor(e,t,n,r)}},{key:"applyAttachmentStateIndexed",value:function(e,t,n){var r=this.gl,i=this.OES_draw_buffers_indexed;t.channelWriteMask!==n.channelWriteMask&&(i.colorMaskiOES(e,!!(1&n.channelWriteMask),!!(2&n.channelWriteMask),!!(4&n.channelWriteMask),!!(8&n.channelWriteMask)),t.channelWriteMask=n.channelWriteMask);var o=t.rgbBlendState.blendMode!==n.rgbBlendState.blendMode||t.alphaBlendState.blendMode!==n.alphaBlendState.blendMode,a=t.rgbBlendState.blendSrcFactor!==n.rgbBlendState.blendSrcFactor||t.alphaBlendState.blendSrcFactor!==n.alphaBlendState.blendSrcFactor||t.rgbBlendState.blendDstFactor!==n.rgbBlendState.blendDstFactor||t.alphaBlendState.blendDstFactor!==n.alphaBlendState.blendDstFactor;(a||o)&&(Tc(t.rgbBlendState)&&Tc(t.alphaBlendState)?i.enableiOES(e,r.BLEND):Tc(n.rgbBlendState)&&Tc(n.alphaBlendState)&&i.disableiOES(e,r.BLEND)),o&&(i.blendEquationSeparateiOES(e,n.rgbBlendState.blendMode,n.alphaBlendState.blendMode),t.rgbBlendState.blendMode=n.rgbBlendState.blendMode,t.alphaBlendState.blendMode=n.alphaBlendState.blendMode),a&&(i.blendFuncSeparateiOES(e,n.rgbBlendState.blendSrcFactor,n.rgbBlendState.blendDstFactor,n.alphaBlendState.blendSrcFactor,n.alphaBlendState.blendDstFactor),t.rgbBlendState.blendSrcFactor=n.rgbBlendState.blendSrcFactor,t.alphaBlendState.blendSrcFactor=n.alphaBlendState.blendSrcFactor,t.rgbBlendState.blendDstFactor=n.rgbBlendState.blendDstFactor,t.alphaBlendState.blendDstFactor=n.alphaBlendState.blendDstFactor)}},{key:"applyAttachmentState",value:function(e,t){var n=this.gl;e.channelWriteMask!==t.channelWriteMask&&(n.colorMask(!!(1&t.channelWriteMask),!!(2&t.channelWriteMask),!!(4&t.channelWriteMask),!!(8&t.channelWriteMask)),e.channelWriteMask=t.channelWriteMask);var r=e.rgbBlendState.blendMode!==t.rgbBlendState.blendMode||e.alphaBlendState.blendMode!==t.alphaBlendState.blendMode,i=e.rgbBlendState.blendSrcFactor!==t.rgbBlendState.blendSrcFactor||e.alphaBlendState.blendSrcFactor!==t.alphaBlendState.blendSrcFactor||e.rgbBlendState.blendDstFactor!==t.rgbBlendState.blendDstFactor||e.alphaBlendState.blendDstFactor!==t.alphaBlendState.blendDstFactor;(i||r)&&(Tc(e.rgbBlendState)&&Tc(e.alphaBlendState)?n.enable(n.BLEND):Tc(t.rgbBlendState)&&Tc(t.alphaBlendState)&&n.disable(n.BLEND)),r&&(n.blendEquationSeparate(t.rgbBlendState.blendMode,t.alphaBlendState.blendMode),e.rgbBlendState.blendMode=t.rgbBlendState.blendMode,e.alphaBlendState.blendMode=t.alphaBlendState.blendMode),i&&(n.blendFuncSeparate(t.rgbBlendState.blendSrcFactor,t.rgbBlendState.blendDstFactor,t.alphaBlendState.blendSrcFactor,t.alphaBlendState.blendDstFactor),e.rgbBlendState.blendSrcFactor=t.rgbBlendState.blendSrcFactor,e.alphaBlendState.blendSrcFactor=t.alphaBlendState.blendSrcFactor,e.rgbBlendState.blendDstFactor=t.rgbBlendState.blendDstFactor,e.alphaBlendState.blendDstFactor=t.alphaBlendState.blendDstFactor)}},{key:"setMegaState",value:function(e){var t=this.gl,n=this.currentMegaState;if(null!==this.OES_draw_buffers_indexed)for(var r=0;r<e.attachmentsState.length;r++)this.applyAttachmentStateIndexed(r,n.attachmentsState[0],e.attachmentsState[0]);else eu(1===e.attachmentsState.length),this.applyAttachmentState(n.attachmentsState[0],e.attachmentsState[0]);if(nu(n.blendConstant,e.blendConstant)||(t.blendColor(e.blendConstant.r,e.blendConstant.g,e.blendConstant.b,e.blendConstant.a),ru(n.blendConstant,e.blendConstant)),n.depthCompare!==e.depthCompare&&(t.depthFunc(e.depthCompare),n.depthCompare=e.depthCompare),n.depthWrite!==e.depthWrite&&(t.depthMask(e.depthWrite),n.depthWrite=e.depthWrite),n.stencilCompare!==e.stencilCompare){var i=t.getParameter(t.STENCIL_REF);t.stencilFunc(e.stencilCompare,i,255),n.stencilCompare=e.stencilCompare}n.stencilWrite!==e.stencilWrite&&(t.stencilMask(e.stencilWrite?255:0),n.stencilWrite=e.stencilWrite),n.stencilWrite&&n.stencilPassOp!==e.stencilPassOp&&(t.stencilOp(t.KEEP,t.KEEP,e.stencilPassOp),n.stencilPassOp=e.stencilPassOp),n.cullMode!==e.cullMode&&(0===n.cullMode?t.enable(t.CULL_FACE):0===e.cullMode&&t.disable(t.CULL_FACE),2===e.cullMode?t.cullFace(t.BACK):1===e.cullMode?t.cullFace(t.FRONT):3===e.cullMode&&t.cullFace(t.FRONT_AND_BACK),n.cullMode=e.cullMode),n.frontFace!==e.frontFace&&(t.frontFace(e.frontFace),n.frontFace=e.frontFace),n.polygonOffset!==e.polygonOffset&&(e.polygonOffset?(t.polygonOffset(1,1),t.enable(t.POLYGON_OFFSET_FILL)):t.disable(t.POLYGON_OFFSET_FILL),n.polygonOffset=e.polygonOffset)}},{key:"validatePipelineFormats",value:function(e){for(var t=0;t<this.currentColorAttachments.length;t++){var n=this.currentColorAttachments[t];null!==n&&eu(n.pixelFormat===e.colorAttachmentFormats[t])}null!==this.currentDepthStencilAttachment&&eu(this.currentDepthStencilAttachment.pixelFormat===e.depthStencilAttachmentFormat),-1!==this.currentSampleCount&&eu(this.currentSampleCount===e.sampleCount)}},{key:"setPipeline",value:function(e){this.currentPipeline=e,this.validatePipelineFormats(this.currentPipeline),this.setMegaState(this.currentPipeline.megaState);var t=this.currentPipeline.program;if(this.useProgram(t),2===t.compileState){var n=this.gl,r=t.gl_program,i=t.descriptor,o=Ec(i.preprocessedVert,/uniform (\w+) {([^]*?)}/g);if(lc(n))for(var a=0;a<o.length;a++){var s=xs(o[a],3),u=(s[0],s[1]),c=(s[2],n.getUniformBlockIndex(r,u));-1!==c&&4294967295!==c&&n.uniformBlockBinding(r,c,a)}for(var l=Ec(i.preprocessedVert,/^uniform .*sampler\S+ (\w+);\s* \/\/ BINDING=(\d+)$/gm),h=0;h<l.length;h++){var f=xs(l[h],3),d=(f[0],f[1]),p=f[2],v=n.getUniformLocation(r,d);n.uniform1i(v,parseInt(p))}t.compileState=3}}},{key:"setInputState",value:function(e){var t=e;this.currentInputState=t,null!==this.currentInputState?(eu(this.currentPipeline.inputLayout===this.currentInputState.inputLayout),this.bindVAO(this.currentInputState.vao)):(eu(null===this.currentPipeline.inputLayout),this.bindVAO(null))}},{key:"setStencilRef",value:function(e){this.currentStencilRef=e,this.applyStencil(),this.gl.stencilFunc(this.currentMegaState.stencilCompare,e,255)}},{key:"draw",value:function(e,t){var n=this.gl,r=this.currentPipeline;n.drawArrays(r.drawMode,t,e),this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(e/3)}},{key:"drawIndexed",value:function(e,t){var n=this.gl,r=this.currentPipeline,i=this.currentInputState,o=tu(i.indexBufferByteOffset)+t*tu(i.indexBufferCompByteSize);n.drawElements(r.drawMode,e,tu(i.indexBufferType),o),this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(e/3)}},{key:"drawIndexedInstanced",value:function(e,t,n){var r,i=this.gl,o=this.currentPipeline,a=this.currentInputState,s=tu(a.indexBufferByteOffset)+t*tu(a.indexBufferCompByteSize),u=[o.drawMode,e,tu(a.indexBufferType),s,n];lc(i)?i.drawElementsInstanced.apply(i,u):(r=this.ANGLE_instanced_arrays).drawElementsInstancedANGLE.apply(r,u),this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(e/3*n)}},{key:"beginOcclusionQuery",value:function(e){var t=this.gl;if(lc(t)){var n=this.currentRenderPassDescriptor.occlusionQueryPool;t.beginQuery(n.gl_query_type,n.gl_query[e])}}},{key:"endOcclusionQuery",value:function(e){var t=this.gl;if(lc(t)){var n=this.currentRenderPassDescriptor.occlusionQueryPool;t.endQuery(n.gl_query_type)}}},{key:"beginDebugGroup",value:function(e){}},{key:"endDebugGroup",value:function(){}},{key:"pipelineQueryReady",value:function(e){var t=e;return this.queryProgramReady(t.program)}},{key:"pipelineForceReady",value:function(e){}},{key:"endPass",value:function(){for(var e=this.gl,t=!1,n=0;n<this.currentColorAttachments.length;n++){var r=this.currentColorResolveTos[n];if(null!==r){var i=tu(this.currentColorAttachments[n]);eu(i.width===r.width&&i.height===r.height),eu(i.pixelFormat===r.pixelFormat),e.disable(Xs.SCISSOR_TEST),lc(e)&&e.bindFramebuffer(Xs.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),r===this.scTexture?(e.bindFramebuffer(lc(e)?Xs.DRAW_FRAMEBUFFER:Xs.FRAMEBUFFER,this.scPlatformFramebuffer),this.resolveColorAttachmentsChanged&&lc(e)&&this.bindFramebufferAttachment(Xs.READ_FRAMEBUFFER,Xs.COLOR_ATTACHMENT0,i),lc(e)?e.blitFramebuffer(0,0,i.width,i.height,0,0,r.width,r.height,Xs.COLOR_BUFFER_BIT,Xs.LINEAR):e.bindTexture(Xs.TEXTURE_2D,i.texture.gl_texture),t=!0):(e.bindFramebuffer(lc(e)?Xs.DRAW_FRAMEBUFFER:Xs.FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.resolveColorAttachmentsChanged&&(this.bindFramebufferAttachment(lc(e)?Xs.READ_FRAMEBUFFER:Xs.FRAMEBUFFER,lc(e)?Xs.COLOR_ATTACHMENT0:Xs.COLOR_ATTACHMENT0_WEBGL,i),e.framebufferTexture2D(lc(e)?Xs.DRAW_FRAMEBUFFER:Xs.FRAMEBUFFER,lc(e)?Xs.COLOR_ATTACHMENT0:Xs.COLOR_ATTACHMENT0_WEBGL,Xs.TEXTURE_2D,r.gl_texture,0)),lc(e)&&e.blitFramebuffer(0,0,i.width,i.height,0,0,r.width,r.height,e.COLOR_BUFFER_BIT,e.LINEAR),e.bindFramebuffer(lc(e)?Xs.DRAW_FRAMEBUFFER:Xs.FRAMEBUFFER,null),t=!0),lc(e)&&e.bindFramebuffer(Xs.READ_FRAMEBUFFER,null)}}this.resolveColorAttachmentsChanged=!1;var o=this.currentDepthStencilAttachment,a=this.currentDepthStencilResolveTo;null!==o&&null!==a&&(eu(o.width===a.width&&o.height===a.height),e.disable(e.SCISSOR_TEST),e.bindFramebuffer(lc(e)?Xs.READ_FRAMEBUFFER:Xs.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),e.bindFramebuffer(lc(e)?Xs.DRAW_FRAMEBUFFER:Xs.FRAMEBUFFER,this.resolveDepthStencilDrawFramebuffer),this.resolveDepthStencilAttachmentsChanged&&(this.bindFramebufferDepthStencilAttachment(lc(e)?Xs.READ_FRAMEBUFFER:Xs.FRAMEBUFFER,o),this.bindFramebufferDepthStencilAttachment(lc(e)?Xs.DRAW_FRAMEBUFFER:Xs.FRAMEBUFFER,a)),lc(e)&&e.blitFramebuffer(0,0,o.width,o.height,0,0,a.width,a.height,e.DEPTH_BUFFER_BIT,e.NEAREST),e.bindFramebuffer(lc(e)?Xs.READ_FRAMEBUFFER:Xs.FRAMEBUFFER,null),e.bindFramebuffer(lc(e)?Xs.DRAW_FRAMEBUFFER:Xs.FRAMEBUFFER,null),t=!0),this.resolveDepthStencilAttachmentsChanged=!1,t||e.bindFramebuffer(lc(e)?Xs.DRAW_FRAMEBUFFER:Xs.FRAMEBUFFER,null)}},{key:"setScissorEnabled",value:function(e){if(this.currentScissorEnabled!==e){var t=this.gl;e?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST),this.currentScissorEnabled=e}}},{key:"applyStencil",value:function(){null!==this.currentStencilRef&&this.gl.stencilFunc(this.currentMegaState.stencilCompare,this.currentStencilRef,255)}},{key:"getFallbackTexture",value:function(e){var t=e.gl_target,n=e.formatKind;if(t===Xs.TEXTURE_2D)return 3===n?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(t===Xs.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(t===Xs.TEXTURE_3D)return this.fallbackTexture3D;if(t===Xs.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw"whoops"}}]),e}();function rl(e){return void 0!==e.byteLength}var il=function(e){_s(n,e);var t=As(n);function n(e){var r,i=e.id,o=e.device,a=e.descriptor;ds(this,n),(r=t.call(this,{id:i,device:o})).type=Ls.Buffer,r.gpuBuffer=void 0,r.size=void 0,r.view=void 0,r.usage=void 0,r.flags=void 0;var s=a.usage,u=a.flags,c=a.viewOrSize,l=rl(c)?c.byteLength+3&-4:c+3&-4;return r.usage=function(e){if(1===e)return 16;if(2===e)return 32;if(3===e)return 64;if(4===e)return 128;throw"whoops"}(s),r.usage|=GPUBufferUsage.COPY_DST,r.flags=r.usage|u,r.size=rl(c)?c.byteLength:c,r.view=rl(c)?c:null,r.gpuBuffer=r.device.device.createBuffer({usage:r.flags,size:l}),rl(c)&&r.setSubData(0,c),r}return vs(n,[{key:"setSubData",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=this.gpuBuffer;r=r||t.byteLength,r=Math.min(r,this.size-e);var o=t.byteOffset+n,a=o+r,s=r+3&-4;if(s!==r){var u=new Uint8Array(t.buffer.slice(o,a));(t=new Uint8Array(s)).set(u),n=0,o=0,a=s,r=s}for(var c=15728640,l=0;a-(o+l)>c;)this.device.device.queue.writeBuffer(i,e+l,t.buffer,o+l,c),l+=c;this.device.device.queue.writeBuffer(i,e+l,t.buffer,o+l,r-l)}},{key:"destroy",value:function(){bs(ys(n.prototype),"destroy",this).call(this),this.gpuBuffer.destroy()}}]),n}(qc),ol=function(e){_s(n,e);var t=As(n);function n(e){var r,i=e.id,o=e.device,a=e.descriptor;ds(this,n),(r=t.call(this,{id:i,device:o})).type=Ls.InputLayout,r.buffers=void 0,r.indexFormat=void 0;for(var s=[],u=0;u<a.vertexBufferDescriptors.length;u++){var c=a.vertexBufferDescriptors[u];if(null!==c){var l=c.byteStride,h=Xc(c.frequency);s[u]={arrayStride:l,stepMode:h,attributes:[]}}}for(var f=0;f<a.vertexAttributeDescriptors.length;f++){var d=a.vertexAttributeDescriptors[f],p=tu(s[d.bufferIndex]),v={shaderLocation:d.location,format:Hc(d.format),offset:d.bufferByteOffset};p.attributes.push(v)}return r.indexFormat=function(e){if(null!==e){if(e===ws.U16_R)return"uint16";if(e===ws.U32_R)return"uint32";throw"whoops"}}(a.indexBufferFormat),r.buffers=s,r}return n}(qc),al=function(e){_s(n,e);var t=As(n);function n(e){var r,i=e.id,o=e.device,a=e.descriptor;return ds(this,n),(r=t.call(this,{id:i,device:o})).type=Ls.Program,r.descriptor=void 0,r.vertexStage=null,r.fragmentStage=null,r.computeStage=null,r.descriptor=a,a.preprocessedVert&&(r.vertexStage=r.createShaderStage(a.preprocessedVert,"vertex")),a.preprocessedFrag&&(r.fragmentStage=r.createShaderStage(a.preprocessedFrag,"fragment")),a.preprocessedCompute&&(r.computeStage=r.createShaderStage(a.preprocessedCompute,"compute")),r}return vs(n,[{key:"createShaderStage",value:function(e,t){var n=e;if("compute"!==t)try{n=this.device.glsl_compile(e,t,!1)}catch(t){throw console.error(t,e),"whoops"}for(var r=function(){var e=o[i];if(!n.includes(e))return"continue";n=(n=n.replace("var T_".concat(e,": texture_2d<f32>;"),"var T_".concat(e,": texture_depth_2d;"))).replace(new RegExp("textureSample\\(T_".concat(e,"(.*)\\);$"),"gm"),(function(t,n){return"vec4<f32>(textureSample(T_".concat(e).concat(n,"), 0.0, 0.0, 0.0);")}))},i=0,o=["u_TextureFramebufferDepth"];i<o.length;i++)r();return{module:this.device.device.createShaderModule({code:n}),entryPoint:"main"}}}]),n}(qc),sl=function(){function e(){ds(this,e),this.commandEncoder=null,this.descriptor=void 0,this.gpuRenderPassEncoder=null,this.gpuRenderPassDescriptor=void 0,this.gpuColorAttachments=void 0,this.gpuDepthStencilAttachment=void 0,this.gfxColorAttachment=[],this.gfxColorResolveTo=[],this.gfxDepthStencilAttachment=null,this.gfxDepthStencilResolveTo=null,this.gpuColorAttachments=[],this.gpuDepthStencilAttachment={view:null,depthLoadValue:"load",depthStoreOp:"store",stencilLoadValue:"load",stencilStoreOp:"store"},this.gpuRenderPassDescriptor={colorAttachments:this.gpuColorAttachments,depthStencilAttachment:this.gpuDepthStencilAttachment}}return vs(e,[{key:"setRenderPassDescriptor",value:function(e){this.descriptor=e,this.gpuRenderPassDescriptor.colorAttachments=this.gpuColorAttachments;var t=e.colorAttachment.length;this.gfxColorAttachment.length=t,this.gfxColorResolveTo.length=t;for(var n=0;n<e.colorAttachment.length;n++){var r=e.colorAttachment[n],i=e.colorResolveTo[n];if(null===r&&null!==i&&(r=i,i=null),this.gfxColorAttachment[n]=r,this.gfxColorResolveTo[n]=i,null===r){this.gpuColorAttachments.length=n,this.gfxColorAttachment.length=n,this.gfxColorResolveTo.length=n;break}void 0===this.gpuColorAttachments[n]&&(this.gpuColorAttachments[n]={});var o=this.gpuColorAttachments[n];o.view=r.gpuTextureView,o.loadValue=e.colorClearColor[n],o.storeOp=e.colorStore[n]?"store":"discard",o.resolveTarget=void 0,null!==i&&(r.sampleCount>1?o.resolveTarget=i.gpuTextureView:o.storeOp="store")}if(this.gfxDepthStencilAttachment=e.depthStencilAttachment,this.gfxDepthStencilResolveTo=e.depthStencilResolveTo,null!==e.depthStencilAttachment){var a=e.depthStencilAttachment,s=this.gpuDepthStencilAttachment;s.view=a.gpuTextureView,s.depthLoadValue=e.depthClearValue,s.stencilLoadValue=e.stencilClearValue,s.depthStoreOp=e.depthStencilStore?"store":"discard",s.stencilStoreOp=e.depthStencilStore?"store":"discard",this.gpuRenderPassDescriptor.depthStencilAttachment=this.gpuDepthStencilAttachment,null!==this.gfxDepthStencilResolveTo&&(s.depthStoreOp="store",s.stencilStoreOp="store")}else this.gpuRenderPassDescriptor.depthStencilAttachment=void 0;this.gpuRenderPassDescriptor.occlusionQuerySet=null!==e.occlusionQueryPool?Dc(e.occlusionQueryPool):void 0}},{key:"beginRenderPass",value:function(e){eu(null===this.gpuRenderPassEncoder),this.setRenderPassDescriptor(e),this.gpuRenderPassEncoder=this.commandEncoder.beginRenderPass(this.gpuRenderPassDescriptor)}},{key:"setViewport",value:function(e,t,n,r){this.gpuRenderPassEncoder.setViewport(e,t,n,r,0,1)}},{key:"setScissor",value:function(e,t,n,r){this.gpuRenderPassEncoder.setScissorRect(e,t,n,r)}},{key:"setPipeline",value:function(e){var t=tu(e.gpuRenderPipeline);this.gpuRenderPassEncoder.setPipeline(t)}},{key:"setInputState",value:function(e){if(null!==e){var t=e;if(null!==t.indexBuffer){var n=t.inputLayout,r=t.indexBuffer;this.gpuRenderPassEncoder.setIndexBuffer(Ic(r.buffer),tu(n.indexFormat),r.byteOffset)}for(var i=0;i<t.vertexBuffers.length;i++){var o=t.vertexBuffers[i];null!==o&&this.gpuRenderPassEncoder.setVertexBuffer(i,Ic(o.buffer),o.byteOffset)}}}},{key:"setBindings",value:function(e,t,n){var r=t;this.gpuRenderPassEncoder.setBindGroup(e+0,r.gpuBindGroup[0],n.slice(0,r.bindingLayout.numUniformBuffers)),this.gpuRenderPassEncoder.setBindGroup(e+1,r.gpuBindGroup[1])}},{key:"setStencilRef",value:function(e){this.gpuRenderPassEncoder.setStencilReference(e)}},{key:"draw",value:function(e,t){this.gpuRenderPassEncoder.draw(e,1,t,0)}},{key:"drawIndexed",value:function(e,t){this.gpuRenderPassEncoder.drawIndexed(e,1,t,0,0)}},{key:"drawIndexedInstanced",value:function(e,t,n){this.gpuRenderPassEncoder.drawIndexed(e,n,t,0,0)}},{key:"beginOcclusionQuery",value:function(e){this.gpuRenderPassEncoder.beginOcclusionQuery(e)}},{key:"endOcclusionQuery",value:function(e){this.gpuRenderPassEncoder.endOcclusionQuery()}},{key:"beginDebugGroup",value:function(e){void 0!==this.gpuRenderPassEncoder.pushDebugGroup&&this.gpuRenderPassEncoder.pushDebugGroup(e)}},{key:"endDebugGroup",value:function(){void 0!==this.gpuRenderPassEncoder.popDebugGroup&&this.gpuRenderPassEncoder.popDebugGroup()}},{key:"finish",value:function(){this.gpuRenderPassEncoder.endPass(),this.gpuRenderPassEncoder=null;for(var e=0;e<this.gfxColorAttachment.length;e++){var t=this.gfxColorAttachment[e],n=this.gfxColorResolveTo[e];null!==t&&null!==n&&1===t.sampleCount&&this.copyAttachment(n,t)}return null!==this.gfxDepthStencilAttachment&&null!==this.gfxDepthStencilResolveTo&&(this.gfxDepthStencilAttachment.sampleCount>1||this.copyAttachment(this.gfxDepthStencilResolveTo,this.gfxDepthStencilAttachment)),this.commandEncoder.finish()}},{key:"copyAttachment",value:function(e,t){eu(1===t.sampleCount);var n={texture:t.gpuTexture},r={texture:e.gpuTexture};eu(t.width===e.width),eu(t.height===e.height),eu(!!(1&t.usage)),eu(!!(2&e.usage)),this.commandEncoder.copyTextureToTexture(n,r,[e.width,e.height,1])}}]),e}(),ul=function(e){_s(n,e);var t=As(n);function n(e){var r,i,o,a=e.id,s=e.device,u=e.descriptor;ds(this,n),(o=t.call(this,{id:a,device:s})).type=Ls.Sampler,o.gpuSampler=void 0;var c=u.minLOD,l=0===u.mipFilter?u.minLOD:u.maxLOD,h=null!==(r=u.maxAnisotropy)&&void 0!==r?r:1;return h>1&&eu(1===u.minFilter&&1===u.magFilter&&2===u.mipFilter),o.gpuSampler=o.device.device.createSampler({addressModeU:Mc(u.wrapS),addressModeV:Mc(u.wrapT),addressModeW:Mc(null!==(i=u.wrapQ)&&void 0!==i?i:u.wrapS),lodMinClamp:c,lodMaxClamp:l,minFilter:Pc(u.minFilter),magFilter:Pc(u.magFilter),mipmapFilter:Nc(u.mipFilter),maxAnisotropy:h}),o}return n}(qc),cl=function(e){_s(n,e);var t=As(n);function n(e){var r,i=e.id,o=e.device,a=e.descriptor,s=e.skipCreate;return ds(this,n),(r=t.call(this,{id:i,device:o})).type=Ls.Texture,r.pixelFormat=void 0,r.dimension=void 0,r.format=void 0,r.width=void 0,r.height=void 0,r.depthOrArrayLayers=void 0,r.numLevels=void 0,r.sampleCount=void 0,r.usage=void 0,r.gpuTexture=void 0,r.gpuTextureView=void 0,r.device.createTextureShared({pixelFormat:a.pixelFormat,dimension:a.dimension,width:a.width,height:a.height,depthOrArrayLayers:a.depth,numLevels:a.numLevels,usage:a.usage,sampleCount:1},Ts(r),s),r}return vs(n,[{key:"setImageData",value:function(e,t){}},{key:"destroy",value:function(){this.gpuTexture.destroy()}}]),n}(qc),ll=function(e){_s(n,e);var t=As(n);function n(e){var r,i=e.id,o=e.device,a=e.inputLayout,s=e.vertexBuffers,u=e.indexBuffer;return ds(this,n),(r=t.call(this,{id:i,device:o})).type=Ls.InputState,r.inputLayout=void 0,r.vertexBuffers=void 0,r.indexBuffer=void 0,r.inputLayout=a,r.vertexBuffers=s,r.indexBuffer=u,r}return n}(qc),hl=function(e){_s(n,e);var t=As(n);function n(e){var r,i=e.id,o=e.device,a=e.descriptor;return ds(this,n),(r=t.call(this,{id:i,device:o})).type=Ls.RenderPipeline,r.descriptor=void 0,r.isCreating=!1,r.isCreatingAsync=!1,r.gpuRenderPipeline=null,r.descriptor=a,r.device.ensureRenderPipeline(Ts(r)),r}return vs(n,[{key:"getBindGroupLayout",value:function(e){return this.gpuRenderPipeline.getBindGroupLayout(e)}}]),n}(qc),fl=function(e){_s(n,e);var t=As(n);function n(e){var r,i=e.id,o=e.device;return ds(this,n),(r=t.call(this,{id:i,device:o})).type=Ls.Readback,r}return vs(n,[{key:"readTexture",value:function(e,t,n,r,i,o){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=e,c=0,l=this.getBlockInformationFromFormat(u.format),h=Math.ceil(r/l.width)*l.length,f=256*Math.ceil(h/256),d=f*i,p=this.device.createBuffer({flags:9,hint:1,viewOrSize:d,usage:4}),v=this.device.device.createCommandEncoder();return v.copyTextureToBuffer({texture:u.gpuTexture,mipLevel:0,origin:{x:t,y:n,z:Math.max(c,0)}},{buffer:p.gpuBuffer,offset:0,bytesPerRow:f},{width:r,height:i,depthOrArrayLayers:1}),this.device.device.queue.submit([v.finish()]),this.readBuffer(p,d,o,a,s,u.pixelFormat)}},{key:"readBuffer",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:ws.U8_RGB,a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=e,u=i||s.size,c=r||s.view,l=c&&c.constructor&&c.constructor.BYTES_PER_ELEMENT||Zs(o),h=s;if(!(1&s.flags&&8&s.flags)){var f=this.device.device.createCommandEncoder();h=this.device.createBuffer({flags:9,hint:1,viewOrSize:u,usage:4}),f.copyBufferToBuffer(s.gpuBuffer,n,h.gpuBuffer,0,u),this.device.device.queue.submit([f.finish()])}return new Promise((function(e,r){h.gpuBuffer.mapAsync(1,n,u).then((function(){var r=h.gpuBuffer.getMappedRange(n,u),i=c;if(a)i=null===i?jc(o,u,!0,r):jc(o,i.buffer,void 0,r);else if(null===i)switch(l){case 1:(i=new Uint8Array(u)).set(new Uint8Array(r));break;case 2:i=t.getHalfFloatAsFloatRGBAArrayBuffer(u/2,r);break;case 4:(i=new Float32Array(u/4)).set(new Float32Array(r))}else switch(l){case 1:(i=new Uint8Array(i.buffer)).set(new Uint8Array(r));break;case 2:i=t.getHalfFloatAsFloatRGBAArrayBuffer(u/2,r,c);break;case 4:(i=new Float32Array(i.buffer)).set(new Float32Array(r))}h.gpuBuffer.unmap(),e(i)}),(function(e){return r(e)}))}))}},{key:"getHalfFloatAsFloatRGBAArrayBuffer",value:function(e,t,n){n||(n=new Float32Array(e));for(var r,i,o,a,s=new Uint16Array(t);e--;)n[e]=(void 0,void 0,void 0,i=(32768&(r=s[e]))>>15,a=1023&r,0==(o=(31744&r)>>10)?(i?-1:1)*Math.pow(2,-14)*(a/Math.pow(2,10)):31==o?a?NaN:1/0*(i?-1:1):(i?-1:1)*Math.pow(2,o-15)*(1+a/Math.pow(2,10)));return n}},{key:"getBlockInformationFromFormat",value:function(e){switch(e){case"r8unorm":case"r8snorm":case"r8uint":case"r8sint":return{width:1,height:1,length:1};case"r16uint":case"r16sint":case"r16float":case"rg8unorm":case"rg8snorm":case"rg8uint":case"rg8sint":case"depth16unorm":return{width:1,height:1,length:2};case"r32uint":case"r32sint":case"r32float":case"rg16uint":case"rg16sint":case"rg16float":case"rgba8unorm":case"rgba8unorm-srgb":case"rgba8snorm":case"rgba8uint":case"rgba8sint":case"bgra8unorm":case"bgra8unorm-srgb":case"rgb9e5ufloat":case"rgb10a2unorm":case"rg11b10ufloat":case"depth32float":case"depth24unorm-stencil8":return{width:1,height:1,length:4};case"rg32uint":case"rg32sint":case"rg32float":case"rgba16uint":case"rgba16sint":case"rgba16float":return{width:1,height:1,length:8};case"rgba32uint":case"rgba32sint":case"rgba32float":return{width:1,height:1,length:16};case"stencil8":throw"No fixed size for Stencil8 format!";case"depth24plus":throw"No fixed size for Depth24Plus format!";case"depth24plus-stencil8":throw"No fixed size for Depth24PlusStencil8 format!";case"depth32float-stencil8":return{width:1,height:1,length:5};case"bc7-rgba-unorm":case"bc7-rgba-unorm-srgb":case"bc6h-rgb-ufloat":case"bc6h-rgb-float":case"bc2-rgba-unorm":case"bc2-rgba-unorm-srgb":case"bc3-rgba-unorm":case"bc3-rgba-unorm-srgb":case"bc5-rg-unorm":case"bc5-rg-snorm":return{width:4,height:4,length:16};case"bc4-r-unorm":case"bc4-r-snorm":case"bc1-rgba-unorm":case"bc1-rgba-unorm-srgb":return{width:4,height:4,length:8}}}}]),n}(qc);function dl(e,t){return e+=t,e+=e<<10,(e+=e>>>6)>>>0}function pl(e){return e+=e<<3,e^=e>>>11,(e+=e<<15)>>>0}function vl(e){return 0}var gl=function e(){ds(this,e),this.keys=[],this.values=[]},_l=function(){function e(t,n){ds(this,e),this.keyEqualFunc=void 0,this.keyHashFunc=void 0,this.buckets=new Map,this.keyEqualFunc=t,this.keyHashFunc=n}return vs(e,[{key:"findBucketIndex",value:function(e,t){for(var n=0;n<e.keys.length;n++)if(this.keyEqualFunc(t,e.keys[n]))return n;return-1}},{key:"findBucket",value:function(e){var t=this.keyHashFunc(e);return this.buckets.get(t)}},{key:"get",value:function(e){var t=this.findBucket(e);if(void 0===t)return null;var n=this.findBucketIndex(t,e);return n<0?null:t.values[n]}},{key:"add",value:function(e,t){var n=this.keyHashFunc(e);void 0===this.buckets.get(n)&&this.buckets.set(n,new gl);var r=this.buckets.get(n);r.keys.push(e),r.values.push(t)}},{key:"delete",value:function(e){var t=this.findBucket(e);if(void 0!==t){var n=this.findBucketIndex(t,e);-1!==n&&(t.keys.splice(n,1),t.values.splice(n,1))}}},{key:"clear",value:function(){this.buckets.clear()}},{key:"size",value:function(){var e,t=0,n=Is(this.buckets.values());try{for(n.s();!(e=n.n()).done;)t+=e.value.values.length}catch(e){n.e(e)}finally{n.f()}return t}},{key:"values",value:regeneratorRuntime.mark((function e(){var t,n,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Is(this.buckets.values()),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=14;break}r=n.value,i=r.values.length-1;case 6:if(!(i>=0)){e.next=12;break}return e.next=9,r.values[i];case 9:i--,e.next=6;break;case 12:e.next=3;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(1),t.e(e.t0);case 19:return e.prev=19,t.f(),e.finish(19);case 22:case"end":return e.stop()}}),e,this,[[1,16,19,22]])}))}]),e}(),yl=function(){function e(){ds(this,e),this.commandEncoder=null,this.descriptor=void 0,this.gpuComputePassDescriptor=void 0,this.gpuComputePassEncoder=null}return vs(e,[{key:"dispatch",value:function(e,t,n){this.gpuComputePassEncoder.dispatch(e,t,n)}},{key:"finish",value:function(){return this.gpuComputePassEncoder.endPass(),this.gpuComputePassEncoder=null,this.commandEncoder.finish()}},{key:"beginComputePass",value:function(e){eu(null===this.gpuComputePassEncoder),this.setComputePassDescriptor(e),this.gpuComputePassEncoder=this.commandEncoder.beginComputePass(this.gpuComputePassDescriptor)}},{key:"setPipeline",value:function(e){var t=tu(e.gpuComputePipeline);this.gpuComputePassEncoder.setPipeline(t)}},{key:"setBindings",value:function(e,t){var n=t;this.gpuComputePassEncoder.setBindGroup(e,n.gpuBindGroup[0])}},{key:"setComputePassDescriptor",value:function(e){this.descriptor=e}}]),e}(),ml=function(e){_s(n,e);var t=As(n);function n(e){var r,i=e.id,o=e.device,a=e.descriptor;ds(this,n),(r=t.call(this,{id:i,device:o})).type=Ls.ComputePipeline,r.descriptor=void 0,r.gpuComputePipeline=null,r.descriptor=a;var s=a.program.computeStage;if(null===s)return Rs(r);var u={compute:ls({},s)};return r.gpuComputePipeline=r.device.device.createComputePipeline(u),void 0!==r.name&&(r.gpuComputePipeline.label=r.name),r}return vs(n,[{key:"getBindGroupLayout",value:function(e){return this.gpuComputePipeline.getBindGroupLayout(e)}}]),n}(qc),El=function(){function e(t){ds(this,e),this.shaderModule=void 0,this.pipeline=void 0,this.shaderText="\n".concat("\nstruct VertexOutput {\n  [[builtin(position)]] pos: vec4<f32>;\n};\n\n[[stage(vertex)]]\nfn vs([[builtin(vertex_index)]] index: u32) -> VertexOutput {\n  var out: VertexOutput;\n  out.pos.x = select(-1.0, 3.0, index == 1u);\n  out.pos.y = select(-1.0, 3.0, index == 2u);\n  out.pos.z = 1.0;\n  out.pos.w = 1.0;\n  return out;\n}\n","\n\nstruct FragmentOutput { [[location(0)]] color: vec4<f32>; };\n\n[[stage(fragment)]]\nfn fs() -> FragmentOutput {\n  return FragmentOutput(vec4<f32>(1.0, 0.0, 1.0, 1.0));\n}\n"),this.shaderModule=t.createShaderModule({code:this.shaderText}),this.pipeline=t.createRenderPipeline({vertex:{module:this.shaderModule,entryPoint:"vs"},fragment:{module:this.shaderModule,entryPoint:"fs",targets:[{format:"bgra8unorm",writeMask:8}]}})}return vs(e,[{key:"render",value:function(e,t){var n=e.createCommandEncoder(),r=n.beginRenderPass({colorAttachments:[{view:t,loadValue:"load",storeOp:"store"}]});r.setPipeline(this.pipeline),r.draw(3),r.endPass(),e.queue.submit([n.finish()])}}]),e}(),Tl=function(e){_s(n,e);var t=As(n);function n(e){var r,i=e.id,o=e.device,a=e.descriptor;ds(this,n),(r=t.call(this,{id:i,device:o})).type=Ls.QueryPool,r.querySet=void 0;var s=a.elemCount,u=a.type;return r.querySet=r.device.device.createQuerySet({type:Fc(u),count:s}),r}return vs(n,[{key:"queryResultOcclusion",value:function(e){return!0}}]),n}(qc),Rl=function(){function e(t,n,r,i,o){ds(this,e),this.swapChainWidth=0,this.swapChainHeight=0,this.swapChainTextureUsage=18,this._resourceUniqueId=0,this.renderPassPool=[],this.computePassPool=[],this.bindGroupLayoutCache=new _l(Cu,vl),this.fallbackTexture2D=void 0,this.fallbackTexture2DDepth=void 0,this.fallbackTexture2DArray=void 0,this.fallbackTexture3D=void 0,this.fallbackTextureCube=void 0,this.fallbackSampler=void 0,this.featureTextureCompressionBC=!1,this.fullscreenAlphaClear=void 0,this.platformString="WebGPU",this.glslVersion="#version 440",this.explicitBindingLocations=!0,this.separateSamplerTextures=!0,this.viewportOrigin=1,this.clipSpaceNearZ=1,this.supportsSyncPipelineCompilation=!1,this.supportMRT=!0,this.adapter=void 0,this.device=void 0,this.canvas=void 0,this.canvasContext=void 0,this.glsl_compile=void 0,this.adapter=t,this.device=n,this.canvas=r,this.canvasContext=i,this.glsl_compile=o,this.fallbackTexture2D=this.createFallbackTexture(0,0),this.fallbackTexture2DDepth=this.createFallbackTexture(0,3),this.fallbackTexture2DArray=this.createFallbackTexture(1,0),this.fallbackTexture3D=this.createFallbackTexture(2,0),this.fallbackTextureCube=this.createFallbackTexture(3,0),this.fallbackSampler=this.createSampler({wrapS:0,wrapT:0,minFilter:0,magFilter:0,mipFilter:0}),this.device.features&&(this.featureTextureCompressionBC=this.device.features.has("texture-compression-bc")),this.device.onuncapturederror=function(e){console.error(e.error)},this.fullscreenAlphaClear=new El(this.device)}return vs(e,[{key:"configureSwapChain",value:function(e,t){this.swapChainWidth===e&&this.swapChainHeight===t||(this.swapChainWidth=e,this.swapChainHeight=t,this.canvasContext.configure({device:this.device,format:"bgra8unorm",usage:this.swapChainTextureUsage}))}},{key:"getOnscreenTexture",value:function(){var e=this.canvasContext.getCurrentTexture(),t=e.createView(),n=new cl({id:0,device:this,descriptor:{pixelFormat:ws.U8_RGBA_RT,width:this.swapChainWidth,height:this.swapChainHeight,depth:0,dimension:0,numLevels:1,usage:this.swapChainTextureUsage},skipCreate:!0});return n.depthOrArrayLayers=1,n.sampleCount=1,n.gpuTexture=e,n.gpuTextureView=t,n}},{key:"getDevice",value:function(){return this}},{key:"getCanvas",value:function(){return this.canvas}},{key:"present",value:function(){this.fullscreenAlphaClear.render(this.device,this.canvasContext.getCurrentTexture().createView())}},{key:"getNextUniqueId",value:function(){return++this._resourceUniqueId}},{key:"createBuffer",value:function(e){return new il({id:this.getNextUniqueId(),device:this,descriptor:e})}},{key:"createTexture",value:function(e){return new cl({id:this.getNextUniqueId(),device:this,descriptor:e})}},{key:"createSampler",value:function(e){return new ul({id:this.getNextUniqueId(),device:this,descriptor:e})}},{key:"createRenderTarget",value:function(e){var t=new cl({id:this.getNextUniqueId(),device:this,descriptor:ls(ls({},e),{},{dimension:0,numLevels:1,depth:1,usage:2})});return t.depthOrArrayLayers=1,t.type=Ls.RenderTarget,t}},{key:"createRenderTargetFromTexture",value:function(e){var t=e.pixelFormat,n=e.width,r=e.height,i=e.depthOrArrayLayers,o=e.sampleCount,a=e.numLevels,s=e.gpuTexture,u=e.gpuTextureView,c=e.usage;eu(!!(16&c));var l=new cl({id:this.getNextUniqueId(),device:this,descriptor:{pixelFormat:t,width:n,height:r,depth:i,dimension:0,numLevels:a,usage:c},skipCreate:!0});return l.depthOrArrayLayers=i,l.sampleCount=o,l.gpuTexture=s,l.gpuTextureView=u,l}},{key:"createProgram",value:function(e){return e.ensurePreprocessed(this),this.createProgramSimple(e)}},{key:"createProgramSimple",value:function(e){return new al({id:this.getNextUniqueId(),device:this,descriptor:e})}},{key:"createTextureShared",value:function(e,t,n){var r={width:e.width,height:e.height,depthOrArrayLayers:e.depthOrArrayLayers},i=e.numLevels,o=Cc(e.pixelFormat),a=function(e){if(0===e)return"2d";if(3===e)return"3d";if(1===e)return"3d";if(2===e)return"3d";throw"whoops"}(e.dimension),s=function(e){var t=0;return 1&e&&(t|=6),2&e&&(t|=23),t}(e.usage);if(t.format=o,t.dimension=e.dimension,t.pixelFormat=e.pixelFormat,t.width=e.width,t.height=e.height,t.depthOrArrayLayers=e.depthOrArrayLayers,t.numLevels=i,t.usage=s,t.sampleCount=1,!n){var u=this.device.createTexture({size:r,mipLevelCount:i,format:o,dimension:a,usage:s}),c=u.createView();t.gpuTexture=u,t.gpuTextureView=c}}},{key:"getFallbackTexture",value:function(e){var t=e.dimension,n=e.formatKind;if(0===t)return 3===n?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(1===t)return this.fallbackTexture2DArray;if(2===t)return this.fallbackTexture3D;if(3===t)return this.fallbackTextureCube;throw"whoops"}},{key:"createFallbackTexture",value:function(e,t){var n=3===e?6:1,r=0===t?ws.U8_RGBA_NORM:ws.D24;return this.createTexture({dimension:e,pixelFormat:r,usage:1,width:1,height:1,depth:n,numLevels:1})}},{key:"createBindings",value:function(e){return e.pipeline,new Zc({id:this.getNextUniqueId(),device:this,descriptor:e})}},{key:"createInputLayout",value:function(e){return new ol({id:this.getNextUniqueId(),device:this,descriptor:e})}},{key:"createInputState",value:function(e,t,n){return new ll({id:this.getNextUniqueId(),device:this,inputLayout:e,vertexBuffers:t,indexBuffer:n})}},{key:"createComputePipeline",value:function(e){return new ml({id:this.getNextUniqueId(),device:this,descriptor:e})}},{key:"createRenderPipeline",value:function(e){return new hl({id:this.getNextUniqueId(),device:this,descriptor:ls({},e)})}},{key:"createQueryPool",value:function(e,t){return new Tl({id:this.getNextUniqueId(),device:this,descriptor:{type:e,elemCount:t}})}},{key:"ensureRenderPipeline",value:function(e){if(!e.isCreating&&null===e.gpuRenderPipeline){var t=e.descriptor,n=t.program,r=n.vertexStage,i=n.fragmentStage;if(null!==r&&null!==i){var o,a,s=(o=t.topology,a=t.megaStateDescriptor,{topology:wc(o),cullMode:Lc(a.cullMode),frontFace:kc(a.frontFace)}),u=function(e,t){return t.attachmentsState.map((function(t,n){return function(e,t){return{format:Cc(t),blend:{color:Wc(e.rgbBlendState),alpha:Wc(e.alphaBlendState)},writeMask:e.channelWriteMask}}(t,e[n])}))}(t.colorAttachmentFormats,t.megaStateDescriptor),c=function(e,t){if(null!==e)return{format:Cc(e),depthWriteEnabled:t.depthWrite,depthCompare:Vc(t.depthCompare),depthBias:t.polygonOffset?1:0,depthBiasSlopeScale:t.polygonOffset?1:0}}(t.depthStencilAttachmentFormat,t.megaStateDescriptor),l=void 0;null!==t.inputLayout&&(l=t.inputLayout.buffers);var h=t.sampleCount;e.isCreating=!0;var f={vertex:ls(ls({},r),{},{buffers:l}),primitive:s,depthStencil:c,multisample:{count:h},fragment:ls(ls({},i),{},{targets:u})};e.gpuRenderPipeline=this.device.createRenderPipeline(f),void 0!==e.name&&(e.gpuRenderPipeline.label=e.name)}}}},{key:"createReadback",value:function(){return new fl({id:this.getNextUniqueId(),device:this})}},{key:"destroyRenderTarget",value:function(e){e.gpuTexture.destroy()}},{key:"createRenderPass",value:function(e){var t=this.renderPassPool.pop();return void 0===t&&(t=new sl),t.commandEncoder=this.device.createCommandEncoder(),t.beginRenderPass(e),t}},{key:"createComputePass",value:function(e){var t=this.computePassPool.pop();return void 0===t&&(t=new yl),t.commandEncoder=this.device.createCommandEncoder(),t.beginComputePass(e),t}},{key:"submitPass",value:function(e){var t=this.device.queue,n=e,r=n.finish();t.submit([r]),n.commandEncoder=null,n instanceof sl?this.renderPassPool.push(n):this.computePassPool.push(n)}},{key:"copySubTexture2D",value:function(e,t,n,r,i,o){var a=this.device.createCommandEncoder(),s=e,u=r,c={texture:u.gpuTexture,origin:[i,o,0]},l={texture:s.gpuTexture,origin:[t,n,0]};eu(!!(1&u.usage)),eu(!!(2&s.usage)),a.copyTextureToTexture(c,l,[u.width,u.height,1]),this.device.queue.submit([a.finish()])}},{key:"queryLimits",value:function(){return{uniformBufferMaxPageWordSize:4096,uniformBufferWordAlignment:64,supportedSampleCounts:[1]}}},{key:"queryTextureFormatSupported",value:function(e,t,n){if(function(e){switch(Ys(e)){case 65:case 66:case 67:case 69:case 68:case 71:case 70:return!0}return!1}(e)){if(!this.featureTextureCompressionBC)return!1;var r=function(e){switch(Ys(e)){case 65:case 66:case 67:case 69:case 68:case 71:case 70:return 4}return 1}(e);return t%r==0&&n%r==0&&this.featureTextureCompressionBC}return!0}},{key:"queryPipelineReady",value:function(e){var t=e;return this.ensureRenderPipeline(t),null!==t.gpuRenderPipeline}},{key:"queryPlatformAvailable",value:function(){return!0}},{key:"queryVendorInfo",value:function(){return this}},{key:"queryRenderPass",value:function(e){return e.descriptor}},{key:"queryRenderTarget",value:function(e){return e}},{key:"setResourceName",value:function(e,t){if(e.name=t,e.type===Ls.Buffer)e.gpuBuffer.label=t;else if(e.type===Ls.Texture){var n=e;n.gpuTexture.label=t,n.gpuTextureView.label=t}else if(e.type===Ls.RenderTarget){var r=e;r.gpuTexture.label=t,r.gpuTextureView.label=t}else if(e.type===Ls.Sampler)e.gpuSampler.label=t;else if(e.type===Ls.RenderPipeline){var i=e;null!==i.gpuRenderPipeline&&(i.gpuRenderPipeline.label=t)}}},{key:"setResourceLeakCheck",value:function(e,t){}},{key:"checkForLeaks",value:function(){}},{key:"programPatched",value:function(e){}},{key:"pushDebugGroup",value:function(e){}},{key:"popDebugGroup",value:function(){}},{key:"pipelineQueryReady",value:function(e){return null!==e.gpuRenderPipeline}},{key:"pipelineForceReady",value:function(e){}}]),e}(),Al=function(){function e(t){ds(this,e),this.device=void 0,this.uniformBufferWordAlignment=void 0,this.uniformBufferMaxPageWordSize=void 0,this.currentBufferWordSize=-1,this.currentWordOffset=0,this.buffer=null,this.shadowBufferF32=null,this.shadowBufferU8=null,this.device=t;var n=t.queryLimits();this.uniformBufferWordAlignment=n.uniformBufferWordAlignment,this.uniformBufferMaxPageWordSize=n.uniformBufferMaxPageWordSize}return vs(e,[{key:"isSupportedUBO",value:function(){return"WebGL1"!==this.device.queryVendorInfo().platformString}},{key:"findPageIndex",value:function(e){return e/this.uniformBufferMaxPageWordSize|0}},{key:"allocateChunk",value:function(e){eu((e=fu(e,this.uniformBufferWordAlignment))<this.uniformBufferMaxPageWordSize);var t=this.currentWordOffset;return this.findPageIndex(t)!==this.findPageIndex(t+e-1)&&(t=fu(t,this.uniformBufferMaxPageWordSize)),this.currentWordOffset=t+e,this.ensureShadowBuffer(t,e),t}},{key:"ensureShadowBuffer",value:function(e,t){if(null===this.shadowBufferU8||null===this.shadowBufferF32){var n=fu(this.currentWordOffset,this.uniformBufferMaxPageWordSize);this.shadowBufferU8=new Uint8Array(4*n),this.shadowBufferF32=new Float32Array(this.shadowBufferU8.buffer)}else if(e+t>=this.shadowBufferF32.length){eu(e<this.currentWordOffset&&e+t<=this.currentWordOffset);var r=fu(Math.max(this.currentWordOffset,2*this.shadowBufferF32.length),this.uniformBufferMaxPageWordSize),i=new Uint8Array(4*r);if(i.set(this.shadowBufferU8,0),this.shadowBufferU8=i,this.shadowBufferF32=new Float32Array(this.shadowBufferU8.buffer),!(this.currentWordOffset<=r))throw new Error("Assert fail: this.currentWordOffset [".concat(this.currentWordOffset,"] <= newWordCount [").concat(r,"]"))}}},{key:"mapBufferF32",value:function(){return tu(this.shadowBufferF32)}},{key:"prepareToRender",value:function(){if(null!==this.shadowBufferF32){var e=tu(this.shadowBufferF32);e.length!==this.currentBufferWordSize&&(this.currentBufferWordSize=e.length,null!==this.buffer&&this.buffer.destroy(),this.buffer=this.device.createBuffer({viewOrSize:this.currentBufferWordSize,usage:3,hint:2}));var t=fu(this.currentWordOffset,this.uniformBufferMaxPageWordSize);if(!(t<=this.currentBufferWordSize))throw new Error("Assert fail: wordCount [".concat(t,"] (").concat(this.currentWordOffset," aligned ").concat(this.uniformBufferMaxPageWordSize,") <= this.currentBufferWordSize [").concat(this.currentBufferWordSize,"]"));this.isSupportedUBO()&&tu(this.buffer).setSubData(0,this.shadowBufferU8,0,4*t),this.currentWordOffset=0}}},{key:"destroy",value:function(){null!==this.buffer&&this.buffer.destroy(),this.shadowBufferF32=null,this.shadowBufferU8=null}}]),e}();function Sl(e,t){return eu(""!==e.preprocessedVert&&""!==t.preprocessedVert),eu(""!==e.preprocessedFrag&&""!==t.preprocessedFrag),e.preprocessedVert===t.preprocessedVert&&e.preprocessedFrag===t.preprocessedFrag}function bl(e,t){return e=dl(e,t.numUniformBuffers),dl(e,t.numSamplers)}function xl(e,t){return e=dl(e,t.blendMode),e=dl(e,t.blendSrcFactor),dl(e,t.blendDstFactor)}function Cl(e,t){return e=xl(e,t.rgbBlendState),dl(e=xl(e,t.alphaBlendState),t.channelWriteMask)}function Ml(e){var t=0;t=dl(t,e.program.id),null!==e.inputLayout&&(t=dl(t,e.inputLayout.id));for(var n=0;n<e.bindingLayouts.length;n++)t=bl(t,e.bindingLayouts[n]);t=function(e,t){for(var n=0;n<t.attachmentsState.length;n++)e=Cl(e,t.attachmentsState[n]);return e=function(e,t){return dl(e,t.r<<24|t.g<<16|t.b<<8|t.a)}(e,t.blendConstant),e=dl(e,t.depthCompare),e=dl(e,t.depthWrite?1:0),e=dl(e,t.stencilCompare),e=dl(e,t.stencilPassOp),e=dl(e,t.stencilWrite?1:0),e=dl(e,t.cullMode),e=dl(e,t.frontFace?1:0),dl(e,t.polygonOffset?1:0)}(t,e.megaStateDescriptor);for(var r=0;r<e.colorAttachmentFormats.length;r++)t=dl(t,e.colorAttachmentFormats[r]||0);return pl(t=dl(t,e.depthStencilAttachmentFormat||0))}function Pl(e){for(var t=0,n=0;n<e.samplerBindings.length;n++){var r=e.samplerBindings[n];null!==r&&null!==r.texture&&(t=dl(t,r.texture.id))}for(var i=0;i<e.uniformBufferBindings.length;i++){var o=e.uniformBufferBindings[i];null!==o&&null!==o.buffer&&(t=dl(t,o.buffer.id),t=dl(t,o.wordCount))}return pl(t)}var Nl,Ol=function(){function e(t){ds(this,e),this.device=void 0,this.bindingsCache=new _l(Mu,Pl),this.renderPipelinesCache=new _l(Iu,Ml),this.inputLayoutsCache=new _l(wu,vl),this.programCache=new _l(Sl,vl),this.samplerCache=new _l(Lu,vl),this.device=t}return vs(e,[{key:"createBindings",value:function(e){var t,n=this.bindingsCache.get(e);if(null===n){var r={bindingLayout:(t=e).bindingLayout,samplerBindings:Su(t.samplerBindings,ku),uniformBufferBindings:Su(t.uniformBufferBindings,Uu),pipeline:t.pipeline};n=this.device.createBindings(r),this.bindingsCache.add(r,n)}return n}},{key:"createRenderPipeline",value:function(e){var t,n,r,i,o,a=this.renderPipelinesCache.get(e);if(null===a){var s=(n=Su((t=e).bindingLayouts,Wu),r=t.inputLayout,i=t.program,o=t.topology,{bindingLayouts:n,inputLayout:r,megaStateDescriptor:Eu(t.megaStateDescriptor),program:i,topology:o,colorAttachmentFormats:t.colorAttachmentFormats.slice(),depthStencilAttachmentFormat:t.depthStencilAttachmentFormat,sampleCount:t.sampleCount});a=this.device.createRenderPipeline(s),this.renderPipelinesCache.add(s,a)}return a}},{key:"createInputLayout",value:function(e){var t,n=this.inputLayoutsCache.get(e);if(null===n){var r={vertexAttributeDescriptors:Su((t=e).vertexAttributeDescriptors,Vu),vertexBufferDescriptors:Su(t.vertexBufferDescriptors,Xu),indexBufferFormat:t.indexBufferFormat};n=this.device.createInputLayout(r),this.inputLayoutsCache.add(r,n)}return n}},{key:"createProgramSimple",value:function(e){var t,n=this.programCache.get(e);if(null===n){var r={preprocessedVert:(t=e).preprocessedVert,preprocessedFrag:t.preprocessedFrag};n=this.device.createProgramSimple(r),this.programCache.add(r,n)}return n}},{key:"createProgram",value:function(e){return e.ensurePreprocessed(this.device.queryVendorInfo()),this.createProgramSimple(e)}},{key:"createSampler",value:function(e){var t=this.samplerCache.get(e);return null===t&&(t=this.device.createSampler(e),this.samplerCache.add(e,t)),t}},{key:"destroy",value:function(){var e,t=Is(this.bindingsCache.values());try{for(t.s();!(e=t.n()).done;)e.value.destroy()}catch(e){t.e(e)}finally{t.f()}var n,r=Is(this.renderPipelinesCache.values());try{for(r.s();!(n=r.n()).done;)n.value.destroy()}catch(e){r.e(e)}finally{r.f()}var i,o=Is(this.inputLayoutsCache.values());try{for(o.s();!(i=o.n()).done;)i.value.destroy()}catch(e){o.e(e)}finally{o.f()}var a,s=Is(this.programCache.values());try{for(s.s();!(a=s.n()).done;)a.value.destroy()}catch(e){s.e(e)}finally{s.f()}var u,c=Is(this.samplerCache.values());try{for(c.s();!(u=c.n()).done;)u.value.destroy()}catch(e){c.e(e)}finally{c.f()}this.bindingsCache.clear(),this.renderPipelinesCache.clear(),this.inputLayoutsCache.clear(),this.programCache.clear(),this.samplerCache.clear()}}]),e}(),Bl={x:0,y:0,w:1,h:1},Il=function(){function e(){ds(this,e),this.renderTargetIDs=[],this.resolveTextureOutputIDs=[],this.resolveTextureOutputExternalTextures=[],this.resolveTextureInputIDs=[],this.renderTargetExtraRefs=[],this.viewport=Bl,this.resolveTextureInputTextures=[],this.renderTargets=[],this.descriptor={colorAttachment:[],colorResolveTo:[],colorStore:[],depthStencilAttachment:null,depthStencilResolveTo:null,depthStencilStore:!0,colorClearColor:["load"],depthClearValue:"load",stencilClearValue:"load",occlusionQueryPool:null},this.viewportX=0,this.viewportY=0,this.viewportW=0,this.viewportH=0,this.execFunc=null,this.postFunc=null,this.debugName=void 0,this.debugThumbnails=[]}return vs(e,[{key:"setDebugName",value:function(e){this.debugName=e}},{key:"pushDebugThumbnail",value:function(e){this.debugThumbnails[e]=!0}},{key:"setViewport",value:function(e){this.viewport=e}},{key:"attachRenderTargetID",value:function(e,t){eu(void 0===this.renderTargetIDs[e]),this.renderTargetIDs[e]=t}},{key:"attachResolveTexture",value:function(e){this.resolveTextureInputIDs.push(e)}},{key:"attachOcclusionQueryPool",value:function(e){this.descriptor.occlusionQueryPool=e}},{key:"resolveToExternalTexture",value:function(e,t){this.resolveTextureOutputExternalTextures[e]=t}},{key:"exec",value:function(e){eu(null===this.execFunc),this.execFunc=e}},{key:"post",value:function(e){eu(null===this.postFunc),this.postFunc=e}},{key:"addExtraRef",value:function(e){this.renderTargetExtraRefs[e]=!0}}]),e}(),Dl=function(){function e(t,n){ds(this,e),this.debugName=void 0,this.dimension=0,this.depth=1,this.numLevels=1,this.pixelFormat=void 0,this.width=0,this.height=0,this.sampleCount=0,this.usage=2,this.immutable=!0,this.needsClear=!0,this.texture=null,this.attachment=void 0,this.age=0,this.pixelFormat=n.pixelFormat,this.width=n.width,this.height=n.height,this.sampleCount=n.sampleCount,eu(this.sampleCount>=1),this.sampleCount>1?this.attachment=t.createRenderTarget(this):(this.texture=t.createTexture(this),t.setResourceName(this.texture,this.debugName),this.attachment=t.createRenderTargetFromTexture(this.texture)),t.setResourceName(this.attachment,this.debugName)}return vs(e,[{key:"matchesDescription",value:function(e){return this.pixelFormat===e.pixelFormat&&this.width===e.width&&this.height===e.height&&this.sampleCount===e.sampleCount}},{key:"reset",value:function(e){eu(this.matchesDescription(e)),this.age=0}},{key:"destroy",value:function(e){null!==this.texture&&this.texture.destroy(),this.attachment.destroy()}}]),e}(),Fl=function(){function e(t,n){ds(this,e),this.dimension=0,this.depth=1,this.numLevels=1,this.usage=2,this.pixelFormat=void 0,this.width=0,this.height=0,this.texture=void 0,this.age=0,this.immutable=!0,this.pixelFormat=n.pixelFormat,this.width=n.width,this.height=n.height,this.texture=t.createTexture(this)}return vs(e,[{key:"matchesDescription",value:function(e){return this.pixelFormat===e.pixelFormat&&this.width===e.width&&this.height===e.height}},{key:"reset",value:function(e){eu(this.matchesDescription(e)),this.age=0}},{key:"destroy",value:function(e){this.texture.destroy()}}]),e}();Nl=Symbol.species;var wl=function e(){ds(this,e),this[Nl]=void 0,this.renderTargetDescriptions=[],this.resolveTextureRenderTargetIDs=[],this.passes=[],this.renderTargetDebugNames=[]},Ll=function(){function e(t){ds(this,e),this.device=void 0,this.currentPass=null,this.renderTargetDeadPool=[],this.singleSampledTextureDeadPool=[],this.currentGraph=null,this.renderTargetOutputCount=[],this.renderTargetResolveCount=[],this.resolveTextureUseCount=[],this.renderTargetAliveForID=[],this.singleSampledTextureForResolveTextureID=[],this.device=t}return vs(e,[{key:"acquireRenderTargetForDescription",value:function(e){for(var t=0;t<this.renderTargetDeadPool.length;t++){var n=this.renderTargetDeadPool[t];if(n.matchesDescription(e))return n.reset(e),this.renderTargetDeadPool.splice(t--,1),n}return new Dl(this.device,e)}},{key:"acquireSingleSampledTextureForDescription",value:function(e){for(var t=0;t<this.singleSampledTextureDeadPool.length;t++){var n=this.singleSampledTextureDeadPool[t];if(n.matchesDescription(e))return n.reset(e),this.singleSampledTextureDeadPool.splice(t--,1),n}return new Fl(this.device,e)}},{key:"beginGraphBuilder",value:function(){eu(null===this.currentGraph),this.currentGraph=new wl}},{key:"pushPass",value:function(e){var t=new Il;e(t),this.currentGraph.passes.push(t)}},{key:"createRenderTargetID",value:function(e,t){return this.currentGraph.renderTargetDebugNames.push(t),this.currentGraph.renderTargetDescriptions.push(e)-1}},{key:"createResolveTextureID",value:function(e){return this.currentGraph.resolveTextureRenderTargetIDs.push(e)-1}},{key:"findMostRecentPassThatAttachedRenderTarget",value:function(e){for(var t=this.currentGraph.passes.length-1;t>=0;t--){var n=this.currentGraph.passes[t];if(n.renderTargetIDs.includes(e))return n}return null}},{key:"resolveRenderTargetPassAttachmentSlot",value:function(e,t){var n=e;if(void 0===n.resolveTextureOutputIDs[t]){var r=n.renderTargetIDs[t],i=this.createResolveTextureID(r);n.resolveTextureOutputIDs[t]=i}return n.resolveTextureOutputIDs[t]}},{key:"findPassForResolveRenderTarget",value:function(e){var t=tu(this.findMostRecentPassThatAttachedRenderTarget(e)),n=t.renderTargetIDs.indexOf(e);return eu(void 0===t.resolveTextureOutputExternalTextures[n]),t}},{key:"resolveRenderTarget",value:function(e){var t=this.findPassForResolveRenderTarget(e),n=t.renderTargetIDs.indexOf(e);return this.resolveRenderTargetPassAttachmentSlot(t,n)}},{key:"resolveRenderTargetToExternalTexture",value:function(e,t){var n=this.findPassForResolveRenderTarget(e),r=n.renderTargetIDs.indexOf(e);eu(void 0===n.resolveTextureOutputIDs[r]),n.resolveTextureOutputExternalTextures[r]=t}},{key:"getRenderTargetDescription",value:function(e){return tu(this.currentGraph.renderTargetDescriptions[e])}},{key:"scheduleAddUseCount",value:function(e,t){for(var n=0;n<t.renderTargetIDs.length;n++){var r=t.renderTargetIDs[n];void 0!==r&&(this.renderTargetOutputCount[r]++,t.renderTargetExtraRefs[n]&&this.renderTargetOutputCount[r]++)}for(var i=0;i<t.resolveTextureInputIDs.length;i++){var o=t.resolveTextureInputIDs[i];if(void 0!==o){this.resolveTextureUseCount[o]++;var a=e.resolveTextureRenderTargetIDs[o];this.renderTargetResolveCount[a]++}}}},{key:"acquireRenderTargetForID",value:function(e,t){if(void 0===t)return null;if(eu(this.renderTargetOutputCount[t]>0),!this.renderTargetAliveForID[t]){var n=e.renderTargetDescriptions[t],r=this.acquireRenderTargetForDescription(n);r.debugName=e.renderTargetDebugNames[t],this.renderTargetAliveForID[t]=r}return this.renderTargetAliveForID[t]}},{key:"releaseRenderTargetForID",value:function(e,t){if(void 0===e)return null;var n=tu(this.renderTargetAliveForID[e]);return t?(eu(this.renderTargetOutputCount[e]>0),this.renderTargetOutputCount[e]--):(eu(this.renderTargetResolveCount[e]>0),this.renderTargetResolveCount[e]--),0===this.renderTargetOutputCount[e]&&0===this.renderTargetResolveCount[e]&&(n.needsClear=!0,delete this.renderTargetAliveForID[e],this.renderTargetDeadPool.push(n)),n}},{key:"acquireResolveTextureInputTextureForID",value:function(e,t){var n=e.resolveTextureRenderTargetIDs[t];eu(this.resolveTextureUseCount[t]>0),this.resolveTextureUseCount[t]--;var r=tu(this.releaseRenderTargetForID(n,!1));if(void 0!==this.singleSampledTextureForResolveTextureID[t]){var i=this.singleSampledTextureForResolveTextureID[t];return 0===this.resolveTextureUseCount[t]&&this.singleSampledTextureDeadPool.push(i),i.texture}return tu(r.texture)}},{key:"determineResolveParam",value:function(e,t,n){var r=t.renderTargetIDs[n],i=t.resolveTextureOutputIDs[n],o=t.resolveTextureOutputExternalTextures[n],a=void 0!==i,s=void 0!==o;eu(!(a&&s));var u=null,c=!1;if(this.renderTargetOutputCount[r]>1&&(c=!0),a){eu(e.resolveTextureRenderTargetIDs[i]===r),eu(this.resolveTextureUseCount[i]>0),eu(this.renderTargetOutputCount[r]>0);var l=tu(this.renderTargetAliveForID[r]);if(null!==l.texture&&1===this.renderTargetOutputCount[r])u=null,c=!0;else{if(!this.singleSampledTextureForResolveTextureID[i]){var h=tu(e.renderTargetDescriptions[r]);this.singleSampledTextureForResolveTextureID[i]=this.acquireSingleSampledTextureForDescription(h),this.device.setResourceName(this.singleSampledTextureForResolveTextureID[i].texture,l.debugName+" (Resolve ".concat(i,")"))}u=this.singleSampledTextureForResolveTextureID[i].texture}}else u=s?o:null;return{resolveTo:u,store:c}}},{key:"schedulePass",value:function(e,t){for(var n=t.renderTargetIDs[4],r=0;r<=3;r++){var i=t.renderTargetIDs[r],o=this.acquireRenderTargetForID(e,i);t.renderTargets[r]=o,t.descriptor.colorAttachment[r]=null!==o?o.attachment:null;var a=this.determineResolveParam(e,t,r),s=a.resolveTo,u=a.store;t.descriptor.colorResolveTo[r]=s,t.descriptor.colorStore[r]=u,t.descriptor.colorClearColor[r]=null!==o&&o.needsClear?e.renderTargetDescriptions[i].colorClearColor:"load"}var c=this.acquireRenderTargetForID(e,n);t.renderTargets[4]=c,t.descriptor.depthStencilAttachment=null!==c?c.attachment:null;var l=this.determineResolveParam(e,t,4),h=l.resolveTo,f=l.store;t.descriptor.depthStencilResolveTo=h,t.descriptor.depthStencilStore=f,t.descriptor.depthClearValue=null!==c&&c.needsClear?e.renderTargetDescriptions[n].depthClearValue:"load",t.descriptor.stencilClearValue=null!==c&&c.needsClear?e.renderTargetDescriptions[n].stencilClearValue:"load";for(var d=0,p=0,v=0,g=0;g<t.renderTargets.length;g++){var _=t.renderTargets[g];_&&(0===d&&(d=_.width,p=_.height,v=_.sampleCount),eu(_.width===d),eu(_.height===p),eu(_.sampleCount===v),_.needsClear=!1)}if(d>0&&p>0){var y=d*t.viewport.x,m=p*t.viewport.y,E=d*t.viewport.w,T=p*t.viewport.h;t.viewportX=y,t.viewportY=m,t.viewportW=E,t.viewportH=T}for(var R=0;R<t.resolveTextureInputIDs.length;R++){var A=t.resolveTextureInputIDs[R];t.resolveTextureInputTextures[R]=this.acquireResolveTextureInputTextureForID(e,A)}for(var S=0;S<t.renderTargetIDs.length;S++)this.releaseRenderTargetForID(t.renderTargetIDs[S],!0);for(var b=0;b<t.renderTargetExtraRefs.length;b++)t.renderTargetExtraRefs[b]&&this.releaseRenderTargetForID(t.renderTargetIDs[b],!0)}},{key:"scheduleGraph",value:function(e){eu(0===this.renderTargetOutputCount.length),eu(0===this.renderTargetResolveCount.length),eu(0===this.resolveTextureUseCount.length);for(var t=0;t<this.renderTargetDeadPool.length;t++)this.renderTargetDeadPool[t].age++;for(var n=0;n<this.singleSampledTextureDeadPool.length;n++)this.singleSampledTextureDeadPool[n].age++;hu(this.renderTargetOutputCount,e.renderTargetDescriptions.length,0),hu(this.renderTargetResolveCount,e.renderTargetDescriptions.length,0),hu(this.resolveTextureUseCount,e.resolveTextureRenderTargetIDs.length,0);for(var r=0;r<e.passes.length;r++)this.scheduleAddUseCount(e,e.passes[r]);for(var i=0;i<e.passes.length;i++)this.schedulePass(e,e.passes[i]);for(var o=0;o<this.renderTargetOutputCount.length;o++)eu(0===this.renderTargetOutputCount[o]);for(var a=0;a<this.renderTargetResolveCount.length;a++)eu(0===this.renderTargetResolveCount[a]);for(var s=0;s<this.resolveTextureUseCount.length;s++)eu(0===this.resolveTextureUseCount[s]);for(var u=0;u<this.renderTargetAliveForID.length;u++)eu(void 0===this.renderTargetAliveForID[u]);for(var c=0;c<this.renderTargetDeadPool.length;c++)this.renderTargetDeadPool[c].age>=1&&(this.renderTargetDeadPool[c].destroy(this.device),this.renderTargetDeadPool.splice(c--,1));for(var l=0;l<this.singleSampledTextureDeadPool.length;l++)this.singleSampledTextureDeadPool[l].age>=1&&(this.singleSampledTextureDeadPool[l].destroy(this.device),this.singleSampledTextureDeadPool.splice(l--,1));this.renderTargetResolveCount.length=0,this.renderTargetOutputCount.length=0,this.resolveTextureUseCount.length=0}},{key:"execPass",value:function(e){eu(null===this.currentPass),this.currentPass=e;var t=this.device.createRenderPass(e.descriptor);t.beginDebugGroup(e.debugName),t.setViewport(e.viewportX,e.viewportY,e.viewportW,e.viewportH),null!==e.execFunc&&e.execFunc(t,this),t.endDebugGroup(),this.device.submitPass(t),null!==e.postFunc&&e.postFunc(this),this.currentPass=null}},{key:"execGraph",value:function(e){var t=this;this.scheduleGraph(e),e.passes.forEach((function(e){t.execPass(e)})),this.singleSampledTextureForResolveTextureID.length=0}},{key:"execute",value:function(){var e=tu(this.currentGraph);this.execGraph(e),this.currentGraph=null}},{key:"getDebug",value:function(){return this}},{key:"getPasses",value:function(){return this.currentGraph.passes}},{key:"getPassDebugThumbnails",value:function(e){return e.debugThumbnails}},{key:"getPassRenderTargetID",value:function(e,t){return e.renderTargetIDs[t]}},{key:"getRenderTargetIDDebugName",value:function(e){return this.currentGraph.renderTargetDebugNames[e]}},{key:"getResolveTextureForID",value:function(e){var t=this.currentPass,n=t.resolveTextureInputIDs.indexOf(e);return eu(n>=0),tu(t.resolveTextureInputTextures[n])}},{key:"getRenderTargetAttachment",value:function(e){var t=this.currentPass.renderTargets[e];return t?t.attachment:null}},{key:"getRenderTargetTexture",value:function(e){var t=this.currentPass.renderTargets[e];return t?t.texture:null}},{key:"newGraphBuilder",value:function(){return this.beginGraphBuilder(),this}},{key:"destroy",value:function(){for(var e=0;e<this.renderTargetAliveForID.length;e++)eu(void 0===this.renderTargetAliveForID[e]);for(var t=0;t<this.singleSampledTextureForResolveTextureID.length;t++)eu(void 0===this.singleSampledTextureForResolveTextureID[t]);for(var n=0;n<this.renderTargetDeadPool.length;n++)this.renderTargetDeadPool[n].destroy(this.device);for(var r=0;r<this.singleSampledTextureDeadPool.length;r++)this.singleSampledTextureDeadPool[r].destroy(this.device)}}]),e}();function kl(e,t){return e.sortKey-t.sortKey}var Ul=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:kl,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;ds(this,e),this.renderInsts=[],this.compareFunction=void 0,this.executionOrder=void 0,this.usePostSort=!1,this.compareFunction=t,this.executionOrder=n}return vs(e,[{key:"checkUsePostSort",value:function(){this.usePostSort=null!==this.compareFunction&&this.renderInsts.length>=500}},{key:"insertSorted",value:function(e){var t,n,r;null===this.compareFunction||this.usePostSort?this.renderInsts.push(e):(r=function(e,t,n){for(var r=0,i=e.length;r<i;){var o=r+(i-r>>>1);n(t,e[o])<0?i=o:r=o+1}return r}(t=this.renderInsts,n=e,this.compareFunction),t.splice(r,0,n)),this.checkUsePostSort()}},{key:"submitRenderInst",value:function(e){e.flags|=8,this.insertSorted(e)}},{key:"hasLateSamplerBinding",value:function(e){for(var t=0;t<this.renderInsts.length;t++)if(this.renderInsts[t].hasLateSamplerBinding(e))return!0;return!1}},{key:"resolveLateSamplerBinding",value:function(e,t){for(var n=0;n<this.renderInsts.length;n++)this.renderInsts[n].resolveLateSamplerBinding(e,t)}},{key:"ensureSorted",value:function(){this.usePostSort&&(0!==this.renderInsts.length&&this.renderInsts.sort(this.compareFunction),this.usePostSort=!1)}},{key:"drawOnPassRendererNoReset",value:function(e,t){this.ensureSorted();var n=0;if(0===this.executionOrder)for(var r=0;r<this.renderInsts.length;r++)this.renderInsts[r].drawOnPass(e,t)&&n++;else for(var i=this.renderInsts.length-1;i>=0;i--)this.renderInsts[i].drawOnPass(e,t)&&n++;return n}},{key:"reset",value:function(){this.renderInsts.length=0}},{key:"drawOnPassRenderer",value:function(e,t){var n=this.drawOnPassRendererNoReset(e,t);return this.reset(),n}}]),e}(),Gl=function(){function e(){ds(this,e),this.sortKey=0,this.debug=null,this.renderPipelineDescriptor=void 0,this.uniformBuffer=void 0,this.bindingDescriptors=pu(1,(function(){return{bindingLayout:null,samplerBindings:[],uniformBufferBindings:[]}})),this.dynamicUniformBufferByteOffsets=pu(4,(function(){return 0})),this.flags=0,this.inputState=null,this.drawStart=0,this.drawCount=0,this.drawInstanceCount=0,this.renderPipelineDescriptor={bindingLayouts:[],inputLayout:null,megaStateDescriptor:Eu(Ru),program:null,topology:1,colorAttachmentFormats:[],depthStencilAttachmentFormat:null,sampleCount:1},this.reset()}return vs(e,[{key:"reset",value:function(){this.sortKey=0,this.flags=2,this.inputState=null,this.renderPipelineDescriptor.inputLayout=null}},{key:"setFromTemplate",value:function(e){mu(this.renderPipelineDescriptor.megaStateDescriptor,e.renderPipelineDescriptor.megaStateDescriptor),this.renderPipelineDescriptor.program=e.renderPipelineDescriptor.program,this.renderPipelineDescriptor.inputLayout=e.renderPipelineDescriptor.inputLayout,this.renderPipelineDescriptor.topology=e.renderPipelineDescriptor.topology,this.renderPipelineDescriptor.colorAttachmentFormats.length=Math.max(this.renderPipelineDescriptor.colorAttachmentFormats.length,e.renderPipelineDescriptor.colorAttachmentFormats.length);for(var t=0;t<e.renderPipelineDescriptor.colorAttachmentFormats.length;t++)this.renderPipelineDescriptor.colorAttachmentFormats[t]=e.renderPipelineDescriptor.colorAttachmentFormats[t];this.renderPipelineDescriptor.depthStencilAttachmentFormat=e.renderPipelineDescriptor.depthStencilAttachmentFormat,this.renderPipelineDescriptor.sampleCount=e.renderPipelineDescriptor.sampleCount,this.inputState=e.inputState,this.uniformBuffer=e.uniformBuffer,this.drawCount=e.drawCount,this.drawStart=e.drawStart,this.drawInstanceCount=e.drawInstanceCount,this.flags=-4&this.flags|3&e.flags,this.sortKey=e.sortKey;var n=this.bindingDescriptors[0],r=e.bindingDescriptors[0];null!==r.bindingLayout&&this.setBindingLayout(r.bindingLayout);for(var i=0;i<Math.min(n.uniformBufferBindings.length,r.uniformBufferBindings.length);i++)n.uniformBufferBindings[i].wordCount=e.bindingDescriptors[0].uniformBufferBindings[i].wordCount;this.setSamplerBindingsFromTextureMappings(r.samplerBindings);for(var o=0;o<e.dynamicUniformBufferByteOffsets.length;o++)this.dynamicUniformBufferByteOffsets[o]=e.dynamicUniformBufferByteOffsets[o]}},{key:"setProgram",value:function(e){this.renderPipelineDescriptor.program=e}},{key:"setMegaStateFlags",value:function(e){return mu(this.renderPipelineDescriptor.megaStateDescriptor,e),this.renderPipelineDescriptor.megaStateDescriptor}},{key:"getMegaStateFlags",value:function(){return this.renderPipelineDescriptor.megaStateDescriptor}},{key:"setInputLayoutAndState",value:function(e,t){this.inputState=t,this.renderPipelineDescriptor.inputLayout=e}},{key:"setBindingLayout",value:function(e){eu(e.numUniformBuffers<this.dynamicUniformBufferByteOffsets.length),this.renderPipelineDescriptor.bindingLayouts[0]=e,this.bindingDescriptors[0].bindingLayout=e;for(var t=this.bindingDescriptors[0].uniformBufferBindings.length;t<e.numUniformBuffers;t++)this.bindingDescriptors[0].uniformBufferBindings.push({buffer:null,wordCount:0});for(var n=this.bindingDescriptors[0].samplerBindings.length;n<e.numSamplers;n++)this.bindingDescriptors[0].samplerBindings.push({sampler:null,texture:null,lateBinding:null})}},{key:"setBindingLayouts",value:function(e){eu(e.length<=this.bindingDescriptors.length),eu(1===e.length),this.setBindingLayout(e[0])}},{key:"drawIndexes",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.flags=du(this.flags,1,!0),this.drawCount=e,this.drawStart=t,this.drawInstanceCount=1}},{key:"drawIndexesInstanced",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.flags=du(this.flags,1,!0),this.drawCount=e,this.drawStart=n,this.drawInstanceCount=t}},{key:"drawPrimitives",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.flags=du(this.flags,1,!1),this.drawCount=e,this.drawStart=t,this.drawInstanceCount=1}},{key:"setUniformBuffer",value:function(e){this.uniformBuffer=e}},{key:"allocateUniformBuffer",value:function(e,t){return eu(this.bindingDescriptors[0].bindingLayout.numUniformBuffers<this.dynamicUniformBufferByteOffsets.length),this.dynamicUniformBufferByteOffsets[e]=this.uniformBuffer.allocateChunk(t)<<2,this.bindingDescriptors[0].uniformBufferBindings[e].wordCount=t,this.getUniformBufferOffset(e)}},{key:"getUniformBufferOffset",value:function(e){return this.dynamicUniformBufferByteOffsets[e]>>>2}},{key:"setUniformBufferOffset",value:function(e,t,n){this.dynamicUniformBufferByteOffsets[e]=t<<2,this.bindingDescriptors[0].uniformBufferBindings[e].wordCount=n}},{key:"mapUniformBufferF32",value:function(e){return this.uniformBuffer.mapBufferF32()}},{key:"getUniformBuffer",value:function(){return this.uniformBuffer}},{key:"setSamplerBindingsFromTextureMappings",value:function(e){e=e.filter((function(e){return e}));for(var t=0;t<this.bindingDescriptors[0].samplerBindings.length;t++){var n=this.bindingDescriptors[0].samplerBindings[t],r=e[t];null!=r?(n.texture=r.texture,n.sampler=r.sampler,n.lateBinding=r.lateBinding):(n.texture=null,n.sampler=null,n.lateBinding=null)}}},{key:"hasLateSamplerBinding",value:function(e){for(var t=0;t<this.bindingDescriptors[0].samplerBindings.length;t++)if(this.bindingDescriptors[0].samplerBindings[t].lateBinding===e)return!0;return!1}},{key:"resolveLateSamplerBinding",value:function(e,t){for(var n=0;n<this.bindingDescriptors[0].samplerBindings.length;n++){var r=this.bindingDescriptors[0].samplerBindings[n];r.lateBinding===e&&(null===t?(r.texture=null,r.sampler=null):(eu(null===t.lateBinding),r.texture=t.texture,null!==t.sampler&&(r.sampler=t.sampler)),r.lateBinding=null)}}},{key:"queryPipelineReady",value:function(e){var t=e.createRenderPipeline(this.renderPipelineDescriptor);return e.device.queryPipelineReady(t)}},{key:"setAllowSkippingIfPipelineNotReady",value:function(e){this.flags=du(this.flags,2,e)}},{key:"setAttachmentFormatsFromRenderPass",value:function(e,t){for(var n=e.queryRenderPass(t),r=-1,i=0;i<n.colorAttachment.length;i++){var o=null!==n.colorAttachment[i]?e.queryRenderTarget(n.colorAttachment[i]):null;this.renderPipelineDescriptor.colorAttachmentFormats[i]=null!==o?o.pixelFormat:null,null!==o&&(-1===r?r=o.sampleCount:eu(r===o.sampleCount))}var a=null!==n.depthStencilAttachment?e.queryRenderTarget(n.depthStencilAttachment):null;this.renderPipelineDescriptor.depthStencilAttachmentFormat=null!==a?a.pixelFormat:null,null!==a&&(-1===r?r=a.sampleCount:eu(r==a.sampleCount)),eu(r>0),this.renderPipelineDescriptor.sampleCount=r}},{key:"drawOnPass",value:function(e,t){var n=e.device;this.setAttachmentFormatsFromRenderPass(n,t);var r=e.createRenderPipeline(this.renderPipelineDescriptor);if(!n.queryPipelineReady(r)){if(2&this.flags)return!1;n.pipelineForceReady(r)}t.setPipeline(r),t.setInputState(this.inputState);for(var i=0;i<this.bindingDescriptors[0].uniformBufferBindings.length;i++)this.bindingDescriptors[0].uniformBufferBindings[i].buffer=tu(this.uniformBuffer.buffer);var o=e.createBindings(ls(ls({},this.bindingDescriptors[0]),{},{pipeline:r}));return t.setBindings(0,o,this.dynamicUniformBufferByteOffsets),this.drawInstanceCount>1?(eu(!!(1&this.flags)),t.drawIndexedInstanced(this.drawCount,this.drawStart,this.drawInstanceCount)):1&this.flags?t.drawIndexed(this.drawCount,this.drawStart):t.draw(this.drawCount,this.drawStart),!0}}]),e}(),Wl=function(){function e(){ds(this,e),this.pool=[],this.allocCount=0}return vs(e,[{key:"allocRenderInstIndex",value:function(){return this.allocCount++,this.allocCount>this.pool.length&&this.pool.push(new Gl),this.allocCount-1}},{key:"popRenderInst",value:function(){this.allocCount--}},{key:"reset",value:function(){for(var e=0;e<this.pool.length;e++)this.pool[e].reset();this.allocCount=0}},{key:"destroy",value:function(){this.pool.length=0,this.allocCount=0}}]),e}(),Vl=function(){function e(t){ds(this,e),this.renderCache=void 0,this.instPool=new Wl,this.templatePool=new Wl,this.simpleRenderInstList=new Ul,this.currentRenderInstList=this.simpleRenderInstList,this.renderCache=t}return vs(e,[{key:"newRenderInst",value:function(){var e=this.templatePool.allocCount-1,t=this.instPool.allocRenderInstIndex(),n=this.instPool.pool[t];return n.debug=null,e>=0&&n.setFromTemplate(this.templatePool.pool[e]),n}},{key:"submitRenderInst",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.currentRenderInstList;t.submitRenderInst(e)}},{key:"setCurrentRenderInstList",value:function(e){eu(null===this.simpleRenderInstList),this.currentRenderInstList=e}},{key:"pushTemplateRenderInst",value:function(){var e=this.templatePool.allocCount-1,t=this.templatePool.allocRenderInstIndex(),n=this.templatePool.pool[t];return e>=0&&n.setFromTemplate(this.templatePool.pool[e]),n.flags|=4,n}},{key:"popTemplateRenderInst",value:function(){this.templatePool.popRenderInst()}},{key:"getTemplateRenderInst",value:function(){var e=this.templatePool.allocCount-1;return this.templatePool.pool[e]}},{key:"resetRenderInsts",value:function(){this.instPool.reset(),null!==this.simpleRenderInstList&&this.simpleRenderInstList.reset(),eu(0===this.templatePool.allocCount)}},{key:"destroy",value:function(){this.instPool.destroy(),this.renderCache.destroy()}},{key:"disableSimpleMode",value:function(){this.simpleRenderInstList=null}},{key:"drawListOnPassRenderer",value:function(e,t){e.drawOnPassRenderer(this.renderCache,t)}},{key:"drawOnPassRenderer",value:function(e){tu(this.simpleRenderInstList).drawOnPassRenderer(this.renderCache,e)}},{key:"drawOnPassRendererNoReset",value:function(e){tu(this.simpleRenderInstList).drawOnPassRendererNoReset(this.renderCache,e)}}]),e}(),Xl=function(){function e(){ds(this,e),this.renderCache=void 0,this.renderGraph=void 0,this.renderInstManager=void 0,this.uniformBuffer=void 0,this.device=void 0}return vs(e,[{key:"getDevice",value:function(){return this.device}},{key:"setDevice",value:function(e){this.device=e,this.renderCache=new Ol(e),this.renderGraph=new Ll(this.device),this.renderInstManager=new Vl(this.renderCache),this.uniformBuffer=new Al(this.device)}},{key:"pushTemplateRenderInst",value:function(){var e=this.renderInstManager.pushTemplateRenderInst();return e.setUniformBuffer(this.uniformBuffer),e}},{key:"prepareToRender",value:function(){this.uniformBuffer.prepareToRender()}},{key:"destroy",value:function(){this.uniformBuffer.destroy(),this.renderInstManager.destroy(),this.renderCache.destroy(),this.renderGraph.destroy()}},{key:"getCache",value:function(){return this.renderCache}}]),e}();function Hl(e,t){return function(e,t){return(16777215&e|(255&t)<<24)>>>0}(function(e,t){return(0|(65535&t)<<8)>>>0}(0,t),e)}Xl=a([I()],Xl);var jl="undefined"!=typeof Float32Array?Float32Array:Array;function zl(){var e=new jl(16);return jl!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Yl(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function ql(e,t,n,r,i,o,a,s,u,c,l,h,f,d,p,v){var g=new jl(16);return g[0]=e,g[1]=t,g[2]=n,g[3]=r,g[4]=i,g[5]=o,g[6]=a,g[7]=s,g[8]=u,g[9]=c,g[10]=l,g[11]=h,g[12]=f,g[13]=d,g[14]=p,g[15]=v,g}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var Kl;function Zl(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return e[t+0]=n,e[t+1]=r,e[t+2]=i,e[t+3]=o,4}function $l(e,t,n){return e[t+0]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],16}ql(1,0,0,0,0,1,0,0,0,0,2,0,0,0,-1,1),ql(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1),function(e){e.saturate="\n  float saturate(float v) { return clamp(v, 0.0, 1.0); }\n  vec2 saturate(vec2 v) { return clamp(v, vec2(0.0), vec2(1.0)); }\n  vec3 saturate(vec3 v) { return clamp(v, vec3(0.0), vec3(1.0)); }\n  vec4 saturate(vec4 v) { return clamp(v, vec4(0.0), vec4(1.0)); }\n  ",e.invlerp="\n  float invlerp(float a, float b, float v) { return (v - a) / (b - a); }\n  ",e.fullscreenVS="\nlayout(location = 0) attribute vec2 a_Position;\n\nvarying vec2 v_TexCoord;\n\nvoid main() {\n  v_TexCoord = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n\n  #ifdef VIEWPORT_ORIGIN_TL\n    v_TexCoord.y = 1.0 - v_TexCoord.y;\n  #endif\n}\n  ",e.fullscreenBlitOneTexPS="\nuniform sampler2D u_Texture;\nvarying vec2 v_TexCoord;\n\nvoid main() {\n  gl_FragColor = texture(SAMPLER_2D(u_Texture), v_TexCoord);\n  gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n}\n  ",e.monochromeNTSC="\n  float MonochromeNTSC(vec3 t_Color) {\n      // NTSC primaries.\n      return dot(t_Color.rgb, vec3(0.299, 0.587, 0.114));\n  }\n  ",e.fxaa="\nvec4 FXAA(PD_SAMPLER_2D(t_Texture), in vec2 t_PixelCenter, in vec2 t_InvResolution) {\n    // FXAA v2, based on implementations:\n    // http://www.geeks3d.com/20110405/fxaa-fast-approximate-anti-aliasing-demo-glsl-opengl-test-radeon-geforce/\n    // https://github.com/mitsuhiko/webgl-meincraft\n\n    float lumaMM = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy).rgb);\n\n#if 1\n    vec2 t_PixelTopLeft = t_PixelCenter.xy - t_InvResolution.xy * 0.5;\n    float lumaNW = MonochromeNTSC(texture      (PU_SAMPLER_2D(t_Texture), t_PixelTopLeft.xy)             .rgb);\n    float lumaNE = MonochromeNTSC(textureOffset(PU_SAMPLER_2D(t_Texture), t_PixelTopLeft.xy, ivec2(1, 0)).rgb);\n    float lumaSW = MonochromeNTSC(textureOffset(PU_SAMPLER_2D(t_Texture), t_PixelTopLeft.xy, ivec2(0, 1)).rgb);\n    float lumaSE = MonochromeNTSC(textureOffset(PU_SAMPLER_2D(t_Texture), t_PixelTopLeft.xy, ivec2(1, 1)).rgb);\n#else\n    // We're at the pixel center -- pixel edges are 0.5 units away.\n    // NOTE(jstpierre): mitsuhiko's port seems to get this wrong?\n    vec2 t_PixelSize = t_InvResolution.xy * 0.5;\n\n    float lumaNW = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + t_PixelSize * vec2(-1.0, -1.0)).rgb);\n    float lumaNE = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + t_PixelSize * vec2( 1.0, -1.0)).rgb);\n    float lumaSW = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + t_PixelSize * vec2(-1.0,  1.0)).rgb);\n    float lumaSE = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + t_PixelSize * vec2( 1.0,  1.0)).rgb);\n#endif\n\n    vec2 dir; \n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    const float FXAA_REDUCE_MIN = 1.0/128.0;\n    const float FXAA_REDUCE_MUL = 1.0/8.0;\n    const float FXAA_SPAN_MAX = 8.0;\n\n    float dirReduce = max(\n        (lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL),\n        FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0/(min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2( FXAA_SPAN_MAX,  FXAA_SPAN_MAX), max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), dir * rcpDirMin)) * u_InvResolution.xy;\n\n    float lumaMin = min(lumaMM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaMM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    vec4 rgbA = (1.0/2.0) * (\n        texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + dir * (1.0/3.0 - 0.5)) +\n        texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + dir * (2.0/3.0 - 0.5)));\n    vec4 rgbB = rgbA * (1.0/2.0) + (1.0/4.0) * (\n        texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + dir * (0.0/3.0 - 0.5)) +\n        texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + dir * (3.0/3.0 - 0.5)));\n    float lumaB = MonochromeNTSC(rgbB.rgb);\n\n    vec4 rgbOutput = ((lumaB < lumaMin) || (lumaB > lumaMax)) ? rgbA : rgbB;\n    return rgbOutput;\n}\n"}(Kl||(Kl={}));var Ql=p.defineToken("RendererFactory"),Jl=p.defineToken("ShapeRenderer"),eh=function(){function e(t){ds(this,e),this.pixelFormat=void 0,this.width=0,this.height=0,this.sampleCount=0,this.colorClearColor="load",this.depthClearValue="load",this.stencilClearValue="load",this.pixelFormat=t}return vs(e,[{key:"setDimensions",value:function(e,t,n){this.width=e,this.height=t,this.sampleCount=n}},{key:"copyDimensions",value:function(e){this.width=e.width,this.height=e.height,this.sampleCount=e.sampleCount}}]),e}();function th(e){return{colorClearColor:e,depthClearValue:1,stencilClearValue:0}}var nh=th(su);function rh(e,t,n){var r=function(e){if(0===e)return ws.U8_RGBA_RT;if(4===e)return ws.D24;throw"whoops"}(e),i=new eh(r);return function(e,t){var n=function(e){return 2===e.antialiasingMode?4:1}(t);e.setDimensions(t.backbufferWidth,t.backbufferHeight,n)}(i,t),null!==n&&(i.colorClearColor=n.colorClearColor,i.depthClearValue=n.depthClearValue,i.stencilClearValue=n.stencilClearValue),i}var ih=["style"],oh=function(e){_s(n,e);var t=As(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.style,i=Es(e,ih);return ds(this,n),t.call(this,ls({type:n.tag,style:ls({intensity:Math.PI},r)},i))}return n}(si);oh.tag="light";var ah,sh,uh,ch=function(){function e(){ds(this,e),this.cache=[]}return vs(e,[{key:"addLight",value:function(e){this.cache.push(e)}},{key:"getAll",value:function(){return this.cache}}]),e}();ch=a([I()],ch);var lh,hh,fh,dh=(sh=ah=function(){function e(){ds(this,e),this.canvasConfig=void 0,this.contextService=void 0,this.renderingContext=void 0,this.camera=void 0,this.pluginOptions=void 0,this.pickingIdGenerator=void 0,this.rendererFactory=void 0,this.renderHelper=void 0,this.lightPool=void 0,this.device=void 0,this.swapChain=void 0,this.batches=[],this.renderLists={skyscape:new Ul,world:new Ul,picking:new Ul},this.builder=void 0,this.pickingTexture=void 0}var t,r,i;return vs(e,[{key:"getDevice",value:function(){return this.device}},{key:"apply",value:function(e){var t=this;e.hooks.init.tapPromise(uh.tag,fs(regeneratorRuntime.mark((function e(){var a,s,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.renderingContext.root.addEventListener(Wt.MOUNTED,n),t.renderingContext.root.addEventListener(Wt.UNMOUNTED,r),t.renderingContext.root.addEventListener(Wt.ATTRIBUTE_CHANGED,i),t.renderingContext.root.addEventListener(Wt.RENDER_ORDER_CHANGED,o),t.canvasConfig.renderer.getConfig().enableDirtyRectangleRendering=!1,a=t.contextService.getDomElement(),s=t.canvasConfig,u=s.width,c=s.height,t.contextService.resize(u,c),e.next=10,t.createSwapChain(a);case 10:t.device=t.swapChain.getDevice(),t.renderHelper.setDevice(t.device),t.renderHelper.renderInstManager.disableSimpleMode(),t.swapChain.configureSwapChain(a.width,a.height),t.renderingContext.root.ownerDocument.defaultView.on(Za.RESIZE,(function(){t.swapChain.configureSwapChain(a.width,a.height)}));case 15:case"end":return e.stop()}}),e)})))),e.hooks.destroy.tap(uh.tag,(function(){t.renderHelper.destroy(),t.renderingContext.root.removeEventListener(Wt.MOUNTED,n),t.renderingContext.root.removeEventListener(Wt.UNMOUNTED,r),t.renderingContext.root.removeEventListener(Wt.ATTRIBUTE_CHANGED,i),t.renderingContext.root.removeEventListener(Wt.RENDER_ORDER_CHANGED,o)})),e.hooks.beginFrame.tap(uh.tag,(function(){var e=t.swapChain.getCanvas(),n=t.renderHelper.renderInstManager;t.builder=t.renderHelper.renderGraph.newGraphBuilder();var r=co(t.canvasConfig.background).value,i={backbufferWidth:e.width,backbufferHeight:e.height,antialiasingMode:0},o=rh(0,i,th(ou.apply(void 0,Cs(r)))),a=rh(4,i,nh),s=t.builder.createRenderTargetID(o,"Main Render Target"),u=t.builder.createRenderTargetID(a,"Main Depth"),c=t.builder.createRenderTargetID(o,"Picking Render Target");t.builder.pushPass((function(e){e.setDebugName("Main Render Pass"),e.attachRenderTargetID(0,s),e.attachRenderTargetID(1,c),e.attachRenderTargetID(4,u),e.exec((function(e){n.drawListOnPassRenderer(t.renderLists.world,e)})),e.post((function(e){t.pickingTexture=e.getRenderTargetTexture(1)}))})),t.builder.resolveRenderTargetToExternalTexture(s,t.swapChain.getOnscreenTexture())})),e.hooks.endFrame.tap(uh.tag,(function(){var e,n,r=t.renderHelper.renderInstManager,i=t.renderHelper.pushTemplateRenderInst();i.setBindingLayouts([{numUniformBuffers:2,numSamplers:0}]),i.setMegaStateFlags((e={depthWrite:!0},n={rgbBlendMode:Ws.Add,alphaBlendMode:Ws.Add,rgbBlendSrcFactor:Gs.SrcAlpha,alphaBlendSrcFactor:Gs.One,rgbBlendDstFactor:Gs.OneMinusSrcAlpha,alphaBlendDstFactor:Gs.One},void 0===e.attachmentsState&&(e.attachmentsState=[],yu(e.attachmentsState,Ru.attachmentsState)),function(e,t){void 0!==t.channelWriteMask&&(e.channelWriteMask=t.channelWriteMask),void 0!==t.rgbBlendMode&&(e.rgbBlendState.blendMode=t.rgbBlendMode),void 0!==t.alphaBlendMode&&(e.alphaBlendState.blendMode=t.alphaBlendMode),void 0!==t.rgbBlendSrcFactor&&(e.rgbBlendState.blendSrcFactor=t.rgbBlendSrcFactor),void 0!==t.alphaBlendSrcFactor&&(e.alphaBlendState.blendSrcFactor=t.alphaBlendSrcFactor),void 0!==t.rgbBlendDstFactor&&(e.rgbBlendState.blendDstFactor=t.rgbBlendDstFactor),void 0!==t.alphaBlendDstFactor&&(e.alphaBlendState.blendDstFactor=t.alphaBlendDstFactor)}(e.attachmentsState[0],n),e));var o=i.allocateUniformBuffer(0,40),a=i.mapUniformBufferF32(0);o+=$l(a,o,t.camera.getPerspective()),o+=$l(a,o,t.camera.getViewTransform()),o+=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return e[t+0]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=r,4}(a,o,t.camera.getPosition(),t.contextService.getDPR());var s=t.canvasConfig;o+=Zl(a,o,s.width,s.height,t.camera.isOrtho()?1:0),r.setCurrentRenderInstList(t.renderLists.world),t.batches.forEach((function(e){e.render(t.renderLists.world)})),r.popTemplateRenderInst(),t.renderHelper.prepareToRender(),t.renderHelper.renderGraph.execute(),r.resetRenderInsts(),t.swapChain.present()})),e.hooks.render.tap(uh.tag,(function(n){if(n.nodeName!==tn.Group){var r=n.renderable3D;if(r&&!r.batchId){var i=t.batches.find((function(e){return e.checkBatchable(n)}));i||(i=t.rendererFactory(n.nodeName))&&(i.init(t.device,e),t.batches.push(i)),i&&(i.merge(n),r.batchId=i.id)}}}));var n=function(e){var n=e.target;if(n.nodeName!==oh.tag){var r=new Ds,i=t.pickingIdGenerator.getId(n);r.pickingId=i,r.encodedPickingColor=t.pickingIdGenerator.encodePickingColor(i),n.renderable3D=r}else t.lightPool.addLight(n)},r=function(e){var n=e.target,r=n.renderable3D;if(r&&r.batchId){var i=t.batches.findIndex((function(e){return e.id===r.batchId})),o=t.batches[i];o&&(o.purge(n),0===o.objects.length&&t.batches.splice(i,1))}delete n.renderable3D},i=function(e){var n=e.target,r=e.detail,i=r.attributeName,o=r.newValue,a=n.renderable3D;if(a){var s=t.batches.find((function(e){return a.batchId===e.id}));s&&s.updateAttribute(n,i,o)}},o=function(e){var n=e.target,r=e.detail.renderOrder,i=n.renderable3D;if(i){var o=t.batches.find((function(e){return i.batchId===e.id}));o&&o.changeRenderOrder(n,r)}}}},{key:"createSwapChain",value:(i=fs(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=this.pluginOptions.targets).includes("webgpu")){e.next=5;break}return e.next=4,this.createSwapChainForWebGPU(t);case 4:this.swapChain=e.sent;case 5:this.swapChain||(this.swapChain=this.createSwapChainForWebGL(t,n));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"createSwapChainForWebGL",value:function(e,t){var n,r={antialias:!1,preserveDrawingBuffer:!1,stencil:!0};return this.handleContextEvents(e),t.includes("webgl2")&&(n=e.getContext("webgl2",r)||e.getContext("experimental-webgl2",r)),!n&&t.includes("webgl1")&&(n=e.getContext("webgl",r)||e.getContext("experimental-webgl",r)),new nl(n,{shaderDebug:!0,trackResources:!0})}},{key:"createSwapChainForWebGPU",value:(r=fs(regeneratorRuntime.mark((function e(t){var r,i,o,a,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==navigator.gpu){e.next=2;break}return e.abrupt("return",null);case 2:return r=null,e.prev=3,e.next=6,navigator.gpu.requestAdapter();case 6:r=e.sent,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),console.log(e.t0);case 12:if(null!==r){e.next=14;break}return e.abrupt("return",null);case 14:return i=["depth24unorm-stencil8","depth32float-stencil8","texture-compression-bc"].filter((function(e){return r.features.has(e)})),e.next=18,r.requestDevice({requiredFeatures:i});case 18:if(null!==(o=e.sent)){e.next=21;break}return e.abrupt("return",null);case 21:if(a=t.getContext("webgpu")){e.next=24;break}return e.abrupt("return",null);case 24:return e.next=26,function(e,t,r,i){function o(e,t,n){var r=n?WebAssembly.instantiateStreaming:WebAssembly.instantiate,i=n?WebAssembly.compileStreaming:WebAssembly.compile;return t?r(e,t):i(e)}var a="undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node;if(a){var s=n(6285),u=n(5e3);return new Promise(((e,n)=>{s.readFile(u.resolve("/",t),((t,r)=>{null!=t&&n(t),e(o(r,i,!1))}))}))}return o(fetch(t),i,!0)}(0,"8bebd36b4e823422.wasm",0,void 0);case 26:return s=e.sent,u=s.glsl_compile,e.abrupt("return",new Rl(r,o,t,a,u));case 29:case"end":return e.stop()}}),e,null,[[3,9]])}))),function(e){return r.apply(this,arguments)})},{key:"handleContextEvents",value:function(e){var t=this.pluginOptions,n=t.onContextLost,r=t.onContextRestored,i=t.onContextCreationError;i&&e.addEventListener("webglcontextcreationerror",i,!1),n&&e.addEventListener("webglcontextlost",n,!1),r&&e.addEventListener("webglcontextrestored",r,!1)}},{key:"pickByRectangle",value:(t=fs(regeneratorRuntime.mark((function e(t){var n,r,i,o,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=[],r=this.device.createReadback(),!this.pickingTexture){e.next=10;break}return e.next=5,r.readTexture(this.pickingTexture,t.x,t.y,t.width,t.height,new Uint8Array(t.width*t.height*4));case 5:i=e.sent,o=-1,!i||0===i[0]&&0===i[1]&&0===i[2]||(o=this.pickingIdGenerator.decodePickingColor(i)),o>-1&&(a=this.pickingIdGenerator.getById(o))&&a.interactive&&-1===n.indexOf(a)&&n.push(a),r.destroy();case 10:return e.abrupt("return",n);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}(),ah.tag="RenderGraphPlugin",uh=sh);a([D(cn),s("design:type",Object)],dh.prototype,"canvasConfig",void 0),a([D(Sn),s("design:type",Object)],dh.prototype,"contextService",void 0),a([D(xn),s("design:type",Object)],dh.prototype,"renderingContext",void 0),a([D(wa),s("design:type",Ga)],dh.prototype,"camera",void 0),a([D(Hs),s("design:type",Object)],dh.prototype,"pluginOptions",void 0),a([D(Fs),s("design:type",Fs)],dh.prototype,"pickingIdGenerator",void 0),a([D(Ql),s("design:type",Function)],dh.prototype,"rendererFactory",void 0),a([D(Xl),s("design:type",Xl)],dh.prototype,"renderHelper",void 0),a([D(ch),s("design:type",ch)],dh.prototype,"lightPool",void 0),dh=uh=a([I({contrib:Si})],dh);var ph=(hh=lh=function(){function e(){ds(this,e),this.canvasConfig=void 0,this.sceneGraphService=void 0,this.contextService=void 0,this.renderGraphPlugin=void 0}return vs(e,[{key:"apply",value:function(e){var t=this;e.hooks.pick.tapPromise(fh.tag,function(){var e=fs(regeneratorRuntime.mark((function e(n){var r,i,o,a,s,u,c,l,h,f,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.position,i=r.viewportX,o=r.viewportY,a=t.contextService.getDPR(),s=t.canvasConfig.width*a,u=t.canvasConfig.height*a,l=o*a,!((c=i*a)>s||c<0||l>u||l<0)){e.next=9;break}return n.picked=null,e.abrupt("return",n);case 9:return e.next=11,t.renderGraphPlugin.pickByRectangle(new Kt(ie(Math.round(c),0,s-1),ie(Math.round(u-(o+1)*a),0,u-1),1,1));case 11:return h=e.sent,f=xs(h,1),d=f[0],n.picked=d||null,e.abrupt("return",n);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}}]),e}(),lh.tag="PickingPlugin",fh=hh);function vh(e,t,n){var r,i=e.createBuffer({viewOrSize:(r=n.byteLength,4,3,(r+3&-4)/4),usage:t,hint:1});return i.setSubData(0,new Uint8Array(n)),i}a([D(cn),s("design:type",Object)],ph.prototype,"canvasConfig",void 0),a([D(rn),s("design:type",Object)],ph.prototype,"sceneGraphService",void 0),a([D(Sn),s("design:type",Object)],ph.prototype,"contextService",void 0),a([D(dh),s("design:type",dh)],ph.prototype,"renderGraphPlugin",void 0),ph=fh=a([I({contrib:Si})],ph);var gh=function(){function e(){ds(this,e),this.drawMode=1,this.device=void 0,this.vertexBuffers=[],this.indicesBuffer=void 0,this.inputLayoutDescriptor={vertexBufferDescriptors:[],vertexAttributeDescriptors:[],indexBufferFormat:ws.U32_R},this.vertexCount=0,this.maxInstancedCount=void 0}return vs(e,[{key:"destroy",value:function(){this.vertexBuffers.forEach((function(e){e&&e.destroy()})),this.indicesBuffer&&this.indicesBuffer.destroy(),this.indicesBuffer=void 0,this.vertexBuffers=[],this.vertexCount=0,this.maxInstancedCount=0}},{key:"setVertexBuffer",value:function(e){var t=this,n=e.bufferIndex,r=e.byteStride,i=e.frequency,o=e.attributes,a=e.data;this.inputLayoutDescriptor.vertexBufferDescriptors[n]={byteStride:r,frequency:i},o.forEach((function(e){var r=e.format,i=e.bufferByteOffset,o=e.location,a=e.divisor,s=e.byteStride,u=t.inputLayoutDescriptor.vertexAttributeDescriptors.find((function(e){return e.bufferIndex===n&&e.location===o}));u?(u.format=r,u.bufferByteOffset=i,u.byteStride=s,u.divisor=a):t.inputLayoutDescriptor.vertexAttributeDescriptors.push({format:r,bufferIndex:n,bufferByteOffset:i,location:o,byteStride:s,divisor:a})})),this.vertexBuffers[n]&&this.vertexBuffers[n].destroy();var s=vh(this.device,2,a.buffer);return this.vertexBuffers[n]=s,this}},{key:"getVertexBuffer",value:function(e){return this.vertexBuffers[e]}},{key:"updateVertexBuffer",value:function(e,t,n,r){var i=this.inputLayoutDescriptor.vertexBufferDescriptors[e].byteStride,o=this.inputLayoutDescriptor.vertexAttributeDescriptors.find((function(e){return e.location===t}));if(o){var a=n*i;this.getVertexBuffer(e).setSubData(o.bufferByteOffset+a,r)}}},{key:"updateIndices",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.indicesBuffer&&this.indicesBuffer.setSubData(t,ArrayBuffer.isView(e)?e:new Uint32Array(e)),this}},{key:"setIndices",value:function(e){return this.indicesBuffer&&this.indicesBuffer.destroy(),this.indicesBuffer=vh(this.device,1,new Uint32Array(ArrayBuffer.isView(e)?e.buffer:e).buffer),this}}]),e}(),_h=(z.EventEmitter,function(){function e(){ds(this,e),this.texture=null,this.sampler=null,this.lateBinding=null,this.width=0,this.height=0,this.lodBias=0,this.flipY=!1}return vs(e,[{key:"reset",value:function(){this.texture=null,this.sampler=null,this.lateBinding=null,this.width=0,this.height=0,this.lodBias=0,this.flipY=!1}},{key:"fillFromTextureOverride",value:function(e){return this.texture=e.texture,e.sampler&&(this.sampler=e.sampler),this.width=e.width,this.height=e.height,this.flipY=e.flipY,e.lateBinding&&(this.lateBinding=e.lateBinding),!0}},{key:"copy",value:function(e){this.texture=e.texture,this.sampler=e.sampler,this.lateBinding=e.lateBinding,this.width=e.width,this.height=e.height,this.lodBias=e.lodBias,this.flipY=e.flipY}}]),e}()),yh=[[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]];function mh(e,t){return"#define ".concat(e," ").concat(t)}function Eh(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o="#version 100"===e.glslVersion,a=e.supportMRT&&!!i.MRT,s=n.split("\n").map((function(e){return e.replace(/[/][/].*$/,"")})).filter((function(e){return!(!e||/^\s+$/.test(e))})),u="";null!==r&&(u=Cs(r.entries()).map((function(e){var t=xs(e,2);return mh(t[0],t[1])})).join("\n"));var c=s.find((function(e){return e.startsWith("precision")}))||"precision mediump float;",l=s.filter((function(e){return!e.startsWith("precision")})).join("\n"),h="";if(1===e.viewportOrigin&&(h+="".concat(mh("VIEWPORT_ORIGIN_TL","1"),"\n")),1===e.clipSpaceNearZ&&(h+="".concat(mh("CLIPSPACE_NEAR_ZERO","1"),"\n")),e.explicitBindingLocations){var f=0,d=0,p=0;l=l.replace(/^(layout\((.*)\))?\s*uniform(.+{)$/gm,(function(e,t,n,r){var i=n?"".concat(n,", "):"";return"layout(".concat(i,"set = ").concat(f,", binding = ").concat(d++,") uniform ").concat(r)})),f++,d=0,eu(e.separateSamplerTextures),l=(l=l.replace(/uniform sampler2D (.*);/g,(function(e,n){return"frag"===t?"\nlayout(set = ".concat(f,", binding = ").concat(d++,") uniform texture2D T_").concat(n,";\nlayout(set = ").concat(f,", binding = ").concat(d++,") uniform sampler S_").concat(n,";\n"):""}))).replace("frag"===t?/^\b(varying|in)\b/gm:/^\b(varying|out)\b/gm,(function(e,t){return"layout(location = ".concat(p++,") ").concat(t)})),h+="".concat(mh("gl_VertexID","gl_VertexIndex"),"\n")}var v=(l=e.separateSamplerTextures?(l=(l=(l=l.replace(/\bPD_SAMPLER_2D\((.*?)\)/g,(function(e,t){return"texture2D T_P_".concat(t,", sampler S_P_").concat(t)}))).replace(/\bPU_SAMPLER_2D\((.*?)\)/g,(function(e,t){return"SAMPLER_2D(P_".concat(t,")")}))).replace(/\bPP_SAMPLER_2D\((.*?)\)/g,(function(e,t){return"T_".concat(t,", S_").concat(t)}))).replace(/\bSAMPLER_2D\((.*?)\)/g,(function(e,t){return"sampler2D(T_".concat(t,", S_").concat(t,")")})):(l=(l=(l=l.replace(/\bPD_SAMPLER_2D\((.*?)\)/g,(function(e,t){return"sampler2D P_".concat(t)}))).replace(/\bPU_SAMPLER_2D\((.*?)\)/g,(function(e,t){return"SAMPLER_2D(P_".concat(t,")")}))).replace(/\bPP_SAMPLER_2D\((.*?)\)/g,(function(e,t){return t}))).replace(/\bSAMPLER_2D\((.*?)\)/g,(function(e,t){return t}))).includes("gl_FragColor"),g="\n".concat(e.glslVersion,"\n").concat(o&&a?"#extension GL_EXT_draw_buffers : require":"","\n").concat(c,"\n#define ").concat(t.toUpperCase(),"\n").concat(o?"":"\n#define attribute in\n#define varying ".concat("vert"===t?"out":"in","\n"),"\n#define main").concat("vert"===t?"VS":"PS"," main\n").concat(h,"\n").concat(v&&"\n".concat("frag"===t&&a?"#define gl_FragColor gbuf_color\nlayout(location = 0) out vec4 gbuf_color;\n":"","\n").concat("frag"===t&&a?"layout(location = 1) out vec4 gbuf_picking;":"","\n")||"","\n").concat(u,"\n").concat(l,"\n").trim();if(e.explicitBindingLocations&&"frag"===t&&(g=g.replace(/^\b(out)\b/gm,(function(e,t){return"layout(location = 0) ".concat(t)}))),o){if(g=g.replace(/\s*uniform\s*.*\s*{((?:\s*.*\s*)*?)};/g,(function(e,t){return t.trim().replace(/^.*$/gm,(function(e){return e?"uniform ".concat(e.trim()):""}))})),a&&"frag"===t){var _=[],y=(g=(g=g.replace(/^layout\(location\s*=\s*\d*\)\s*out\s*vec4\s*(.*);$/gm,(function(e,t){return _.push(t),""}))).replace(/^void\s*main\(\)\s*{$/gm,(function(){return"void main() {\n  ".concat(_.map((function(e){return"vec4 ".concat(e,";")})).join("\n"),"\n")}))).lastIndexOf("}");g=g.substring(0,y)+"gbuf_color = gl_FragColor;\n".concat(_.map((function(e,t){return"gl_FragData[".concat(t,"] = ").concat(e,";\n")})).join("\n"))+g.substring(y)}g=g.replace(/^\s*layout\((.*)\)/gm,"");var m,E=Is(yh);try{for(E.s();!(m=E.n()).done;){var T=xs(m.value,2),R=T[0],A=T[1];g=g.replace(R,A)}}catch(e){E.e(e)}finally{E.f()}}return g}var Th,Rh,Ah,Sh=function(){function e(){ds(this,e),this.offscreenCanvas=void 0,this.textureCache={},this.gradientCache={}}return vs(e,[{key:"getOrCreateTexture",value:function(e,t,n,r){var i=this,o="string"==typeof t?t:t.src||"";if(!this.textureCache[o])if(this.textureCache[o]=e.createTexture(ls(ls({},n),{},{immutable:!1})),"string"!=typeof t)this.textureCache[o].setImageData(t,0);else{var a=new window.Image;a.onload=function(){i.textureCache[o].setImageData(a,0),r()},a.onerror=function(){},a.crossOrigin="Anonymous",a.src=t}return this.textureCache[o]}},{key:"getOrCreateCanvas",value:function(){return this.offscreenCanvas.getOrCreateCanvas()}},{key:"getOrCreateGradient",value:function(e){var t=this.generateCacheKey(e),n=e.type,r=e.x0,i=e.y0,o=e.x1,a=e.y1,s=e.steps,u=e.width,c=e.height,l=this.gradientCache[t],h=this.offscreenCanvas.getOrCreateCanvas(),f=this.offscreenCanvas.getOrCreateContext();if(!l){if(h.width=u,h.height=c,n===Oi.LinearGradient)l=f.createLinearGradient(r*u,i*c,o*u,a*c);else if(n===Oi.RadialGradient){var d=Math.sqrt(u*u+c*c)/2;l=f.createRadialGradient(r*u,i*c,0,o*u,a*c,e.r1*d)}s.forEach((function(e){var t,n=xs(e,2),r=n[0],i=n[1];null===(t=l)||void 0===t||t.addColorStop(Number(r),i)})),this.gradientCache[t]=l}l&&(f.fillStyle=l,f.fillRect(0,0,u,c))}},{key:"generateCacheKey",value:function(e){var t=e.type,n=e.x0,r=e.y0,i=e.x1,o=e.y1,a=e.r1,s=e.steps,u=e.width,c=e.height;return"gradient-".concat(t,"-").concat(n,"-").concat(r,"-").concat(i,"-").concat(o,"-").concat(a||0,"-").concat(u,"-").concat(c,"-").concat(s.map((function(e){return e.join("")})).join("-"))}},{key:"destroy",value:function(){for(var e in this.textureCache)this.textureCache[e].destroy();this.textureCache={},this.gradientCache={}}}]),e}();a([D(pn),s("design:type",pn)],Sh.prototype,"offscreenCanvas",void 0),Sh=a([I()],Sh);var bh,xh=.005,Ch=1;!function(e){e[e.a_ModelMatrix0=0]="a_ModelMatrix0",e[e.a_ModelMatrix1=1]="a_ModelMatrix1",e[e.a_ModelMatrix2=2]="a_ModelMatrix2",e[e.a_ModelMatrix3=3]="a_ModelMatrix3",e[e.a_Color=4]="a_Color",e[e.a_StrokeColor=5]="a_StrokeColor",e[e.a_StylePacked1=6]="a_StylePacked1",e[e.a_StylePacked2=7]="a_StylePacked2",e[e.a_PickingColor=8]="a_PickingColor",e[e.a_Anchor=9]="a_Anchor",e[e.MAX=10]="MAX"}(bh||(bh={}));var Mh=(Rh=Th=function(){function e(){ds(this,e),this.renderHelper=void 0,this.texturePool=void 0,this.camera=void 0,this.device=void 0,this.renderingService=void 0,this.id=Ch++,this.type=void 0,this.objects=[],this.geometry=void 0,this.inputState=void 0,this.fillMapping=void 0,this.geometryDirty=!0,this.inputStateDirty=!0,this.programDescriptorSimpleWithOrig=void 0,this.instanced=!0}return vs(e,[{key:"instance",get:function(){return this.objects[0]}},{key:"init",value:function(e,t){this.device=e,this.renderingService=t,this.geometry=new gh,this.geometry.device=this.device}},{key:"checkBatchable",value:function(e){return 0===this.objects.length||this.instance.nodeName===e.nodeName&&this.validate(e)}},{key:"merge",value:function(e){this.type=e.nodeName,-1===this.objects.indexOf(e)&&(this.objects.push(e),this.geometryDirty=!0)}},{key:"purge",value:function(e){this.geometryDirty=!0;var t=this.objects.indexOf(e);this.objects.splice(t,1)}},{key:"createGeometry",value:function(){var e=this;this.buildGeometry();var t,n=zl(),r=zl(),i=(t=new jl(9),jl!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t);if(this.instanced){var o=[];this.objects.forEach((function(t){var a=t.parsedStyle,s=a.fill,u=a.stroke,c=a.opacity,l=a.fillOpacity,h=a.strokeOpacity,f=a.lineWidth,d=void 0===f?0:f,p=a.anchor,v=a.visibility,g=[0,0,0,0];(null==s?void 0:s.type)===Oi.Constant&&(g=s.value);var _=[0,0,0,0];(null==u?void 0:u.type)===Oi.Constant&&(_=u.value),Yl(n,t.getWorldTransform()),function(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],c=t[6],l=t[7],h=t[8],f=t[9],d=t[10],p=t[11],v=t[12],g=t[13],_=t[14],y=t[15],m=n[0],E=n[1],T=n[2],R=n[3];e[0]=m*r+E*s+T*h+R*v,e[1]=m*i+E*u+T*f+R*g,e[2]=m*o+E*c+T*d+R*_,e[3]=m*a+E*l+T*p+R*y,m=n[4],E=n[5],T=n[6],R=n[7],e[4]=m*r+E*s+T*h+R*v,e[5]=m*i+E*u+T*f+R*g,e[6]=m*o+E*c+T*d+R*_,e[7]=m*a+E*l+T*p+R*y,m=n[8],E=n[9],T=n[10],R=n[11],e[8]=m*r+E*s+T*h+R*v,e[9]=m*i+E*u+T*f+R*g,e[10]=m*o+E*c+T*d+R*_,e[11]=m*a+E*l+T*p+R*y,m=n[12],E=n[13],T=n[14],R=n[15],e[12]=m*r+E*s+T*h+R*v,e[13]=m*i+E*u+T*f+R*g,e[14]=m*o+E*c+T*d+R*_,e[15]=m*a+E*l+T*p+R*y}(r,e.camera.getViewTransform(),n),function(e,t){e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10]}(i,r),function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],c=t[7],l=t[8],h=l*a-s*c,f=-l*o+s*u,d=c*o-a*u,p=n*h+r*f+i*d;p&&(p=1/p,e[0]=h*p,e[1]=(-l*r+i*c)*p,e[2]=(s*r-i*a)*p,e[3]=f*p,e[4]=(l*n-i*u)*p,e[5]=(-s*n+i*o)*p,e[6]=d*p,e[7]=(-c*n+r*u)*p,e[8]=(a*n-r*o)*p)}(i,i),function(e,t){if(e===t){var n=t[1],r=t[2],i=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=r,e[7]=i}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8]}(i,i);var y=t.renderable3D.encodedPickingColor;o.push.apply(o,Cs(n).concat(Cs(g),Cs(_),[c,l,h,d,"visible"===v?1:0,0,0,0],Cs(y),[t.sortable.renderOrder*xh,p[0],p[1]]))})),this.geometry.maxInstancedCount=this.objects.length,this.geometry.setVertexBuffer({bufferIndex:Ah.CommonBufferIndex,byteStride:152,frequency:2,attributes:[{format:ws.F32_RGBA,bufferByteOffset:0,location:bh.a_ModelMatrix0,divisor:1},{format:ws.F32_RGBA,bufferByteOffset:16,location:bh.a_ModelMatrix1,divisor:1},{format:ws.F32_RGBA,bufferByteOffset:32,location:bh.a_ModelMatrix2,divisor:1},{format:ws.F32_RGBA,bufferByteOffset:48,location:bh.a_ModelMatrix3,divisor:1},{format:ws.F32_RGBA,bufferByteOffset:64,location:bh.a_Color,divisor:1},{format:ws.F32_RGBA,bufferByteOffset:80,location:bh.a_StrokeColor,divisor:1},{format:ws.F32_RGBA,bufferByteOffset:96,location:bh.a_StylePacked1,divisor:1},{format:ws.F32_RGBA,bufferByteOffset:112,location:bh.a_StylePacked2,divisor:1},{format:ws.F32_RGBA,bufferByteOffset:128,location:bh.a_PickingColor,divisor:1},{format:ws.F32_RG,bufferByteOffset:144,location:bh.a_Anchor,divisor:1}],data:new Float32Array(o)})}this.buildGradient()}},{key:"buildGradient",value:function(){var e,t=this,n=this.instance,r=n.nodeName===tn.Line?n.parsedStyle.stroke:n.parsedStyle.fill;!r||r.type!==Oi.Pattern&&r.type!==Oi.LinearGradient&&r.type!==Oi.RadialGradient||(this.program.setDefineBool("USE_UV",!0),this.program.setDefineBool("USE_MAP",!0),r.type===Oi.LinearGradient||r.type===Oi.RadialGradient?(this.texturePool.getOrCreateGradient(ls(ls({type:r.type},r.value),{},{width:128,height:128})),e=this.texturePool.getOrCreateCanvas()):e=r.value.src,this.fillMapping=new _h,this.fillMapping.texture=this.texturePool.getOrCreateTexture(this.device,e,Js(ws.U8_RGBA_NORM,1,1,1),(function(){t.objects.forEach((function(e){e.renderable.dirty=!0,t.renderingService.dirtify()}))})),this.device.setResourceName(this.fillMapping.texture,"Fill Texture"+this.id),this.fillMapping.sampler=this.renderHelper.getCache().createSampler({wrapS:1,wrapT:1,minFilter:1,magFilter:1,mipFilter:0,minLOD:0,maxLOD:0}))}},{key:"destroy",value:function(){this.geometry&&this.geometry.destroy(),this.inputState&&this.inputState.destroy()}},{key:"render",value:function(e){this.beforeRender&&this.beforeRender(e),this.geometryDirty&&(this.geometry&&this.geometry.destroy(),this.createGeometry(),this.geometryDirty=!1,this.inputStateDirty=!0);var t=this.renderHelper.getCache().createInputLayout(this.geometry.inputLayoutDescriptor);this.program.dirty&&(this.programDescriptorSimpleWithOrig=function(e,t){var n=void 0!==t.defines?t.defines:null,r=void 0!==t.features?t.features:null,i=void 0!==t.both?t.both+t.vert:t.vert,o=void 0!==t.both?t.both+t.frag:t.frag;return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return{vert:t,frag:n,preprocessedVert:Eh(e,"vert",t,r,i),preprocessedFrag:Eh(e,"frag",n,r,i)}}(e.queryVendorInfo(),i,o,n,r)}(this.device,this.program),this.program.dirty=!1);var n=this.renderHelper.getCache().createProgramSimple(this.programDescriptorSimpleWithOrig);this.inputStateDirty&&(this.inputState&&this.inputState.destroy(),this.inputState=this.device.createInputState(t,this.geometry.vertexBuffers.map((function(e){return{buffer:e,byteOffset:0}})),{buffer:this.geometry.indicesBuffer,byteOffset:0},n),this.inputStateDirty=!1);var r=this.renderHelper.renderInstManager.newRenderInst();r.setProgram(n),r.setInputLayoutAndState(t,this.inputState),this.fillMapping,this.uploadUBO(r),r.drawIndexesInstanced(this.geometry.vertexCount,this.geometry.maxInstancedCount),r.sortKey=Hl(32,n.id),this.renderHelper.renderInstManager.submitRenderInst(r,e),this.afterRender&&this.afterRender(e),this.objects.forEach((function(e){e.renderable.dirty=!1}))}},{key:"changeRenderOrder",value:function(e,t){var n=this.objects.indexOf(e),r=this.geometry;if(this.instanced&&r.vertexBuffers.length){var i=e.renderable3D.encodedPickingColor;r.updateVertexBuffer(Ah.CommonBufferIndex,bh.a_PickingColor,n,new Uint8Array(new Float32Array([].concat(Cs(i),[t*xh])).buffer))}}},{key:"updateAttribute",value:function(e,t,n){var r=this.objects.indexOf(e),i=this.geometry;if(this.instanced)if("fill"===t){var o=e.parsedStyle.fill,a=[0,0,0,0];(null==o?void 0:o.type)===Oi.Constant&&(a=o.value),i.updateVertexBuffer(Ah.CommonBufferIndex,bh.a_Color,r,new Uint8Array(new Float32Array(Cs(a)).buffer))}else if("stroke"===t){var s=e.parsedStyle.stroke,u=[0,0,0,0];(null==s?void 0:s.type)===Oi.Constant&&(u=s.value),i.updateVertexBuffer(Ah.CommonBufferIndex,bh.a_StrokeColor,r,new Uint8Array(new Float32Array(Cs(u)).buffer))}else if(["opacity","fillOpacity","strokeOpacity","lineWidth"].indexOf(t)>-1){var c=e.parsedStyle,l=c.opacity,h=c.fillOpacity,f=c.strokeOpacity,d=c.lineWidth,p=void 0===d?0:d;i.updateVertexBuffer(Ah.CommonBufferIndex,bh.a_StylePacked1,r,new Uint8Array(new Float32Array([l,h,f,p]).buffer))}else if("modelMatrix"===t){var v=Yl(zl(),e.getWorldTransform());i.updateVertexBuffer(Ah.CommonBufferIndex,bh.a_ModelMatrix0,r,new Uint8Array(new Float32Array(v).buffer))}else if("anchor"===t){var g=e.parsedStyle.anchor;i.updateVertexBuffer(Ah.CommonBufferIndex,bh.a_Anchor,r,new Uint8Array(new Float32Array([g[0],g[1]]).buffer))}else if("visibility"===t){var _=e.parsedStyle.visibility;i.updateVertexBuffer(Ah.CommonBufferIndex,bh.a_StylePacked2,r,new Uint8Array(new Float32Array(["visible"===_?1:0]).buffer))}}}]),e}(),Th.tag="batch",Th.CommonBufferIndex=0,Ah=Rh);a([D(Xl),s("design:type",Xl)],Mh.prototype,"renderHelper",void 0),a([D(Sh),s("design:type",Sh)],Mh.prototype,"texturePool",void 0),a([D(wa),s("design:type",Ga)],Mh.prototype,"camera",void 0),Mh=Ah=a([B()],Mh);var Ph=function(){function e(){ds(this,e),this.name="(unnamed)",this.preprocessedVert="",this.preprocessedFrag="",this.both="",this.vert="",this.frag="",this.defines=new Map,this.features={MRT:!0},this.dirty=!0}return vs(e,[{key:"definesChanged",value:function(){this.preprocessedVert="",this.preprocessedFrag=""}},{key:"setDefineString",value:function(e,t){if(null!==t){if(this.defines.get(e)===t)return!1;this.defines.set(e,t)}else{if(!this.defines.has(e))return!1;this.defines.delete(e)}return this.definesChanged(),!0}},{key:"setDefineBool",value:function(e,t){return this.setDefineString(e,t?"1":null)}},{key:"getDefineString",value:function(e){return lu(this.defines.get(e))}},{key:"getDefineBool",value:function(e){var t=this.getDefineString(e);return null!==t&&eu("1"===t),null!==t}},{key:"ensurePreprocessed",value:function(e){""===this.preprocessedVert&&(this.preprocessedVert=Eh(e,"vert",this.both+this.vert,this.defines,this.features),this.preprocessedFrag=Eh(e,"frag",this.both+this.frag,this.defines,this.features))}}]),e}(),Nh="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  bool u_IsOrtho;\n};\n\nlayout(location = 0) attribute vec4 a_ModelMatrix0;\nlayout(location = 1) attribute vec4 a_ModelMatrix1;\nlayout(location = 2) attribute vec4 a_ModelMatrix2;\nlayout(location = 3) attribute vec4 a_ModelMatrix3;\nlayout(location = 4) attribute vec4 a_Color;\nlayout(location = 5) attribute vec4 a_StrokeColor;\nlayout(location = 6) attribute vec4 a_StylePacked1;\nlayout(location = 7) attribute vec4 a_StylePacked2;\nlayout(location = 8) attribute vec4 a_PickingColor;\nlayout(location = 9) attribute vec2 a_Anchor;\n// layout(location = {AttributeLocation.a_Uv}) attribute vec2 a_Uv;\n\nvarying vec4 v_PickingResult;\nvarying vec4 v_Color;\nvarying vec4 v_StrokeColor;\nvarying vec4 v_StylePacked1;\nvarying vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nlayout(location = 10) attribute vec2 a_Extrude;\nlayout(location = 11) attribute vec4 a_StylePacked3;\nlayout(location = 12) attribute vec2 a_Size;\n#ifdef USE_UV\n  layout(location = 13) attribute vec2 a_Uv;\n  varying vec2 v_Uv;\n#endif\n\nvarying vec4 v_Data;\nvarying vec2 v_Radius;\nvarying vec4 v_StylePacked3;\n\nvoid main() {\n  mat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n#ifdef CLIPSPACE_NEAR_ZERO\n    gl_Position.z = gl_Position.z * 0.5 + 0.5;\n#endif\n  #ifdef USE_UV\n  v_Uv = a_Uv;\n  #ifdef VIEWPORT_ORIGIN_TL\n    v_Uv.y = 1.0 - v_Uv.y;\n  #endif\n#endif\n\n  float antialiasblur = 1.0 / (a_Size.x + u_StrokeWidth);\n\n  vec2 offset = (a_Extrude + vec2(1.0) - 2.0 * a_Anchor.xy) * a_Size;\n\n  int shape = int(floor(a_StylePacked3.x + 0.5));\n  if (shape == 2) {\n    offset = offset - vec2(u_StrokeWidth / 2.0);\n  }\n\n  gl_Position = project(vec4(offset, u_ZIndex, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  \n  v_Radius = a_Size;\n  v_Data = vec4(a_Extrude, antialiasblur, a_StylePacked3.x);\n  v_StylePacked3 = a_StylePacked3;\n}",Oh="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  bool u_IsOrtho;\n};\n\nvarying vec4 v_PickingResult;\nvarying vec4 v_Color;\nvarying vec4 v_StrokeColor;\nvarying vec4 v_StylePacked1;\nvarying vec4 v_StylePacked2;\n#ifdef USE_UV\n  varying vec2 v_Uv;\n#endif\n#ifdef USE_MAP\n  uniform sampler2D u_Map;\n#endif\n\nvarying vec4 v_Data;\nvarying vec2 v_Radius;\nvarying vec4 v_StylePacked3;\n\n/**\n * 2D signed distance field functions\n * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm\n */\n\nfloat sdCircle(vec2 p, float r) {\n  return length(p) - r;\n}\n\n// @see http://www.iquilezles.org/www/articles/ellipsoids/ellipsoids.htm\nfloat sdEllipsoidApproximated(vec2 p, vec2 r) {\n  float k0 = length(p / r);\n  float k1 = length(p / (r * r));\n  return k0 * (k0 - 1.0) / k1;\n}\n\n// @see https://www.shadertoy.com/view/4llXD7\nfloat sdRoundedBox(vec2 p, vec2 b, vec2 r) {\n  vec2 q = abs(p) - b + r;\n  return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - r.x;\n}\n\nvoid main() {\n  int shape = int(floor(v_Data.w + 0.5));\n\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\n\ngbuf_picking = vec4(v_PickingResult.rgb, 1.0);\n\nif (u_Visible < 1.0) {\n    discard;\n}\n  #ifdef USE_MAP\n  vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n  u_Color = texelColor;\n#endif\n\n  float antialiasblur = v_Data.z;\n  float antialiased_blur = -max(0.0, antialiasblur);\n  vec2 r = (v_Radius - u_StrokeWidth) / v_Radius;\n\n  float outer_df;\n  float inner_df;\n  // 'circle', 'ellipse', 'rect'\n  if (shape == 0) {\n    outer_df = sdCircle(v_Data.xy, 1.0);\n    inner_df = sdCircle(v_Data.xy, r.x);\n  } else if (shape == 1) {\n    outer_df = sdEllipsoidApproximated(v_Data.xy, vec2(1.0));\n    inner_df = sdEllipsoidApproximated(v_Data.xy, r);\n  } else if (shape == 2) {\n  float u_RectRadius = v_StylePacked3.y;\n    outer_df = sdRoundedBox(v_Data.xy, vec2(1.0), u_RectRadius / v_Radius);\n    inner_df = sdRoundedBox(v_Data.xy, r, u_RectRadius / v_Radius);\n  }\n\n  float opacity_t = smoothstep(0.0, antialiased_blur, outer_df);\n\n  float color_t = u_StrokeWidth < 0.01 ? 0.0 : smoothstep(\n    antialiased_blur,\n    0.0,\n    inner_df\n  );\n\n  vec4 diffuseColor = u_Color;\n\n  vec4 strokeColor = u_StrokeColor == vec4(0) ? diffuseColor : u_StrokeColor;\n\n  gl_FragColor = mix(vec4(diffuseColor.rgb, diffuseColor.a * u_FillOpacity), strokeColor * u_StrokeOpacity, color_t);\n  gl_FragColor.a = gl_FragColor.a * u_Opacity * opacity_t;\n\n  if (gl_FragColor.a < 0.01)\n    discard;\n}",Bh=[tn.Circle,tn.Ellipse,tn.Rect],Ih=function(e){_s(n,e);var t=As(n);function n(){var e;ds(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).vert=Nh,e.frag=Oh,e}return n}(Ph);Ih.a_Extrude=bh.MAX,Ih.a_StylePacked3=bh.MAX+1,Ih.a_Size=bh.MAX+2,Ih.a_Uv=bh.MAX+3,Ih.ub_ObjectParams=1;var Dh=function(e){_s(n,e);var t=As(n);function n(){var e;ds(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).contextService=void 0,e.program=new Ih,e}return vs(n,[{key:"validate",value:function(){return!0}},{key:"buildGeometry",value:function(){var e=this,t=[],n=[],r=[],i=[];this.objects.forEach((function(o,a){var s=o,u=4*a,c=s.parsedStyle,l=c.lineWidth,h=void 0===l?0:l,f=c.radius,d=xs(e.getSize(o.attributes,s.nodeName),2),p=[d[0]+h/2,d[1]+h/2];n.push.apply(n,p),r.push(Bh.indexOf(s.nodeName),f||0,0,0),t.push(-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1),i.push(0+u,2+u,1+u,0+u,3+u,2+u)})),this.geometry.setIndices(new Uint32Array(i)),this.geometry.vertexCount=6,this.geometry.setVertexBuffer({bufferIndex:1,byteStride:16,frequency:1,attributes:[{format:ws.F32_RG,bufferByteOffset:0,location:Ih.a_Extrude},{format:ws.F32_RG,bufferByteOffset:8,location:Ih.a_Uv}],data:new Float32Array(t)}),this.geometry.setVertexBuffer({bufferIndex:2,byteStride:8,frequency:2,attributes:[{format:ws.F32_RG,bufferByteOffset:0,location:Ih.a_Size,divisor:1}],data:new Float32Array(n)}),this.geometry.setVertexBuffer({bufferIndex:3,byteStride:16,frequency:2,attributes:[{format:ws.F32_RGBA,bufferByteOffset:0,location:Ih.a_StylePacked3,divisor:1}],data:new Float32Array(r)})}},{key:"updateAttribute",value:function(e,t,r){bs(ys(n.prototype),"updateAttribute",this).call(this,e,t,r);var i=this.objects.indexOf(e),o=this.geometry;if("r"===t||"rx"===t||"ry"===t||"width"===t||"height"===t||"lineWidth"===t){var a=e.parsedStyle.lineWidth,s=xs(this.getSize(e.attributes,e.nodeName),2),u=[s[0]+a/2,s[1]+a/2];o.updateVertexBuffer(2,Ih.a_Size,i,new Uint8Array(new Float32Array([].concat(u)).buffer))}else"radius"===t&&o.updateVertexBuffer(3,Ih.a_StylePacked3,i,new Uint8Array(new Float32Array([Bh.indexOf(e.nodeName),e.parsedStyle.radius||0,0,0]).buffer))}},{key:"uploadUBO",value:function(e){e.setBindingLayouts([{numUniformBuffers:1,numSamplers:1}]),e.setSamplerBindingsFromTextureMappings([this.fillMapping]);var t=e.renderPipelineDescriptor.program;t.gl_program&&t.setUniforms({u_ProjectionMatrix:this.camera.getPerspective(),u_ViewMatrix:this.camera.getViewTransform(),u_CameraPosition:this.camera.getPosition(),u_DevicePixelRatio:this.contextService.getDPR()})}},{key:"getSize",value:function(e,t){return t===tn.Circle?[e.r,e.r]:t===tn.Ellipse?[e.rx,e.ry]:t===tn.Rect?[(e.width||0)/2,(e.height||0)/2]:[0,0]}}]),n}(Mh);a([D(Sn),s("design:type",Object)],Dh.prototype,"contextService",void 0),Dh=a([B({token:[{token:Jl,named:tn.Circle},{token:Jl,named:tn.Ellipse},{token:Jl,named:tn.Rect}]})],Dh);var Fh="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  bool u_IsOrtho;\n};\nlayout(location = 0) attribute vec4 a_ModelMatrix0;\nlayout(location = 1) attribute vec4 a_ModelMatrix1;\nlayout(location = 2) attribute vec4 a_ModelMatrix2;\nlayout(location = 3) attribute vec4 a_ModelMatrix3;\nlayout(location = 4) attribute vec4 a_Color;\nlayout(location = 5) attribute vec4 a_StrokeColor;\nlayout(location = 6) attribute vec4 a_StylePacked1;\nlayout(location = 7) attribute vec4 a_StylePacked2;\nlayout(location = 8) attribute vec4 a_PickingColor;\nlayout(location = 9) attribute vec2 a_Anchor;\n// layout(location = {AttributeLocation.a_Uv}) attribute vec2 a_Uv;\n\nvarying vec4 v_PickingResult;\nvarying vec4 v_Color;\nvarying vec4 v_StrokeColor;\nvarying vec4 v_StylePacked1;\nvarying vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nlayout(location = 10) attribute vec2 a_Size;\n\n#ifdef USE_UV\n  layout(location = 11) attribute vec2 a_Uv;\n  varying vec2 v_Uv;\n#endif\n\nvoid main() {\n  mat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n#ifdef CLIPSPACE_NEAR_ZERO\n    gl_Position.z = gl_Position.z * 0.5 + 0.5;\n#endif\n\n  vec2 offset = (a_Uv - a_Anchor.xy) * a_Size;\n\n  gl_Position = project(vec4(offset, u_ZIndex, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n\n  #ifdef USE_UV\n  v_Uv = a_Uv;\n  #ifdef VIEWPORT_ORIGIN_TL\n    v_Uv.y = 1.0 - v_Uv.y;\n  #endif\n#endif\n\n}",wh="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  bool u_IsOrtho;\n};\n\nvarying vec4 v_PickingResult;\nvarying vec4 v_Color;\nvarying vec4 v_StrokeColor;\nvarying vec4 v_StylePacked1;\nvarying vec4 v_StylePacked2;\n#ifdef USE_UV\n  varying vec2 v_Uv;\n#endif\n#ifdef USE_MAP\n  uniform sampler2D u_Map;\n#endif\n\nvoid main() {\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\n\ngbuf_picking = vec4(v_PickingResult.rgb, 1.0);\n\nif (u_Visible < 1.0) {\n    discard;\n}\n  #ifdef USE_MAP\n  vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n  u_Color = texelColor;\n#endif\n\n  gl_FragColor = u_Color;\n  gl_FragColor.a = gl_FragColor.a * u_Opacity;\n}",Lh=function(e){_s(n,e);var t=As(n);function n(){var e;ds(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).vert=Fh,e.frag=wh,e}return n}(Ph);Lh.a_Size=bh.MAX,Lh.a_Uv=bh.MAX+1,Lh.ub_ObjectParams=1;var kh=function(e){_s(n,e);var t=As(n);function n(){var e;ds(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).program=new Lh,e.mapping=void 0,e}return vs(n,[{key:"validate",value:function(e){return this.instance.nodeName!==tn.Image||this.instance.parsedStyle.img===e.parsedStyle.img}},{key:"buildGeometry",value:function(){var e=this;this.program.setDefineBool("USE_UV",!0),this.program.setDefineBool("USE_MAP",!0);var t=this.instance.parsedStyle,n=t.img,r=t.width,i=t.height;this.mapping=new _h,this.mapping.texture=this.texturePool.getOrCreateTexture(this.device,n,Js(ws.U8_RGBA_NORM,r,i,1),(function(){e.objects.forEach((function(t){t.renderable.dirty=!0,e.renderingService.dirtify()}))})),this.device.setResourceName(this.mapping.texture,"Image Texture"+this.id),this.mapping.sampler=this.renderHelper.getCache().createSampler({wrapS:0,wrapT:0,minFilter:1,magFilter:1,mipFilter:0,minLOD:0,maxLOD:0});var o=[],a=[],s=[];this.objects.forEach((function(e,t){var n=4*t,r=e.parsedStyle,i=r.width,u=r.height;o.push(i,u),a.push(0,0,1,0,1,1,0,1),s.push(0+n,2+n,1+n,0+n,3+n,2+n)})),this.geometry.setIndices(new Uint32Array(s)),this.geometry.vertexCount=6,this.geometry.setVertexBuffer({bufferIndex:1,byteStride:8,frequency:1,attributes:[{format:ws.F32_RG,bufferByteOffset:0,location:Lh.a_Uv}],data:new Float32Array(a)}),this.geometry.setVertexBuffer({bufferIndex:2,byteStride:8,frequency:2,attributes:[{format:ws.F32_RG,bufferByteOffset:0,location:Lh.a_Size}],data:new Float32Array(o)})}},{key:"updateAttribute",value:function(e,t,r){var i=this;bs(ys(n.prototype),"updateAttribute",this).call(this,e,t,r);var o=this.objects.indexOf(e),a=this.geometry,s=e.parsedStyle,u=s.width,c=s.height,l=s.img;"width"===t||"height"===t?a.updateVertexBuffer(2,Lh.a_Size,o,new Uint8Array(new Float32Array([u,c]).buffer)):"img"===t&&(this.mapping.texture=this.texturePool.getOrCreateTexture(this.device,l,Js(ws.U8_RGBA_NORM,u,c,1),(function(){i.objects.forEach((function(e){e.renderable.dirty=!0,i.renderingService.dirtify()}))})))}},{key:"uploadUBO",value:function(e){e.setBindingLayouts([{numUniformBuffers:1,numSamplers:1}]),e.setSamplerBindingsFromTextureMappings([this.mapping])}}]),n}(Mh);function Uh(e,t,n,r){var i=t.width,o=t.height;if(r){if(r.length!==i*o*n)throw new RangeError("mismatched image size")}else r=new Uint8Array(i*o*n);return e.width=i,e.height=o,e.data=r,e}function Gh(e,t,n,r,i,o){if(0===i.width||0===i.height)return t;if(i.width>e.width||i.height>e.height||n.x>e.width-i.width||n.y>e.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>t.width||i.height>t.height||r.x>t.width-i.width||r.y>t.height-i.height)throw new RangeError("out of range destination coordinates for image copy");for(var a=e.data,s=t.data,u=0;u<i.height;u++)for(var c=((n.y+u)*e.width+n.x)*o,l=((r.y+u)*t.width+r.x)*o,h=0;h<i.width*o;h++)s[l+h]=a[c+h];return t}kh=a([B({token:[{token:Jl,named:tn.Image}]})],kh);var Wh=function(){function e(t,n){ds(this,e),this.width=void 0,this.height=void 0,this.data=void 0,Uh(this,t,1,n)}return vs(e,[{key:"resize",value:function(e){!function(e,t,n){var r=t.width,i=t.height;if(r!==e.width||i!==e.height){var o=Uh({},{width:r,height:i},1);Gh(e,o,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,r),height:Math.min(e.height,i)},1),e.width=r,e.height=i,e.data=o.data}}(this,e)}},{key:"clone",value:function(){return new e({width:this.width,height:this.height},new Uint8Array(this.data))}}],[{key:"copy",value:function(e,t,n,r,i){Gh(e,t,n,r,i,1)}}]),e}(),Vh=function e(t){ds(this,e),this.image=void 0,this.positions=void 0;var n={},r=[];for(var i in t){var o=t[i],a=n[i]={};for(var s in o){var u=o[+s];if(u&&0!==u.bitmap.width&&0!==u.bitmap.height){var c={x:0,y:0,w:u.bitmap.width+2,h:u.bitmap.height+2};r.push(c),a[s]={rect:c,metrics:u.metrics}}}}var l=function(e){var t,n=0,r=0,i=Is(e);try{for(i.s();!(t=i.n()).done;){var o=t.value;n+=o.w*o.h,r=Math.max(r,o.w)}}catch(e){i.e(e)}finally{i.f()}e.sort((function(e,t){return t.h-e.h}));var a,s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),r),h:1/0}],u=0,c=0,l=Is(e);try{for(l.s();!(a=l.n()).done;)for(var h=a.value,f=s.length-1;f>=0;f--){var d=s[f];if(!(h.w>d.w||h.h>d.h)){if(h.x=d.x,h.y=d.y,c=Math.max(c,h.y+h.h),u=Math.max(u,h.x+h.w),h.w===d.w&&h.h===d.h){var p=s.pop();f<s.length&&(s[f]=p)}else h.h===d.h?(d.x+=h.w,d.w-=h.w):h.w===d.w?(d.y+=h.h,d.h-=h.h):(s.push({x:d.x+h.w,y:d.y,w:d.w-h.w,h:h.h}),d.y+=h.h,d.h-=h.h);break}}}catch(e){l.e(e)}finally{l.f()}return{w:u,h:c,fill:n/(u*c)||0}}(r),h=l.w,f=l.h,d=new Wh({width:h||1,height:f||1});for(var p in t){var v=t[p];for(var g in v){var _=v[+g];if(_&&0!==_.bitmap.width&&0!==_.bitmap.height){var y=n[p][g].rect;Wh.copy(_.bitmap,d,{x:0,y:0},{x:y.x+1,y:y.y+1},_.bitmap)}}}this.image=d,this.positions=n},Xh=24;function Hh(e){return e>=19968&&e<=40959}function jh(){for(var e=[],t=32;t<128;t++)e.push(String.fromCharCode(t));return e}var zh=function(){function e(){ds(this,e),this.sdfGeneratorCache={},this.textMetricsCache={},this.glyphAtlas=void 0,this.glyphMap={},this.glyphAtlasTexture=void 0}return vs(e,[{key:"getMap",value:function(){return this.glyphMap}},{key:"getAtlas",value:function(){return this.glyphAtlas}},{key:"getAtlasTexture",value:function(){return this.glyphAtlasTexture}},{key:"layout",value:function(e,t,n,r,i,o){var a=this,s=[],u=0,c=o,l="right"===r||"end"===r?1:"left"===r||"start"===r?0:.5;return e.forEach((function(e){var r=s.length;Array.from(e).forEach((function(e){var n=a.glyphMap[t],r=e.charCodeAt(0),o=n&&n[r];o&&(s.push({glyph:r,x:u,y:c,scale:1,fontStack:t}),u+=o.metrics.advance+i)}));for(var o=u-i,h=r;h<s.length;h++)s[h].x=s[h].x-l*o;u=0,c+=n})),s}},{key:"generateAtlas",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,a=[];this.glyphMap[t]||(a=jh());var s=Object.keys(this.glyphMap[t]||{});if(Array.from(new Set(i.split(""))).forEach((function(e){-1===s.indexOf(e.charCodeAt(0).toString())&&a.push(e)})),a.length){var u=a.map((function(i){return e.generateSDF(t,n,r.toString(),i)})).reduce((function(e,t){return e[t.id]=t,e}),{});this.glyphMap[t]=ls(ls({},this.glyphMap[t]),u),this.glyphAtlas=new Vh(this.glyphMap);var c=this.glyphAtlas.image,l=c.width,h=c.height,f=c.data;this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.glyphAtlasTexture=o.createTexture(ls(ls({},Js(ws.ALPHA,l,h,1)),{},{immutable:!1})),this.glyphAtlasTexture.setImageData([f],0)}}},{key:"generateSDF",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=r.charCodeAt(0),o=this.sdfGeneratorCache[e];return o||(o=this.sdfGeneratorCache[e]=new(as())(24,3,8,.25,t,n)),this.textMetricsCache[e]||(this.textMetricsCache[e]={}),this.textMetricsCache[e][r]||(this.textMetricsCache[e][r]=o.ctx.measureText(r).width),{id:i,bitmap:new Wh({width:30,height:30},o.draw(r)),metrics:{width:Xh,height:Xh,left:0,top:-2,advance:Hh(i)?Xh:this.textMetricsCache[e][r]}}}}]),e}();zh=a([B()],zh);var Yh="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  bool u_IsOrtho;\n};\nlayout(std140) uniform ub_ObjectParams {\n    vec2 u_SDFMapSize;\n    float u_FontSize;\n    float u_GammaScale;\n    float u_StrokeBlur;\n    bool u_HasStroke;\n};\n\nlayout(location = 0) attribute vec4 a_ModelMatrix0;\nlayout(location = 1) attribute vec4 a_ModelMatrix1;\nlayout(location = 2) attribute vec4 a_ModelMatrix2;\nlayout(location = 3) attribute vec4 a_ModelMatrix3;\nlayout(location = 4) attribute vec4 a_Color;\nlayout(location = 5) attribute vec4 a_StrokeColor;\nlayout(location = 6) attribute vec4 a_StylePacked1;\nlayout(location = 7) attribute vec4 a_StylePacked2;\nlayout(location = 8) attribute vec4 a_PickingColor;\nlayout(location = 9) attribute vec2 a_Anchor;\n// layout(location = {AttributeLocation.a_Uv}) attribute vec2 a_Uv;\n\nvarying vec4 v_PickingResult;\nvarying vec4 v_Color;\nvarying vec4 v_StrokeColor;\nvarying vec4 v_StylePacked1;\nvarying vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nlayout(location = 10) attribute vec2 a_Tex;\nlayout(location = 11) attribute vec2 a_Offset;\n\nvarying vec2 v_UV;\nvarying float v_GammaScale;\n\nvoid main() {\n  mat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n#ifdef CLIPSPACE_NEAR_ZERO\n    gl_Position.z = gl_Position.z * 0.5 + 0.5;\n#endif\n\n  v_UV = a_Tex / u_SDFMapSize;\n\n  float fontScale = u_FontSize / 24.;\n\n  gl_Position = project(vec4(a_Offset * fontScale, u_ZIndex, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  v_GammaScale = gl_Position.w;\n}",qh="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  bool u_IsOrtho;\n};\nlayout(std140) uniform ub_ObjectParams {\n    vec2 u_SDFMapSize;\n    float u_FontSize;\n    float u_GammaScale;\n    float u_StrokeBlur;\n    bool u_HasStroke;\n};\n\nvarying vec4 v_PickingResult;\nvarying vec4 v_Color;\nvarying vec4 v_StrokeColor;\nvarying vec4 v_StylePacked1;\nvarying vec4 v_StylePacked2;\n\nvarying vec2 v_UV;\nvarying float v_GammaScale;\n\nuniform sampler2D u_SDFMap;\n\n#define SDF_PX 8.0\n\nvoid main() {\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\n\ngbuf_picking = vec4(v_PickingResult.rgb, 1.0);\n\nif (u_Visible < 1.0) {\n    discard;\n}\n\n  float dist = texture(SAMPLER_2D(u_SDFMap), v_UV).a;\n\n  float EDGE_GAMMA = 0.105 / u_DevicePixelRatio;\n  float fontScale = u_FontSize / 24.0;\n  highp float gamma = EDGE_GAMMA / (fontScale * u_GammaScale);\n  lowp vec4 color = u_Color;\n  lowp float buff = (256.0 - 64.0) / 256.0;\n  float opacity = u_FillOpacity;\n  if (u_HasStroke && u_StrokeWidth > 0.0) {\n    color = u_StrokeColor;\n    gamma = (u_StrokeBlur * 1.19 / SDF_PX + EDGE_GAMMA) / (fontScale * u_GammaScale);\n    buff = (6.0 - u_StrokeWidth / fontScale / 2.0) / SDF_PX;\n    opacity = u_StrokeOpacity;\n  }\n\n  highp float gamma_scaled = gamma * v_GammaScale;\n  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\n\n  gl_FragColor = color * (alpha * opacity * u_Opacity);\n}",Kh=function(e){_s(n,e);var t=As(n);function n(){var e;ds(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).vert=Yh,e.frag=qh,e}return n}(Ph);Kh.a_Tex=bh.MAX,Kh.a_Offset=bh.MAX+1,Kh.ub_ObjectParams=1;var Zh=function(e){_s(n,e);var t=As(n);function n(){var e;ds(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).program=new Kh,e.instanced=!1,e.mapping=void 0,e.glyphManager=void 0,e}return vs(n,[{key:"buildGeometry",value:function(){this.generateAtlas()}},{key:"validate",value:function(e){var t=this.instance;return t.parsedStyle.metrics.font===e.parsedStyle.metrics.font&&!["fontSize","fontFamily","fontWeight","textBaseline","letterSpacing"].some((function(n){return t.parsedStyle[n]!==e.parsedStyle[n]}))}},{key:"updateAttribute",value:function(e,t,r){bs(ys(n.prototype),"updateAttribute",this).call(this,e,t,r),"text"!==t&&"fontFamily"!==t&&"textBaseline"!==t&&"letterSpacing"!==t&&"wordWrapWidth"!==t&&"lineHeight"!==t&&"wordWrap"!==t&&"textAlign"!==t&&"modelMatrix"!==t&&"visibility"!==t||(this.geometryDirty=!0)}},{key:"changeRenderOrder",value:function(e,t){this.geometryDirty=!0}},{key:"uploadUBO",value:function(e){e.setBindingLayouts([{numUniformBuffers:2,numSamplers:1,samplerEntries:[{dimension:0,formatKind:1}]}]);var t=this.instance.parsedStyle.fontSize;e.setSamplerBindingsFromTextureMappings([this.mapping]);var n=this.glyphManager.getAtlas().image,r=n.width,i=n.height,o=e.allocateUniformBuffer(Kh.ub_ObjectParams,8),a=e.mapUniformBufferF32(Kh.ub_ObjectParams);o+=Zl(a,o,r,i,t,1),o+=Zl(a,o,.2,1)}},{key:"afterRender",value:function(e){var t=this.instance.parsedStyle,n=t.stroke,r=t.lineWidth;if(n&&r){var i=this.renderHelper.getCache().createInputLayout(this.geometry.inputLayoutDescriptor),o=this.renderHelper.getCache().createProgramSimple(this.programDescriptorSimpleWithOrig),a=this.renderHelper.renderInstManager.newRenderInst();a.setProgram(o),a.setInputLayoutAndState(i,this.inputState),this.uploadUBO(a);var s=a.getUniformBufferOffset(Kh.ub_ObjectParams);Zl(a.mapUniformBufferF32(Kh.ub_ObjectParams),s+4,.2,0),a.drawIndexesInstanced(this.geometry.vertexCount,this.geometry.maxInstancedCount),a.sortKey=Hl(32,o.id),this.renderHelper.renderInstManager.submitRenderInst(a,e)}}},{key:"generateAtlas",value:function(){var e=this,t=this.geometry,n=this.instance.parsedStyle,r=n.textBaseline,i=n.fontSize,o=void 0===i?0:i,a=n.fontFamily,s=void 0===a?"":a,u=n.fontWeight,c=void 0===u?"normal":u,l=n.letterSpacing,h=void 0===l?0:l,f=n.metrics.font,d=this.objects.map((function(e){return e.parsedStyle.text})).join("");this.glyphManager.generateAtlas(f,s,c,d,this.device);var p=this.glyphManager.getAtlasTexture(),v=this.glyphManager.getAtlas(),g=new _h;g.texture=p,this.device.setResourceName(g.texture,"TextSDF Texture"),g.sampler=this.renderHelper.getCache().createSampler({wrapS:0,wrapT:0,minFilter:1,magFilter:1,mipFilter:0,minLOD:0,maxLOD:0}),this.mapping=g;var _=Xh/o,y=[],m=[],E=[],T=0;this.objects.forEach((function(t){var n=t.parsedStyle.metrics,i=n.font,o=n.lines,a=n.height,s=n.lineHeight,u=0;"middle"===r?u=-a/2:"bottom"===r?u=-a:"top"===r||"hanging"===r?u=0:"alphabetic"===r?u=.75*-a:"ideographic"===r&&(u=-a);var c=e.buildTextBuffers({object:t,lines:o,fontStack:i,lineHeight:_*s,offsetY:_*u,letterSpacing:_*h,glyphAtlas:v,indicesOffset:T}),l=c.indicesOffset,f=c.indexBuffer,d=c.charUVOffsetBuffer,p=c.charPackedBuffer;T=l,E.push.apply(E,Cs(p)),m.push.apply(m,Cs(d)),y.push.apply(y,Cs(f))})),t.vertexCount=y.length,t.setIndices(new Uint32Array(y)),this.geometry.setVertexBuffer({bufferIndex:0,byteStride:144,frequency:1,attributes:[{format:ws.F32_RGBA,bufferByteOffset:0,location:bh.a_ModelMatrix0},{format:ws.F32_RGBA,bufferByteOffset:16,location:bh.a_ModelMatrix1},{format:ws.F32_RGBA,bufferByteOffset:32,location:bh.a_ModelMatrix2},{format:ws.F32_RGBA,bufferByteOffset:48,location:bh.a_ModelMatrix3},{format:ws.F32_RGBA,bufferByteOffset:64,location:bh.a_Color},{format:ws.F32_RGBA,bufferByteOffset:80,location:bh.a_StrokeColor},{format:ws.F32_RGBA,bufferByteOffset:96,location:bh.a_StylePacked1},{format:ws.F32_RGBA,bufferByteOffset:112,location:bh.a_StylePacked2},{format:ws.F32_RGBA,bufferByteOffset:128,location:bh.a_PickingColor}],data:new Float32Array(E)}),t.setVertexBuffer({bufferIndex:1,byteStride:16,frequency:1,attributes:[{format:ws.F32_RG,bufferByteOffset:0,location:Kh.a_Tex},{format:ws.F32_RG,bufferByteOffset:8,location:Kh.a_Offset}],data:new Float32Array(m)})}},{key:"buildTextBuffers",value:function(e){var t=e.object,n=e.lines,r=e.fontStack,i=e.lineHeight,o=e.letterSpacing,a=e.offsetY,s=e.glyphAtlas,u=e.indicesOffset,c=t.parsedStyle.textAlign,l=void 0===c?"start":c,h=t.parsedStyle,f=h.fill,d=h.stroke,p=h.opacity,v=h.fillOpacity,g=h.strokeOpacity,_=h.lineWidth,y=h.visibility,m=[0,0,0,0];(null==f?void 0:f.type)===Oi.Constant&&(m=f.value);var E=[0,0,0,0];(null==d?void 0:d.type)===Oi.Constant&&(E=d.value);var T=t.renderable3D.encodedPickingColor,R=Yl(zl(),t.getWorldTransform()),A=[],S=[],b=[],x=u;return function(e,t){for(var n=[],r=0;r<e.length;r++){var i=e[r],o=t[i.fontStack],a=o&&o[i.glyph];if(a){var s=a.rect;if(s){var u=a.metrics.advance*i.scale/2,c=[i.x+u,i.y],l=(a.metrics.left-4)*i.scale-u+c[0],h=(-a.metrics.top-4)*i.scale+c[1],f=l+s.w*i.scale,d=h+s.h*i.scale,p={x:l,y:h},v={x:f,y:h},g={x:l,y:d},_={x:f,y:d};n.push({tl:p,tr:v,bl:g,br:_,tex:s,glyphOffset:[0,0]})}}}return n}(this.glyphManager.layout(n,r,i,l,o,a),s.positions).forEach((function(e){var n=[].concat(Cs(R),Cs(m),Cs(E),[p,v,g,_,"visible"===y?1:0,0,0,0],Cs(T),[t.sortable.renderOrder*xh]);A.push.apply(A,Cs(n).concat(Cs(n),Cs(n),Cs(n))),S.push(e.tex.x,e.tex.y,e.tl.x,e.tl.y),S.push(e.tex.x+e.tex.w,e.tex.y,e.tr.x,e.tr.y),S.push(e.tex.x+e.tex.w,e.tex.y+e.tex.h,e.br.x,e.br.y),S.push(e.tex.x,e.tex.y+e.tex.h,e.bl.x,e.bl.y),b.push(0+x,2+x,1+x),b.push(2+x,0+x,3+x),x+=4})),{indexBuffer:b,charUVOffsetBuffer:S,charPackedBuffer:A,indicesOffset:x}}}]),n}(Mh);a([D(zh),s("design:type",zh)],Zh.prototype,"glyphManager",void 0),Zh=a([B({token:[{token:Jl,named:tn.Text}]})],Zh);var $h,Qh="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  bool u_IsOrtho;\n};\nlayout(std140) uniform ub_ObjectParams {\n  mat4 u_ModelMatrix;\n  vec4 u_Color;\n  vec4 u_StrokeColor;\n  float u_StrokeWidth;\n  float u_Opacity;\n  float u_FillOpacity;\n  float u_StrokeOpacity;\n  float u_Expand;\n  float u_MiterLimit;\n  float u_ScaleMode;\n  float u_Alignment;\n  vec4 u_PickingColor;\n  float u_Dash;\n  float u_Gap;\n  vec2 u_Anchor;\n  float u_DashOffset;\n  float u_Visible;\n  float u_ZIndex;\n};\n\nlayout(location = 0) attribute vec2 a_Prev;\nlayout(location = 1) attribute vec2 a_Point1;\nlayout(location = 2) attribute vec2 a_Point2;\nlayout(location = 3) attribute vec2 a_Next;\nlayout(location = 4) attribute float a_VertexJoint;\nlayout(location = 5) attribute float a_VertexNum;\nlayout(location = 6) attribute float a_Travel;\n\nconst float FILL = 1.0;\nconst float BEVEL = 4.0;\nconst float MITER = 8.0;\nconst float ROUND = 12.0;\nconst float JOINT_CAP_BUTT = 16.0;\nconst float JOINT_CAP_SQUARE = 18.0;\nconst float JOINT_CAP_ROUND = 20.0;\nconst float FILL_EXPAND = 24.0;\nconst float CAP_BUTT = 1.0;\nconst float CAP_SQUARE = 2.0;\nconst float CAP_ROUND = 3.0;\nconst float CAP_BUTT2 = 4.0;\n\nvarying vec4 v_Distance;\nvarying vec4 v_Arc;\nvarying float v_Type;\nvarying float v_Travel;\n\nvarying vec4 v_PickingResult;\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n    v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 doBisect(\nvec2 norm, float len, vec2 norm2, float len2, float dy, float inner\n) {\nvec2 bisect = (norm + norm2) / 2.0;\nbisect /= dot(norm, bisect);\nvec2 shift = dy * bisect;\nif (inner > 0.5) {\n    if (len < len2) {\n    if (abs(dy * (bisect.x * norm.y - bisect.y * norm.x)) > len) {\n        return dy * norm;\n    }\n    } else {\n    if (abs(dy * (bisect.x * norm2.y - bisect.y * norm2.x)) > len2) {\n        return dy * norm;\n    }\n    }\n}\nreturn dy * bisect;\n}\n\nvoid main() {\nvec2 pointA = (u_ModelMatrix * vec4(a_Point1, 0., 1.0)).xy;\nvec2 pointB = (u_ModelMatrix * vec4(a_Point2, 0., 1.0)).xy;\n\nvec2 xBasis = pointB - pointA;\nfloat len = length(xBasis);\nvec2 forward = xBasis / len;\nvec2 norm = vec2(forward.y, -forward.x);\n\nfloat type = a_VertexJoint;\nfloat lineWidth = u_StrokeWidth;\n\nif (u_ScaleMode > 2.5) {\n    lineWidth *= length(u_ModelMatrix * vec4(1.0, 0.0, 0.0, 0.0));\n} else if (u_ScaleMode > 1.5) {\n    lineWidth *= length(u_ModelMatrix * vec4(0.0, 1.0, 0.0, 0.0));\n} else if (u_ScaleMode > 0.5) {\n    vec2 avgDiag = (u_ModelMatrix * vec4(1.0, 1.0, 0.0, 0.0)).xy;\n    lineWidth *= sqrt(dot(avgDiag, avgDiag) * 0.5);\n}\nfloat capType = floor(type / 32.0);\ntype -= capType * 32.0;\nv_Arc = vec4(0.0);\nlineWidth *= 0.5;\nfloat lineAlignment = 2.0 * u_Alignment - 1.0;\n\nvec2 pos;\n\nif (capType == CAP_ROUND) {\n    if (a_VertexNum < 3.5) {\n    gl_Position = vec4(0.0, 0.0, 0.0, 1.0);\n    return;\n    }\n    type = JOINT_CAP_ROUND;\n    capType = 0.0;\n}\n\nif (type >= BEVEL) {\n    float dy = lineWidth + u_Expand;\n    float inner = 0.0;\n    if (a_VertexNum >= 1.5) {\n    dy = -dy;\n    inner = 1.0;\n    }\n\n    vec2 base, next, xBasis2, bisect;\n    float flag = 0.0;\n    float sign2 = 1.0;\n    if (a_VertexNum < 0.5 || a_VertexNum > 2.5 && a_VertexNum < 3.5) {\n    next = (u_ModelMatrix * vec4(a_Prev, 0.0, 1.0)).xy;\n    base = pointA;\n    flag = type - floor(type / 2.0) * 2.0;\n    sign2 = -1.0;\n\n    } else {\n    next = (u_ModelMatrix * vec4(a_Next, 0.0, 1.0)).xy;\n    base = pointB;\n    if (type >= MITER && type < MITER + 3.5) {\n        flag = step(MITER + 1.5, type);\n        // check miter limit here?\n    }\n    }\n    xBasis2 = next - base;\n    float len2 = length(xBasis2);\n    vec2 norm2 = vec2(xBasis2.y, -xBasis2.x) / len2;\n    float D = norm.x * norm2.y - norm.y * norm2.x;\n    if (D < 0.0) {\n    inner = 1.0 - inner;\n    }\n    norm2 *= sign2;\n\n    if (abs(lineAlignment) > 0.01) {\n    float shift = lineWidth * lineAlignment;\n    pointA += norm * shift;\n    pointB += norm * shift;\n    if (abs(D) < 0.01) {\n        base += norm * shift;\n    } else {\n        base += doBisect(norm, len, norm2, len2, shift, 0.0);\n    }\n    }\n\n    float collinear = step(0.0, dot(norm, norm2));\n    v_Type = 0.0;\n    float dy2 = -1000.0;\n    float dy3 = -1000.0;\n    if (abs(D) < 0.01 && collinear < 0.5) {\n    if (type >= ROUND && type < ROUND + 1.5) {\n        type = JOINT_CAP_ROUND;\n    }\n    //TODO: BUTT here too\n    }\n\n    if (a_VertexNum < 3.5) {\n    if (abs(D) < 0.01) {\n        pos = dy * norm;\n    } else {\n        if (flag < 0.5 && inner < 0.5) {\n        pos = dy * norm;\n        } else {\n        pos = doBisect(norm, len, norm2, len2, dy, inner);\n        }\n    }\n    if (capType >= CAP_BUTT && capType < CAP_ROUND) {\n        float extra = step(CAP_SQUARE, capType) * lineWidth;\n        vec2 back = -forward;\n        if (a_VertexNum < 0.5 || a_VertexNum > 2.5) {\n        pos += back * (u_Expand + extra);\n        dy2 = u_Expand;\n        } else {\n        dy2 = dot(pos + base - pointA, back) - extra;\n        }\n    }\n    if (type >= JOINT_CAP_BUTT && type < JOINT_CAP_SQUARE + 0.5) {\n        float extra = step(JOINT_CAP_SQUARE, type) * lineWidth;\n        if (a_VertexNum < 0.5 || a_VertexNum > 2.5) {\n        dy3 = dot(pos + base - pointB, forward) - extra;\n        } else {\n        pos += forward * (u_Expand + extra);\n        dy3 = u_Expand;\n        if (capType >= CAP_BUTT) {\n            dy2 -= u_Expand + extra;\n        }\n        }\n    }\n    } else if (type >= JOINT_CAP_ROUND && type < JOINT_CAP_ROUND + 1.5) {\n    if (inner > 0.5) {\n        dy = -dy;\n        inner = 0.0;\n    }\n    vec2 d2 = abs(dy) * forward;\n    if (a_VertexNum < 4.5) {\n        dy = -dy;\n        pos = dy * norm;\n    } else if (a_VertexNum < 5.5) {\n        pos = dy * norm;\n    } else if (a_VertexNum < 6.5) {\n        pos = dy * norm + d2;\n        v_Arc.x = abs(dy);\n    } else {\n        dy = -dy;\n        pos = dy * norm + d2;\n        v_Arc.x = abs(dy);\n    }\n    dy2 = 0.0;\n    v_Arc.y = dy;\n    v_Arc.z = 0.0;\n    v_Arc.w = lineWidth;\n    v_Type = 3.0;\n    } else if (abs(D) < 0.01) {\n    pos = dy * norm;\n    } else {\n    if (type >= ROUND && type < ROUND + 1.5) {\n        if (inner > 0.5) {\n        dy = -dy;\n        inner = 0.0;\n        }\n        if (a_VertexNum < 4.5) {\n        pos = doBisect(norm, len, norm2, len2, -dy, 1.0);\n        } else if (a_VertexNum < 5.5) {\n        pos = dy * norm;\n        } else if (a_VertexNum > 7.5) {\n        pos = dy * norm2;\n        } else {\n        pos = doBisect(norm, len, norm2, len2, dy, 0.0);\n        float d2 = abs(dy);\n        if (length(pos) > abs(dy) * 1.5) {\n            if (a_VertexNum < 6.5) {\n            pos.x = dy * norm.x - d2 * norm.y;\n            pos.y = dy * norm.y + d2 * norm.x;\n            } else {\n            pos.x = dy * norm2.x + d2 * norm2.y;\n            pos.y = dy * norm2.y - d2 * norm2.x;\n            }\n        }\n        }\n        vec2 norm3 = normalize(norm + norm2);\n        float sign = step(0.0, dy) * 2.0 - 1.0;\n        v_Arc.x = sign * dot(pos, norm3);\n        v_Arc.y = pos.x * norm3.y - pos.y * norm3.x;\n        v_Arc.z = dot(norm, norm3) * lineWidth;\n        v_Arc.w = lineWidth;\n        dy = -sign * dot(pos, norm);\n        dy2 = -sign * dot(pos, norm2);\n        dy3 = v_Arc.z - v_Arc.x;\n        v_Type = 3.0;\n    } else {\n        float hit = 0.0;\n        if (type >= BEVEL && type < BEVEL + 1.5) {\n        if (dot(norm, norm2) > 0.0) {\n            type = MITER;\n        }\n        }\n        if (type >= MITER && type < MITER + 3.5) {\n        if (inner > 0.5) {\n            dy = -dy;\n            inner = 0.0;\n        }\n        float sign = step(0.0, dy) * 2.0 - 1.0;\n        pos = doBisect(norm, len, norm2, len2, dy, 0.0);\n        if (length(pos) > abs(dy) * u_MiterLimit) {\n            type = BEVEL;\n        } else {\n            if (a_VertexNum < 4.5) {\n            dy = -dy;\n            pos = doBisect(norm, len, norm2, len2, dy, 1.0);\n            } else if (a_VertexNum < 5.5) {\n            pos = dy * norm;\n            } else if (a_VertexNum > 6.5) {\n            pos = dy * norm2;\n            }\n            v_Type = 1.0;\n            dy = -sign * dot(pos, norm);\n            dy2 = -sign * dot(pos, norm2);\n            hit = 1.0;\n        }\n        }\n        if (type >= BEVEL && type < BEVEL + 1.5) {\n        if (inner > 0.5) {\n            dy = -dy;\n            inner = 0.0;\n        }\n        float d2 = abs(dy);\n        vec2 pos3 = vec2(dy * norm.x - d2 * norm.y, dy * norm.y + d2 * norm.x);\n        vec2 pos4 = vec2(dy * norm2.x + d2 * norm2.y, dy * norm2.y - d2 * norm2.x);\n        if (a_VertexNum < 4.5) {\n            pos = doBisect(norm, len, norm2, len2, -dy, 1.0);\n        } else if (a_VertexNum < 5.5) {\n            pos = dy * norm;\n        } else if (a_VertexNum > 7.5) {\n            pos = dy * norm2;\n        } else {\n            if (a_VertexNum < 6.5) {\n            pos = pos3;\n            } else {\n            pos = pos4;\n            }\n        }\n        vec2 norm3 = normalize(norm + norm2);\n        float sign = step(0.0, dy) * 2.0 - 1.0;\n        dy = -sign * dot(pos, norm);\n        dy2 = -sign * dot(pos, norm2);\n        dy3 = (-sign * dot(pos, norm3)) + lineWidth;\n        v_Type = 4.0;\n        hit = 1.0;\n        }\n        if (hit < 0.5) {\n        gl_Position = vec4(0.0, 0.0, 0.0, 1.0);\n        return;\n        }\n    }\n    }\n    pos += base;\n    v_Distance = vec4(dy, dy2, dy3, lineWidth) * u_DevicePixelRatio;\n    v_Arc = v_Arc * u_DevicePixelRatio;\n    v_Travel = a_Travel + dot(pos - pointA, vec2(-norm.y, norm.x));\n}\n\npos += u_Anchor;\n\ngl_Position = u_ProjectionMatrix * u_ViewMatrix * vec4(pos, u_ZIndex, 1.0);\n\nsetPickingColor(u_PickingColor.xyz);\n}",Jh="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  bool u_IsOrtho;\n};\nlayout(std140) uniform ub_ObjectParams {\n  mat4 u_ModelMatrix;\n  vec4 u_Color;\n  vec4 u_StrokeColor;\n  float u_StrokeWidth;\n  float u_Opacity;\n  float u_FillOpacity;\n  float u_StrokeOpacity;\n  float u_Expand;\n  float u_MiterLimit;\n  float u_ScaleMode;\n  float u_Alignment;\n  vec4 u_PickingColor;\n  float u_Dash;\n  float u_Gap;\n  vec2 u_Anchor;\n  float u_DashOffset;\n  float u_Visible;\n  float u_ZIndex;\n};\n\nvarying vec4 v_Distance;\nvarying vec4 v_Arc;\nvarying float v_Type;\nvarying float v_Travel;\n\nvarying vec4 v_PickingResult;\n\nvoid main(){\n  if (u_Visible < 1.0) {\n    discard;\n  }\n\n  gbuf_picking = vec4(v_PickingResult.rgb, 1.0);\n\n  float alpha = 1.0;\n  float lineWidth = v_Distance.w;\n  if (v_Type < 0.5) {\n    float left = max(v_Distance.x - 0.5, -v_Distance.w);\n    float right = min(v_Distance.x + 0.5, v_Distance.w);\n    float near = v_Distance.y - 0.5;\n    float far = min(v_Distance.y + 0.5, 0.0);\n    float top = v_Distance.z - 0.5;\n    float bottom = min(v_Distance.z + 0.5, 0.0);\n    alpha = max(right - left, 0.0) * max(bottom - top, 0.0) * max(far - near, 0.0);\n  } else if (v_Type < 1.5) {\n    float a1 = clamp(v_Distance.x + 0.5 - lineWidth, 0.0, 1.0);\n    float a2 = clamp(v_Distance.x + 0.5 + lineWidth, 0.0, 1.0);\n    float b1 = clamp(v_Distance.y + 0.5 - lineWidth, 0.0, 1.0);\n    float b2 = clamp(v_Distance.y + 0.5 + lineWidth, 0.0, 1.0);\n    alpha = a2 * b2 - a1 * b1;\n  } else if (v_Type < 2.5) {\n    alpha *= max(min(v_Distance.x + 0.5, 1.0), 0.0);\n    alpha *= max(min(v_Distance.y + 0.5, 1.0), 0.0);\n    alpha *= max(min(v_Distance.z + 0.5, 1.0), 0.0);\n  } else if (v_Type < 3.5) {\n    float a1 = clamp(v_Distance.x + 0.5 - lineWidth, 0.0, 1.0);\n    float a2 = clamp(v_Distance.x + 0.5 + lineWidth, 0.0, 1.0);\n    float b1 = clamp(v_Distance.y + 0.5 - lineWidth, 0.0, 1.0);\n    float b2 = clamp(v_Distance.y + 0.5 + lineWidth, 0.0, 1.0);\n    float alpha_miter = a2 * b2 - a1 * b1;\n    float alpha_plane = max(min(v_Distance.z + 0.5, 1.0), 0.0);\n    float d = length(v_Arc.xy);\n    float circle_hor = max(min(v_Arc.w, d + 0.5) - max(-v_Arc.w, d - 0.5), 0.0);\n    float circle_vert = min(v_Arc.w * 2.0, 1.0);\n    float alpha_circle = circle_hor * circle_vert;\n    alpha = min(alpha_miter, max(alpha_circle, alpha_plane));\n  } else {\n    float a1 = clamp(v_Distance.x + 0.5 - lineWidth, 0.0, 1.0);\n    float a2 = clamp(v_Distance.x + 0.5 + lineWidth, 0.0, 1.0);\n    float b1 = clamp(v_Distance.y + 0.5 - lineWidth, 0.0, 1.0);\n    float b2 = clamp(v_Distance.y + 0.5 + lineWidth, 0.0, 1.0);\n    alpha = a2 * b2 - a1 * b1;\n    alpha *= max(min(v_Distance.z + 0.5, 1.0), 0.0);\n  }\n\n  if (u_Dash + u_Gap > 1.0) {\n    float travel = mod(v_Travel + u_Gap * 0.5 + u_DashOffset, u_Dash + u_Gap) - (u_Gap * 0.5);\n    float left = max(travel - 0.5, -0.5);\n    float right = min(travel + 0.5, u_Gap + 0.5);\n    alpha *= max(0.0, right - left);\n  }\n\n  gl_FragColor = u_StrokeColor * alpha;\n  gl_FragColor.a = gl_FragColor.a * u_StrokeOpacity;\n}";!function(e){e[e.NONE=0]="NONE",e[e.FILL=1]="FILL",e[e.JOINT_BEVEL=4]="JOINT_BEVEL",e[e.JOINT_MITER=8]="JOINT_MITER",e[e.JOINT_ROUND=12]="JOINT_ROUND",e[e.JOINT_CAP_BUTT=16]="JOINT_CAP_BUTT",e[e.JOINT_CAP_SQUARE=18]="JOINT_CAP_SQUARE",e[e.JOINT_CAP_ROUND=20]="JOINT_CAP_ROUND",e[e.FILL_EXPAND=24]="FILL_EXPAND",e[e.CAP_BUTT=32]="CAP_BUTT",e[e.CAP_SQUARE=64]="CAP_SQUARE",e[e.CAP_ROUND=96]="CAP_ROUND",e[e.CAP_BUTT2=128]="CAP_BUTT2"}($h||($h={}));var ef=function(e){_s(n,e);var t=As(n);function n(){var e;ds(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).vert=Qh,e.frag=Jh,e}return n}(Ph);ef.a_Prev=0,ef.a_Point1=1,ef.a_Point2=2,ef.a_Next=3,ef.a_VertexJoint=4,ef.a_VertexNum=5,ef.a_Travel=6,ef.ub_ObjectParams=1;var tf=function(e){_s(n,e);var t=As(n);function n(){var e;ds(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).program=new ef,e.instanced=!1,e.needFill=!1,e.triangles=void 0,e}return vs(n,[{key:"validate",value:function(e){return!1}},{key:"buildGeometry",value:function(){var e=this.geometry,t=this.updateBuffer(this.instance),n=t.triangles,r=t.pointsBuffer,i=t.travelBuffer,o=t.instanceCount;n&&n.length&&(this.needFill=!0,this.triangles=n),e.setVertexBuffer({bufferIndex:0,byteStride:48,frequency:2,attributes:[{format:ws.F32_RG,bufferByteOffset:0,byteStride:12,location:ef.a_Prev,divisor:1},{format:ws.F32_RG,bufferByteOffset:12,byteStride:12,location:ef.a_Point1,divisor:1},{format:ws.F32_R,bufferByteOffset:20,byteStride:12,location:ef.a_VertexJoint,divisor:1},{format:ws.F32_RG,bufferByteOffset:24,byteStride:12,location:ef.a_Point2,divisor:1},{format:ws.F32_RG,bufferByteOffset:36,byteStride:12,location:ef.a_Next,divisor:1}],data:new Float32Array(r)}),e.setVertexBuffer({bufferIndex:1,byteStride:4,frequency:2,attributes:[{format:ws.F32_R,bufferByteOffset:0,byteStride:4,location:ef.a_VertexNum,divisor:0}],data:new Float32Array([0,1,2,3,4,5,6,7,8])}),e.setVertexBuffer({bufferIndex:2,byteStride:4,frequency:2,attributes:[{format:ws.F32_R,bufferByteOffset:0,byteStride:4,location:ef.a_Travel,divisor:1}],data:new Float32Array(i)}),e.vertexCount=15,e.maxInstancedCount=o,e.setIndices(new Uint32Array([0,2,1,0,3,2,4,6,5,4,7,6,4,7,8]))}},{key:"afterRender",value:function(e){this.instance.parsedStyle.fill,this.needFill}},{key:"changeRenderOrder",value:function(e,t){this.geometryDirty=!0}},{key:"updateAttribute",value:function(e,t,r){bs(ys(n.prototype),"updateAttribute",this).call(this,e,t,r),("lineJoin"===t||"lineCap"===t||e.nodeName===tn.Line&&("x1"===t||"y1"===t||"x2"===t||"y2"===t)||e.nodeName===tn.Polyline&&"points"===t||e.nodeName===tn.Polygon&&"points"===t||e.nodeName===tn.Path&&"path"===t)&&(this.geometryDirty=!0)}},{key:"uploadUBO",value:function(e){var t=this.objects[0],n=t.parsedStyle,r=n.fill,i=n.stroke,o=n.opacity,a=n.fillOpacity,s=n.strokeOpacity,u=n.lineWidth,c=n.anchor,l=n.lineDash,h=void 0===l?[]:l,f=n.lineDashOffset,d=void 0===f?0:f,p=n.visibility,v=[0,0,0,0];(null==r?void 0:r.type)===Oi.Constant&&(v=r.value);var g=[0,0,0,0];(null==i?void 0:i.type)===Oi.Constant&&(g=i.value);var _=t.renderable3D.encodedPickingColor,y=0,m=0,E=t.getGeometryBounds();if(E){var T=E.halfExtents;y=-T[0]*c[0]*2,m=-T[1]*c[1]*2}var R=e.allocateUniformBuffer(ef.ub_ObjectParams,44),A=e.mapUniformBufferF32(ef.ub_ObjectParams);R+=$l(A,R,t.getWorldTransform()),R+=Zl.apply(void 0,[A,R].concat(Cs(v))),R+=Zl.apply(void 0,[A,R].concat(Cs(g))),R+=Zl(A,R,u,o,a,s),R+=Zl(A,R,1,5,1,.5),R+=Zl.apply(void 0,[A,R].concat(Cs(_))),R+=Zl(A,R,h[0]||0,h[1]||0,y,m),R+=Zl(A,R,d,"visible"===p?1:0,t.sortable.renderOrder*xh),e.setMegaStateFlags({cullMode:0})}},{key:"updateBuffer",value:function(e){var t=e.parsedStyle,n=t.lineCap,r=t.lineJoin,i=t.defX,o=t.defY,a=t.lineDash,s=[],u=[];if(e.nodeName===tn.Polyline||e.nodeName===tn.Polygon)s=e.parsedStyle.points.points.reduce((function(e,t){return e.push(t[0]-i,t[1]-o),e}),[]),e.nodeName===tn.Polygon&&(s.push(s[0],s[1]),u=us()(s,[],2));else if(e.nodeName===tn.Path){var c,l=e.parsedStyle.path,h=l.curve,f=l.totalLength;h.forEach((function(e){var t,n=Ms(t=e)||Ps(t)||Ns(t)||Bs(),r=n[0],a=n.slice(1);"M"===r?(s.push(a[0]-i,a[1]-o),c=[a[0]-i,a[1]-o]):"C"===r?function(e,t,n,r,i,o,a,s){var u=s[s.length-2],c=s[s.length-1];s.length-=2;var l=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;return!e||isNaN(e)?t:Math.ceil(e/10)}(a),h=0,f=0,d=0,p=0,v=0;s.push(u,c);for(var g=1,_=0;g<=l;++g)d=(f=(h=1-(_=g/l))*h)*h,v=(p=_*_)*_,s.push(d*u+3*f*_*e+3*h*p*n+v*i,d*c+3*f*_*t+3*h*p*r+v*o)}(a[0]-i,a[1]-o,a[2]-i,a[3]-o,a[4]-i,a[5]-o,f,s):"Z"===r&&s.push(c[0],c[1])}))}var d=this.jointType(r),p=this.capType(n),v=p;p===$h.CAP_ROUND&&(v=$h.JOINT_CAP_ROUND),p===$h.CAP_BUTT&&(v=$h.JOINT_CAP_BUTT),p===$h.CAP_SQUARE&&(v=$h.JOINT_CAP_SQUARE);for(var g=3*(Math.round(0)+2),_=!ce(a),y=0,m=[],E=[],T=0;T<s.length;T+=2)_?(T>1&&(y+=Math.sqrt(Math.pow(s[T]-s[T-2],2)+Math.pow(s[T+1]-s[T+1-2],2))),E.push(0,y,y,0,y,y,y,y,y)):E.push(0,0,0,0,0,0,0,0,0),m[g++]=s[T],m[g++]=s[T+1],m[g]=d,0==T&&p!==$h.CAP_ROUND&&(m[g]+=p),T+4>=s.length?m[g]+=v-d:T+2>=s.length&&(m[g]=0),g++;return m[g++]=s[s.length-4],m[g++]=s[s.length-3],m[g++]=0,m[0]=s[0],m[1]=s[1],m[2]=0,m[3]=s[2],m[4]=s[3],m[5]=p===$h.CAP_ROUND?p:0,{pointsBuffer:m,travelBuffer:E,triangles:u,instanceCount:Math.round(s.length/2)}}},{key:"jointType",value:function(e){var t;switch(e){case"bevel":t=$h.JOINT_BEVEL;break;case"round":t=$h.JOINT_ROUND;break;default:t=$h.JOINT_MITER}return t}},{key:"capType",value:function(e){var t;switch(e){case"square":t=$h.CAP_SQUARE;break;case"round":t=$h.CAP_ROUND;break;default:t=$h.CAP_BUTT}return t}}]),n}(Mh);tf=a([B({token:[{token:Jl,named:tn.Polyline},{token:Jl,named:tn.Path},{token:Jl,named:tn.Polygon}]})],tf);var nf,rf="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  bool u_IsOrtho;\n};\n\nlayout(location = 0) attribute vec4 a_ModelMatrix0;\nlayout(location = 1) attribute vec4 a_ModelMatrix1;\nlayout(location = 2) attribute vec4 a_ModelMatrix2;\nlayout(location = 3) attribute vec4 a_ModelMatrix3;\nlayout(location = 4) attribute vec4 a_Color;\nlayout(location = 5) attribute vec4 a_StrokeColor;\nlayout(location = 6) attribute vec4 a_StylePacked1;\nlayout(location = 7) attribute vec4 a_StylePacked2;\nlayout(location = 8) attribute vec4 a_PickingColor;\nlayout(location = 9) attribute vec2 a_Anchor;\n// layout(location = {AttributeLocation.a_Uv}) attribute vec2 a_Uv;\n\nvarying vec4 v_PickingResult;\nvarying vec4 v_Color;\nvarying vec4 v_StrokeColor;\nvarying vec4 v_StylePacked1;\nvarying vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nlayout(location = 10) attribute vec3 a_Position;\nlayout(location = 11) attribute vec3 a_PointA;\nlayout(location = 12) attribute vec3 a_PointB;\nlayout(location = 13) attribute float a_Cap;\n#ifdef USE_UV\n  layout(location = 14) attribute vec2 a_Uv;\n  varying vec2 v_Uv;\n#endif\nlayout(location = 15) attribute vec3 a_Dash;\n\nvarying vec4 v_Dash;\n// varying vec2 v_Normal;\n\nvoid main() {\n  mat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n#ifdef CLIPSPACE_NEAR_ZERO\n    gl_Position.z = gl_Position.z * 0.5 + 0.5;\n#endif\n  #ifdef USE_UV\n  v_Uv = a_Uv;\n  #ifdef VIEWPORT_ORIGIN_TL\n    v_Uv.y = 1.0 - v_Uv.y;\n  #endif\n#endif\n\n  // vec2 xBasis = a_PointB.xy - a_PointA.xy;\n  // vec2 yBasis = normalize(vec2(-xBasis.y, xBasis.x));\n\n  // vec2 point = a_PointA.xy + xBasis * a_Position.x + yBasis * u_StrokeWidth * a_Position.y;\n  // point = point - a_Anchor.xy * abs(xBasis);\n\n  // // round & square\n  // if (a_Cap > 1.0) {\n  //   point += sign(a_Position.x - 0.5) * normalize(xBasis) * vec2(u_StrokeWidth / 2.0);\n  // }\n\n  // gl_Position = project(vec4(point, u_ZIndex, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n\n  // clip space\n  vec4 clip0 = project(vec4(a_PointA, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  vec4 clip1 = project(vec4(a_PointB, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  // screen space\n  vec2 screen0 = u_Viewport * (0.5 * clip0.xy / clip0.w + 0.5);\n  vec2 screen1 = u_Viewport * (0.5 * clip1.xy / clip1.w + 0.5);\n  vec2 xBasis = normalize(screen1 - screen0);\n  vec2 yBasis = vec2(-xBasis.y, xBasis.x);\n  vec2 pt0 = screen0 + u_StrokeWidth * (a_Position.x * xBasis + a_Position.y * yBasis);\n  vec2 pt1 = screen1 + u_StrokeWidth * (a_Position.x * xBasis + a_Position.y * yBasis);\n  vec2 pt = mix(pt0, pt1, a_Position.z);\n  vec4 clip = mix(clip0, clip1, a_Position.z);\n  gl_Position = vec4(clip.w * (2.0 * pt / u_Viewport - 1.0), clip.z, clip.w);\n\n  v_Dash = vec4(a_Position.x, a_Dash);\n}",of="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  bool u_IsOrtho;\n};\n\nvarying vec4 v_PickingResult;\nvarying vec4 v_Color;\nvarying vec4 v_StrokeColor;\nvarying vec4 v_StylePacked1;\nvarying vec4 v_StylePacked2;\n#ifdef USE_UV\n  varying vec2 v_Uv;\n#endif\n#ifdef USE_MAP\n  uniform sampler2D u_Map;\n#endif\n\nvarying vec4 v_Dash;\n// varying vec2 v_Normal;\n\nvoid main() {\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\n\ngbuf_picking = vec4(v_PickingResult.rgb, 1.0);\n\nif (u_Visible < 1.0) {\n    discard;\n}\n  #ifdef USE_MAP\n  vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n  u_Color = texelColor;\n#endif\n\n  gl_FragColor = u_StrokeColor;\n  #ifdef USE_MAP\n      gl_FragColor = u_Color;\n  #endif\n\n  // float blur = 1. - smoothstep(0.98, 1., length(v_Normal));\n  float u_dash_offset = v_Dash.y;\n  float u_dash_array = v_Dash.z;\n  float u_dash_ratio = v_Dash.w;\n  gl_FragColor.a = gl_FragColor.a\n    // * blur\n    * u_Opacity\n    * ceil(mod(v_Dash.x + u_dash_offset, u_dash_array) - (u_dash_array * u_dash_ratio));\n}",af=[0,-.5,0,0,0,1,-.5,1,1,0,1,.5,1,1,1,0,.5,0,0,1],sf=function(e){_s(n,e);var t=As(n);function n(){var e;ds(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).vert=rf,e.frag=of,e}return n}(Ph);sf.a_Position=bh.MAX,sf.a_PointA=bh.MAX+1,sf.a_PointB=bh.MAX+2,sf.a_Cap=bh.MAX+3,sf.a_Uv=bh.MAX+4,sf.a_Dash=bh.MAX+5,sf.ub_ObjectParams=1;var uf=(gs(nf={},"butt",1),gs(nf,"round",2),gs(nf,"square",3),nf),cf=function(e){_s(n,e);var t=As(n);function n(){var e;ds(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).program=new sf,e}return vs(n,[{key:"validate",value:function(e){var t=this.instance;if(t.nodeName===tn.Line){var n=t.parsedStyle.stroke,r=e.parsedStyle.stroke;if(n.type!==r.type)return!1;if(n.type!==Oi.Constant&&r.type!==Oi.Constant)return n.value.hash===r.value.hash}return!0}},{key:"buildGeometry",value:function(){var e=this,t=[],n=[],r=0;this.objects.forEach((function(i){var o=i.parsedStyle,a=o.x1,s=o.y1,u=o.x2,c=o.y2,l=o.z1,h=o.z2,f=o.defX,d=o.defY,p=o.lineCap,v=e.calcDash(i),g=v.dashOffset,_=v.dashSegmentPercent,y=v.dashRatioInEachSegment;t.push(a-f,s-d,l,u-f,c-d,h,uf[p],g,_,y),n.push(0+r,2+r,1+r,0+r,3+r,2+r),r+=4})),this.geometry.setIndices(new Uint32Array(n)),this.geometry.vertexCount=6,this.geometry.setVertexBuffer({bufferIndex:1,byteStride:20,frequency:2,attributes:[{format:ws.F32_RGB,bufferByteOffset:0,location:sf.a_Position,divisor:0},{format:ws.F32_RG,bufferByteOffset:12,location:sf.a_Uv,divisor:0}],data:new Float32Array(af)}),this.geometry.setVertexBuffer({bufferIndex:2,byteStride:40,frequency:2,attributes:[{format:ws.F32_RGB,bufferByteOffset:0,location:sf.a_PointA,divisor:1},{format:ws.F32_RGB,bufferByteOffset:12,location:sf.a_PointB,divisor:1},{format:ws.F32_R,bufferByteOffset:24,location:sf.a_Cap,divisor:1},{format:ws.F32_RGB,bufferByteOffset:28,location:sf.a_Dash,divisor:1}],data:new Float32Array(t)})}},{key:"updateAttribute",value:function(e,t,r){bs(ys(n.prototype),"updateAttribute",this).call(this,e,t,r);var i=this.geometry,o=this.objects.indexOf(e),a=e.parsedStyle,s=a.x1,u=a.y1,c=a.x2,l=a.y2,h=a.z1,f=a.z2,d=a.defX,p=a.defY,v=a.lineCap;if("x1"===t||"y1"===t||"x2"===t||"y2"===t||"z1"===t||"z2"===t)i.updateVertexBuffer(2,sf.a_PointA,o,new Uint8Array(new Float32Array([s-d,u-p,h,c-d,l-p,f]).buffer));else if("lineDashOffset"===t||"lineDash"===t){var g=this.calcDash(e),_=g.dashOffset,y=g.dashSegmentPercent,m=g.dashRatioInEachSegment;i.updateVertexBuffer(2,sf.a_Dash,o,new Uint8Array(new Float32Array([_,y,m]).buffer))}else"lineCap"===t&&i.updateVertexBuffer(2,sf.a_Cap,o,new Uint8Array(new Float32Array([uf[v]]).buffer))}},{key:"uploadUBO",value:function(e){e.setBindingLayouts([{numUniformBuffers:1,numSamplers:1}]),e.setSamplerBindingsFromTextureMappings([this.fillMapping])}},{key:"calcDash",value:function(e){var t=e.parsedStyle,n=t.lineDash,r=t.lineDashOffset,i=void 0===r?0:r,o=e.getTotalLength(),a=0,s=1,u=0;if(n&&n.length){a=i/o;var c=n.reduce((function(e,t){return e+t}),0);s=c/o,u=n[0]/c}return{dashOffset:a,dashSegmentPercent:s,dashRatioInEachSegment:u}}}]),n}(Mh);cf=a([B({token:{token:Jl,named:tn.Line}})],cf);var lf=["style"],hf=function(e){_s(n,e);var t=As(n);function n(e){var r=e.style,i=Es(e,lf);return ds(this,n),t.call(this,ls({type:n.tag,style:ls({},r)},i))}return vs(n,[{key:"destroy",value:function(){bs(ys(n.prototype),"destroy",this).call(this)}}]),n}(si);hf.tag="mesh";var ff,df;!function(e){e.TEXTURE_LOADED="texture-loaded"}(ff||(ff={})),function(e){e[e.NONE=0]="NONE",e[e.EXP=1]="EXP",e[e.EXP2=2]="EXP2",e[e.LINEAR=3]="LINEAR"}(df||(df={})),z.EventEmitter;var pf=function(e){_s(n,e);var t=As(n);function n(){var e;ds(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).program=new Ph,e.textureMappings=[],e.lightPool=void 0,e.materialDirty=!0,e}return vs(n,[{key:"validate",value:function(e){return this.instance.nodeName!==hf.tag||this.instance.parsedStyle.material===e.parsedStyle.material&&this.instance.parsedStyle.geometry===e.parsedStyle.geometry}},{key:"beforeRender",value:function(){var e=this,t=this.instance.style.material;if(t.dirty||this.materialDirty){this.textureMappings=[];var n=this.lightPool.getAll();!!n.length&&(t.defines.USE_LIGHT=!0,t.defines.NUM_DIR_LIGHTS=n.length),Object.keys(t.defines).forEach((function(n){var r=t.defines[n];"number"==typeof r?e.program.setDefineString(n,"".concat(r)):e.program.setDefineBool(n,r)})),this.program.vert=t.props.vertexShader,this.program.frag=t.props.fragmentShader,this.program.dirty=!0,t.textures.forEach((function(t){var n=t.name,r=t.texture,i=new _h,o=r.descriptor,a=o.src,s=o.sampler,u=o.flipY;i.texture=e.texturePool.getOrCreateTexture(e.device,a,ls(ls({},Js(ws.U8_RGBA_NORM,1,1,1)),{},{flipY:u}),(function(){e.objects.forEach((function(t){t.renderable.dirty=!0,e.renderingService.dirtify()}))})),e.device.setResourceName(i.texture,"Material Texture "+n),i.sampler=e.renderHelper.getCache().createSampler(s),e.textureMappings.push(i)})),t.dirty=!1,this.materialDirty=!1}}},{key:"buildGeometry",value:function(){var e=this,t=this.instance,n=t.style.geometry,r=t.style.material;if(n.build(this.objects),this.geometry.inputLayoutDescriptor.vertexBufferDescriptors[0],r.props.wireframe){for(var i=n.indices,o=n.indices.length,a=1;a<n.vertexBuffers.length;a++){var s=n.inputLayoutDescriptor.vertexBufferDescriptors[a].byteStride;n.vertexBuffers[a]=new Float32Array(s/4*o)}for(var u=0,c=new Uint32Array(o),l=0;l<o;l++){for(var h=i[l],f=1;f<n.vertexBuffers.length;f++)for(var d=n.inputLayoutDescriptor.vertexBufferDescriptors[f].byteStride/4,p=0;p<d;p++)n.vertexBuffers[f][u*d+p]=n.vertexBuffers[f][h*d+p];c[l]=u,u++}for(var v=new Float32Array(3*o),g=0;g<o;)for(var _=0;_<3;_++)v[3*c[g++]+_]=1;n.setVertexBuffer({bufferIndex:4,byteStride:12,frequency:1,attributes:[{format:ws.F32_RGB,bufferByteOffset:0,location:13}],data:v}),n.setIndices(c)}this.geometry.setIndices(n.indices),this.geometry.vertexCount=n.vertexCount,this.geometry.maxInstancedCount=n.instancedCount,this.geometry.inputLayoutDescriptor=n.inputLayoutDescriptor,n.vertexBuffers.forEach((function(t,n){var r=vh(e.device,2,t.buffer);e.geometry.vertexBuffers[n]=r}))}},{key:"updateAttribute",value:function(e,t,r){bs(ys(n.prototype),"updateAttribute",this).call(this,e,t,r),this.objects.indexOf(e),this.instance.style.geometry}},{key:"uploadUBO",value:function(e){var t=this.instance.style.material,n=0,r=this.lightPool.getAll();n+=t.getUniformWordCount(),t.defines.USE_FOG&&(n+=8),t.defines.USE_LIGHT&&(n+=r.reduce((function(e,t){return e+t.getUniformWordCount()}),0)),t.defines.USE_BUMPMAP&&(n+=4);var i=e.allocateUniformBuffer(1,n),o=e.mapUniformBufferF32(1),a=t.props,s=a.emissive,u=a.shininess,c=a.specular,l=co(s).value,h=co(c).value;if(i+=Zl(o,i,l[0],l[1],l[2],u),i+=Zl.apply(void 0,[o,i].concat(Cs(h))),i+=Zl(o,i,0,0,0,0),t.defines.USE_FOG){var f=t.props,d=f.fogType,p=void 0===d?df.NONE:d,v=f.fogColor,g=void 0===v?"black":v,_=f.fogStart,y=void 0===_?1:_,m=f.fogEnd,E=void 0===m?1e3:m,T=f.fogDensity,R=void 0===T?0:T,A=co(g).value;i+=Zl(o,i,p,y,E,R),i+=Zl.apply(void 0,[o,i].concat(Cs(A)))}if(t.defines.USE_LIGHT&&r.forEach((function(e){var t=e.parsedStyle,n=t.fill,r=t.direction,a=t.intensity;if((null==n?void 0:n.type)===Oi.Constant){var s=n.value;i+=Zl.apply(void 0,[o,i].concat(Cs(r),[a])),i+=Zl.apply(void 0,[o,i].concat(Cs(s)))}})),t.defines.USE_BUMPMAP){var S=t.props.bumpScale;i+=Zl(o,i,S)}var b=t.props,x=b.depthCompare,C=b.depthWrite,M=b.stencilCompare,P=b.stencilWrite,N=b.stencilPassOp,O=b.cullMode,B=b.frontFace,I=b.polygonOffset,D=b.blendEquation,F=b.blendEquationAlpha,w=b.blendSrc,L=b.blendDst,k=b.blendSrcAlpha,U=b.blendDstAlpha;e.setMegaStateFlags({attachmentsState:[{channelWriteMask:15,rgbBlendState:{blendMode:D,blendSrcFactor:w,blendDstFactor:L},alphaBlendState:{blendMode:F,blendSrcFactor:k,blendDstFactor:U}}],depthCompare:x,depthWrite:C,stencilCompare:M,stencilWrite:P,stencilPassOp:N,cullMode:O,frontFace:B,polygonOffset:I}),e.setBindingLayouts([{numUniformBuffers:1,numSamplers:this.textureMappings.length}]),e.setSamplerBindingsFromTextureMappings(this.textureMappings)}}]),n}(Mh);a([D(ch),s("design:type",ch)],pf.prototype,"lightPool",void 0),pf=a([B({token:[{token:Jl,named:hf.tag}]})],pf);var vf=X((function(e){e(Xl),e(Sh),e(ch),e(zh),e(Fs),e(dh),e(ph),e(Dh),e(kh),e(cf),e(tf),e(Zh),e(pf),e({token:Ql,useFactory:function(e){return function(t){return e.container.isBoundNamed(Jl,t)&&e.container.getNamed(Jl,t)||null}}})})),gf=function(){function e(t){ds(this,e),this.options=void 0,this.options=t}return vs(e,[{key:"init",value:function(e){e.register({token:Hs,useValue:ls({targets:["webgl2","webgl1"]},this.options)}),e.load(vf,!0)}},{key:"destroy",value:function(e){e.remove(Xl),e.remove(Sh),e.remove(zh),e.remove(Fs),e.remove(Dh),e.remove(kh),e.remove(cf),e.remove(tf),e.remove(Zh),e.remove(Jl),e.remove(Ql),e.remove(dh),e.remove(ph),e.remove(Hs)}}]),e}(),_f="undefined"!=typeof window&&void 0!==window.document,yf=function(){function e(){}return e.prototype.init=function(){var e=this.canvasConfig.container;if(this.$container=re(e)?document.getElementById(e):e,this.$container){var t=document.createElement("canvas");this.$container.appendChild(t),this.$container.style.position||(this.$container.style.position="relative"),this.$canvas=t}},e.prototype.getDomElement=function(){return this.$canvas},e.prototype.getContext=function(){return this.context},e.prototype.getBoundingClientRect=function(){var e;return null===(e=this.$container)||void 0===e?void 0:e.getBoundingClientRect()},e.prototype.destroy=function(){this.$container&&this.$canvas&&this.$canvas.parentNode&&this.$container.removeChild(this.$canvas)},e.prototype.resize=function(e,t){if(this.$canvas){var n=this.getDPR();this.$canvas.width=n*e,this.$canvas.height=n*t,function(e,t,n){_f&&(e.style.width=t+"px",e.style.height=n+"px")}(this.$canvas,e,t)}},e.prototype.getDPR=function(){var e=window.devicePixelRatio||1;return e>=1?Math.ceil(e):1},e.prototype.applyCursorStyle=function(e){this.$container&&(this.$container.style.cursor=e)},a([D(cn),s("design:type",Object)],e.prototype,"canvasConfig",void 0),a([I({token:Sn})],e)}(),mf=X((function(e){e(yf)})),Ef=function(){function e(){}return e.prototype.init=function(e){e.load(mf,!0)},e.prototype.destroy=function(e){e.remove(yf)},e}(),Tf=function(e){function t(t){var n=e.call(this,t)||this;return n.registerPlugin(new Ef),n.registerPlugin(new gf),n.registerPlugin(new is),n}return r(t,e),t}(Ba);const Rf=(e,t)=>customElements.get(e)||customElements.define(e,t);class Af extends HTMLElement{gElement=null;connectedCallback(){if(this.parentElement.gElement){const e=this.callClass,t=Object.fromEntries(Array.from(this.attributes).map((e=>[e.name,Number.isNaN(Number(e.value))?e.value:Number(e.value)])));this.innerText&&(t.text=this.innerText),this.gElement=new e({style:t}),this.parentElement.gElement.appendChild(this.gElement)}}static get observedAttributes(){return["x","y","z","visibility","zIndex","cursor","width","height","zIndex","r","path","points","fill","stroke","opacity","text"]}attributeChangedCallback(e,t,n){this.gElement&&this.gElement.attr(e,Number.isNaN(Number(n))?n:Number(n))}disconnectedCallback(){this.gElement.remove(),this.gElement=null}}Rf("g-circle",class extends Af{callClass=di}),Rf("g-ellipse",class extends Af{callClass=pi}),Rf("g-text",class extends Af{callClass=Ti}),Rf("g-rect",class extends Af{callClass=Ei}),Rf("g-path",class extends Af{callClass=_i}),Rf("g-polygon",class extends Af{callClass=yi});class Sf extends HTMLElement{renderer=new Tf;gElement=null;connectedCallback(){const{clientWidth:e,clientHeight:t}=this,n=this.attachShadow({mode:"closed"}),r=document.createElement("div");n.appendChild(r),this.gElement=new Ja({container:r,width:e||0,height:t||0,renderer:this.renderer})}}customElements.define("g-webgl",Sf)})()})();